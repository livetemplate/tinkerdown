"use strict";var LivepageClient=(()=>{var Yt=Object.create;var he=Object.defineProperty;var Xt=Object.getOwnPropertyDescriptor;var Qt=Object.getOwnPropertyNames;var Zt=Object.getPrototypeOf,er=Object.prototype.hasOwnProperty;var T=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),tr=(o,e)=>{for(var t in e)he(o,t,{get:e[t],enumerable:!0})},ot=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Qt(e))!er.call(o,n)&&n!==t&&he(o,n,{get:()=>e[n],enumerable:!(r=Xt(e,n))||r.enumerable});return o};var at=(o,e,t)=>(t=o!=null?Yt(Zt(o)):{},ot(e||!o||!o.__esModule?he(t,"default",{value:o,enumerable:!0}):t,o)),rr=o=>ot(he({},"__esModule",{value:!0}),o);var gt=T((Jr,pt)=>{"use strict";var lt=11;function nr(o,e){var t=e.attributes,r,n,i,a,s;if(!(e.nodeType===lt||o.nodeType===lt)){for(var l=t.length-1;l>=0;l--)r=t[l],n=r.name,i=r.namespaceURI,a=r.value,i?(n=r.localName||n,s=o.getAttributeNS(i,n),s!==a&&(r.prefix==="xmlns"&&(n=r.name),o.setAttributeNS(i,n,a))):(s=o.getAttribute(n),s!==a&&o.setAttribute(n,a));for(var c=o.attributes,d=c.length-1;d>=0;d--)r=c[d],n=r.name,i=r.namespaceURI,i?(n=r.localName||n,e.hasAttributeNS(i,n)||o.removeAttributeNS(i,n)):e.hasAttribute(n)||o.removeAttribute(n)}}var pe,ir="http://www.w3.org/1999/xhtml",O=typeof document>"u"?void 0:document,sr=!!O&&"content"in O.createElement("template"),or=!!O&&O.createRange&&"createContextualFragment"in O.createRange();function ar(o){var e=O.createElement("template");return e.innerHTML=o,e.content.childNodes[0]}function lr(o){pe||(pe=O.createRange(),pe.selectNode(O.body));var e=pe.createContextualFragment(o);return e.childNodes[0]}function cr(o){var e=O.createElement("body");return e.innerHTML=o,e.childNodes[0]}function dr(o){return o=o.trim(),sr?ar(o):or?lr(o):cr(o)}function ge(o,e){var t=o.nodeName,r=e.nodeName,n,i;return t===r?!0:(n=t.charCodeAt(0),i=r.charCodeAt(0),n<=90&&i>=97?t===r.toUpperCase():i<=90&&n>=97?r===t.toUpperCase():!1)}function ur(o,e){return!e||e===ir?O.createElement(o):O.createElementNS(e,o)}function hr(o,e){for(var t=o.firstChild;t;){var r=t.nextSibling;e.appendChild(t),t=r}return e}function Ue(o,e,t){o[t]!==e[t]&&(o[t]=e[t],o[t]?o.setAttribute(t,""):o.removeAttribute(t))}var ct={OPTION:function(o,e){var t=o.parentNode;if(t){var r=t.nodeName.toUpperCase();r==="OPTGROUP"&&(t=t.parentNode,r=t&&t.nodeName.toUpperCase()),r==="SELECT"&&!t.hasAttribute("multiple")&&(o.hasAttribute("selected")&&!e.selected&&(o.setAttribute("selected","selected"),o.removeAttribute("selected")),t.selectedIndex=-1)}Ue(o,e,"selected")},INPUT:function(o,e){Ue(o,e,"checked"),Ue(o,e,"disabled"),o.value!==e.value&&(o.value=e.value),e.hasAttribute("value")||o.removeAttribute("value")},TEXTAREA:function(o,e){var t=e.value;o.value!==t&&(o.value=t);var r=o.firstChild;if(r){var n=r.nodeValue;if(n==t||!t&&n==o.placeholder)return;r.nodeValue=t}},SELECT:function(o,e){if(!e.hasAttribute("multiple")){for(var t=-1,r=0,n=o.firstChild,i,a;n;)if(a=n.nodeName&&n.nodeName.toUpperCase(),a==="OPTGROUP")i=n,n=i.firstChild,n||(n=i.nextSibling,i=null);else{if(a==="OPTION"){if(n.hasAttribute("selected")){t=r;break}r++}n=n.nextSibling,!n&&i&&(n=i.nextSibling,i=null)}o.selectedIndex=t}}},ie=1,dt=11,ut=3,ht=8;function $(){}function pr(o){if(o)return o.getAttribute&&o.getAttribute("id")||o.id}function gr(o){return function(t,r,n){if(n||(n={}),typeof r=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var i=r;r=O.createElement("html"),r.innerHTML=i}else r=dr(r);else r.nodeType===dt&&(r=r.firstElementChild);var a=n.getNodeKey||pr,s=n.onBeforeNodeAdded||$,l=n.onNodeAdded||$,c=n.onBeforeElUpdated||$,d=n.onElUpdated||$,h=n.onBeforeNodeDiscarded||$,p=n.onNodeDiscarded||$,m=n.onBeforeElChildrenUpdated||$,x=n.skipFromChildren||$,y=n.addChild||function(g,f){return g.appendChild(f)},v=n.childrenOnly===!0,u=Object.create(null),A=[];function C(g){A.push(g)}function I(g,f){if(g.nodeType===ie)for(var M=g.firstChild;M;){var b=void 0;f&&(b=a(M))?C(b):(p(M),M.firstChild&&I(M,f)),M=M.nextSibling}}function w(g,f,M){h(g)!==!1&&(f&&f.removeChild(g),p(g),I(g,M))}function E(g){if(g.nodeType===ie||g.nodeType===dt)for(var f=g.firstChild;f;){var M=a(f);M&&(u[M]=f),E(f),f=f.nextSibling}}E(t);function S(g){l(g);for(var f=g.firstChild;f;){var M=f.nextSibling,b=a(f);if(b){var k=u[b];k&&ge(f,k)?(f.parentNode.replaceChild(k,f),R(k,f)):S(f)}else S(f);f=M}}function D(g,f,M){for(;f;){var b=f.nextSibling;(M=a(f))?C(M):w(f,g,!0),f=b}}function R(g,f,M){var b=a(f);if(b&&delete u[b],!M){var k=c(g,f);if(k===!1||(k instanceof HTMLElement&&(g=k,E(g)),o(g,f),d(g),m(g,f)===!1))return}g.nodeName!=="TEXTAREA"?H(g,f):ct.TEXTAREA(g,f)}function H(g,f){var M=x(g,f),b=f.firstChild,k=g.firstChild,q,B,z,de,P;e:for(;b;){for(de=b.nextSibling,q=a(b);!M&&k;){if(z=k.nextSibling,b.isSameNode&&b.isSameNode(k)){b=de,k=z;continue e}B=a(k);var ue=k.nodeType,F=void 0;if(ue===b.nodeType&&(ue===ie?(q?q!==B&&((P=u[q])?z===P?F=!1:(g.insertBefore(P,k),B?C(B):w(k,g,!0),k=P,B=a(k)):F=!1):B&&(F=!1),F=F!==!1&&ge(k,b),F&&R(k,b)):(ue===ut||ue==ht)&&(F=!0,k.nodeValue!==b.nodeValue&&(k.nodeValue=b.nodeValue))),F){b=de,k=z;continue e}B?C(B):w(k,g,!0),k=z}if(q&&(P=u[q])&&ge(P,b))M||y(g,P),R(P,b);else{var We=s(b);We!==!1&&(We&&(b=We),b.actualize&&(b=b.actualize(g.ownerDocument||O)),y(g,b),S(b))}b=de,k=z}D(g,k,B);var st=ct[g.nodeName];st&&st(g,f)}var L=t,ce=L.nodeType,it=r.nodeType;if(!v){if(ce===ie)it===ie?ge(t,r)||(p(t),L=hr(t,ur(r.nodeName,r.namespaceURI))):L=r;else if(ce===ut||ce===ht){if(it===ce)return L.nodeValue!==r.nodeValue&&(L.nodeValue=r.nodeValue),L;L=r}}if(L===r)p(t);else{if(r.isSameNode&&r.isSameNode(L))return;if(R(L,r,v),A)for(var Fe=0,Jt=A.length;Fe<Jt;Fe++){var $e=u[A[Fe]];$e&&w($e,$e.parentNode,!1)}}return!v&&L!==t&&t.parentNode&&(L.actualize&&(L=L.actualize(t.ownerDocument||O)),t.parentNode.replaceChild(L,t)),L}}var fr=gr(nr);pt.exports=fr});var ft=T(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.FOCUSABLE_INPUTS=void 0;fe.FOCUSABLE_INPUTS=["text","textarea","number","email","password","search","tel","url","date","time","datetime-local","color","range"]});var vt=T(me=>{"use strict";Object.defineProperty(me,"__esModule",{value:!0});me.FocusManager=void 0;var mt=ft(),je=class{constructor(e){this.logger=e,this.wrapperElement=null,this.focusableElements=[],this.lastFocusedElement=null,this.lastFocusedSelectionStart=null,this.lastFocusedSelectionEnd=null}attach(e){this.wrapperElement=e,e&&(this.updateFocusableElements(),this.setupFocusTracking())}reset(){this.wrapperElement=null,this.focusableElements=[],this.lastFocusedElement=null,this.lastFocusedSelectionStart=null,this.lastFocusedSelectionEnd=null}updateFocusableElements(){if(!this.wrapperElement)return;let r=`${mt.FOCUSABLE_INPUTS.map(n=>n==="textarea"?"textarea:not([disabled])":`input[type="${n}"]:not([disabled])`).join(", ")}, select:not([disabled]), button:not([disabled]), [contenteditable="true"], [tabindex]:not([tabindex="-1"])`;this.focusableElements=Array.from(this.wrapperElement.querySelectorAll(r))}setupFocusTracking(){if(!this.wrapperElement)return;let e=this.wrapperElement.getAttribute("data-lvt-id"),t=`__lvt_focus_tracker_${e}`,r=`__lvt_blur_tracker_${e}`,n=a=>{let s=a.target;!s||!this.wrapperElement?.contains(s)||(this.isTextualInput(s)||s instanceof HTMLSelectElement)&&(this.lastFocusedElement=s,this.logger.debug("[Focus] Tracked focus on:",s.tagName,s.id||s.getAttribute("name")),this.isTextualInput(s)&&(this.lastFocusedSelectionStart=s.selectionStart,this.lastFocusedSelectionEnd=s.selectionEnd))},i=a=>{let s=a.target;!s||!this.wrapperElement?.contains(s)||this.isTextualInput(s)&&s===this.lastFocusedElement&&(this.lastFocusedSelectionStart=s.selectionStart,this.lastFocusedSelectionEnd=s.selectionEnd,this.logger.debug("[Focus] Saved cursor on blur:",this.lastFocusedSelectionStart,"-",this.lastFocusedSelectionEnd))};document[t]&&document.removeEventListener("focus",document[t],!0),document[r]&&document.removeEventListener("blur",document[r],!0),document[t]=n,document[r]=i,document.addEventListener("focus",n,!0),document.addEventListener("blur",i,!0),this.logger.debug("[Focus] Focus tracking set up")}restoreFocusedElement(){if(this.logger.debug("[Focus] restoreFocusedElement - lastFocusedElement:",this.lastFocusedElement?.tagName,this.lastFocusedElement?.id||this.lastFocusedElement?.getAttribute("name")),!this.lastFocusedElement||!this.wrapperElement){this.logger.debug("[Focus] No element to restore");return}let e=this.getElementSelector(this.lastFocusedElement);if(this.logger.debug("[Focus] Selector for last focused:",e),!e){this.logger.debug("[Focus] Could not generate selector");return}let t=null;if(e.startsWith("data-focus-index-")){this.updateFocusableElements();let n=parseInt(e.replace("data-focus-index-",""),10);t=this.focusableElements[n]||null,this.logger.debug("[Focus] Found by index:",n,t?.tagName)}else t=this.wrapperElement.querySelector(e),this.logger.debug("[Focus] Found by selector:",e,t?.tagName);if(!t){this.logger.debug("[Focus] Element not found in updated DOM");return}let r=t.matches(":focus");this.logger.debug("[Focus] Already focused:",r),r||(t.focus(),this.logger.debug("[Focus] Restored focus")),this.isTextualInput(t)&&this.lastFocusedSelectionStart!==null&&this.lastFocusedSelectionEnd!==null&&(t.setSelectionRange(this.lastFocusedSelectionStart,this.lastFocusedSelectionEnd),this.logger.debug("[Focus] Restored cursor:",this.lastFocusedSelectionStart,"-",this.lastFocusedSelectionEnd))}isTextualInput(e){return e instanceof HTMLTextAreaElement?!0:e instanceof HTMLInputElement?mt.FOCUSABLE_INPUTS.indexOf(e.type)>=0:!1}getLastFocusedElement(){return this.lastFocusedElement}getElementSelector(e){if(e.id)return`#${e.id}`;if(e.name)return`[name="${e.name}"]`;if(e.getAttribute("data-key"))return`[data-key="${e.getAttribute("data-key")}"]`;let t=this.focusableElements.indexOf(e);return t>=0?`data-focus-index-${t}`:null}};me.FocusManager=je});var bt=T(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});se.handleScrollDirectives=mr;se.handleHighlightDirectives=vr;se.handleAnimateDirectives=br;function mr(o){o.querySelectorAll("[lvt-scroll]").forEach(t=>{let r=t,n=r.getAttribute("lvt-scroll"),i=r.getAttribute("lvt-scroll-behavior")||"auto",a=parseInt(r.getAttribute("lvt-scroll-threshold")||"100",10);if(n)switch(n){case"bottom":r.scrollTo({top:r.scrollHeight,behavior:i});break;case"bottom-sticky":{r.scrollHeight-r.scrollTop-r.clientHeight<=a&&r.scrollTo({top:r.scrollHeight,behavior:i});break}case"top":r.scrollTo({top:0,behavior:i});break;case"preserve":break;default:console.warn(`Unknown lvt-scroll mode: ${n}`)}})}function vr(o){o.querySelectorAll("[lvt-highlight]").forEach(t=>{let r=t.getAttribute("lvt-highlight"),n=parseInt(t.getAttribute("lvt-highlight-duration")||"500",10),i=t.getAttribute("lvt-highlight-color")||"#ffc107";if(!r)return;let a=t,s=a.style.backgroundColor,l=a.style.transition;a.style.transition=`background-color ${n}ms ease-out`,a.style.backgroundColor=i,setTimeout(()=>{a.style.backgroundColor=s,setTimeout(()=>{a.style.transition=l},n)},50)})}function br(o){if(o.querySelectorAll("[lvt-animate]").forEach(t=>{let r=t.getAttribute("lvt-animate"),n=parseInt(t.getAttribute("lvt-animate-duration")||"300",10);if(!r)return;let i=t;switch(i.style.setProperty("--lvt-animate-duration",`${n}ms`),r){case"fade":i.style.animation="lvt-fade-in var(--lvt-animate-duration) ease-out";break;case"slide":i.style.animation="lvt-slide-in var(--lvt-animate-duration) ease-out";break;case"scale":i.style.animation="lvt-scale-in var(--lvt-animate-duration) ease-out";break;default:console.warn(`Unknown lvt-animate mode: ${r}`)}i.addEventListener("animationend",()=>{i.style.animation=""},{once:!0})}),!document.getElementById("lvt-animate-styles")){let t=document.createElement("style");t.id="lvt-animate-styles",t.textContent=`
      @keyframes lvt-fade-in {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      @keyframes lvt-slide-in {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes lvt-scale-in {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
    `,document.head.appendChild(t)}}});var yt=T(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.debounce=yr;ve.throttle=wr;function yr(o,e){let t=null;return function(...n){let i=this;t!==null&&clearTimeout(t),t=window.setTimeout(()=>{o.apply(i,n)},e)}}function wr(o,e){let t=!1;return function(...n){let i=this;t||(o.apply(i,n),t=!0,setTimeout(()=>{t=!1},e))}}});var qe=T(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});be.checkLvtConfirm=Er;be.extractLvtData=kr;function Er(o){if(o.hasAttribute("lvt-confirm")){let e=o.getAttribute("lvt-confirm");if(e&&!confirm(e))return!1}return!0}function kr(o){let e={},t=o.attributes;for(let r=0;r<t.length;r++){let n=t[r];if(n.name.startsWith("lvt-data-")){let i=n.name.substring(9);e[i]=n.value}}return e}});var wt=T(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});we.EventDelegator=void 0;var ye=yt(),xr=qe(),ze=class{constructor(e,t){this.context=e,this.logger=t}setupEventDelegation(){let e=this.context.getWrapperElement();if(!e)return;let t=["click","submit","change","input","keydown","keyup","focus","blur","mouseenter","mouseleave"],r=e.getAttribute("data-lvt-id"),n=this.context.getRateLimitedHandlers();t.forEach(i=>{let a=`__lvt_delegated_${i}_${r}`,s=document[a];s&&document.removeEventListener(i,s,!1);let l=c=>{let d=this.context.getWrapperElement();if(!d)return;i==="submit"&&(window.__lvtSubmitListenerTriggered=!0,window.__lvtSubmitEventTarget=c.target?.tagName),this.logger.debug("Event listener triggered:",i,c.target);let h=c.target;if(!h)return;let p=h,m=!1;for(;p;){if(p===d){m=!0;break}p=p.parentElement}if(i==="submit"&&(window.__lvtInWrapper=m,window.__lvtWrapperElement=d.getAttribute("data-lvt-id")),!m)return;let x=`lvt-${i}`;for(p=h;p&&p!==d.parentElement;){let y=p.getAttribute(x),v=p;if(!y&&i==="submit"&&p instanceof HTMLFormElement){let u=p.getAttribute("lvt-persist");u&&(y=`persist:${u}`,v=p)}if(!y&&(i==="change"||i==="input")){let u=p.closest("form");u&&u.hasAttribute("lvt-change")&&(y=u.getAttribute("lvt-change"),v=u)}if(y&&v){if(i==="submit"&&(window.__lvtActionFound=y,window.__lvtActionElement=v.tagName),i==="submit"&&c.preventDefault(),(i==="keydown"||i==="keyup")&&v.hasAttribute("lvt-key")){let w=v.getAttribute("lvt-key");if(w&&c.key!==w){p=p.parentElement;continue}}let u=v,A=()=>{if(this.logger.debug("handleAction called",{action:y,eventType:i,targetElement:u}),!(0,xr.checkLvtConfirm)(u)){this.logger.debug("Action cancelled by user:",y);return}let w={action:y,data:{}};if(u instanceof HTMLFormElement){this.logger.debug("Processing form element");let E=new FormData(u),S=Array.from(u.querySelectorAll('input[type="checkbox"][name]')),D=new Set(S.map(R=>R.name));D.forEach(R=>{w.data[R]=!1}),E.forEach((R,H)=>{D.has(H)?(w.data[H]=!0,this.logger.debug("Converted checkbox",H,"to true")):w.data[H]=this.context.parseValue(R)}),this.logger.debug("Form data collected:",w.data)}else if(i==="change"||i==="input"){if(u instanceof HTMLInputElement){let E=u.name||"value";w.data[E]=this.context.parseValue(u.value)}else if(u instanceof HTMLSelectElement){let E=u.name||"value";w.data[E]=this.context.parseValue(u.value)}else if(u instanceof HTMLTextAreaElement){let E=u.name||"value";w.data[E]=this.context.parseValue(u.value)}}if(Array.from(u.attributes).forEach(E=>{if(E.name.startsWith("lvt-data-")){let S=E.name.replace("lvt-data-","");w.data[S]=this.context.parseValue(E.value)}}),Array.from(u.attributes).forEach(E=>{if(E.name.startsWith("lvt-value-")){let S=E.name.replace("lvt-value-","");w.data[S]=this.context.parseValue(E.value)}}),i==="submit"&&u instanceof HTMLFormElement){let S=c.submitter,D=null;S&&S.hasAttribute("lvt-disable-with")&&(D=S.textContent,S.disabled=!0,S.textContent=S.getAttribute("lvt-disable-with"),this.logger.debug("Disabled submit button")),this.context.setActiveSubmission(u,S||null,D),u.querySelectorAll('input[type="file"][lvt-upload]').forEach(H=>{let L=H.getAttribute("lvt-upload");L&&(this.logger.debug("Triggering pending uploads for:",L),this.context.triggerPendingUploads(L))}),u.dispatchEvent(new CustomEvent("lvt:pending",{detail:w})),this.logger.debug("Emitted lvt:pending event")}this.logger.debug("About to send message:",w),this.logger.debug("WebSocket state:",this.context.getWebSocketReadyState()),this.context.send(w),this.logger.debug("send() called")},C=v.getAttribute("lvt-throttle"),I=v.getAttribute("lvt-debounce");if(C||I){n.has(v)||n.set(v,new Map);let w=n.get(v),E=`${i}:${y}`,S=w.get(E);if(!S){if(C){let D=parseInt(C,10);S=(0,ye.throttle)(A,D)}else if(I){let D=parseInt(I,10);S=(0,ye.debounce)(A,D)}S&&w.set(E,S)}S&&S()}else i==="submit"&&(window.__lvtBeforeHandleAction=!0),A(),i==="submit"&&(window.__lvtAfterHandleAction=!0);return}p=p.parentElement}};document[a]=l,document.addEventListener(i,l,!1),this.logger.debug("Registered event listener:",i,"with key:",a)})}setupWindowEventDelegation(){let e=this.context.getWrapperElement();if(!e)return;let t=["keydown","keyup","scroll","resize","focus","blur"],r=e.getAttribute("data-lvt-id"),n=this.context.getRateLimitedHandlers();t.forEach(i=>{let a=`__lvt_window_${i}_${r}`,s=window[a];s&&window.removeEventListener(i,s);let l=c=>{let d=this.context.getWrapperElement();if(!d)return;let h=`lvt-window-${i}`;d.querySelectorAll(`[${h}]`).forEach(m=>{let x=m.getAttribute(h);if(!x)return;if((i==="keydown"||i==="keyup")&&m.hasAttribute("lvt-key")){let C=m.getAttribute("lvt-key");if(C&&c.key!==C)return}let y={action:x,data:{}};Array.from(m.attributes).forEach(C=>{if(C.name.startsWith("lvt-data-")){let I=C.name.replace("lvt-data-","");y.data[I]=this.context.parseValue(C.value)}}),Array.from(m.attributes).forEach(C=>{if(C.name.startsWith("lvt-value-")){let I=C.name.replace("lvt-value-","");y.data[I]=this.context.parseValue(C.value)}});let v=m.getAttribute("lvt-throttle"),u=m.getAttribute("lvt-debounce"),A=()=>this.context.send(y);if(v||u){n.has(m)||n.set(m,new Map);let C=n.get(m),I=`window-${i}:${x}`,w=C.get(I);if(!w){if(v){let E=parseInt(v,10);w=(0,ye.throttle)(A,E)}else if(u){let E=parseInt(u,10);w=(0,ye.debounce)(A,E)}w&&C.set(I,w)}w&&w()}else A()})};window[a]=l,window.addEventListener(i,l)})}setupClickAwayDelegation(){let e=this.context.getWrapperElement();if(!e)return;let r=`__lvt_click_away_${e.getAttribute("data-lvt-id")}`,n=document[r];n&&document.removeEventListener("click",n);let i=a=>{let s=this.context.getWrapperElement();if(!s)return;let l=a.target;s.querySelectorAll("[lvt-click-away]").forEach(d=>{if(!d.contains(l)){let h=d.getAttribute("lvt-click-away");if(!h)return;let p={action:h,data:{}};Array.from(d.attributes).forEach(m=>{if(m.name.startsWith("lvt-data-")){let x=m.name.replace("lvt-data-","");p.data[x]=this.context.parseValue(m.value)}}),Array.from(d.attributes).forEach(m=>{if(m.name.startsWith("lvt-value-")){let x=m.name.replace("lvt-value-","");p.data[x]=this.context.parseValue(m.value)}}),this.context.send(p)}})};document[r]=i,document.addEventListener("click",i)}setupModalDelegation(){let e=this.context.getWrapperElement();if(!e)return;let t=e.getAttribute("data-lvt-id"),r=`__lvt_modal_open_${t}`,n=document[r];n&&document.removeEventListener("click",n);let i=y=>{let v=this.context.getWrapperElement();if(!v)return;let u=y.target?.closest("[lvt-modal-open]");if(!u||!v.contains(u))return;let A=u.getAttribute("lvt-modal-open");A&&(y.preventDefault(),this.context.openModal(A))};document[r]=i,document.addEventListener("click",i);let a=`__lvt_modal_close_${t}`,s=document[a];s&&document.removeEventListener("click",s);let l=y=>{let v=this.context.getWrapperElement();if(!v)return;let u=y.target?.closest("[lvt-modal-close]");if(!u||!v.contains(u))return;let A=u.getAttribute("lvt-modal-close");A&&(y.preventDefault(),this.context.closeModal(A))};document[a]=l,document.addEventListener("click",l);let c=`__lvt_modal_backdrop_${t}`,d=document[c];d&&document.removeEventListener("click",d);let h=y=>{let v=y.target;if(!v.hasAttribute("data-modal-backdrop"))return;let u=v.getAttribute("data-modal-id");u&&this.context.closeModal(u)};document[c]=h,document.addEventListener("click",h);let p=`__lvt_modal_escape_${t}`,m=document[p];m&&document.removeEventListener("keydown",m);let x=y=>{if(y.key!=="Escape")return;let v=this.context.getWrapperElement();if(!v)return;let u=v.querySelectorAll('[role="dialog"]:not([hidden])');if(u.length>0){let A=u[u.length-1];A.id&&this.context.closeModal(A.id)}};document[p]=x,document.addEventListener("keydown",x)}setupFocusTrapDelegation(){let e=this.context.getWrapperElement();if(!e)return;let r=`__lvt_focus_trap_${e.getAttribute("data-lvt-id")}`,n=document[r];n&&document.removeEventListener("keydown",n);let i=s=>{let l=["a[href]:not([disabled])","button:not([disabled])","textarea:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])",'[tabindex]:not([tabindex="-1"]):not([disabled])','[contenteditable="true"]'].join(", ");return Array.from(s.querySelectorAll(l)).filter(c=>{let d=c,h=window.getComputedStyle(d),p=h.display!=="none",m=h.visibility!=="hidden",x=d.offsetParent!==null||h.position==="fixed"||h.position==="absolute"||typeof process<"u"&&!1;return p&&m&&x})},a=s=>{if(s.key!=="Tab")return;let l=this.context.getWrapperElement();if(!l)return;let c=l.querySelectorAll("[lvt-focus-trap]"),d=null;if(c.forEach(x=>{x.contains(document.activeElement)&&(!d||x.contains(d))&&(d=x)}),d||c.forEach(x=>{let y=x,v=window.getComputedStyle(y);v.display!=="none"&&v.visibility!=="hidden"&&(d=x)}),!d)return;let h=i(d);if(h.length===0)return;let p=h[0],m=h[h.length-1];s.shiftKey?document.activeElement===p&&(s.preventDefault(),m.focus()):document.activeElement===m&&(s.preventDefault(),p.focus())};document[r]=a,document.addEventListener("keydown",a),this.logger.debug("Focus trap delegation set up")}setupAutofocusDelegation(){let e=this.context.getWrapperElement();if(!e)return;let r=`__lvt_autofocus_observer_${e.getAttribute("data-lvt-id")}`,n=e[r];n&&n.disconnect();let i=()=>{let s=this.context.getWrapperElement();if(!s)return;s.querySelectorAll("[lvt-autofocus]").forEach(c=>{let d=c,h=window.getComputedStyle(d),p=h.display!=="none",m=h.visibility!=="hidden",x=d.offsetParent!==null||h.position==="fixed"||h.position==="absolute"||d.tagName==="BODY"||typeof process<"u"&&!1,y=p&&m&&x,v=d.getAttribute("data-lvt-autofocused")==="true";y&&!v?(d.setAttribute("data-lvt-autofocused","true"),requestAnimationFrame(()=>{d.focus(),this.logger.debug("Autofocused element:",d.tagName,d.id||d.getAttribute("name"))})):!y&&v&&d.removeAttribute("data-lvt-autofocused")})};i();let a=new MutationObserver(s=>{let l=!1;s.forEach(c=>{c.type==="childList"&&c.addedNodes.length>0&&c.addedNodes.forEach(d=>{d instanceof Element&&(d.hasAttribute("lvt-autofocus")||d.querySelector("[lvt-autofocus]"))&&(l=!0)}),c.type==="attributes"&&(c.target.hasAttribute("lvt-autofocus")||c.attributeName==="hidden"||c.attributeName==="style"||c.attributeName==="class")&&(l=!0)}),l&&i()});a.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["hidden","style","class","lvt-autofocus"]}),e[r]=a,this.logger.debug("Autofocus delegation set up")}};we.EventDelegator=ze});var Et=T(Ee=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0});Ee.ObserverManager=void 0;var Ke=class{constructor(e,t){this.context=e,this.logger=t,this.infiniteScrollObserver=null,this.mutationObserver=null}setupInfiniteScrollObserver(){if(!this.context.getWrapperElement())return;let t=document.getElementById("scroll-sentinel");t&&(this.infiniteScrollObserver&&this.infiniteScrollObserver.disconnect(),this.infiniteScrollObserver=new IntersectionObserver(r=>{r[0].isIntersecting&&(this.logger.debug("Sentinel visible, sending load_more action"),this.context.send({action:"load_more"}))},{rootMargin:"200px"}),this.infiniteScrollObserver.observe(t),this.logger.debug("Observer set up successfully"))}setupInfiniteScrollMutationObserver(){let e=this.context.getWrapperElement();e&&(this.mutationObserver&&this.mutationObserver.disconnect(),this.mutationObserver=new MutationObserver(()=>{this.setupInfiniteScrollObserver()}),this.mutationObserver.observe(e,{childList:!0,subtree:!0}),this.logger.debug("MutationObserver set up successfully"))}teardown(){this.infiniteScrollObserver&&(this.infiniteScrollObserver.disconnect(),this.infiniteScrollObserver=null),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null)}};Ee.ObserverManager=Ke});var kt=T(ke=>{"use strict";Object.defineProperty(ke,"__esModule",{value:!0});ke.ModalManager=void 0;var Ve=class{constructor(e){this.logger=e}open(e){let t=document.getElementById(e);if(!t){this.logger.warn(`Modal with id="${e}" not found`);return}t.removeAttribute("hidden"),t.style.display="flex",t.setAttribute("aria-hidden","false"),t.dispatchEvent(new CustomEvent("lvt:modal-opened",{bubbles:!0})),this.logger.info(`Opened modal: ${e}`);let r=t.querySelector("input, textarea, select");r&&setTimeout(()=>{let n=document.activeElement,i=s=>s?s===document.body||s.offsetParent!==null?!0:s.getClientRects().length>0:!1;(!n||!t.contains(n)||!i(n))&&r.focus()},100)}close(e){let t=document.getElementById(e);if(!t){this.logger.warn(`Modal with id="${e}" not found`);return}t.setAttribute("hidden",""),t.style.display="none",t.setAttribute("aria-hidden","true"),t.dispatchEvent(new CustomEvent("lvt:modal-closed",{bubbles:!0})),this.logger.info(`Closed modal: ${e}`)}};ke.ModalManager=Ve});var xt=T(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});xe.LoadingIndicator=void 0;var Ge=class{constructor(){this.bar=null}show(){if(this.bar)return;let e=document.createElement("div");if(e.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #3b82f6 0%, #60a5fa 50%, #3b82f6 100%);
      background-size: 200% 100%;
      z-index: 9999;
      animation: lvt-loading-shimmer 1.5s ease-in-out infinite;
    `,!document.getElementById("lvt-loading-styles")){let t=document.createElement("style");t.id="lvt-loading-styles",t.textContent=`
        @keyframes lvt-loading-shimmer {
          0% { background-position: 200% 0; }
          100% { background-position: -200% 0; }
        }
      `,document.head.appendChild(t)}document.body.insertBefore(e,document.body.firstChild),this.bar=e}hide(){this.bar&&(this.bar.parentNode&&this.bar.parentNode.removeChild(this.bar),this.bar=null)}};xe.LoadingIndicator=Ge});var St=T(Se=>{"use strict";Object.defineProperty(Se,"__esModule",{value:!0});Se.FormDisabler=void 0;var Je=class{disable(e){if(!e)return;e.querySelectorAll("form").forEach(r=>{r.querySelectorAll("input, textarea, select, button").forEach(i=>{i.disabled=!0})})}enable(e){if(!e)return;e.querySelectorAll("form").forEach(r=>{r.querySelectorAll("input, textarea, select, button").forEach(i=>{i.disabled=!1})})}};Se.FormDisabler=Je});var Ye=T(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.parseReactiveAttribute=Mt;U.executeAction=At;U.matchesEvent=Lt;U.processReactiveAttributes=Tt;U.setupReactiveAttributeListeners=Cr;var Ct=["pending","success","error","done"],Sr={reset:"reset",disable:"disable",enable:"enable",addclass:"addClass",removeclass:"removeClass",toggleclass:"toggleClass",setattr:"setAttr",toggleattr:"toggleAttr"};function Mt(o,e){let t=o.toLowerCase().match(/^lvt-(\w+)-on:(.+)$/);if(!t)return null;let r=t[1],n=Sr[r];if(!n)return null;let a=t[2].split(":"),s=a[a.length-1];if(!Ct.includes(s))return null;let l=s,c=a.length>1?a.slice(0,-1).join(":"):void 0;return{action:n,lifecycle:l,actionName:c||void 0,param:e||void 0}}function At(o,e,t){switch(e){case"reset":o instanceof HTMLFormElement&&o.reset();break;case"disable":"disabled"in o&&(o.disabled=!0);break;case"enable":"disabled"in o&&(o.disabled=!1);break;case"addClass":if(t){let r=t.split(/\s+/).filter(Boolean);o.classList.add(...r)}break;case"removeClass":if(t){let r=t.split(/\s+/).filter(Boolean);o.classList.remove(...r)}break;case"toggleClass":t&&t.split(/\s+/).filter(Boolean).forEach(n=>o.classList.toggle(n));break;case"setAttr":if(t){let r=t.indexOf(":");if(r>0){let n=t.substring(0,r),i=t.substring(r+1);o.setAttribute(n,i)}}break;case"toggleAttr":t&&o.toggleAttribute(t);break}}function Lt(o,e,t){return o.lifecycle!==e?!1:o.actionName?o.actionName===t:!0}function Tt(o,e){document.querySelectorAll("*").forEach(r=>{Array.from(r.attributes).forEach(n=>{if(!n.name.startsWith("lvt-")||!n.name.includes("-on:"))return;let i=Mt(n.name,n.value);i&&Lt(i,o,e)&&At(r,i.action,i.param)})})}function Cr(){Ct.forEach(o=>{document.addEventListener(`lvt:${o}`,e=>{let r=e.detail?.action;Tt(o,r)},!0)})}});var It=T(Ce=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.TreeRenderer=void 0;function _t(o){return typeof structuredClone=="function"?structuredClone(o):JSON.parse(JSON.stringify(o))}var Xe=class{constructor(e){this.logger=e,this.treeState={},this.rangeState={},this.rangeIdKeys={}}applyUpdate(e){let t=!1;for(let[n,i]of Object.entries(e))if(Array.isArray(i)&&i.length>0&&Array.isArray(i[0])&&typeof i[0][0]=="string"){let s=this.treeState[n];s&&typeof s=="object"&&!Array.isArray(s)&&Array.isArray(s.d)&&Array.isArray(s.s)?(this.treeState[n]=_t(s),this.applyDifferentialOpsToRange(this.treeState[n],i,n)):this.treeState[n]=i,t=!0}else{let s=this.treeState[n],l=typeof i=="object"&&i!==null&&!Array.isArray(i)?this.deepMergeTreeNodes(s,i,n):i;JSON.stringify(s)!==JSON.stringify(l)&&(this.treeState[n]=l,t=!0)}return{html:this.reconstructFromTree(this.treeState,""),changed:t}}reset(){this.treeState={},this.rangeState={},this.rangeIdKeys={}}getTreeState(){return{...this.treeState}}getStaticStructure(){return this.treeState.s||null}deepMergeTreeNodes(e,t,r=""){if(typeof t!="object"||t===null||Array.isArray(t)||typeof e!="object"||e===null||Array.isArray(e))return t;let n={...e};for(let[i,a]of Object.entries(t)){let s=r?`${r}.${i}`:i,l=Array.isArray(a)&&a.length>0&&Array.isArray(a[0])&&typeof a[0][0]=="string",c=n[i]&&typeof n[i]=="object"&&!Array.isArray(n[i])&&Array.isArray(n[i].d)&&Array.isArray(n[i].s);l&&c?(n[i]=_t(n[i]),this.logger.debug(`[deepMerge] Applying diff ops at path ${s}`,{ops:a,rangeItems:n[i].d?.length}),this.applyDifferentialOpsToRange(n[i],a,s)):typeof a=="object"&&a!==null&&!Array.isArray(a)&&typeof n[i]=="object"&&n[i]!==null&&!Array.isArray(n[i])?n[i]=this.deepMergeTreeNodes(n[i],a,s):n[i]=a}return n}applyDifferentialOpsToRange(e,t,r){if(!e||typeof e!="object"||!Array.isArray(e.d)||!Array.isArray(e.s)){this.logger.error(`[applyDiffOpsToRange] Invalid rangeStructure at path ${r}`,{rangeStructure:e});return}let n=e.d;this.rangeState[r]||(this.rangeState[r]={items:n,statics:e.s}),e.m&&typeof e.m=="object"&&typeof e.m.idKey=="string"&&(this.rangeIdKeys[r]=e.m.idKey),this.logger.debug(`[applyDiffOpsToRange] path=${r}, idKey=${this.rangeIdKeys[r]}, items=${n.length}, ops=${t.length}`);for(let i of t){if(!Array.isArray(i)||i.length<2)continue;switch(i[0]){case"r":{let s=i[1],l=this.findItemIndexByKey(n,s,e.s,r);this.logger.debug(`[applyDiffOpsToRange] Remove: key=${s}, index=${l}, total=${n.length}`),l>=0?(n.splice(l,1),this.logger.debug(`[applyDiffOpsToRange] After removal: ${n.length} items`)):this.logger.debug(`[applyDiffOpsToRange] Remove failed: key ${s} not found`);break}case"u":{let s=this.findItemIndexByKey(n,i[1],e.s,r),l=i[2];s>=0&&l&&(n[s]={...n[s],...l});break}case"a":{let s=Array.isArray(i[1])?i[1]:[i[1]];i[2]&&(e.s=i[2]),n.push(...s),i[3]&&typeof i[3]=="object"&&i[3].idKey&&(this.rangeIdKeys[r]=i[3].idKey);break}case"p":{let s=Array.isArray(i[1])?i[1]:[i[1]];i[2]&&(e.s=i[2]),n.unshift(...s);break}case"i":{let s=this.findItemIndexByKey(n,i[1],e.s,r);if(s>=0){let l=Array.isArray(i[2])?i[2]:[i[2]];n.splice(s+1,0,...l)}break}case"o":{let s=i[1],l=[],c=new Map;for(let d of n){let h=this.getItemKey(d,e.s,r);h&&c.set(h,d)}for(let d of s){let h=c.get(d);h&&l.push(h)}n.length=0,n.push(...l);break}default:break}}this.rangeState[r]={items:n,statics:e.s}}reconstructFromTree(e,t){if(e.s&&Array.isArray(e.s)){let r="";for(let n=0;n<e.s.length;n++){let i=e.s[n];if(r+=i,n<e.s.length-1){let a=n.toString();if(e[a]!==void 0){let s=t?`${t}.${a}`:a;r+=this.renderValue(e[a],a,s)}}}return r=r.replace(/<root>/g,"").replace(/<\/root>/g,""),r}return this.renderValue(e,"",t)}renderValue(e,t,r){if(e==null||typeof e=="string"&&e.startsWith("{{")&&e.endsWith("}}"))return"";if(typeof e=="object"&&!Array.isArray(e)){if(e.d&&Array.isArray(e.d)&&e.s&&Array.isArray(e.s)){let a=r||t||"";return a&&(this.rangeState[a]={items:e.d,statics:e.s},e.m&&typeof e.m=="object"&&typeof e.m.idKey=="string"&&(this.rangeIdKeys[a]=e.m.idKey)),this.renderRangeStructure(e,t,r)}if("s"in e&&Array.isArray(e.s))return this.reconstructFromTree(e,r||"");let n=Object.keys(e),i=n.filter(a=>/^\d+$/.test(a)).sort((a,s)=>parseInt(a)-parseInt(s));if(i.length>0&&i.length===n.length)return i.map(a=>{let s=r?`${r}.${a}`:a;return this.renderValue(e[a],a,s)}).join("")}return Array.isArray(e)?e.length>0&&Array.isArray(e[0])&&typeof e[0][0]=="string"?this.applyDifferentialOperations(e,r):e.map((n,i)=>{let a=i.toString(),s=r?`${r}.${a}`:a;return typeof n=="object"&&n&&n.s?this.reconstructFromTree(n,s):this.renderValue(n,a,s)}).join(""):(typeof e=="object"&&(this.logger.error("Object value reached string conversion; this will render as [object Object]."),this.logger.isDebugEnabled()&&this.logger.debug("Value diagnostics:",{valueType:typeof e,isArray:Array.isArray(e),keys:Object.keys(e),hasStatics:!!e.s,hasDynamics:!!e.d,value:e})),String(e))}renderRangeStructure(e,t,r){let{d:n,s:i}=e;if(!n||!Array.isArray(n))return"";if(n.length===0){if(e.else){let a="else",s=r?`${r}.else`:"else";return this.renderValue(e.else,a,s)}return""}return i&&Array.isArray(i)?n.map((a,s)=>{let l="";for(let c=0;c<i.length;c++)if(l+=i[c],c<i.length-1){let d=c.toString();if(a[d]!==void 0){let h=r?`${r}.${s}.${d}`:`${s}.${d}`;l+=this.renderValue(a[d],d,h)}}return l}).join(""):n.map((a,s)=>{let l=s.toString(),c=r?`${r}.${l}`:l;return this.renderValue(a,l,c)}).join("")}applyDifferentialOperations(e,t){if(!t||!this.rangeState[t])return"";let r=this.rangeState[t],n=[...r.items],i=r.statics;for(let s of e){if(!Array.isArray(s)||s.length<2)continue;switch(s[0]){case"r":{let c=this.findItemIndexByKey(n,s[1],i,t);c>=0&&n.splice(c,1);break}case"u":{let c=this.findItemIndexByKey(n,s[1],i,t),d=s[2];c>=0&&d&&(n[c]={...n[c],...d});break}case"a":{this.addItemsToRange(n,s[1],s[2],r,!1),s[3]&&typeof s[3]=="object"&&s[3].idKey&&(this.rangeIdKeys[t||""]=s[3].idKey);break}case"p":{this.addItemsToRange(n,s[1],s[2],r,!0);break}case"i":{let c=this.findItemIndexByKey(n,s[1],i,t);if(c>=0){let d=Array.isArray(s[2])?s[2]:[s[2]];n.splice(c+1,0,...d)}break}case"o":{let c=s[1],d=[],h=new Map;for(let p of n){let m=this.getItemKey(p,i,t);m&&h.set(m,p)}for(let p of c){let m=h.get(p);m&&d.push(m)}n.length=0,n.push(...d);break}default:break}}this.rangeState[t]={items:n,statics:r.statics},this.treeState[t]={d:n,s:r.statics};let a=this.getCurrentRangeStructure(t);return a&&a.s?this.renderItemsWithStatics(n,a.s):n.map(s=>this.renderValue(s)).join("")}getCurrentRangeStructure(e){if(this.rangeState[e])return{d:this.rangeState[e].items,s:this.rangeState[e].statics};let t=this.treeState[e];return t&&typeof t=="object"&&t.s?t:null}renderItemsWithStatics(e,t){let r=e.map(n=>{let i="";for(let a=0;a<t.length;a++)if(i+=t[a],a<t.length-1){let s=a.toString();n[s]!==void 0&&(i+=this.renderValue(n[s]))}return i}).join("");return this.logger.isDebugEnabled()&&(this.logger.debug("[renderItemsWithStatics] statics:",t),this.logger.debug("[renderItemsWithStatics] items count:",e.length),this.logger.debug("[renderItemsWithStatics] result snippet:",r.substring(0,200))),r}addItemsToRange(e,t,r,n,i){if(r&&(n.statics=r),!t)return;let a=Array.isArray(t)?t:[t];i?e.unshift(...a):e.push(...a)}getItemKey(e,t,r){if(!r||!this.rangeIdKeys[r])return null;let n=this.rangeIdKeys[r];return e[n]||null}findItemIndexByKey(e,t,r,n){return e.findIndex(i=>this.getItemKey(i,r,n)===t)}};Ce.TreeRenderer=Xe});var Ot=T(Me=>{"use strict";Object.defineProperty(Me,"__esModule",{value:!0});Me.FormLifecycleManager=void 0;var Qe=class{constructor(e){this.modalManager=e,this.activeForm=null,this.activeButton=null,this.originalButtonText=null}setActiveSubmission(e,t,r){this.activeForm=e,this.activeButton=t,this.originalButtonText=r}handleResponse(e){this.activeForm&&this.activeForm.dispatchEvent(new CustomEvent("lvt:done",{detail:e})),e.success?this.handleSuccess(e):this.handleError(e),this.restoreFormState()}reset(){this.restoreFormState()}handleSuccess(e){if(!this.activeForm)return;this.activeForm.dispatchEvent(new CustomEvent("lvt:success",{detail:e}));let t=this.activeForm.closest('[role="dialog"]');t&&t.id&&this.modalManager.close(t.id),this.activeForm.hasAttribute("lvt-preserve")||this.activeForm.reset()}handleError(e){this.activeForm&&this.activeForm.dispatchEvent(new CustomEvent("lvt:error",{detail:e}))}restoreFormState(){this.activeButton&&this.originalButtonText!==null&&(this.activeButton.disabled=!1,this.activeButton.textContent=this.originalButtonText),this.activeForm=null,this.activeButton=null,this.originalButtonText=null}};Me.FormLifecycleManager=Qe});var Nt=T(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.WebSocketManager=W.WebSocketTransport=void 0;W.checkWebSocketAvailability=Dt;W.fetchInitialState=Rt;var Ae=class{constructor(e){this.options=e,this.socket=null,this.reconnectTimer=null,this.manuallyClosed=!1,this.reconnectAttempts=0}connect(){this.manuallyClosed=!1,this.clearReconnectTimer(),this.socket=new WebSocket(this.options.url);let e=this.socket;e.onopen=()=>{this.reconnectAttempts=0,this.options.onOpen?.(e)},e.onmessage=t=>{this.options.onMessage?.(t)},e.onclose=t=>{this.options.onClose?.(t),!this.manuallyClosed&&this.options.autoReconnect&&this.scheduleReconnect()},e.onerror=t=>{this.options.onError?.(t)}}send(e){this.socket&&this.socket.readyState===1&&this.socket.send(e)}disconnect(){this.manuallyClosed=!0,this.clearReconnectTimer(),this.socket&&(this.socket.close(),this.socket=null)}getSocket(){return this.socket}scheduleReconnect(){this.clearReconnectTimer();let e=this.options.maxReconnectAttempts??10;if(e>0&&this.reconnectAttempts>=e){this.options.onReconnectFailed?.();return}this.reconnectAttempts++;let t=this.options.reconnectDelay??1e3,r=this.options.maxReconnectDelay??16e3,n=t*Math.pow(2,this.reconnectAttempts-1),i=Math.random()*1e3,a=Math.min(n+i,r);this.reconnectTimer=window.setTimeout(()=>{this.options.onReconnectAttempt?.(this.reconnectAttempts,a),this.connect()},a)}clearReconnectTimer(){this.reconnectTimer!==null&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}};W.WebSocketTransport=Ae;var Ze=class{constructor(e){this.config=e,this.transport=null}async connect(){let e=this.getLiveUrl();return await Dt(e,this.config.logger)?(this.transport=new Ae({url:this.getWebSocketUrl(),autoReconnect:this.config.options.autoReconnect,reconnectDelay:this.config.options.reconnectDelay,maxReconnectDelay:16e3,maxReconnectAttempts:10,onOpen:()=>{this.config.onConnected()},onMessage:r=>{try{let n=JSON.parse(r.data);this.config.onMessage(n,r)}catch(n){this.config.logger.error("Failed to parse WebSocket message:",n)}},onClose:()=>{this.config.onDisconnected()},onReconnectAttempt:(r,n)=>{this.config.onReconnectAttempt?.(r,n)},onReconnectFailed:()=>{this.config.onReconnectFailed?.()},onError:r=>{this.config.onError?.(r)}}),this.transport.connect(),{usingWebSocket:!0}):{usingWebSocket:!1,initialState:await Rt(e,this.config.logger)}}disconnect(){this.transport?.disconnect(),this.transport=null}send(e){this.transport?.send(e)}getReadyState(){return this.transport?.getSocket()?.readyState}getSocket(){return this.transport?.getSocket()??null}getWebSocketUrl(){let e=this.config.options.liveUrl||"/live",t=this.config.options.wsUrl;return t||`ws://${window.location.host}${e}`}getLiveUrl(){return this.config.options.liveUrl||window.location.pathname}};W.WebSocketManager=Ze;async function Dt(o,e){try{let r=(await fetch(o,{method:"HEAD"})).headers.get("X-LiveTemplate-WebSocket");return r?r==="enabled":!0}catch(t){return e?.warn("Failed to check WebSocket availability:",t),!0}}async function Rt(o,e){try{let t=await fetch(o,{method:"GET",credentials:"include",headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`Failed to fetch initial state: ${t.status}`);return await t.json()}catch(t){return e?.warn("Failed to fetch initial state:",t),null}}});var Bt=T(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});Le.S3Uploader=void 0;var et=class{async upload(e,t,r){let{file:n}=e;e.abortController=new AbortController;try{let i=new XMLHttpRequest;i.upload.addEventListener("progress",s=>{s.lengthComputable&&(e.bytesUploaded=s.loaded,e.progress=Math.round(s.loaded/s.total*100),r&&r(e))}),e.abortController.signal.addEventListener("abort",()=>{i.abort()});let a=new Promise((s,l)=>{i.addEventListener("load",()=>{i.status>=200&&i.status<300?(e.done=!0,e.progress=100,s()):l(new Error(`S3 upload failed with status ${i.status}: ${i.statusText}`))}),i.addEventListener("error",()=>{l(new Error("S3 upload failed: Network error"))}),i.addEventListener("abort",()=>{l(new Error("S3 upload cancelled"))})});if(i.open("PUT",t.url),t.headers)for(let[s,l]of Object.entries(t.headers))i.setRequestHeader(s,l);i.send(n),await a}catch(i){throw e.error=i instanceof Error?i.message:String(i),i}}};Le.S3Uploader=et});var Ht=T(Te=>{"use strict";Object.defineProperty(Te,"__esModule",{value:!0});Te.UploadHandler=void 0;var Mr=Bt(),tt=class{constructor(e,t={}){this.sendMessage=e,this.entries=new Map,this.pendingFiles=new Map,this.autoUploadConfig=new Map,this.uploaders=new Map,this.inputHandlers=new WeakMap,this.chunkSize=t.chunkSize||256*1024,this.onProgress=t.onProgress,this.onComplete=t.onComplete,this.onError=t.onError,this.uploaders.set("s3",new Mr.S3Uploader)}initializeFileInputs(e){e.querySelectorAll('input[type="file"][lvt-upload]').forEach(r=>{let n=r.getAttribute("lvt-upload");if(!n)return;let i=this.inputHandlers.get(r);i&&r.removeEventListener("change",i);let a=s=>{let l=s.target.files;!l||l.length===0||this.startUpload(n,Array.from(l))};r.addEventListener("change",a),this.inputHandlers.set(r,a)})}async startUpload(e,t){this.pendingFiles.set(e,t);let r=t.map(i=>({name:i.name,type:i.type||"application/octet-stream",size:i.size})),n={action:"upload_start",upload_name:e,files:r};this.sendMessage(n)}async handleUploadStartResponse(e){let{upload_name:t,entries:r}=e;r.length>0&&this.autoUploadConfig.set(t,r[0].auto_upload);let n=this.pendingFiles.get(t);if(!n){console.error(`No pending files found for upload: ${t}`);return}this.pendingFiles.delete(t);let i=new Map;for(let s of n)i.set(s.name,s);let a=[];for(let s of r){let l=i.get(s.client_name);if(!l){console.warn(`No file found for entry ${s.entry_id} (client_name: ${s.client_name})`);continue}let c={id:s.entry_id,file:l,uploadName:t,progress:0,bytesUploaded:0,valid:s.valid,done:!1,error:s.error,external:s.external};if(this.entries.set(c.id,c),a.push(c),!s.valid){this.onError&&s.error&&this.onError(c,s.error);continue}s.auto_upload&&(s.external?this.uploadExternal(c,s.external):this.uploadChunked(c))}}async uploadExternal(e,t){try{let r=this.uploaders.get(t.uploader);if(!r)throw new Error(`Unknown uploader: ${t.uploader}`);await r.upload(e,t,this.onProgress);let n={action:"upload_complete",upload_name:e.uploadName,entry_ids:[e.id]};this.sendMessage(n),this.onComplete&&this.onComplete(e.uploadName,[e]),this.clearFileInput(e.uploadName),this.cleanupEntries(e.uploadName)}catch(r){let n=r instanceof Error?r.message:String(r);e.error=n,this.onError&&this.onError(e,n),this.cleanupEntries(e.uploadName)}}async uploadChunked(e){let{file:t,id:r}=e,n=0;e.abortController=new AbortController;try{for(;n<t.size;){if(e.abortController.signal.aborted)throw new Error("Upload cancelled");let a=Math.min(n+this.chunkSize,t.size),s=t.slice(n,a),l=await this.fileToBase64(s),c={action:"upload_chunk",entry_id:r,chunk_base64:l,offset:n,total:t.size};this.sendMessage(c),n=a,e.bytesUploaded=n,e.progress=Math.round(n/t.size*100),this.onProgress&&this.onProgress(e)}e.done=!0;let i={action:"upload_complete",upload_name:e.uploadName,entry_ids:[r]};this.sendMessage(i),this.onComplete&&this.onComplete(e.uploadName,[e]),this.clearFileInput(e.uploadName),this.cleanupEntries(e.uploadName)}catch(i){let a=i instanceof Error?i.message:String(i);e.error=a,this.onError&&this.onError(e,a),this.cleanupEntries(e.uploadName)}}handleProgressMessage(e){let t=this.entries.get(e.entry_id);t&&(t.progress=e.progress,t.bytesUploaded=e.bytes_recv,this.onProgress&&this.onProgress(t))}cancelUpload(e){let t=this.entries.get(e);t&&(t.abortController&&t.abortController.abort(),this.sendMessage({action:"cancel_upload",entry_id:e}),this.entries.delete(e))}getEntries(e){let t=[];for(let r of this.entries.values())r.uploadName===e&&t.push(r);return t}triggerPendingUploads(e){let t=[];for(let r of this.entries.values())r.uploadName===e&&r.progress===0&&!r.done&&!r.error&&t.push(r);for(let r of t)r.external?this.uploadExternal(r,r.external):this.uploadChunked(r)}registerUploader(e,t){this.uploaders.set(e,t)}clearFileInput(e){document.querySelectorAll(`input[type="file"][lvt-upload="${e}"]`).forEach(r=>{r.value=""})}cleanupEntries(e,t=5e3){setTimeout(()=>{let r=[];for(let[n,i]of this.entries)e&&i.uploadName!==e||(i.done||i.error)&&r.push(n);for(let n of r)this.entries.delete(n)},t)}fileToBase64(e){return new Promise((t,r)=>{let n=new FileReader;n.onload=()=>{let a=n.result.split(",")[1];t(a)},n.onerror=r,n.readAsDataURL(e)})}};Te.UploadHandler=tt});var $t=T(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.Logger=void 0;oe.createLogger=Ar;var Pt={silent:0,error:1,warn:2,info:3,debug:4},Ft="LiveTemplate",_e=class o{constructor(e,t=[],r=console){this.state=e,this.scope=t,this.sink=r}setLevel(e){this.state.level=e}getLevel(){return this.state.level}child(e){return new o(this.state,[...this.scope,e],this.sink)}isDebugEnabled(){return this.shouldLog("debug")}error(...e){this.log("error","error",e)}warn(...e){this.log("warn","warn",e)}info(...e){this.log("info","info",e)}debug(...e){this.log("debug","debug",e)}log(e,t,r){if(!this.shouldLog(e))return;(this.sink[t]||console[t]||console.log).apply(this.sink,[this.formatPrefix(),...r])}shouldLog(e){return Pt[e]<=Pt[this.state.level]}formatPrefix(){return this.scope.length===0?`[${Ft}]`:`[${Ft}:${this.scope.join(":")}]`}};oe.Logger=_e;function Ar(o={}){let e={level:o.level??"info"},t=Array.isArray(o.scope)?o.scope:o.scope?[o.scope]:[];return new _e(e,t,o.sink??console)}});var Wt=T(Ie=>{"use strict";Object.defineProperty(Ie,"__esModule",{value:!0});Ie.loadAndApplyUpdate=Lr;Ie.compareHTML=Tr;async function Lr(o,e){try{let t=globalThis?.require;if(typeof t=="function"){let i=t("fs"),a=JSON.parse(i.readFileSync(e,"utf8"));return o.applyUpdate(a)}let n=await(await fetch(e)).json();return o.applyUpdate(n)}catch(t){throw new Error(`Failed to load update from ${e}: ${t}`)}}function Tr(o,e){let t=[],r=c=>c.replace(/\s+/g," ").replace(/>\s+</g,"><").trim(),n=r(o),i=r(e);if(n===i)return{match:!0,differences:[]};let a=n.split(`
`),s=i.split(`
`),l=Math.max(a.length,s.length);for(let c=0;c<l;c++){let d=a[c]||"",h=s[c]||"";d!==h&&(t.push(`Line ${c+1}:`),t.push(`  Expected: ${d}`),t.push(`  Actual:   ${h}`))}return{match:!1,differences:t}}});var nt=T(_=>{"use strict";var _r=_&&_.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(_,"__esModule",{value:!0});_.LiveTemplateClient=_.extractLvtData=_.checkLvtConfirm=_.setupReactiveAttributeListeners=_.compareHTML=_.loadAndApplyUpdate=void 0;var Ir=_r(gt()),Or=vt(),rt=bt(),Dr=wt(),Rr=Et(),Nr=kt(),Br=xt(),Hr=St(),Pr=Ye(),Fr=It(),$r=Ot(),Wr=Nt(),Ur=Ht(),Ut=$t(),jt=Wt();Object.defineProperty(_,"loadAndApplyUpdate",{enumerable:!0,get:function(){return jt.loadAndApplyUpdate}});Object.defineProperty(_,"compareHTML",{enumerable:!0,get:function(){return jt.compareHTML}});var jr=Ye();Object.defineProperty(_,"setupReactiveAttributeListeners",{enumerable:!0,get:function(){return jr.setupReactiveAttributeListeners}});var qt=qe();Object.defineProperty(_,"checkLvtConfirm",{enumerable:!0,get:function(){return qt.checkLvtConfirm}});Object.defineProperty(_,"extractLvtData",{enumerable:!0,get:function(){return qt.extractLvtData}});var Oe=class o{constructor(e={}){this.lvtId=null,this.ws=null,this.wrapperElement=null,this.useHTTP=!1,this.sessionCookie=null,this.rateLimitedHandlers=new WeakMap,this.isInitialized=!1,this.messageCount=0;let{logger:t,logLevel:r,debug:n,...i}=e,a=r??(n?"debug":"info"),s=t??(0,Ut.createLogger)({level:a});t?r?t.setLevel(r):n&&t.setLevel("debug"):s.setLevel(a),this.logger=s.child("Client"),this.options={autoReconnect:!1,reconnectDelay:1e3,liveUrl:window.location.pathname,...i},this.treeRenderer=new Fr.TreeRenderer(this.logger.child("TreeRenderer")),this.focusManager=new Or.FocusManager(this.logger.child("FocusManager")),this.modalManager=new Nr.ModalManager(this.logger.child("ModalManager")),this.formLifecycleManager=new $r.FormLifecycleManager(this.modalManager),this.loadingIndicator=new Br.LoadingIndicator,this.formDisabler=new Hr.FormDisabler,this.uploadHandler=new Ur.UploadHandler(l=>this.send(l),{chunkSize:256*1024,onProgress:l=>{this.wrapperElement&&this.wrapperElement.dispatchEvent(new CustomEvent("lvt:upload:progress",{detail:{entry:l}}))},onComplete:(l,c)=>{this.logger.info(`Upload complete: ${l}`,c),this.wrapperElement&&this.wrapperElement.dispatchEvent(new CustomEvent("lvt:upload:complete",{detail:{uploadName:l,entries:c}}))},onError:(l,c)=>{this.logger.error(`Upload error for ${l.id}:`,c),this.wrapperElement&&this.wrapperElement.dispatchEvent(new CustomEvent("lvt:upload:error",{detail:{entry:l,error:c}}))}}),this.eventDelegator=new Dr.EventDelegator({getWrapperElement:()=>this.wrapperElement,getRateLimitedHandlers:()=>this.rateLimitedHandlers,parseValue:l=>this.parseValue(l),send:l=>this.send(l),setActiveSubmission:(l,c,d)=>this.formLifecycleManager.setActiveSubmission(l,c,d),openModal:l=>this.modalManager.open(l),closeModal:l=>this.modalManager.close(l),getWebSocketReadyState:()=>this.webSocketManager.getReadyState(),triggerPendingUploads:l=>this.uploadHandler.triggerPendingUploads(l)},this.logger.child("EventDelegator")),this.observerManager=new Rr.ObserverManager({getWrapperElement:()=>this.wrapperElement,send:l=>this.send(l)},this.logger.child("ObserverManager")),this.webSocketManager=new Wr.WebSocketManager({options:this.options,logger:this.logger.child("Transport"),onConnected:()=>{this.ws=this.webSocketManager.getSocket(),this.logger.info("WebSocket connected"),this.options.onConnect?.(),this.wrapperElement?.dispatchEvent(new Event("lvt:connected"))},onDisconnected:()=>{this.ws=null,this.logger.info("WebSocket disconnected"),this.options.onDisconnect?.(),this.wrapperElement?.dispatchEvent(new Event("lvt:disconnected"))},onMessage:(l,c)=>{this.handleWebSocketPayload(l,c)},onReconnectAttempt:()=>{this.logger.info("Attempting to reconnect...")},onError:l=>{this.logger.error("WebSocket error:",l),this.options.onError?.(l)}})}static autoInit(){let e=(0,Ut.createLogger)({scope:"Client:autoInit"}),t=()=>{let r=document.querySelector("[data-lvt-id]");if(r){let n=new o;n.wrapperElement=r,r.getAttribute("data-lvt-loading")==="true"&&(n.loadingIndicator.show(),n.formDisabler.disable(n.wrapperElement)),n.connect().catch(a=>{e.error("Auto-initialization connect failed:",a)}),window.liveTemplateClient=n}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t()}handleWebSocketPayload(e,t){t&&(window.__lastWSMessage=t.data,window.__wsMessages||(window.__wsMessages=[]),window.__wsMessages.push(e));let r=e;if(r.type==="upload_progress"){this.uploadHandler.handleProgressMessage(r);return}if(r.upload_name&&r.entries){let n=r;try{this.handleUploadStartResponse(n)}catch(i){this.logger.error("Error handling upload start response:",i)}return}if(r.upload_name&&r.hasOwnProperty("success")){r.success?this.logger.info(`Upload complete: ${r.upload_name}`):this.logger.error(`Upload failed: ${r.upload_name}`,r.error);return}this.isInitialized||(this.loadingIndicator.hide(),this.formDisabler.enable(this.wrapperElement),this.wrapperElement&&this.wrapperElement.hasAttribute("data-lvt-loading")&&this.wrapperElement.removeAttribute("data-lvt-loading"),this.isInitialized=!0),this.wrapperElement&&(this.updateDOM(this.wrapperElement,e.tree,e.meta),this.messageCount++,window.__wsMessageCount=this.messageCount,this.wrapperElement.dispatchEvent(new CustomEvent("lvt:updated",{detail:{messageCount:this.messageCount,action:e.meta?.action,success:e.meta?.success}})))}async connect(e="[data-lvt-id]"){if(this.wrapperElement=document.querySelector(e),!this.wrapperElement)throw new Error(`LiveTemplate wrapper not found with selector: ${e}`);this.webSocketManager.disconnect();let t=await this.webSocketManager.connect();this.useHTTP=!t.usingWebSocket,this.useHTTP&&(this.ws=null,this.logger.info("WebSocket not available, using HTTP mode"),this.options.onConnect?.(),t.initialState&&this.wrapperElement&&this.handleWebSocketPayload(t.initialState)),this.eventDelegator.setupEventDelegation(),this.eventDelegator.setupWindowEventDelegation(),this.eventDelegator.setupClickAwayDelegation(),this.eventDelegator.setupModalDelegation(),this.eventDelegator.setupFocusTrapDelegation(),this.eventDelegator.setupAutofocusDelegation(),(0,Pr.setupReactiveAttributeListeners)(),this.focusManager.attach(this.wrapperElement),this.observerManager.setupInfiniteScrollObserver(),this.observerManager.setupInfiniteScrollMutationObserver()}disconnect(){this.webSocketManager.disconnect(),this.ws=null,this.useHTTP=!1,this.observerManager.teardown(),this.formLifecycleManager.reset(),this.loadingIndicator.hide(),this.formDisabler.enable(this.wrapperElement)}isReady(){let e=this.wrapperElement;return!e||e.hasAttribute("data-lvt-loading")?!1:this.useHTTP?!0:this.webSocketManager.getReadyState()===1}send(e){window.__lvtSendCalled=!0,window.__lvtMessageAction=e?.action;let t=this.webSocketManager.getReadyState();this.logger.isDebugEnabled()&&this.logger.debug("send() invoked",{message:e,useHTTP:this.useHTTP,hasWebSocket:t!==void 0,readyState:t}),this.useHTTP?(this.logger.debug("Using HTTP mode for send"),window.__lvtSendPath="http",this.sendHTTP(e)):t===1?(this.logger.debug("Sending via WebSocket"),window.__lvtSendPath="websocket",window.__lvtWSMessage=JSON.stringify(e),this.webSocketManager.send(JSON.stringify(e)),this.logger.debug("WebSocket send complete"),window.__lvtWSSendComplete=!0):t!==void 0?(this.logger.warn(`WebSocket not ready (state: ${t}), using HTTP fallback`),window.__lvtSendPath="http-fallback",this.sendHTTP(e)):(this.logger.error("No transport available"),window.__lvtSendPath="no-transport")}async sendHTTP(e){try{let t=this.options.liveUrl||"/live",r=await fetch(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)});if(!r.ok)throw new Error(`HTTP request failed: ${r.status}`);let n=await r.json();this.wrapperElement&&this.updateDOM(this.wrapperElement,n.tree,n.meta)}catch(t){this.logger.error("Failed to send HTTP request:",t)}}parseValue(e){let t=parseFloat(e);return!isNaN(t)&&e.trim()===t.toString()?t:e==="true"?!0:e==="false"?!1:e}applyUpdate(e){return this.treeRenderer.applyUpdate(e)}applyUpdateToHTML(e,t){let r=this.applyUpdate(t);if(!this.lvtId){let c=e.match(/data-lvt-id="([^"]+)"/);c&&(this.lvtId=c[1])}let n=r.html;if(!e.match(/<body>([\s\S]*?)<\/body>/))return e;let l=`<div data-lvt-id="${this.lvtId||"lvt-unknown"}">`+n+"</div>";return e.replace(/<body>[\s\S]*?<\/body>/,`<body>${l}</body>`)}updateDOM(e,t,r){let n=this.applyUpdate(t),i=s=>!s||typeof s!="object"?!1:s.s&&Array.isArray(s.s)?!0:Object.values(s).some(l=>i(l));if(!n.changed&&!i(t))return;let a=document.createElement(e.tagName);this.logger.isDebugEnabled()&&(this.logger.debug("[updateDOM] element.tagName:",e.tagName),this.logger.debug("[updateDOM] result.html (first 500 chars):",n.html.substring(0,500)),this.logger.debug("[updateDOM] Has <table> tag:",n.html.includes("<table>")),this.logger.debug("[updateDOM] Has <tbody> tag:",n.html.includes("<tbody>")),this.logger.debug("[updateDOM] Has <tr> tag:",n.html.includes("<tr"))),a.innerHTML=n.html,this.logger.isDebugEnabled()&&(this.logger.debug("[updateDOM] tempWrapper.innerHTML (first 500 chars):",a.innerHTML.substring(0,500)),this.logger.debug("[updateDOM] tempWrapper has <table>:",a.innerHTML.includes("<table>")),this.logger.debug("[updateDOM] tempWrapper has <tbody>:",a.innerHTML.includes("<tbody>")),this.logger.debug("[updateDOM] tempWrapper has <tr>:",a.innerHTML.includes("<tr"))),(0,Ir.default)(e,a,{childrenOnly:!0,getNodeKey:s=>{if(s.nodeType===1)return s.getAttribute("data-key")||s.getAttribute("data-lvt-key")||void 0},onBeforeElUpdated:(s,l)=>{let c=this.focusManager.getLastFocusedElement();return c&&this.focusManager.isTextualInput(s)&&s===c&&(l.value=s.value),s.isEqualNode(l)?!1:(this.executeLifecycleHook(s,"lvt-updated"),!0)},onNodeAdded:s=>{s.nodeType===Node.ELEMENT_NODE&&this.executeLifecycleHook(s,"lvt-mounted")},onBeforeNodeDiscarded:s=>(s.nodeType===Node.ELEMENT_NODE&&this.executeLifecycleHook(s,"lvt-destroyed"),!0)}),this.focusManager.restoreFocusedElement(),(0,rt.handleScrollDirectives)(e),(0,rt.handleHighlightDirectives)(e),(0,rt.handleAnimateDirectives)(e),this.uploadHandler.initializeFileInputs(e),r&&this.formLifecycleManager.handleResponse(r)}handleUploadStartResponse(e){this.uploadHandler.handleUploadStartResponse(e)}executeLifecycleHook(e,t){let r=e.getAttribute(t);if(r)try{new Function("element",r).call(e,e)}catch(n){this.logger.error(`Error executing ${t} hook:`,n)}}reset(){this.treeRenderer.reset(),this.focusManager.reset(),this.observerManager.teardown(),this.formLifecycleManager.reset(),this.loadingIndicator.hide(),this.formDisabler.enable(this.wrapperElement),this.lvtId=null}getTreeState(){return this.treeRenderer.getTreeState()}getStaticStructure(){return this.treeRenderer.getStaticStructure()}};_.LiveTemplateClient=Oe;typeof window<"u"&&Oe.autoInit()});var Vr={};tr(Vr,{BaseBlock:()=>N,InteractiveBlock:()=>J,LivepageClient:()=>ne,MessageRouter:()=>K,MonacoEditor:()=>Q,OutputPanel:()=>Z,PersistenceManager:()=>V,RunButton:()=>ee,ServerBlock:()=>G,TinyGoExecutor:()=>te,WasmBlock:()=>re,hasEditableBlocks:()=>Re,initializeWasm:()=>Kt,isMonacoLoaded:()=>zt,loadMonaco:()=>le,preloadMonaco:()=>De});var Vt=at(nt());var K=class{constructor(e=!1){this.handlers=new Map;this.debug=e}register(e,t){this.handlers.has(e)&&console.warn(`[MessageRouter] Overwriting handler for block: ${e}`),this.handlers.set(e,t),this.debug&&console.log(`[MessageRouter] Registered handler for block: ${e}`)}unregister(e){this.handlers.delete(e),this.debug&&console.log(`[MessageRouter] Unregistered handler for block: ${e}`)}route(e){try{let t=typeof e=="string"?JSON.parse(e):e,{blockID:r,action:n,data:i}=t;if(n==="reload"){this.handleReload(i?.filePath||"");return}if(!r){console.error("[MessageRouter] Message missing blockID:",t);return}let a=this.handlers.get(r);if(!a){console.warn(`[MessageRouter] No handler for block: ${r}`);return}this.debug&&console.log(`[MessageRouter] Routing to ${r}:`,{action:n,data:i}),a(n,i)}catch(t){console.error("[MessageRouter] Error routing message:",t)}}handleReload(e){console.log(`[MessageRouter] Page reloading: ${e} changed`),this.showReloadNotification(e),setTimeout(()=>{window.location.reload()},500)}showReloadNotification(e){let t=document.getElementById("livepage-reload-notification");t&&t.remove();let r=document.createElement("div");r.id="livepage-reload-notification",r.innerHTML=`
      <div style="
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 16px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 100000;
        font-family: system-ui, -apple-system, sans-serif;
        font-size: 14px;
        animation: slideIn 0.3s ease-out;
      ">
        <div style="display: flex; align-items: center; gap: 10px;">
          <div style="font-size: 20px;">\u{1F504}</div>
          <div>
            <div style="font-weight: 600;">File Updated</div>
            <div style="opacity: 0.9; font-size: 12px; margin-top: 2px;">${e}</div>
          </div>
        </div>
      </div>
    `;let n=document.createElement("style");n.textContent=`
      @keyframes slideIn {
        from {
          transform: translateX(400px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
    `,document.head.appendChild(n),document.body.appendChild(r)}createEnvelope(e,t,r={}){return{blockID:e,action:t,data:r}}getRegisteredBlocks(){return Array.from(this.handlers.keys())}clear(){this.handlers.clear(),this.debug&&console.log("[MessageRouter] Cleared all handlers")}};var V=class{constructor(e="livepage:persistence",t=!0,r=!1){this.storageKey=e,this.enabled=t&&this.isLocalStorageAvailable(),this.debug=r,!this.enabled&&t&&console.warn("[PersistenceManager] localStorage not available, persistence disabled")}isLocalStorageAvailable(){try{let e="__localStorage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}saveCode(e,t){if(this.enabled)try{let r=this.loadAll();r.code[e]=t,r.timestamp=Date.now(),localStorage.setItem(this.storageKey,JSON.stringify(r)),this.debug&&console.log(`[PersistenceManager] Saved code for block: ${e}`)}catch(r){console.error("[PersistenceManager] Error saving code:",r)}}loadCode(e){if(!this.enabled)return null;try{return this.loadAll().code[e]||null}catch(t){return console.error("[PersistenceManager] Error loading code:",t),null}}loadAll(){if(!this.enabled)return{code:{},timestamp:Date.now()};try{let e=localStorage.getItem(this.storageKey);if(!e)return{code:{},timestamp:Date.now()};let t=JSON.parse(e);return!t.code||typeof t.code!="object"?(console.warn("[PersistenceManager] Invalid data structure, resetting"),{code:{},timestamp:Date.now()}):t}catch(e){return console.error("[PersistenceManager] Error loading data:",e),{code:{},timestamp:Date.now()}}}clearCode(e){if(this.enabled)try{let t=this.loadAll();delete t.code[e],t.timestamp=Date.now(),localStorage.setItem(this.storageKey,JSON.stringify(t)),this.debug&&console.log(`[PersistenceManager] Cleared code for block: ${e}`)}catch(t){console.error("[PersistenceManager] Error clearing code:",t)}}clearAll(){if(this.enabled)try{localStorage.removeItem(this.storageKey),this.debug&&console.log("[PersistenceManager] Cleared all persisted data")}catch(e){console.error("[PersistenceManager] Error clearing all data:",e)}}getPersistedBlocks(){if(!this.enabled)return[];let e=this.loadAll();return Object.keys(e.code)}hasPersistedCode(e){if(!this.enabled)return!1;let t=this.loadAll();return e in t.code}getLastUpdate(){return this.enabled?this.loadAll().timestamp:null}};var N=class{constructor(e,t,r=!1){this.element=e.element,this.metadata=e.metadata,this.persistence=t,this.initialCode=e.initialCode||"",this.currentCode=this.initialCode,this.debug=r}get id(){return this.metadata.id}get type(){return this.metadata.type}getCode(){return this.currentCode}setCode(e){this.currentCode=e,this.metadata.editable&&this.persistence.saveCode(this.id,e)}reset(){this.setCode(this.initialCode),this.debug&&console.log(`[Block:${this.id}] Reset to initial code`)}loadPersistedCode(){if(!this.metadata.editable)return this.initialCode;let e=this.persistence.loadCode(this.id);return e?(this.debug&&console.log(`[Block:${this.id}] Loaded persisted code`),e):this.initialCode}createBlockWrapper(){let e=document.createElement("div");return e.className=`livepage-block livepage-block-${this.type}`,e.dataset.blockId=this.id,e.dataset.blockType=this.type,e}log(...e){this.debug&&console.log(`[Block:${this.id}]`,...e)}error(...e){console.error(`[Block:${this.id}]`,...e)}};var G=class extends N{constructor(t,r,n=!1){super(t,r,n);this.codeElement=null}initialize(){this.log("Initializing server block"),this.codeElement=this.element.querySelector("code")||this.element,this.element.classList.add("livepage-server-block"),this.metadata.readonly&&this.element.classList.add("readonly"),this.element.dataset.blockId=this.id,this.element.dataset.language=this.metadata.language,this.render(),this.log("Server block initialized")}destroy(){this.log("Destroying server block")}handleMessage(t,r){this.log("Received message:",t,r),console.warn(`[ServerBlock:${this.id}] Received unexpected message:`,t)}render(){this.codeElement&&this.log("Rendered server block")}};var Y=at(nt());var J=class extends N{constructor(t,r,n=!1){super(t,r,n);this.client=null;this.containerElement=null;this.sendMessage=null;this.pendingForm=null;this.pendingAction=null}initialize(){this.log("Initializing interactive block"),this.containerElement=this.element.querySelector("[data-interactive-content]")||this.element,this.element.classList.add("livepage-interactive-block"),this.element.dataset.blockId=this.id,this.metadata.stateRef&&(this.element.dataset.stateRef=this.metadata.stateRef),this.client=new Y.LiveTemplateClient,this.attachEventHandlers(),this.log("Interactive block initialized")}destroy(){this.log("Destroying interactive block"),this.client&&(this.client=null)}handleMessage(t,r){switch(this.log("Received message:",t,r),t){case"tree":if(r&&this.containerElement&&this.client&&(this.client.updateDOM(this.containerElement,r),this.log("DOM updated with tree"),this.pendingForm)){let n={success:!0,errors:{},action:this.pendingAction};this.pendingForm.dispatchEvent(new CustomEvent("lvt:success",{bubbles:!0,detail:n})),this.log("Dispatched lvt:success event"),this.pendingForm=null,this.pendingAction=null}break;case"error":if(this.error("Server error:",r.message),this.pendingForm){let n={success:!1,errors:r.errors||{},action:this.pendingAction};this.pendingForm.dispatchEvent(new CustomEvent("lvt:error",{bubbles:!0,detail:n})),this.pendingForm=null,this.pendingAction=null}break;default:this.log("Unknown action:",t)}}setMessageSender(t){this.sendMessage=t}attachEventHandlers(){this.element&&(this.element.addEventListener("click",t=>this.handleClick(t),!0),this.element.addEventListener("submit",t=>this.handleSubmit(t),!0),this.element.addEventListener("change",t=>this.handleChange(t),!0))}handleClick(t){let r=t.target,n=r.getAttribute("lvt-click");if(n){if(t.preventDefault(),!(0,Y.checkLvtConfirm)(r)){this.log("Click action cancelled by user:",n);return}let i=(0,Y.extractLvtData)(r);this.sendAction(n,i),this.log("Click action:",n,i)}}handleSubmit(t){let r=t.target,n=r.getAttribute("lvt-submit");if(n){t.preventDefault();let i=new FormData(r),a={};i.forEach((s,l)=>{a[l]=s}),this.pendingForm=r,this.pendingAction=n,r.dispatchEvent(new CustomEvent("lvt:pending",{bubbles:!0,detail:{action:n}})),this.sendAction(n,a),this.log("Submit action:",n,a)}}handleChange(t){let r=t.target,n=r.getAttribute("lvt-change");if(n){let i={value:r.value};this.sendAction(n,i),this.log("Change action:",n,i)}}sendAction(t,r={}){if(!this.sendMessage){this.error("Cannot send action - no message sender configured");return}this.sendMessage(this.id,t,r)}};var qr="0.45.0",j=`https://cdn.jsdelivr.net/npm/monaco-editor@${qr}/min`,ae=null,X=null;function zr(){return new Promise((o,e)=>{if(typeof window.require=="function"){o();return}let t=document.createElement("script");t.src=`${j}/vs/loader.js`,t.async=!0,t.onload=()=>o(),t.onerror=()=>e(new Error("Failed to load Monaco loader from CDN")),document.head.appendChild(t)})}function Kr(){window.MonacoEnvironment={getWorkerUrl:function(o,e){let t=`${j}/vs/base/worker/workerMain.js`;return e==="json"?`${j}/vs/language/json/json.worker.js`:e==="css"||e==="scss"||e==="less"?`${j}/vs/language/css/css.worker.js`:e==="html"||e==="handlebars"||e==="razor"?`${j}/vs/language/html/html.worker.js`:e==="typescript"||e==="javascript"?`${j}/vs/language/typescript/ts.worker.js`:t}}}async function le(){if(ae)return ae;if(X)return X;console.log("[MonacoLoader] Loading Monaco Editor from CDN...");let o=performance.now();return X=(async()=>{try{await zr();let e=window.require;if(!e)throw new Error("AMD loader not available after loading");return e.config({paths:{vs:`${j}/vs`}}),Kr(),await new Promise((t,r)=>{e(["vs/editor/editor.main"],n=>{if(!n){r(new Error("Monaco module loaded but is undefined"));return}ae=n;let i=Math.round(performance.now()-o);console.log(`[MonacoLoader] Monaco Editor loaded from CDN in ${i}ms`),t(n)})})}catch(e){throw X=null,e}})(),X}function zt(){return ae!==null}function De(){!ae&&!X&&le().catch(o=>{console.error("[MonacoLoader] Failed to preload Monaco from CDN:",o)})}function Re(){return document.querySelectorAll('[data-block-type="wasm"]').length>0}var Q=class{constructor(e,t,r){this.editor=null;this.monaco=null;this.onChangeCallback=null;this.editorDiv=null;this.initPromise=null;this.container=e,this.initialCode=t,this.options=r,this.initPromise=this.initialize()}async initialize(){let e=document.createElement("div");e.className="livepage-monaco-loading",e.style.padding="2rem",e.style.textAlign="center",e.style.color="#999",e.textContent="Loading editor...",this.container.appendChild(e);try{this.monaco=await le(),e.remove(),this.editorDiv=document.createElement("div"),this.editorDiv.className="livepage-monaco-editor",this.editorDiv.style.height="300px",this.editorDiv.style.width="100%",this.container.appendChild(this.editorDiv),this.editor=this.monaco.editor.create(this.editorDiv,{value:this.initialCode,language:this.options.language,theme:this.options.theme||"vs-dark",readOnly:this.options.readonly,minimap:{enabled:this.options.minimap??!0},lineNumbers:this.options.lineNumbers!==!1?"on":"off",scrollBeyondLastLine:!1,automaticLayout:!0,fontSize:14,tabSize:4,insertSpaces:!1}),this.editor.onDidChangeModelContent(()=>{this.onChangeCallback&&this.editor&&this.onChangeCallback(this.editor.getValue())})}catch(t){console.error("[MonacoEditor] Failed to load Monaco:",t),e.textContent="Failed to load editor",e.style.color="#f44"}}async ensureReady(){this.initPromise&&await this.initPromise}getValue(){return this.editor?.getValue()||""}async setValue(e){await this.ensureReady(),this.editor?.setValue(e)}onChange(e){this.onChangeCallback=e}async setReadOnly(e){await this.ensureReady(),this.editor?.updateOptions({readOnly:e})}async focus(){await this.ensureReady(),this.editor?.focus()}async layout(){await this.ensureReady(),this.editor?.layout()}destroy(){this.editor?.dispose(),this.editor=null}async getEditor(){return await this.ensureReady(),this.editor}};var Z=class{constructor(e,t=1e3,r=!0){this.lines=[];this.maxLines=t,this.autoScroll=r,this.element=this.createPanel(),e.appendChild(this.element)}createPanel(){let e=document.createElement("div");e.className="livepage-output-panel",e.innerHTML=`
      <div class="output-header">
        <span class="output-title">Output</span>
        <button class="output-clear" title="Clear output">Clear</button>
      </div>
      <div class="output-content"></div>
    `;let t=e.querySelector(".output-clear");return t&&t.addEventListener("click",()=>this.clear()),e}append(e,t){let r={type:e,text:t,timestamp:Date.now()};this.lines.push(r),this.lines.length>this.maxLines&&(this.lines=this.lines.slice(-this.maxLines)),this.render()}stdout(e){this.append("stdout",e)}stderr(e){this.append("stderr",e)}error(e){this.append("error",e)}info(e){this.append("info",e)}clear(){this.lines=[],this.render()}show(){this.element.style.display="block"}hide(){this.element.style.display="none"}render(){let e=this.element.querySelector(".output-content");if(e){e.innerHTML="";for(let t of this.lines){let r=document.createElement("div");r.className=`output-line output-${t.type}`,r.textContent=t.text,e.appendChild(r)}this.autoScroll&&(e.scrollTop=e.scrollHeight)}}getElement(){return this.element}destroy(){this.element.remove()}};var ee=class{constructor(e,t="Run"){this.callback=null;this.isRunning=!1;this.element=this.createButton(t),e.appendChild(this.element)}createButton(e){let t=document.createElement("button");return t.className="livepage-run-button",t.textContent=e,t.addEventListener("click",()=>this.handleClick()),t}onClick(e){this.callback=e}async handleClick(){if(!(this.isRunning||!this.callback)){this.setRunning(!0);try{await this.callback()}catch(e){console.error("[RunButton] Error executing callback:",e)}finally{this.setRunning(!1)}}}setRunning(e){this.isRunning=e,this.element.disabled=e,e?(this.element.classList.add("running"),this.element.textContent="Running..."):(this.element.classList.remove("running"),this.element.textContent="Run")}enable(){this.element.disabled=!1}disable(){this.element.disabled=!0}getElement(){return this.element}destroy(){this.element.remove()}};var te=class{constructor(e="/api/compile",t=!1){this.serverUrl=e,this.debug=t}async execute(e){this.debug&&console.log("[TinyGoExecutor] Executing code:",e);try{let t=await fetch(this.serverUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})});if(!t.ok){let n=await t.text();return{stdout:"",stderr:n,error:`Compilation failed: ${n}`,exitCode:1}}let r=await t.arrayBuffer();return await this.executeWasm(r)}catch(t){return{stdout:"",stderr:"",error:`Execution failed: ${t instanceof Error?t.message:String(t)}`,exitCode:1}}}async executeWasm(e){let t="",r="";try{let n=new window.Go,i=console.log,a=console.error;console.log=(...l)=>{t+=l.join(" ")+`
`},console.error=(...l)=>{r+=l.join(" ")+`
`};let s=await WebAssembly.instantiate(e,n.importObject);return await n.run(s.instance),console.log=i,console.error=a,{stdout:t,stderr:r,exitCode:0}}catch(n){let i=n instanceof Error?n.message:String(n);return{stdout:t,stderr:r,error:`WASM execution failed: ${i}`,exitCode:1}}}static isSupported(){return typeof WebAssembly<"u"&&typeof window.Go<"u"}};async function Kt(){if(!window.Go)try{let o=document.createElement("script");o.src="/assets/wasm_exec.js",await new Promise((e,t)=>{o.onload=()=>e(),o.onerror=()=>t(new Error("Failed to load wasm_exec.js")),document.head.appendChild(o)}),console.log("[TinyGoExecutor] WASM environment initialized")}catch(o){throw console.error("[TinyGoExecutor] Failed to initialize WASM:",o),o}}var re=class extends N{constructor(t,r,n=!1){super(t,r,n);this.editor=null;this.outputPanel=null;this.runButton=null;this.executor=null;this.containerElement=null;this.editorContainer=null;this.controlsContainer=null}initialize(){this.log("Initializing WASM block"),this.currentCode=this.loadPersistedCode(),this.createBlockStructure(),this.initializeEditor(),this.initializeControls(),this.initializeExecutor(),this.log("WASM block initialized")}destroy(){this.log("Destroying WASM block"),this.editor?.destroy(),this.outputPanel?.destroy(),this.runButton?.destroy(),this.editor=null,this.outputPanel=null,this.runButton=null,this.executor=null}handleMessage(t,r){this.log("Received message:",t,r)}createBlockStructure(){this.containerElement=document.createElement("div"),this.containerElement.className="livepage-wasm-block",this.containerElement.dataset.blockId=this.id,this.editorContainer=document.createElement("div"),this.editorContainer.className="wasm-editor-container",this.containerElement.appendChild(this.editorContainer),this.controlsContainer=document.createElement("div"),this.controlsContainer.className="wasm-controls",this.containerElement.appendChild(this.controlsContainer),this.element.parentNode&&this.element.parentNode.replaceChild(this.containerElement,this.element)}initializeEditor(){this.editorContainer&&(this.editor=new Q(this.editorContainer,this.currentCode,{language:this.metadata.language||"go",readonly:this.metadata.readonly||!1,theme:"vs-dark",minimap:!1,lineNumbers:!0}),this.editor.onChange(t=>{this.setCode(t)}),this.log("Editor initialized"))}initializeControls(){if(!this.controlsContainer)return;let t=document.createElement("div");t.className="wasm-buttons",this.runButton=new ee(t,"Run"),this.runButton.onClick(()=>this.executeCode());let r=document.createElement("button");r.className="livepage-reset-button",r.textContent="Reset",r.addEventListener("click",()=>this.resetCode()),t.appendChild(r),this.controlsContainer.appendChild(t),this.outputPanel=new Z(this.controlsContainer),this.outputPanel.hide(),this.log("Controls initialized")}initializeExecutor(){this.executor=new te("/api/compile",this.debug),this.log("Executor initialized")}async executeCode(){if(!this.editor||!this.executor||!this.outputPanel){this.error("Cannot execute - components not initialized");return}let t=this.editor.getValue();this.log("Executing code"),this.outputPanel.clear(),this.outputPanel.show(),this.outputPanel.info("Compiling and running...");try{let r=await this.executor.execute(t);this.outputPanel.clear(),r.stdout&&this.outputPanel.stdout(r.stdout),r.stderr&&this.outputPanel.stderr(r.stderr),r.error&&this.outputPanel.error(r.error),r.exitCode===0&&!r.stdout&&!r.stderr&&this.outputPanel.info("Program completed successfully (no output)"),this.log("Execution completed with exit code:",r.exitCode)}catch(r){let n=r instanceof Error?r.message:String(r);this.outputPanel.error(`Execution error: ${n}`),this.error("Execution error:",r)}}resetCode(){this.editor&&(this.editor.setValue(this.initialCode),this.setCode(this.initialCode),this.outputPanel?.clear(),this.log("Code reset to initial state"))}};var ne=class{constructor(e){this.blocks=new Map;this.ws=null;this.reconnectTimer=null;this.isConnected=!1;this.options={debug:!1,persistence:!0,cdnFallback:!1,...e},this.router=new K(this.options.debug),this.persistence=new V("livepage:persistence",this.options.persistence,this.options.debug),this.options.debug&&console.log("[LivepageClient] Initialized with options:",this.options)}connect(){if(this.ws){console.warn("[LivepageClient] Already connected");return}try{this.ws=new WebSocket(this.options.wsUrl),this.ws.onopen=()=>{this.isConnected=!0,console.log("[LivepageClient] Connected to server"),this.options.onConnect?.()},this.ws.onclose=()=>{this.isConnected=!1,console.log("[LivepageClient] Disconnected from server"),this.options.onDisconnect?.(),this.scheduleReconnect()},this.ws.onerror=e=>{console.error("[LivepageClient] WebSocket error:",e),this.options.onError?.(new Error("WebSocket error"))},this.ws.onmessage=e=>{this.handleMessage(e.data)}}catch(e){console.error("[LivepageClient] Failed to connect:",e),this.options.onError?.(e)}}disconnect(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws&&(this.ws.close(),this.ws=null),this.isConnected=!1}handleMessage(e){this.options.debug&&console.log("[LivepageClient] Received message:",e),this.router.route(e)}send(e,t,r={}){if(!this.isConnected||!this.ws){console.warn("[LivepageClient] Cannot send - not connected");return}let i=JSON.stringify({blockID:e,action:t,data:r});this.options.debug&&console.log("[LivepageClient] Sending message:",i),this.ws.send(i)}scheduleReconnect(){this.reconnectTimer||(this.reconnectTimer=window.setTimeout(()=>{this.reconnectTimer=null,console.log("[LivepageClient] Attempting to reconnect..."),this.connect()},3e3))}discoverBlocks(){console.log("[LivepageClient] Discovering blocks..."),(0,Vt.setupReactiveAttributeListeners)();let e=document.querySelectorAll("[data-livepage-block]");for(let t of Array.from(e))try{let r=this.extractMetadata(t),n=this.extractCode(t),i={element:t,metadata:r,initialCode:n};this.registerBlock(i)}catch(r){console.error("[LivepageClient] Error discovering block:",r)}console.log(`[LivepageClient] Discovered ${this.blocks.size} blocks`)}extractMetadata(e){let t=e.dataset.blockId||this.generateBlockId(),r=e.dataset.blockType||"server",n=e.dataset.language||"go",i=e.dataset.readonly==="true",a=e.dataset.editable==="true",s=e.dataset.stateRef;return{id:t,type:r,language:n,readonly:i,editable:a,stateRef:s}}extractCode(e){let t=e.querySelector("code");return t?t.textContent||"":e.textContent||""}generateBlockId(){return`block-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}registerBlock(e){let{metadata:t}=e;if(this.blocks.has(t.id)){console.warn(`[LivepageClient] Block already registered: ${t.id}`);return}let r;switch(t.type){case"server":r=new G(e,this.persistence,this.options.debug);break;case"interactive":case"lvt":r=new J(e,this.persistence,this.options.debug),r.setMessageSender((n,i,a)=>{this.send(n,i,a)});break;case"wasm":r=new re(e,this.persistence,this.options.debug);break;default:console.warn(`[LivepageClient] Unknown block type: ${t.type}`);return}r.initialize(),this.router.register(t.id,(n,i)=>{r.handleMessage(n,i)}),this.blocks.set(t.id,r),this.options.debug&&console.log(`[LivepageClient] Registered block: ${t.id} (${t.type})`)}unregisterBlock(e){let t=this.blocks.get(e);t&&(t.destroy(),this.router.unregister(e),this.blocks.delete(e),this.options.debug&&console.log(`[LivepageClient] Unregistered block: ${e}`))}getBlock(e){return this.blocks.get(e)}getBlockIds(){return Array.from(this.blocks.keys())}destroy(){console.log("[LivepageClient] Destroying client");for(let e of this.blocks.values())e.destroy();this.blocks.clear(),this.router.clear(),this.disconnect()}};var Ne=class{constructor(){this.steps=[];this.currentStepIndex=0;this.sidebar=null;this.bottomNav=null;this.init()}init(){document.querySelector(".livepage-nav-sidebar")||(this.parseSteps(),this.steps.length!==0&&(this.createSidebar(),this.createBottomNav(),this.setupKeyboardShortcuts(),this.setupHashNavigation(),this.setupScrollTracking(),this.initializeFromHash()))}parseSteps(){document.querySelectorAll("h2").forEach((t,r)=>{let n=t.id||this.generateId(t.textContent||"");t.id||(t.id=n),this.steps.push({id:n,title:t.textContent||"",element:t,index:r})})}generateId(e){return e.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim()}createSidebar(){this.sidebar=document.createElement("nav"),this.sidebar.className="livepage-nav-sidebar",this.sidebar.innerHTML=`
      <div class="nav-sidebar-header">
        <h3>Contents</h3>
      </div>
      <ol class="nav-sidebar-steps">
        ${this.steps.map((e,t)=>`
          <li class="nav-step ${t===0?"active":""}" data-step="${t}">
            <a href="#${e.id}">
              <span class="step-number">${t+1}</span>
              <span class="step-title">${e.title}</span>
            </a>
          </li>
        `).join("")}
      </ol>
    `,this.sidebar.querySelectorAll(".nav-step").forEach((e,t)=>{e.addEventListener("click",r=>{r.preventDefault(),this.navigateToStep(t)})}),document.body.appendChild(this.sidebar)}createBottomNav(){this.bottomNav=document.createElement("nav"),this.bottomNav.className="livepage-nav-bottom",this.bottomNav.innerHTML=`
      <button class="nav-btn nav-prev" ${this.currentStepIndex===0?"disabled":""}>
        <span class="nav-arrow">\u2190</span>
        <span class="nav-label">Previous</span>
      </button>
      <span class="nav-progress">
        Step <span class="current-step">1</span> of <span class="total-steps">${this.steps.length}</span>
      </span>
      <button class="nav-btn nav-next" ${this.currentStepIndex===this.steps.length-1?"disabled":""}>
        <span class="nav-label">Next</span>
        <span class="nav-arrow">\u2192</span>
      </button>
    `;let e=this.bottomNav.querySelector(".nav-prev"),t=this.bottomNav.querySelector(".nav-next");e?.addEventListener("click",()=>this.navigatePrev()),t?.addEventListener("click",()=>this.navigateNext()),document.body.appendChild(this.bottomNav)}setupKeyboardShortcuts(){document.addEventListener("keydown",e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))switch(e.key){case"ArrowRight":case"ArrowDown":e.preventDefault(),this.navigateNext();break;case"ArrowLeft":case"ArrowUp":e.preventDefault(),this.navigatePrev();break}})}setupHashNavigation(){window.addEventListener("hashchange",()=>{this.handleHashChange()})}setupScrollTracking(){let e=new IntersectionObserver(t=>{t.forEach(r=>{if(r.isIntersecting){let n=r.target,i=this.steps.findIndex(a=>a.element===n);i!==-1&&i!==this.currentStepIndex&&this.updateCurrentStep(i,!1)}})},{threshold:.5,rootMargin:"-100px 0px -50% 0px"});this.steps.forEach(t=>e.observe(t.element))}initializeFromHash(){let e=window.location.hash.slice(1);if(e){let t=this.steps.findIndex(r=>r.id===e);if(t!==-1){this.navigateToStep(t);return}}this.updateCurrentStep(0,!1)}handleHashChange(){let e=window.location.hash.slice(1);if(e){let t=this.steps.findIndex(r=>r.id===e);t!==-1&&this.navigateToStep(t,!1)}}navigateToStep(e,t=!0){e<0||e>=this.steps.length||(this.updateCurrentStep(e,!0),t&&history.pushState(null,"",`#${this.steps[e].id}`))}navigateNext(){this.currentStepIndex<this.steps.length-1&&this.navigateToStep(this.currentStepIndex+1)}navigatePrev(){this.currentStepIndex>0&&this.navigateToStep(this.currentStepIndex-1)}updateCurrentStep(e,t=!0){if(this.currentStepIndex=e,this.sidebar&&this.sidebar.querySelectorAll(".nav-step").forEach((r,n)=>{r.classList.toggle("active",n===e)}),this.bottomNav){let r=this.bottomNav.querySelector(".nav-prev"),n=this.bottomNav.querySelector(".nav-next"),i=this.bottomNav.querySelector(".current-step");r&&(r.disabled=e===0),n&&(n.disabled=e===this.steps.length-1),i&&(i.textContent=String(e+1))}t&&this.scrollToStep(e)}scrollToStep(e){let t=this.steps[e];t&&t.element.scrollIntoView({behavior:"smooth",block:"start"})}getCurrentStep(){return this.currentStepIndex}getTotalSteps(){return this.steps.length}goToStep(e){this.navigateToStep(e)}};var Be=class{constructor(){this.searchIndex=[];this.searchModal=null;this.searchInput=null;this.resultsContainer=null;this.selectedIndex=0;document.querySelector(".livepage-nav-sidebar")&&this.init()}async init(){await this.loadSearchIndex(),this.createSearchModal(),this.setupKeyboardShortcuts(),this.addSearchButton()}async loadSearchIndex(){try{let e=await fetch("/search-index.json");if(!e.ok){console.warn("[Search] Failed to load search index");return}this.searchIndex=await e.json(),console.log(`[Search] Loaded ${this.searchIndex.length} pages`)}catch(e){console.error("[Search] Error loading search index:",e)}}createSearchModal(){this.searchModal=document.createElement("div"),this.searchModal.className="search-modal",this.searchModal.innerHTML=`
      <div class="search-backdrop"></div>
      <div class="search-container">
        <div class="search-input-wrapper">
          <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          <input
            type="text"
            class="search-input"
            placeholder="Search documentation..."
            autocomplete="off"
            spellcheck="false"
          />
          <button class="search-close" aria-label="Close search">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        <div class="search-results"></div>
        <div class="search-footer">
          <div class="search-hints">
            <span><kbd>\u2191</kbd><kbd>\u2193</kbd> Navigate</span>
            <span><kbd>\u21B5</kbd> Select</span>
            <span><kbd>Esc</kbd> Close</span>
          </div>
        </div>
      </div>
    `,document.body.appendChild(this.searchModal),this.searchInput=this.searchModal.querySelector(".search-input"),this.resultsContainer=this.searchModal.querySelector(".search-results"),this.searchInput?.addEventListener("input",()=>this.handleSearch()),this.searchInput?.addEventListener("keydown",e=>this.handleKeyDown(e)),this.searchModal.querySelector(".search-close")?.addEventListener("click",()=>this.closeSearch()),this.searchModal.querySelector(".search-backdrop")?.addEventListener("click",()=>this.closeSearch())}addSearchButton(){let e=document.querySelector(".livepage-nav-sidebar");if(!e)return;let t=e.querySelector(".nav-header");if(!t)return;let r=document.createElement("button");r.className="search-button",r.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
      <span>Search</span>
      <kbd>\u2318K</kbd>
    `,r.addEventListener("click",()=>this.openSearch()),t.appendChild(r)}setupKeyboardShortcuts(){document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="k"&&(e.preventDefault(),this.openSearch()),e.key==="Escape"&&this.searchModal?.classList.contains("open")&&this.closeSearch()})}openSearch(){this.searchModal?.classList.add("open"),this.searchInput?.focus(),this.selectedIndex=0}closeSearch(){this.searchModal?.classList.remove("open"),this.searchInput&&(this.searchInput.value=""),this.resultsContainer&&(this.resultsContainer.innerHTML="")}handleSearch(){let e=this.searchInput?.value.trim()||"";if(e.length===0){this.resultsContainer&&(this.resultsContainer.innerHTML="");return}let t=this.search(e);this.renderResults(t)}search(e){let t=e.toLowerCase(),r=[];for(let n of this.searchIndex){let i=n.title.toLowerCase(),a=n.content.toLowerCase(),s=i.includes(t),l=a.includes(t);if(s||l){let c=0;s&&(c+=10,i===t?c+=50:i.startsWith(t)&&(c+=20)),l&&(c+=1),r.push({...n,score:c,titleMatches:s,contentMatches:l})}}return r.sort((n,i)=>i.score-n.score),r.slice(0,10)}renderResults(e){if(this.resultsContainer){if(e.length===0){this.resultsContainer.innerHTML='<div class="search-no-results">No results found</div>';return}this.resultsContainer.innerHTML=e.map((t,r)=>`
      <a
        href="${t.path}"
        class="search-result ${r===this.selectedIndex?"selected":""}"
        data-index="${r}"
      >
        <div class="search-result-title">
          ${this.highlightMatch(t.title,this.searchInput?.value||"")}
        </div>
        ${t.section?`<div class="search-result-section">${t.section}</div>`:""}
        <div class="search-result-content">
          ${this.highlightMatch(this.truncateContent(t.content),this.searchInput?.value||"")}
        </div>
      </a>
    `).join(""),this.resultsContainer.querySelectorAll(".search-result").forEach(t=>{t.addEventListener("click",()=>this.closeSearch())})}}highlightMatch(e,t){if(!t)return e;let r=new RegExp(`(${this.escapeRegex(t)})`,"gi");return e.replace(r,"<mark>$1</mark>")}truncateContent(e,t=200){return e.length<=t?e:e.substring(0,t)+"..."}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}handleKeyDown(e){if(!this.resultsContainer)return;let t=this.resultsContainer.querySelectorAll(".search-result");switch(e.key){case"Escape":e.preventDefault(),this.closeSearch();break;case"ArrowDown":if(t.length===0)return;e.preventDefault(),this.selectedIndex=Math.min(this.selectedIndex+1,t.length-1),this.updateSelection();break;case"ArrowUp":if(t.length===0)return;e.preventDefault(),this.selectedIndex=Math.max(this.selectedIndex-1,0),this.updateSelection();break;case"Enter":if(t.length===0)return;e.preventDefault();let r=t[this.selectedIndex];r&&(window.location.href=r.href,this.closeSearch());break}}updateSelection(){if(!this.resultsContainer)return;let e=this.resultsContainer.querySelectorAll(".search-result");e.forEach((r,n)=>{r.classList.toggle("selected",n===this.selectedIndex)});let t=e[this.selectedIndex];t&&t.scrollIntoView({block:"nearest",behavior:"smooth"})}};var He=class o{static{this.COPY_BUTTON_CLASS="code-copy-btn"}static{this.CODE_WRAPPER_CLASS="code-block-wrapper"}static{this.COPIED_CLASS="copied"}constructor(){this.init()}init(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.addCopyButtons()):this.addCopyButtons()}addCopyButtons(){document.querySelectorAll("pre > code").forEach(t=>{let r=t.parentElement;if(!r||r.querySelector(`.${o.COPY_BUTTON_CLASS}`))return;if(!r.parentElement?.classList.contains(o.CODE_WRAPPER_CLASS)){let i=document.createElement("div");i.className=o.CODE_WRAPPER_CLASS,r.parentNode?.insertBefore(i,r),i.appendChild(r)}let n=this.createCopyButton();r.appendChild(n),n.addEventListener("click",i=>{i.preventDefault(),this.copyCode(t,n)})})}createCopyButton(){let e=document.createElement("button");return e.className=o.COPY_BUTTON_CLASS,e.setAttribute("aria-label","Copy code to clipboard"),e.innerHTML=this.getCopyIcon(),e}async copyCode(e,t){let r=e.textContent||"";try{await navigator.clipboard.writeText(r),this.showCopiedFeedback(t)}catch(n){console.error("Failed to copy code:",n),this.fallbackCopy(r,t)}}showCopiedFeedback(e){e.classList.add(o.COPIED_CLASS),e.innerHTML=this.getCheckIcon(),e.setAttribute("aria-label","Code copied!"),setTimeout(()=>{e.classList.remove(o.COPIED_CLASS),e.innerHTML=this.getCopyIcon(),e.setAttribute("aria-label","Copy code to clipboard")},2e3)}fallbackCopy(e,t){let r=document.createElement("textarea");r.value=e,r.style.position="fixed",r.style.opacity="0",document.body.appendChild(r),r.select();try{document.execCommand("copy"),this.showCopiedFeedback(t)}catch(n){console.error("Fallback copy failed:",n)}finally{document.body.removeChild(r)}}getCopyIcon(){return`
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10.5 2H3.5C2.67 2 2 2.67 2 3.5V10.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        <rect x="5.5" y="5.5" width="8" height="8" rx="1" stroke="currentColor" stroke-width="1.5"/>
      </svg>
    `}getCheckIcon(){return`
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 8L6.5 11.5L13 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    `}};var Pe=class{constructor(){this.sections=[];this.tocElement=null;this.currentActiveSection=-1;this.init()}init(){document.querySelector(".livepage-nav-sidebar")&&(this.parseSections(),this.sections.length!==0&&(this.createTOC(),this.setupScrollTracking()))}parseSections(){document.querySelectorAll(".content-wrapper h2").forEach((t,r)=>{let n=t.id||this.generateId(t.textContent||"");t.id||(t.id=n),this.sections.push({id:n,title:t.textContent||"",element:t,index:r})})}generateId(e){return e.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim()}createTOC(){let e=document.querySelector(".livepage-nav-sidebar");if(!e)return;let t=e.querySelector(".nav-page-link.active");if(!t)return;let r=t.closest("li");if(!r)return;let n=document.createElement("ul");n.className="page-toc-list",n.innerHTML=this.sections.map((i,a)=>`
      <li class="page-toc-item" data-section="${a}">
        <a href="#${i.id}" class="page-toc-link">
          ${this.escapeHtml(i.title)}
        </a>
      </li>
    `).join(""),n.querySelectorAll(".page-toc-item").forEach((i,a)=>{i.querySelector("a")?.addEventListener("click",l=>{l.preventDefault(),this.scrollToSection(a)})}),r.appendChild(n),r.classList.add("has-subnav"),this.tocElement=n}escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}setupScrollTracking(){let e=new IntersectionObserver(t=>{t.forEach(r=>{if(r.isIntersecting){let n=r.target,i=this.sections.findIndex(a=>a.element===n);i!==-1&&i!==this.currentActiveSection&&this.updateActiveSection(i)}})},{threshold:.5,rootMargin:"-100px 0px -50% 0px"});this.sections.forEach(t=>e.observe(t.element))}updateActiveSection(e){this.currentActiveSection=e,this.tocElement&&this.tocElement.querySelectorAll(".page-toc-item").forEach((t,r)=>{t.classList.toggle("active",r===e)})}scrollToSection(e){let t=this.sections[e];t&&(t.element.scrollIntoView({behavior:"smooth",block:"start"}),history.pushState(null,"",`#${t.id}`))}};function Gt(){if(window.LIVEPAGE_DISABLE_AUTO_INIT){console.log("[Livepage] Auto-initialization disabled");return}let e=document.querySelector('meta[name="livepage-ws-url"]')?.content||`ws://${window.location.host}/ws`,r=document.querySelector('meta[name="livepage-debug"]')?.content==="true";Re()&&(console.log("[Livepage] Preloading Monaco Editor for WASM blocks..."),De());let n=new ne({wsUrl:e,debug:r,persistence:!0,onConnect:()=>console.log("[Livepage] Connected"),onDisconnect:()=>console.log("[Livepage] Disconnected"),onError:d=>console.error("[Livepage] Error:",d)});n.discoverBlocks(),n.getBlockIds().some(d=>{let h=n.getBlock(d);return h?.type==="interactive"||h?.type==="lvt"})&&n.connect(),window.livepageClient=n;let a=new Ne;window.livepageNavigation=a;let s=new Pe;window.livepagePageTOC=s;let l=new Be;window.livepageSearch=l;let c=new He;window.livepageCodeCopy=c,console.log(`[Livepage] Initialized with ${n.getBlockIds().length} blocks`)}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Gt):Gt());return rr(Vr);})();
//# sourceMappingURL=livepage-client.browser.js.map
