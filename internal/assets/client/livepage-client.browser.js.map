{
  "version": 3,
  "sources": ["../../../client/node_modules/morphdom/dist/morphdom.js", "../../../client/constants.ts", "../../../client/dom/focus-manager.ts", "../../../client/dom/directives.ts", "../../../client/utils/rate-limit.ts", "../../../client/utils/confirm.ts", "../../../client/dom/event-delegation.ts", "../../../client/dom/observer-manager.ts", "../../../client/dom/modal-manager.ts", "../../../client/dom/loading-indicator.ts", "../../../client/dom/form-disabler.ts", "../../../client/dom/reactive-attributes.ts", "../../../client/state/tree-renderer.ts", "../../../client/state/form-lifecycle-manager.ts", "../../../client/transport/websocket.ts", "../../../client/upload/s3-uploader.ts", "../../../client/upload/upload-handler.ts", "../../../client/utils/logger.ts", "../../../client/utils/testing.ts", "../../../client/livetemplate-client.ts", "../src/browser.ts", "../src/livepage-client.ts", "../src/core/message-router.ts", "../src/core/persistence-manager.ts", "../src/blocks/base-block.ts", "../src/blocks/server-block.ts", "../src/blocks/interactive-block.ts", "../src/editor/monaco-loader.ts", "../src/editor/monaco-editor.ts", "../src/ui/output-panel.ts", "../src/ui/run-button.ts", "../src/wasm/tinygo-executor.ts", "../src/blocks/wasm-block.ts", "../src/core/navigation.ts", "../src/core/search.ts", "../src/core/code-copy.ts", "../src/core/page-toc.ts", "../src/auto-init.ts"],
  "sourcesContent": ["'use strict';\n\nvar DOCUMENT_FRAGMENT_NODE = 11;\n\nfunction morphAttrs(fromNode, toNode) {\n    var toNodeAttrs = toNode.attributes;\n    var attr;\n    var attrName;\n    var attrNamespaceURI;\n    var attrValue;\n    var fromValue;\n\n    // document-fragments dont have attributes so lets not do anything\n    if (toNode.nodeType === DOCUMENT_FRAGMENT_NODE || fromNode.nodeType === DOCUMENT_FRAGMENT_NODE) {\n      return;\n    }\n\n    // update attributes on original DOM element\n    for (var i = toNodeAttrs.length - 1; i >= 0; i--) {\n        attr = toNodeAttrs[i];\n        attrName = attr.name;\n        attrNamespaceURI = attr.namespaceURI;\n        attrValue = attr.value;\n\n        if (attrNamespaceURI) {\n            attrName = attr.localName || attrName;\n            fromValue = fromNode.getAttributeNS(attrNamespaceURI, attrName);\n\n            if (fromValue !== attrValue) {\n                if (attr.prefix === 'xmlns'){\n                    attrName = attr.name; // It's not allowed to set an attribute with the XMLNS namespace without specifying the `xmlns` prefix\n                }\n                fromNode.setAttributeNS(attrNamespaceURI, attrName, attrValue);\n            }\n        } else {\n            fromValue = fromNode.getAttribute(attrName);\n\n            if (fromValue !== attrValue) {\n                fromNode.setAttribute(attrName, attrValue);\n            }\n        }\n    }\n\n    // Remove any extra attributes found on the original DOM element that\n    // weren't found on the target element.\n    var fromNodeAttrs = fromNode.attributes;\n\n    for (var d = fromNodeAttrs.length - 1; d >= 0; d--) {\n        attr = fromNodeAttrs[d];\n        attrName = attr.name;\n        attrNamespaceURI = attr.namespaceURI;\n\n        if (attrNamespaceURI) {\n            attrName = attr.localName || attrName;\n\n            if (!toNode.hasAttributeNS(attrNamespaceURI, attrName)) {\n                fromNode.removeAttributeNS(attrNamespaceURI, attrName);\n            }\n        } else {\n            if (!toNode.hasAttribute(attrName)) {\n                fromNode.removeAttribute(attrName);\n            }\n        }\n    }\n}\n\nvar range; // Create a range object for efficently rendering strings to elements.\nvar NS_XHTML = 'http://www.w3.org/1999/xhtml';\n\nvar doc = typeof document === 'undefined' ? undefined : document;\nvar HAS_TEMPLATE_SUPPORT = !!doc && 'content' in doc.createElement('template');\nvar HAS_RANGE_SUPPORT = !!doc && doc.createRange && 'createContextualFragment' in doc.createRange();\n\nfunction createFragmentFromTemplate(str) {\n    var template = doc.createElement('template');\n    template.innerHTML = str;\n    return template.content.childNodes[0];\n}\n\nfunction createFragmentFromRange(str) {\n    if (!range) {\n        range = doc.createRange();\n        range.selectNode(doc.body);\n    }\n\n    var fragment = range.createContextualFragment(str);\n    return fragment.childNodes[0];\n}\n\nfunction createFragmentFromWrap(str) {\n    var fragment = doc.createElement('body');\n    fragment.innerHTML = str;\n    return fragment.childNodes[0];\n}\n\n/**\n * This is about the same\n * var html = new DOMParser().parseFromString(str, 'text/html');\n * return html.body.firstChild;\n *\n * @method toElement\n * @param {String} str\n */\nfunction toElement(str) {\n    str = str.trim();\n    if (HAS_TEMPLATE_SUPPORT) {\n      // avoid restrictions on content for things like `<tr><th>Hi</th></tr>` which\n      // createContextualFragment doesn't support\n      // <template> support not available in IE\n      return createFragmentFromTemplate(str);\n    } else if (HAS_RANGE_SUPPORT) {\n      return createFragmentFromRange(str);\n    }\n\n    return createFragmentFromWrap(str);\n}\n\n/**\n * Returns true if two node's names are the same.\n *\n * NOTE: We don't bother checking `namespaceURI` because you will never find two HTML elements with the same\n *       nodeName and different namespace URIs.\n *\n * @param {Element} a\n * @param {Element} b The target element\n * @return {boolean}\n */\nfunction compareNodeNames(fromEl, toEl) {\n    var fromNodeName = fromEl.nodeName;\n    var toNodeName = toEl.nodeName;\n    var fromCodeStart, toCodeStart;\n\n    if (fromNodeName === toNodeName) {\n        return true;\n    }\n\n    fromCodeStart = fromNodeName.charCodeAt(0);\n    toCodeStart = toNodeName.charCodeAt(0);\n\n    // If the target element is a virtual DOM node or SVG node then we may\n    // need to normalize the tag name before comparing. Normal HTML elements that are\n    // in the \"http://www.w3.org/1999/xhtml\"\n    // are converted to upper case\n    if (fromCodeStart <= 90 && toCodeStart >= 97) { // from is upper and to is lower\n        return fromNodeName === toNodeName.toUpperCase();\n    } else if (toCodeStart <= 90 && fromCodeStart >= 97) { // to is upper and from is lower\n        return toNodeName === fromNodeName.toUpperCase();\n    } else {\n        return false;\n    }\n}\n\n/**\n * Create an element, optionally with a known namespace URI.\n *\n * @param {string} name the element name, e.g. 'div' or 'svg'\n * @param {string} [namespaceURI] the element's namespace URI, i.e. the value of\n * its `xmlns` attribute or its inferred namespace.\n *\n * @return {Element}\n */\nfunction createElementNS(name, namespaceURI) {\n    return !namespaceURI || namespaceURI === NS_XHTML ?\n        doc.createElement(name) :\n        doc.createElementNS(namespaceURI, name);\n}\n\n/**\n * Copies the children of one DOM element to another DOM element\n */\nfunction moveChildren(fromEl, toEl) {\n    var curChild = fromEl.firstChild;\n    while (curChild) {\n        var nextChild = curChild.nextSibling;\n        toEl.appendChild(curChild);\n        curChild = nextChild;\n    }\n    return toEl;\n}\n\nfunction syncBooleanAttrProp(fromEl, toEl, name) {\n    if (fromEl[name] !== toEl[name]) {\n        fromEl[name] = toEl[name];\n        if (fromEl[name]) {\n            fromEl.setAttribute(name, '');\n        } else {\n            fromEl.removeAttribute(name);\n        }\n    }\n}\n\nvar specialElHandlers = {\n    OPTION: function(fromEl, toEl) {\n        var parentNode = fromEl.parentNode;\n        if (parentNode) {\n            var parentName = parentNode.nodeName.toUpperCase();\n            if (parentName === 'OPTGROUP') {\n                parentNode = parentNode.parentNode;\n                parentName = parentNode && parentNode.nodeName.toUpperCase();\n            }\n            if (parentName === 'SELECT' && !parentNode.hasAttribute('multiple')) {\n                if (fromEl.hasAttribute('selected') && !toEl.selected) {\n                    // Workaround for MS Edge bug where the 'selected' attribute can only be\n                    // removed if set to a non-empty value:\n                    // https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/12087679/\n                    fromEl.setAttribute('selected', 'selected');\n                    fromEl.removeAttribute('selected');\n                }\n                // We have to reset select element's selectedIndex to -1, otherwise setting\n                // fromEl.selected using the syncBooleanAttrProp below has no effect.\n                // The correct selectedIndex will be set in the SELECT special handler below.\n                parentNode.selectedIndex = -1;\n            }\n        }\n        syncBooleanAttrProp(fromEl, toEl, 'selected');\n    },\n    /**\n     * The \"value\" attribute is special for the <input> element since it sets\n     * the initial value. Changing the \"value\" attribute without changing the\n     * \"value\" property will have no effect since it is only used to the set the\n     * initial value.  Similar for the \"checked\" attribute, and \"disabled\".\n     */\n    INPUT: function(fromEl, toEl) {\n        syncBooleanAttrProp(fromEl, toEl, 'checked');\n        syncBooleanAttrProp(fromEl, toEl, 'disabled');\n\n        if (fromEl.value !== toEl.value) {\n            fromEl.value = toEl.value;\n        }\n\n        if (!toEl.hasAttribute('value')) {\n            fromEl.removeAttribute('value');\n        }\n    },\n\n    TEXTAREA: function(fromEl, toEl) {\n        var newValue = toEl.value;\n        if (fromEl.value !== newValue) {\n            fromEl.value = newValue;\n        }\n\n        var firstChild = fromEl.firstChild;\n        if (firstChild) {\n            // Needed for IE. Apparently IE sets the placeholder as the\n            // node value and vise versa. This ignores an empty update.\n            var oldValue = firstChild.nodeValue;\n\n            if (oldValue == newValue || (!newValue && oldValue == fromEl.placeholder)) {\n                return;\n            }\n\n            firstChild.nodeValue = newValue;\n        }\n    },\n    SELECT: function(fromEl, toEl) {\n        if (!toEl.hasAttribute('multiple')) {\n            var selectedIndex = -1;\n            var i = 0;\n            // We have to loop through children of fromEl, not toEl since nodes can be moved\n            // from toEl to fromEl directly when morphing.\n            // At the time this special handler is invoked, all children have already been morphed\n            // and appended to / removed from fromEl, so using fromEl here is safe and correct.\n            var curChild = fromEl.firstChild;\n            var optgroup;\n            var nodeName;\n            while(curChild) {\n                nodeName = curChild.nodeName && curChild.nodeName.toUpperCase();\n                if (nodeName === 'OPTGROUP') {\n                    optgroup = curChild;\n                    curChild = optgroup.firstChild;\n                    // handle empty optgroups\n                    if (!curChild) {\n                        curChild = optgroup.nextSibling;\n                        optgroup = null;\n                    }\n                } else {\n                    if (nodeName === 'OPTION') {\n                        if (curChild.hasAttribute('selected')) {\n                            selectedIndex = i;\n                            break;\n                        }\n                        i++;\n                    }\n                    curChild = curChild.nextSibling;\n                    if (!curChild && optgroup) {\n                        curChild = optgroup.nextSibling;\n                        optgroup = null;\n                    }\n                }\n            }\n\n            fromEl.selectedIndex = selectedIndex;\n        }\n    }\n};\n\nvar ELEMENT_NODE = 1;\nvar DOCUMENT_FRAGMENT_NODE$1 = 11;\nvar TEXT_NODE = 3;\nvar COMMENT_NODE = 8;\n\nfunction noop() {}\n\nfunction defaultGetNodeKey(node) {\n  if (node) {\n    return (node.getAttribute && node.getAttribute('id')) || node.id;\n  }\n}\n\nfunction morphdomFactory(morphAttrs) {\n\n  return function morphdom(fromNode, toNode, options) {\n    if (!options) {\n      options = {};\n    }\n\n    if (typeof toNode === 'string') {\n      if (fromNode.nodeName === '#document' || fromNode.nodeName === 'HTML' || fromNode.nodeName === 'BODY') {\n        var toNodeHtml = toNode;\n        toNode = doc.createElement('html');\n        toNode.innerHTML = toNodeHtml;\n      } else {\n        toNode = toElement(toNode);\n      }\n    } else if (toNode.nodeType === DOCUMENT_FRAGMENT_NODE$1) {\n      toNode = toNode.firstElementChild;\n    }\n\n    var getNodeKey = options.getNodeKey || defaultGetNodeKey;\n    var onBeforeNodeAdded = options.onBeforeNodeAdded || noop;\n    var onNodeAdded = options.onNodeAdded || noop;\n    var onBeforeElUpdated = options.onBeforeElUpdated || noop;\n    var onElUpdated = options.onElUpdated || noop;\n    var onBeforeNodeDiscarded = options.onBeforeNodeDiscarded || noop;\n    var onNodeDiscarded = options.onNodeDiscarded || noop;\n    var onBeforeElChildrenUpdated = options.onBeforeElChildrenUpdated || noop;\n    var skipFromChildren = options.skipFromChildren || noop;\n    var addChild = options.addChild || function(parent, child){ return parent.appendChild(child); };\n    var childrenOnly = options.childrenOnly === true;\n\n    // This object is used as a lookup to quickly find all keyed elements in the original DOM tree.\n    var fromNodesLookup = Object.create(null);\n    var keyedRemovalList = [];\n\n    function addKeyedRemoval(key) {\n      keyedRemovalList.push(key);\n    }\n\n    function walkDiscardedChildNodes(node, skipKeyedNodes) {\n      if (node.nodeType === ELEMENT_NODE) {\n        var curChild = node.firstChild;\n        while (curChild) {\n\n          var key = undefined;\n\n          if (skipKeyedNodes && (key = getNodeKey(curChild))) {\n            // If we are skipping keyed nodes then we add the key\n            // to a list so that it can be handled at the very end.\n            addKeyedRemoval(key);\n          } else {\n            // Only report the node as discarded if it is not keyed. We do this because\n            // at the end we loop through all keyed elements that were unmatched\n            // and then discard them in one final pass.\n            onNodeDiscarded(curChild);\n            if (curChild.firstChild) {\n              walkDiscardedChildNodes(curChild, skipKeyedNodes);\n            }\n          }\n\n          curChild = curChild.nextSibling;\n        }\n      }\n    }\n\n    /**\n    * Removes a DOM node out of the original DOM\n    *\n    * @param  {Node} node The node to remove\n    * @param  {Node} parentNode The nodes parent\n    * @param  {Boolean} skipKeyedNodes If true then elements with keys will be skipped and not discarded.\n    * @return {undefined}\n    */\n    function removeNode(node, parentNode, skipKeyedNodes) {\n      if (onBeforeNodeDiscarded(node) === false) {\n        return;\n      }\n\n      if (parentNode) {\n        parentNode.removeChild(node);\n      }\n\n      onNodeDiscarded(node);\n      walkDiscardedChildNodes(node, skipKeyedNodes);\n    }\n\n    // // TreeWalker implementation is no faster, but keeping this around in case this changes in the future\n    // function indexTree(root) {\n    //     var treeWalker = document.createTreeWalker(\n    //         root,\n    //         NodeFilter.SHOW_ELEMENT);\n    //\n    //     var el;\n    //     while((el = treeWalker.nextNode())) {\n    //         var key = getNodeKey(el);\n    //         if (key) {\n    //             fromNodesLookup[key] = el;\n    //         }\n    //     }\n    // }\n\n    // // NodeIterator implementation is no faster, but keeping this around in case this changes in the future\n    //\n    // function indexTree(node) {\n    //     var nodeIterator = document.createNodeIterator(node, NodeFilter.SHOW_ELEMENT);\n    //     var el;\n    //     while((el = nodeIterator.nextNode())) {\n    //         var key = getNodeKey(el);\n    //         if (key) {\n    //             fromNodesLookup[key] = el;\n    //         }\n    //     }\n    // }\n\n    function indexTree(node) {\n      if (node.nodeType === ELEMENT_NODE || node.nodeType === DOCUMENT_FRAGMENT_NODE$1) {\n        var curChild = node.firstChild;\n        while (curChild) {\n          var key = getNodeKey(curChild);\n          if (key) {\n            fromNodesLookup[key] = curChild;\n          }\n\n          // Walk recursively\n          indexTree(curChild);\n\n          curChild = curChild.nextSibling;\n        }\n      }\n    }\n\n    indexTree(fromNode);\n\n    function handleNodeAdded(el) {\n      onNodeAdded(el);\n\n      var curChild = el.firstChild;\n      while (curChild) {\n        var nextSibling = curChild.nextSibling;\n\n        var key = getNodeKey(curChild);\n        if (key) {\n          var unmatchedFromEl = fromNodesLookup[key];\n          // if we find a duplicate #id node in cache, replace `el` with cache value\n          // and morph it to the child node.\n          if (unmatchedFromEl && compareNodeNames(curChild, unmatchedFromEl)) {\n            curChild.parentNode.replaceChild(unmatchedFromEl, curChild);\n            morphEl(unmatchedFromEl, curChild);\n          } else {\n            handleNodeAdded(curChild);\n          }\n        } else {\n          // recursively call for curChild and it's children to see if we find something in\n          // fromNodesLookup\n          handleNodeAdded(curChild);\n        }\n\n        curChild = nextSibling;\n      }\n    }\n\n    function cleanupFromEl(fromEl, curFromNodeChild, curFromNodeKey) {\n      // We have processed all of the \"to nodes\". If curFromNodeChild is\n      // non-null then we still have some from nodes left over that need\n      // to be removed\n      while (curFromNodeChild) {\n        var fromNextSibling = curFromNodeChild.nextSibling;\n        if ((curFromNodeKey = getNodeKey(curFromNodeChild))) {\n          // Since the node is keyed it might be matched up later so we defer\n          // the actual removal to later\n          addKeyedRemoval(curFromNodeKey);\n        } else {\n          // NOTE: we skip nested keyed nodes from being removed since there is\n          //       still a chance they will be matched up later\n          removeNode(curFromNodeChild, fromEl, true /* skip keyed nodes */);\n        }\n        curFromNodeChild = fromNextSibling;\n      }\n    }\n\n    function morphEl(fromEl, toEl, childrenOnly) {\n      var toElKey = getNodeKey(toEl);\n\n      if (toElKey) {\n        // If an element with an ID is being morphed then it will be in the final\n        // DOM so clear it out of the saved elements collection\n        delete fromNodesLookup[toElKey];\n      }\n\n      if (!childrenOnly) {\n        // optional\n        var beforeUpdateResult = onBeforeElUpdated(fromEl, toEl);\n        if (beforeUpdateResult === false) {\n          return;\n        } else if (beforeUpdateResult instanceof HTMLElement) {\n          fromEl = beforeUpdateResult;\n          // reindex the new fromEl in case it's not in the same\n          // tree as the original fromEl\n          // (Phoenix LiveView sometimes returns a cloned tree,\n          //  but keyed lookups would still point to the original tree)\n          indexTree(fromEl);\n        }\n\n        // update attributes on original DOM element first\n        morphAttrs(fromEl, toEl);\n        // optional\n        onElUpdated(fromEl);\n\n        if (onBeforeElChildrenUpdated(fromEl, toEl) === false) {\n          return;\n        }\n      }\n\n      if (fromEl.nodeName !== 'TEXTAREA') {\n        morphChildren(fromEl, toEl);\n      } else {\n        specialElHandlers.TEXTAREA(fromEl, toEl);\n      }\n    }\n\n    function morphChildren(fromEl, toEl) {\n      var skipFrom = skipFromChildren(fromEl, toEl);\n      var curToNodeChild = toEl.firstChild;\n      var curFromNodeChild = fromEl.firstChild;\n      var curToNodeKey;\n      var curFromNodeKey;\n\n      var fromNextSibling;\n      var toNextSibling;\n      var matchingFromEl;\n\n      // walk the children\n      outer: while (curToNodeChild) {\n        toNextSibling = curToNodeChild.nextSibling;\n        curToNodeKey = getNodeKey(curToNodeChild);\n\n        // walk the fromNode children all the way through\n        while (!skipFrom && curFromNodeChild) {\n          fromNextSibling = curFromNodeChild.nextSibling;\n\n          if (curToNodeChild.isSameNode && curToNodeChild.isSameNode(curFromNodeChild)) {\n            curToNodeChild = toNextSibling;\n            curFromNodeChild = fromNextSibling;\n            continue outer;\n          }\n\n          curFromNodeKey = getNodeKey(curFromNodeChild);\n\n          var curFromNodeType = curFromNodeChild.nodeType;\n\n          // this means if the curFromNodeChild doesnt have a match with the curToNodeChild\n          var isCompatible = undefined;\n\n          if (curFromNodeType === curToNodeChild.nodeType) {\n            if (curFromNodeType === ELEMENT_NODE) {\n              // Both nodes being compared are Element nodes\n\n              if (curToNodeKey) {\n                // The target node has a key so we want to match it up with the correct element\n                // in the original DOM tree\n                if (curToNodeKey !== curFromNodeKey) {\n                  // The current element in the original DOM tree does not have a matching key so\n                  // let's check our lookup to see if there is a matching element in the original\n                  // DOM tree\n                  if ((matchingFromEl = fromNodesLookup[curToNodeKey])) {\n                    if (fromNextSibling === matchingFromEl) {\n                      // Special case for single element removals. To avoid removing the original\n                      // DOM node out of the tree (since that can break CSS transitions, etc.),\n                      // we will instead discard the current node and wait until the next\n                      // iteration to properly match up the keyed target element with its matching\n                      // element in the original tree\n                      isCompatible = false;\n                    } else {\n                      // We found a matching keyed element somewhere in the original DOM tree.\n                      // Let's move the original DOM node into the current position and morph\n                      // it.\n\n                      // NOTE: We use insertBefore instead of replaceChild because we want to go through\n                      // the `removeNode()` function for the node that is being discarded so that\n                      // all lifecycle hooks are correctly invoked\n                      fromEl.insertBefore(matchingFromEl, curFromNodeChild);\n\n                      // fromNextSibling = curFromNodeChild.nextSibling;\n\n                      if (curFromNodeKey) {\n                        // Since the node is keyed it might be matched up later so we defer\n                        // the actual removal to later\n                        addKeyedRemoval(curFromNodeKey);\n                      } else {\n                        // NOTE: we skip nested keyed nodes from being removed since there is\n                        //       still a chance they will be matched up later\n                        removeNode(curFromNodeChild, fromEl, true /* skip keyed nodes */);\n                      }\n\n                      curFromNodeChild = matchingFromEl;\n                      curFromNodeKey = getNodeKey(curFromNodeChild);\n                    }\n                  } else {\n                    // The nodes are not compatible since the \"to\" node has a key and there\n                    // is no matching keyed node in the source tree\n                    isCompatible = false;\n                  }\n                }\n              } else if (curFromNodeKey) {\n                // The original has a key\n                isCompatible = false;\n              }\n\n              isCompatible = isCompatible !== false && compareNodeNames(curFromNodeChild, curToNodeChild);\n              if (isCompatible) {\n                // We found compatible DOM elements so transform\n                // the current \"from\" node to match the current\n                // target DOM node.\n                // MORPH\n                morphEl(curFromNodeChild, curToNodeChild);\n              }\n\n            } else if (curFromNodeType === TEXT_NODE || curFromNodeType == COMMENT_NODE) {\n              // Both nodes being compared are Text or Comment nodes\n              isCompatible = true;\n              // Simply update nodeValue on the original node to\n              // change the text value\n              if (curFromNodeChild.nodeValue !== curToNodeChild.nodeValue) {\n                curFromNodeChild.nodeValue = curToNodeChild.nodeValue;\n              }\n\n            }\n          }\n\n          if (isCompatible) {\n            // Advance both the \"to\" child and the \"from\" child since we found a match\n            // Nothing else to do as we already recursively called morphChildren above\n            curToNodeChild = toNextSibling;\n            curFromNodeChild = fromNextSibling;\n            continue outer;\n          }\n\n          // No compatible match so remove the old node from the DOM and continue trying to find a\n          // match in the original DOM. However, we only do this if the from node is not keyed\n          // since it is possible that a keyed node might match up with a node somewhere else in the\n          // target tree and we don't want to discard it just yet since it still might find a\n          // home in the final DOM tree. After everything is done we will remove any keyed nodes\n          // that didn't find a home\n          if (curFromNodeKey) {\n            // Since the node is keyed it might be matched up later so we defer\n            // the actual removal to later\n            addKeyedRemoval(curFromNodeKey);\n          } else {\n            // NOTE: we skip nested keyed nodes from being removed since there is\n            //       still a chance they will be matched up later\n            removeNode(curFromNodeChild, fromEl, true /* skip keyed nodes */);\n          }\n\n          curFromNodeChild = fromNextSibling;\n        } // END: while(curFromNodeChild) {}\n\n        // If we got this far then we did not find a candidate match for\n        // our \"to node\" and we exhausted all of the children \"from\"\n        // nodes. Therefore, we will just append the current \"to\" node\n        // to the end\n        if (curToNodeKey && (matchingFromEl = fromNodesLookup[curToNodeKey]) && compareNodeNames(matchingFromEl, curToNodeChild)) {\n          // MORPH\n          if(!skipFrom){ addChild(fromEl, matchingFromEl); }\n          morphEl(matchingFromEl, curToNodeChild);\n        } else {\n          var onBeforeNodeAddedResult = onBeforeNodeAdded(curToNodeChild);\n          if (onBeforeNodeAddedResult !== false) {\n            if (onBeforeNodeAddedResult) {\n              curToNodeChild = onBeforeNodeAddedResult;\n            }\n\n            if (curToNodeChild.actualize) {\n              curToNodeChild = curToNodeChild.actualize(fromEl.ownerDocument || doc);\n            }\n            addChild(fromEl, curToNodeChild);\n            handleNodeAdded(curToNodeChild);\n          }\n        }\n\n        curToNodeChild = toNextSibling;\n        curFromNodeChild = fromNextSibling;\n      }\n\n      cleanupFromEl(fromEl, curFromNodeChild, curFromNodeKey);\n\n      var specialElHandler = specialElHandlers[fromEl.nodeName];\n      if (specialElHandler) {\n        specialElHandler(fromEl, toEl);\n      }\n    } // END: morphChildren(...)\n\n    var morphedNode = fromNode;\n    var morphedNodeType = morphedNode.nodeType;\n    var toNodeType = toNode.nodeType;\n\n    if (!childrenOnly) {\n      // Handle the case where we are given two DOM nodes that are not\n      // compatible (e.g. <div> --> <span> or <div> --> TEXT)\n      if (morphedNodeType === ELEMENT_NODE) {\n        if (toNodeType === ELEMENT_NODE) {\n          if (!compareNodeNames(fromNode, toNode)) {\n            onNodeDiscarded(fromNode);\n            morphedNode = moveChildren(fromNode, createElementNS(toNode.nodeName, toNode.namespaceURI));\n          }\n        } else {\n          // Going from an element node to a text node\n          morphedNode = toNode;\n        }\n      } else if (morphedNodeType === TEXT_NODE || morphedNodeType === COMMENT_NODE) { // Text or comment node\n        if (toNodeType === morphedNodeType) {\n          if (morphedNode.nodeValue !== toNode.nodeValue) {\n            morphedNode.nodeValue = toNode.nodeValue;\n          }\n\n          return morphedNode;\n        } else {\n          // Text node to something else\n          morphedNode = toNode;\n        }\n      }\n    }\n\n    if (morphedNode === toNode) {\n      // The \"to node\" was not compatible with the \"from node\" so we had to\n      // toss out the \"from node\" and use the \"to node\"\n      onNodeDiscarded(fromNode);\n    } else {\n      if (toNode.isSameNode && toNode.isSameNode(morphedNode)) {\n        return;\n      }\n\n      morphEl(morphedNode, toNode, childrenOnly);\n\n      // We now need to loop over any keyed nodes that might need to be\n      // removed. We only do the removal if we know that the keyed node\n      // never found a match. When a keyed node is matched up we remove\n      // it out of fromNodesLookup and we use fromNodesLookup to determine\n      // if a keyed node has been matched up or not\n      if (keyedRemovalList) {\n        for (var i=0, len=keyedRemovalList.length; i<len; i++) {\n          var elToRemove = fromNodesLookup[keyedRemovalList[i]];\n          if (elToRemove) {\n            removeNode(elToRemove, elToRemove.parentNode, false);\n          }\n        }\n      }\n    }\n\n    if (!childrenOnly && morphedNode !== fromNode && fromNode.parentNode) {\n      if (morphedNode.actualize) {\n        morphedNode = morphedNode.actualize(fromNode.ownerDocument || doc);\n      }\n      // If we had to swap out the from node with a new node because the old\n      // node was not compatible with the target node then we need to\n      // replace the old DOM node in the original DOM tree. This is only\n      // possible if the original DOM node was part of a DOM tree which\n      // we know is the case if it has a parent node.\n      fromNode.parentNode.replaceChild(morphedNode, fromNode);\n    }\n\n    return morphedNode;\n  };\n}\n\nvar morphdom = morphdomFactory(morphAttrs);\n\nmodule.exports = morphdom;\n", "export const FOCUSABLE_INPUTS = [\n  \"text\",\n  \"textarea\",\n  \"number\",\n  \"email\",\n  \"password\",\n  \"search\",\n  \"tel\",\n  \"url\",\n  \"date\",\n  \"time\",\n  \"datetime-local\",\n  \"color\",\n  \"range\",\n];\n", "import { FOCUSABLE_INPUTS } from \"../constants\";\nimport type { Logger } from \"../utils/logger\";\n\nexport class FocusManager {\n  private wrapperElement: Element | null = null;\n  private focusableElements: HTMLElement[] = [];\n  private lastFocusedElement: HTMLElement | null = null;\n  private lastFocusedSelectionStart: number | null = null;\n  private lastFocusedSelectionEnd: number | null = null;\n\n  constructor(private readonly logger: Logger) {}\n\n  attach(wrapper: Element | null): void {\n    this.wrapperElement = wrapper;\n\n    if (!wrapper) {\n      return;\n    }\n\n    this.updateFocusableElements();\n    this.setupFocusTracking();\n  }\n\n  reset(): void {\n    this.wrapperElement = null;\n    this.focusableElements = [];\n    this.lastFocusedElement = null;\n    this.lastFocusedSelectionStart = null;\n    this.lastFocusedSelectionEnd = null;\n  }\n\n  updateFocusableElements(): void {\n    if (!this.wrapperElement) return;\n\n    const inputSelectors = FOCUSABLE_INPUTS.map((type) =>\n      type === \"textarea\"\n        ? \"textarea:not([disabled])\"\n        : `input[type=\"${type}\"]:not([disabled])`\n    ).join(\", \");\n\n    const otherFocusable =\n      'select:not([disabled]), button:not([disabled]), [contenteditable=\"true\"], [tabindex]:not([tabindex=\"-1\"])';\n    const selector = `${inputSelectors}, ${otherFocusable}`;\n\n    this.focusableElements = Array.from(\n      this.wrapperElement.querySelectorAll(selector)\n    );\n  }\n\n  setupFocusTracking(): void {\n    if (!this.wrapperElement) return;\n\n    const wrapperId = this.wrapperElement.getAttribute(\"data-lvt-id\");\n    const focusKey = `__lvt_focus_tracker_${wrapperId}`;\n    const blurKey = `__lvt_blur_tracker_${wrapperId}`;\n\n    const focusListener = (event: Event) => {\n      const target = event.target as HTMLElement;\n      if (!target || !this.wrapperElement?.contains(target)) return;\n\n      if (this.isTextualInput(target) || target instanceof HTMLSelectElement) {\n        this.lastFocusedElement = target;\n        this.logger.debug(\n          \"[Focus] Tracked focus on:\",\n          target.tagName,\n          target.id || target.getAttribute(\"name\")\n        );\n\n        if (this.isTextualInput(target)) {\n          this.lastFocusedSelectionStart = target.selectionStart;\n          this.lastFocusedSelectionEnd = target.selectionEnd;\n        }\n      }\n    };\n\n    const blurListener = (event: Event) => {\n      const target = event.target as HTMLElement;\n      if (!target || !this.wrapperElement?.contains(target)) return;\n\n      if (this.isTextualInput(target) && target === this.lastFocusedElement) {\n        this.lastFocusedSelectionStart = target.selectionStart;\n        this.lastFocusedSelectionEnd = target.selectionEnd;\n        this.logger.debug(\n          \"[Focus] Saved cursor on blur:\",\n          this.lastFocusedSelectionStart,\n          \"-\",\n          this.lastFocusedSelectionEnd\n        );\n      }\n    };\n\n    if ((document as any)[focusKey]) {\n      document.removeEventListener(\"focus\", (document as any)[focusKey], true);\n    }\n    if ((document as any)[blurKey]) {\n      document.removeEventListener(\"blur\", (document as any)[blurKey], true);\n    }\n\n    (document as any)[focusKey] = focusListener;\n    (document as any)[blurKey] = blurListener;\n\n    document.addEventListener(\"focus\", focusListener, true);\n    document.addEventListener(\"blur\", blurListener, true);\n\n    this.logger.debug(\"[Focus] Focus tracking set up\");\n  }\n\n  restoreFocusedElement(): void {\n    this.logger.debug(\n      \"[Focus] restoreFocusedElement - lastFocusedElement:\",\n      this.lastFocusedElement?.tagName,\n      this.lastFocusedElement?.id ||\n        this.lastFocusedElement?.getAttribute(\"name\")\n    );\n\n    if (!this.lastFocusedElement || !this.wrapperElement) {\n      this.logger.debug(\"[Focus] No element to restore\");\n      return;\n    }\n\n    const selector = this.getElementSelector(this.lastFocusedElement);\n    this.logger.debug(\"[Focus] Selector for last focused:\", selector);\n\n    if (!selector) {\n      this.logger.debug(\"[Focus] Could not generate selector\");\n      return;\n    }\n\n    let element: HTMLElement | null = null;\n\n    if (selector.startsWith(\"data-focus-index-\")) {\n      this.updateFocusableElements();\n      const index = parseInt(selector.replace(\"data-focus-index-\", \"\"), 10);\n      element = this.focusableElements[index] || null;\n      this.logger.debug(\"[Focus] Found by index:\", index, element?.tagName);\n    } else {\n      element = this.wrapperElement.querySelector(selector);\n      this.logger.debug(\n        \"[Focus] Found by selector:\",\n        selector,\n        element?.tagName\n      );\n    }\n\n    if (!element) {\n      this.logger.debug(\"[Focus] Element not found in updated DOM\");\n      return;\n    }\n\n    const wasFocused = element.matches(\":focus\");\n    this.logger.debug(\"[Focus] Already focused:\", wasFocused);\n\n    if (!wasFocused) {\n      element.focus();\n      this.logger.debug(\"[Focus] Restored focus\");\n    }\n\n    if (\n      this.isTextualInput(element) &&\n      this.lastFocusedSelectionStart !== null &&\n      this.lastFocusedSelectionEnd !== null\n    ) {\n      element.setSelectionRange(\n        this.lastFocusedSelectionStart,\n        this.lastFocusedSelectionEnd\n      );\n      this.logger.debug(\n        \"[Focus] Restored cursor:\",\n        this.lastFocusedSelectionStart,\n        \"-\",\n        this.lastFocusedSelectionEnd\n      );\n    }\n  }\n\n  isTextualInput(el: Element): el is HTMLInputElement | HTMLTextAreaElement {\n    if (el instanceof HTMLTextAreaElement) return true;\n    if (el instanceof HTMLInputElement) {\n      return FOCUSABLE_INPUTS.indexOf(el.type) >= 0;\n    }\n    return false;\n  }\n\n  getLastFocusedElement(): HTMLElement | null {\n    return this.lastFocusedElement;\n  }\n\n  private getElementSelector(el: HTMLElement): string | null {\n    if (el.id) return `#${el.id}`;\n    if ((el as any).name) return `[name=\"${(el as any).name}\"]`;\n    if (el.getAttribute(\"data-key\"))\n      return `[data-key=\"${el.getAttribute(\"data-key\")}\"]`;\n\n    const index = this.focusableElements.indexOf(el);\n    return index >= 0 ? `data-focus-index-${index}` : null;\n  }\n}\n", "/**\n * Apply scroll directives on elements with lvt-scroll attributes.\n */\nexport function handleScrollDirectives(rootElement: Element): void {\n  const scrollElements = rootElement.querySelectorAll(\"[lvt-scroll]\");\n\n  scrollElements.forEach((element) => {\n    const htmlElement = element as HTMLElement;\n    const mode = htmlElement.getAttribute(\"lvt-scroll\");\n    const behavior =\n      (htmlElement.getAttribute(\"lvt-scroll-behavior\") as ScrollBehavior) ||\n      \"auto\";\n    const threshold = parseInt(\n      htmlElement.getAttribute(\"lvt-scroll-threshold\") || \"100\",\n      10\n    );\n\n    if (!mode) return;\n\n    switch (mode) {\n      case \"bottom\":\n        htmlElement.scrollTo({\n          top: htmlElement.scrollHeight,\n          behavior,\n        });\n        break;\n\n      case \"bottom-sticky\": {\n        const isNearBottom =\n          htmlElement.scrollHeight -\n            htmlElement.scrollTop -\n            htmlElement.clientHeight <=\n          threshold;\n        if (isNearBottom) {\n          htmlElement.scrollTo({\n            top: htmlElement.scrollHeight,\n            behavior,\n          });\n        }\n        break;\n      }\n\n      case \"top\":\n        htmlElement.scrollTo({\n          top: 0,\n          behavior,\n        });\n        break;\n\n      case \"preserve\":\n        break;\n\n      default:\n        console.warn(`Unknown lvt-scroll mode: ${mode}`);\n    }\n  });\n}\n\n/**\n * Apply highlight directives to elements with lvt-highlight attributes.\n */\nexport function handleHighlightDirectives(rootElement: Element): void {\n  const highlightElements = rootElement.querySelectorAll(\"[lvt-highlight]\");\n\n  highlightElements.forEach((element) => {\n    const mode = element.getAttribute(\"lvt-highlight\");\n    const duration = parseInt(\n      element.getAttribute(\"lvt-highlight-duration\") || \"500\",\n      10\n    );\n    const color = element.getAttribute(\"lvt-highlight-color\") || \"#ffc107\";\n\n    if (!mode) return;\n\n    const htmlElement = element as HTMLElement;\n    const originalBackground = htmlElement.style.backgroundColor;\n    const originalTransition = htmlElement.style.transition;\n\n    htmlElement.style.transition = `background-color ${duration}ms ease-out`;\n    htmlElement.style.backgroundColor = color;\n\n    setTimeout(() => {\n      htmlElement.style.backgroundColor = originalBackground;\n\n      setTimeout(() => {\n        htmlElement.style.transition = originalTransition;\n      }, duration);\n    }, 50);\n  });\n}\n\n/**\n * Apply animation directives to elements with lvt-animate attributes.\n */\nexport function handleAnimateDirectives(rootElement: Element): void {\n  const animateElements = rootElement.querySelectorAll(\"[lvt-animate]\");\n\n  animateElements.forEach((element) => {\n    const animation = element.getAttribute(\"lvt-animate\");\n    const duration = parseInt(\n      element.getAttribute(\"lvt-animate-duration\") || \"300\",\n      10\n    );\n\n    if (!animation) return;\n\n    const htmlElement = element as HTMLElement;\n\n    htmlElement.style.setProperty(\"--lvt-animate-duration\", `${duration}ms`);\n\n    switch (animation) {\n      case \"fade\":\n        htmlElement.style.animation = `lvt-fade-in var(--lvt-animate-duration) ease-out`;\n        break;\n\n      case \"slide\":\n        htmlElement.style.animation = `lvt-slide-in var(--lvt-animate-duration) ease-out`;\n        break;\n\n      case \"scale\":\n        htmlElement.style.animation = `lvt-scale-in var(--lvt-animate-duration) ease-out`;\n        break;\n\n      default:\n        console.warn(`Unknown lvt-animate mode: ${animation}`);\n    }\n\n    htmlElement.addEventListener(\n      \"animationend\",\n      () => {\n        htmlElement.style.animation = \"\";\n      },\n      { once: true }\n    );\n  });\n\n  if (!document.getElementById(\"lvt-animate-styles\")) {\n    const style = document.createElement(\"style\");\n    style.id = \"lvt-animate-styles\";\n    style.textContent = `\n      @keyframes lvt-fade-in {\n        from { opacity: 0; }\n        to { opacity: 1; }\n      }\n      @keyframes lvt-slide-in {\n        from {\n          opacity: 0;\n          transform: translateY(-10px);\n        }\n        to {\n          opacity: 1;\n          transform: translateY(0);\n        }\n      }\n      @keyframes lvt-scale-in {\n        from {\n          opacity: 0;\n          transform: scale(0.95);\n        }\n        to {\n          opacity: 1;\n          transform: scale(1);\n        }\n      }\n    `;\n    document.head.appendChild(style);\n  }\n}\n", "/**\n * Debounce function: delays execution until after a pause in calls\n */\nexport function debounce<T extends (...args: any[]) => any>(\n  func: T,\n  wait: number\n): (...args: Parameters<T>) => void {\n  let timeout: number | null = null;\n\n  return function debounceWrapper(this: unknown, ...args: Parameters<T>) {\n    const context = this;\n\n    if (timeout !== null) {\n      clearTimeout(timeout);\n    }\n\n    timeout = window.setTimeout(() => {\n      func.apply(context, args);\n    }, wait);\n  };\n}\n\n/**\n * Throttle function: limits execution to at most once per time period\n * First call executes immediately, subsequent calls are delayed\n */\nexport function throttle<T extends (...args: any[]) => any>(\n  func: T,\n  limit: number\n): (...args: Parameters<T>) => void {\n  let inThrottle = false;\n\n  return function throttleWrapper(this: unknown, ...args: Parameters<T>) {\n    const context = this;\n\n    if (!inThrottle) {\n      func.apply(context, args);\n      inThrottle = true;\n\n      setTimeout(() => {\n        inThrottle = false;\n      }, limit);\n    }\n  };\n}\n", "/**\n * Check if an element has lvt-confirm attribute and prompt user if needed.\n * Returns true if action should proceed, false if cancelled.\n */\nexport function checkLvtConfirm(element: HTMLElement): boolean {\n  if (element.hasAttribute(\"lvt-confirm\")) {\n    const confirmMessage = element.getAttribute(\"lvt-confirm\");\n    if (confirmMessage && !confirm(confirmMessage)) {\n      return false; // User cancelled\n    }\n  }\n  return true; // Proceed\n}\n\n/**\n * Extract lvt-data-* attributes from an element.\n * lvt-data-id=\"123\" becomes { id: \"123\" }\n * lvt-data-user-name=\"john\" becomes { \"user-name\": \"john\" }\n */\nexport function extractLvtData(element: HTMLElement): Record<string, string> {\n  const data: Record<string, string> = {};\n  const attributes = element.attributes;\n\n  for (let i = 0; i < attributes.length; i++) {\n    const attr = attributes[i];\n    if (attr.name.startsWith(\"lvt-data-\")) {\n      const key = attr.name.substring(9); // Remove \"lvt-data-\" prefix\n      data[key] = attr.value;\n    }\n  }\n\n  return data;\n}\n", "import { debounce, throttle } from \"../utils/rate-limit\";\nimport { checkLvtConfirm } from \"../utils/confirm\";\nimport type { Logger } from \"../utils/logger\";\n\nexport interface EventDelegationContext {\n  getWrapperElement(): Element | null;\n  getRateLimitedHandlers(): WeakMap<Element, Map<string, Function>>;\n  parseValue(value: string): any;\n  send(message: any): void;\n  setActiveSubmission(\n    form: HTMLFormElement | null,\n    button: HTMLButtonElement | null,\n    originalButtonText: string | null\n  ): void;\n  openModal(modalId: string): void;\n  closeModal(modalId: string): void;\n  getWebSocketReadyState(): number | undefined;\n  triggerPendingUploads(uploadName: string): void;\n}\n\n/**\n * Handles all DOM event delegation concerns for LiveTemplateClient.\n */\nexport class EventDelegator {\n  constructor(\n    private readonly context: EventDelegationContext,\n    private readonly logger: Logger\n  ) {}\n\n  setupEventDelegation(): void {\n    const wrapperElement = this.context.getWrapperElement();\n    if (!wrapperElement) return;\n\n    const eventTypes = [\n      \"click\",\n      \"submit\",\n      \"change\",\n      \"input\",\n      \"keydown\",\n      \"keyup\",\n      \"focus\",\n      \"blur\",\n      \"mouseenter\",\n      \"mouseleave\",\n    ];\n    const wrapperId = wrapperElement.getAttribute(\"data-lvt-id\");\n    const rateLimitedHandlers = this.context.getRateLimitedHandlers();\n\n    eventTypes.forEach((eventType) => {\n      const listenerKey = `__lvt_delegated_${eventType}_${wrapperId}`;\n      const existingListener = (document as any)[listenerKey];\n      if (existingListener) {\n        document.removeEventListener(eventType, existingListener, false);\n      }\n\n      const listener = (e: Event) => {\n        const currentWrapper = this.context.getWrapperElement();\n        if (!currentWrapper) return;\n\n        if (eventType === \"submit\") {\n          (window as any).__lvtSubmitListenerTriggered = true;\n          (window as any).__lvtSubmitEventTarget = (\n            e.target as Element\n          )?.tagName;\n        }\n\n        this.logger.debug(\"Event listener triggered:\", eventType, e.target);\n\n        const target = e.target as Element;\n        if (!target) return;\n\n        let element: Element | null = target;\n        let inWrapper = false;\n\n        while (element) {\n          if (element === currentWrapper) {\n            inWrapper = true;\n            break;\n          }\n          element = element.parentElement;\n        }\n\n        if (eventType === \"submit\") {\n          (window as any).__lvtInWrapper = inWrapper;\n          (window as any).__lvtWrapperElement =\n            currentWrapper.getAttribute(\"data-lvt-id\");\n        }\n\n        if (!inWrapper) return;\n\n        const attrName = `lvt-${eventType}`;\n        element = target;\n\n        while (element && element !== currentWrapper.parentElement) {\n          let action = element.getAttribute(attrName);\n          let actionElement = element;\n\n          // Check for lvt-persist on form submit (auto-persist to database)\n          if (!action && eventType === \"submit\" && element instanceof HTMLFormElement) {\n            const persistTable = element.getAttribute(\"lvt-persist\");\n            if (persistTable) {\n              action = `persist:${persistTable}`;\n              actionElement = element;\n            }\n          }\n\n          if (!action && (eventType === \"change\" || eventType === \"input\")) {\n            const formElement: HTMLFormElement | null = element.closest(\"form\");\n            if (formElement && formElement.hasAttribute(\"lvt-change\")) {\n              action = formElement.getAttribute(\"lvt-change\");\n              actionElement = formElement;\n            }\n          }\n\n          if (action && actionElement) {\n            if (eventType === \"submit\") {\n              (window as any).__lvtActionFound = action;\n              (window as any).__lvtActionElement = actionElement.tagName;\n            }\n\n            if (eventType === \"submit\") {\n              e.preventDefault();\n            }\n\n            if (\n              (eventType === \"keydown\" || eventType === \"keyup\") &&\n              actionElement.hasAttribute(\"lvt-key\")\n            ) {\n              const keyFilter = actionElement.getAttribute(\"lvt-key\");\n              const keyboardEvent = e as KeyboardEvent;\n              if (keyFilter && keyboardEvent.key !== keyFilter) {\n                element = element.parentElement;\n                continue;\n              }\n            }\n\n            const targetElement = actionElement;\n\n            const handleAction = () => {\n              this.logger.debug(\"handleAction called\", {\n                action,\n                eventType,\n                targetElement,\n              });\n\n              // Handle lvt-confirm for any action\n              if (!checkLvtConfirm(targetElement as HTMLElement)) {\n                this.logger.debug(\"Action cancelled by user:\", action);\n                return;\n              }\n\n              const message: any = { action, data: {} };\n\n              if (targetElement instanceof HTMLFormElement) {\n                this.logger.debug(\"Processing form element\");\n                const formData = new FormData(targetElement);\n\n                const checkboxes = Array.from(\n                  targetElement.querySelectorAll('input[type=\"checkbox\"][name]')\n                ) as HTMLInputElement[];\n                const checkboxNames = new Set(checkboxes.map((cb) => cb.name));\n\n                checkboxNames.forEach((name) => {\n                  message.data[name] = false;\n                });\n\n                formData.forEach((value, key) => {\n                  if (checkboxNames.has(key)) {\n                    message.data[key] = true;\n                    this.logger.debug(\"Converted checkbox\", key, \"to true\");\n                  } else {\n                    message.data[key] = this.context.parseValue(\n                      value as string\n                    );\n                  }\n                });\n                this.logger.debug(\"Form data collected:\", message.data);\n              } else if (eventType === \"change\" || eventType === \"input\") {\n                if (targetElement instanceof HTMLInputElement) {\n                  const key = targetElement.name || \"value\";\n                  message.data[key] = this.context.parseValue(\n                    targetElement.value\n                  );\n                } else if (targetElement instanceof HTMLSelectElement) {\n                  const key = targetElement.name || \"value\";\n                  message.data[key] = this.context.parseValue(\n                    targetElement.value\n                  );\n                } else if (targetElement instanceof HTMLTextAreaElement) {\n                  const key = targetElement.name || \"value\";\n                  message.data[key] = this.context.parseValue(\n                    targetElement.value\n                  );\n                }\n              }\n\n              Array.from(targetElement.attributes).forEach((attr) => {\n                if (attr.name.startsWith(\"lvt-data-\")) {\n                  const key = attr.name.replace(\"lvt-data-\", \"\");\n                  message.data[key] = this.context.parseValue(attr.value);\n                }\n              });\n\n              Array.from(targetElement.attributes).forEach((attr) => {\n                if (attr.name.startsWith(\"lvt-value-\")) {\n                  const key = attr.name.replace(\"lvt-value-\", \"\");\n                  message.data[key] = this.context.parseValue(attr.value);\n                }\n              });\n\n              if (\n                eventType === \"submit\" &&\n                targetElement instanceof HTMLFormElement\n              ) {\n                const submitEvent = e as SubmitEvent;\n                const submitButton =\n                  submitEvent.submitter as HTMLButtonElement | null;\n                let originalButtonText: string | null = null;\n\n                if (\n                  submitButton &&\n                  submitButton.hasAttribute(\"lvt-disable-with\")\n                ) {\n                  originalButtonText = submitButton.textContent;\n                  submitButton.disabled = true;\n                  submitButton.textContent =\n                    submitButton.getAttribute(\"lvt-disable-with\");\n                  this.logger.debug(\"Disabled submit button\");\n                }\n\n                this.context.setActiveSubmission(\n                  targetElement,\n                  submitButton || null,\n                  originalButtonText\n                );\n\n                // Trigger pending uploads for any file inputs in the form\n                const fileInputs = targetElement.querySelectorAll<HTMLInputElement>(\n                  'input[type=\"file\"][lvt-upload]'\n                );\n                fileInputs.forEach((input) => {\n                  const uploadName = input.getAttribute(\"lvt-upload\");\n                  if (uploadName) {\n                    this.logger.debug(\"Triggering pending uploads for:\", uploadName);\n                    this.context.triggerPendingUploads(uploadName);\n                  }\n                });\n\n                targetElement.dispatchEvent(\n                  new CustomEvent(\"lvt:pending\", { detail: message })\n                );\n                this.logger.debug(\"Emitted lvt:pending event\");\n              }\n\n              this.logger.debug(\"About to send message:\", message);\n              this.logger.debug(\n                \"WebSocket state:\",\n                this.context.getWebSocketReadyState()\n              );\n\n              this.context.send(message);\n              this.logger.debug(\"send() called\");\n            };\n\n            const throttleValue = actionElement.getAttribute(\"lvt-throttle\");\n            const debounceValue = actionElement.getAttribute(\"lvt-debounce\");\n\n            if (throttleValue || debounceValue) {\n              if (!rateLimitedHandlers.has(actionElement)) {\n                rateLimitedHandlers.set(actionElement, new Map());\n              }\n              const handlerCache = rateLimitedHandlers.get(actionElement)!;\n              const cacheKey = `${eventType}:${action}`;\n\n              let rateLimitedHandler = handlerCache.get(cacheKey);\n              if (!rateLimitedHandler) {\n                if (throttleValue) {\n                  const limit = parseInt(throttleValue, 10);\n                  rateLimitedHandler = throttle(handleAction, limit);\n                } else if (debounceValue) {\n                  const wait = parseInt(debounceValue, 10);\n                  rateLimitedHandler = debounce(handleAction, wait);\n                }\n                if (rateLimitedHandler) {\n                  handlerCache.set(cacheKey, rateLimitedHandler);\n                }\n              }\n\n              if (rateLimitedHandler) {\n                rateLimitedHandler();\n              }\n            } else {\n              if (eventType === \"submit\") {\n                (window as any).__lvtBeforeHandleAction = true;\n              }\n              handleAction();\n              if (eventType === \"submit\") {\n                (window as any).__lvtAfterHandleAction = true;\n              }\n            }\n\n            return;\n          }\n          element = element.parentElement;\n        }\n      };\n\n      (document as any)[listenerKey] = listener;\n      document.addEventListener(eventType, listener, false);\n      this.logger.debug(\n        \"Registered event listener:\",\n        eventType,\n        \"with key:\",\n        listenerKey\n      );\n    });\n  }\n\n  setupWindowEventDelegation(): void {\n    const wrapperElement = this.context.getWrapperElement();\n    if (!wrapperElement) return;\n\n    const windowEvents = [\n      \"keydown\",\n      \"keyup\",\n      \"scroll\",\n      \"resize\",\n      \"focus\",\n      \"blur\",\n    ];\n    const wrapperId = wrapperElement.getAttribute(\"data-lvt-id\");\n    const rateLimitedHandlers = this.context.getRateLimitedHandlers();\n\n    windowEvents.forEach((eventType) => {\n      const listenerKey = `__lvt_window_${eventType}_${wrapperId}`;\n      const existingListener = (window as any)[listenerKey];\n      if (existingListener) {\n        window.removeEventListener(eventType, existingListener);\n      }\n\n      const listener = (e: Event) => {\n        const currentWrapper = this.context.getWrapperElement();\n        if (!currentWrapper) return;\n\n        const attrName = `lvt-window-${eventType}`;\n        const elements = currentWrapper.querySelectorAll(`[${attrName}]`);\n\n        elements.forEach((element) => {\n          const action = element.getAttribute(attrName);\n          if (!action) return;\n\n          if (\n            (eventType === \"keydown\" || eventType === \"keyup\") &&\n            element.hasAttribute(\"lvt-key\")\n          ) {\n            const keyFilter = element.getAttribute(\"lvt-key\");\n            const keyboardEvent = e as KeyboardEvent;\n            if (keyFilter && keyboardEvent.key !== keyFilter) {\n              return;\n            }\n          }\n\n          const message: any = { action, data: {} };\n\n          Array.from(element.attributes).forEach((attr) => {\n            if (attr.name.startsWith(\"lvt-data-\")) {\n              const key = attr.name.replace(\"lvt-data-\", \"\");\n              message.data[key] = this.context.parseValue(attr.value);\n            }\n          });\n\n          Array.from(element.attributes).forEach((attr) => {\n            if (attr.name.startsWith(\"lvt-value-\")) {\n              const key = attr.name.replace(\"lvt-value-\", \"\");\n              message.data[key] = this.context.parseValue(attr.value);\n            }\n          });\n\n          const throttleValue = element.getAttribute(\"lvt-throttle\");\n          const debounceValue = element.getAttribute(\"lvt-debounce\");\n\n          const handleAction = () => this.context.send(message);\n\n          if (throttleValue || debounceValue) {\n            if (!rateLimitedHandlers.has(element)) {\n              rateLimitedHandlers.set(element, new Map());\n            }\n            const handlerCache = rateLimitedHandlers.get(element)!;\n            const cacheKey = `window-${eventType}:${action}`;\n\n            let rateLimitedHandler = handlerCache.get(cacheKey);\n            if (!rateLimitedHandler) {\n              if (throttleValue) {\n                const limit = parseInt(throttleValue, 10);\n                rateLimitedHandler = throttle(handleAction, limit);\n              } else if (debounceValue) {\n                const wait = parseInt(debounceValue, 10);\n                rateLimitedHandler = debounce(handleAction, wait);\n              }\n              if (rateLimitedHandler) {\n                handlerCache.set(cacheKey, rateLimitedHandler);\n              }\n            }\n\n            if (rateLimitedHandler) {\n              rateLimitedHandler();\n            }\n          } else {\n            handleAction();\n          }\n        });\n      };\n\n      (window as any)[listenerKey] = listener;\n      window.addEventListener(eventType, listener);\n    });\n  }\n\n  setupClickAwayDelegation(): void {\n    const wrapperElement = this.context.getWrapperElement();\n    if (!wrapperElement) return;\n\n    const wrapperId = wrapperElement.getAttribute(\"data-lvt-id\");\n    const listenerKey = `__lvt_click_away_${wrapperId}`;\n    const existingListener = (document as any)[listenerKey];\n    if (existingListener) {\n      document.removeEventListener(\"click\", existingListener);\n    }\n\n    const listener = (e: Event) => {\n      const currentWrapper = this.context.getWrapperElement();\n      if (!currentWrapper) return;\n\n      const target = e.target as Element;\n      const elements = currentWrapper.querySelectorAll(\"[lvt-click-away]\");\n\n      elements.forEach((element) => {\n        if (!element.contains(target)) {\n          const action = element.getAttribute(\"lvt-click-away\");\n          if (!action) return;\n\n          const message: any = { action, data: {} };\n\n          Array.from(element.attributes).forEach((attr) => {\n            if (attr.name.startsWith(\"lvt-data-\")) {\n              const key = attr.name.replace(\"lvt-data-\", \"\");\n              message.data[key] = this.context.parseValue(attr.value);\n            }\n          });\n\n          Array.from(element.attributes).forEach((attr) => {\n            if (attr.name.startsWith(\"lvt-value-\")) {\n              const key = attr.name.replace(\"lvt-value-\", \"\");\n              message.data[key] = this.context.parseValue(attr.value);\n            }\n          });\n\n          this.context.send(message);\n        }\n      });\n    };\n\n    (document as any)[listenerKey] = listener;\n    document.addEventListener(\"click\", listener);\n  }\n\n  setupModalDelegation(): void {\n    const wrapperElement = this.context.getWrapperElement();\n    if (!wrapperElement) return;\n\n    const wrapperId = wrapperElement.getAttribute(\"data-lvt-id\");\n\n    const openListenerKey = `__lvt_modal_open_${wrapperId}`;\n    const existingOpenListener = (document as any)[openListenerKey];\n    if (existingOpenListener) {\n      document.removeEventListener(\"click\", existingOpenListener);\n    }\n\n    const openListener = (e: Event) => {\n      const currentWrapper = this.context.getWrapperElement();\n      if (!currentWrapper) return;\n\n      const target = (e.target as Element)?.closest(\"[lvt-modal-open]\");\n      if (!target || !currentWrapper.contains(target)) return;\n\n      const modalId = target.getAttribute(\"lvt-modal-open\");\n      if (!modalId) return;\n\n      e.preventDefault();\n      this.context.openModal(modalId);\n    };\n\n    (document as any)[openListenerKey] = openListener;\n    document.addEventListener(\"click\", openListener);\n\n    const closeListenerKey = `__lvt_modal_close_${wrapperId}`;\n    const existingCloseListener = (document as any)[closeListenerKey];\n    if (existingCloseListener) {\n      document.removeEventListener(\"click\", existingCloseListener);\n    }\n\n    const closeListener = (e: Event) => {\n      const currentWrapper = this.context.getWrapperElement();\n      if (!currentWrapper) return;\n\n      const target = (e.target as Element)?.closest(\"[lvt-modal-close]\");\n      if (!target || !currentWrapper.contains(target)) {\n        return;\n      }\n\n      const modalId = target.getAttribute(\"lvt-modal-close\");\n      if (!modalId) return;\n\n      e.preventDefault();\n      this.context.closeModal(modalId);\n    };\n\n    (document as any)[closeListenerKey] = closeListener;\n    document.addEventListener(\"click\", closeListener);\n\n    const backdropListenerKey = `__lvt_modal_backdrop_${wrapperId}`;\n    const existingBackdropListener = (document as any)[backdropListenerKey];\n    if (existingBackdropListener) {\n      document.removeEventListener(\"click\", existingBackdropListener);\n    }\n\n    const backdropListener = (e: Event) => {\n      const target = e.target as Element;\n      if (!target.hasAttribute(\"data-modal-backdrop\")) return;\n\n      const modalId = target.getAttribute(\"data-modal-id\");\n      if (modalId) {\n        this.context.closeModal(modalId);\n      }\n    };\n\n    (document as any)[backdropListenerKey] = backdropListener;\n    document.addEventListener(\"click\", backdropListener);\n\n    const escapeListenerKey = `__lvt_modal_escape_${wrapperId}`;\n    const existingEscapeListener = (document as any)[escapeListenerKey];\n    if (existingEscapeListener) {\n      document.removeEventListener(\"keydown\", existingEscapeListener);\n    }\n\n    const escapeListener = (e: KeyboardEvent) => {\n      if (e.key !== \"Escape\") return;\n      const currentWrapper = this.context.getWrapperElement();\n      if (!currentWrapper) return;\n\n      const openModals = currentWrapper.querySelectorAll(\n        '[role=\"dialog\"]:not([hidden])'\n      );\n      if (openModals.length > 0) {\n        const lastModal = openModals[openModals.length - 1];\n        if (lastModal.id) {\n          this.context.closeModal(lastModal.id);\n        }\n      }\n    };\n\n    (document as any)[escapeListenerKey] = escapeListener;\n    document.addEventListener(\"keydown\", escapeListener);\n  }\n\n  /**\n   * Sets up focus trapping for elements with lvt-focus-trap attribute.\n   * Focus is trapped within the element, cycling through focusable elements\n   * when Tab/Shift+Tab is pressed.\n   */\n  setupFocusTrapDelegation(): void {\n    const wrapperElement = this.context.getWrapperElement();\n    if (!wrapperElement) return;\n\n    const wrapperId = wrapperElement.getAttribute(\"data-lvt-id\");\n    const listenerKey = `__lvt_focus_trap_${wrapperId}`;\n    const existingListener = (document as any)[listenerKey];\n    if (existingListener) {\n      document.removeEventListener(\"keydown\", existingListener);\n    }\n\n    const getFocusableElements = (container: Element): HTMLElement[] => {\n      const selector = [\n        'a[href]:not([disabled])',\n        'button:not([disabled])',\n        'textarea:not([disabled])',\n        'input:not([disabled]):not([type=\"hidden\"])',\n        'select:not([disabled])',\n        '[tabindex]:not([tabindex=\"-1\"]):not([disabled])',\n        '[contenteditable=\"true\"]'\n      ].join(', ');\n\n      return Array.from(container.querySelectorAll(selector)).filter(\n        (el) => {\n          const htmlEl = el as HTMLElement;\n          // Check if element is visible\n          const style = window.getComputedStyle(htmlEl);\n          const isNotDisplayNone = style.display !== 'none';\n          const isNotVisibilityHidden = style.visibility !== 'hidden';\n          // offsetParent can be null in JSDOM or for fixed/absolute positioned elements\n          const hasLayoutContext = htmlEl.offsetParent !== null ||\n                                   style.position === 'fixed' ||\n                                   style.position === 'absolute' ||\n                                   // In test environments, offsetParent may always be null\n                                   (typeof process !== 'undefined' && (process as any).env?.NODE_ENV === 'test');\n          return isNotDisplayNone && isNotVisibilityHidden && hasLayoutContext;\n        }\n      ) as HTMLElement[];\n    };\n\n    const listener = (e: KeyboardEvent) => {\n      if (e.key !== \"Tab\") return;\n\n      const currentWrapper = this.context.getWrapperElement();\n      if (!currentWrapper) return;\n\n      // Find the active focus trap container (innermost one containing the focused element)\n      const focusTrapElements = currentWrapper.querySelectorAll(\"[lvt-focus-trap]\");\n      let activeTrap: Element | null = null;\n\n      focusTrapElements.forEach((trap) => {\n        if (trap.contains(document.activeElement)) {\n          // Check if this is the innermost trap containing the focused element\n          if (!activeTrap || trap.contains(activeTrap)) {\n            activeTrap = trap;\n          }\n        }\n      });\n\n      // If there's a visible focus trap that doesn't contain the active element,\n      // and is visible, trap focus there (for newly opened modals/dropdowns)\n      if (!activeTrap) {\n        focusTrapElements.forEach((trap) => {\n          const htmlTrap = trap as HTMLElement;\n          const style = window.getComputedStyle(htmlTrap);\n          if (style.display !== 'none' && style.visibility !== 'hidden') {\n            activeTrap = trap;\n          }\n        });\n      }\n\n      if (!activeTrap) return;\n\n      const focusableElements = getFocusableElements(activeTrap);\n      if (focusableElements.length === 0) return;\n\n      const firstElement = focusableElements[0];\n      const lastElement = focusableElements[focusableElements.length - 1];\n\n      if (e.shiftKey) {\n        // Shift+Tab: moving backwards\n        if (document.activeElement === firstElement) {\n          e.preventDefault();\n          lastElement.focus();\n        }\n      } else {\n        // Tab: moving forwards\n        if (document.activeElement === lastElement) {\n          e.preventDefault();\n          firstElement.focus();\n        }\n      }\n    };\n\n    (document as any)[listenerKey] = listener;\n    document.addEventListener(\"keydown\", listener);\n    this.logger.debug(\"Focus trap delegation set up\");\n  }\n\n  /**\n   * Sets up autofocus for elements with lvt-autofocus attribute.\n   * Automatically focuses the first element with lvt-autofocus when it becomes visible.\n   * Uses MutationObserver to detect when elements are added or become visible.\n   */\n  setupAutofocusDelegation(): void {\n    const wrapperElement = this.context.getWrapperElement();\n    if (!wrapperElement) return;\n\n    const wrapperId = wrapperElement.getAttribute(\"data-lvt-id\");\n    const observerKey = `__lvt_autofocus_observer_${wrapperId}`;\n\n    // Disconnect existing observer if any\n    const existingObserver = (wrapperElement as any)[observerKey];\n    if (existingObserver) {\n      existingObserver.disconnect();\n    }\n\n    const processAutofocus = () => {\n      const currentWrapper = this.context.getWrapperElement();\n      if (!currentWrapper) return;\n\n      // Find all elements with lvt-autofocus that are visible\n      const autofocusElements = currentWrapper.querySelectorAll(\"[lvt-autofocus]\");\n\n      autofocusElements.forEach((element) => {\n        const htmlElement = element as HTMLElement;\n        const style = window.getComputedStyle(htmlElement);\n\n        // Check if element is visible and hasn't been focused yet in this visibility state\n        // Note: offsetParent can be null in JSDOM or for fixed/absolute positioned elements,\n        // so we only use it as a secondary check when it's available\n        const isNotDisplayNone = style.display !== 'none';\n        const isNotVisibilityHidden = style.visibility !== 'hidden';\n        const hasLayoutContext = htmlElement.offsetParent !== null ||\n                                 style.position === 'fixed' ||\n                                 style.position === 'absolute' ||\n                                 htmlElement.tagName === 'BODY' ||\n                                 // In test environments, offsetParent may always be null\n                                 (typeof process !== 'undefined' && (process as any).env?.NODE_ENV === 'test');\n        const isVisible = isNotDisplayNone && isNotVisibilityHidden && hasLayoutContext;\n\n        const wasFocused = htmlElement.getAttribute(\"data-lvt-autofocused\") === \"true\";\n\n        if (isVisible && !wasFocused) {\n          // Mark as focused to prevent re-focusing on every mutation\n          htmlElement.setAttribute(\"data-lvt-autofocused\", \"true\");\n\n          // Use requestAnimationFrame to ensure DOM is ready\n          requestAnimationFrame(() => {\n            htmlElement.focus();\n            this.logger.debug(\"Autofocused element:\", htmlElement.tagName, htmlElement.id || htmlElement.getAttribute(\"name\"));\n          });\n        } else if (!isVisible && wasFocused) {\n          // Reset the flag when element becomes hidden so it can be refocused when shown again\n          htmlElement.removeAttribute(\"data-lvt-autofocused\");\n        }\n      });\n    };\n\n    // Process autofocus immediately for any existing elements\n    processAutofocus();\n\n    // Set up MutationObserver to watch for new autofocus elements or visibility changes\n    const observer = new MutationObserver((mutations) => {\n      let shouldProcess = false;\n\n      mutations.forEach((mutation) => {\n        // Check for added nodes\n        if (mutation.type === \"childList\" && mutation.addedNodes.length > 0) {\n          mutation.addedNodes.forEach((node) => {\n            if (node instanceof Element) {\n              if (node.hasAttribute(\"lvt-autofocus\") || node.querySelector(\"[lvt-autofocus]\")) {\n                shouldProcess = true;\n              }\n            }\n          });\n        }\n\n        // Check for attribute changes that might affect visibility\n        // We intentionally check \"class\" changes to handle CSS-based visibility\n        // (e.g., Tailwind's \"hidden\" class, Bootstrap's \"d-none\", etc.)\n        // This may cause some extra processing but ensures visibility changes\n        // via class toggles are detected.\n        if (mutation.type === \"attributes\") {\n          const target = mutation.target as Element;\n          if (target.hasAttribute(\"lvt-autofocus\") ||\n              mutation.attributeName === \"hidden\" ||\n              mutation.attributeName === \"style\" ||\n              mutation.attributeName === \"class\") {\n            shouldProcess = true;\n          }\n        }\n      });\n\n      if (shouldProcess) {\n        processAutofocus();\n      }\n    });\n\n    observer.observe(wrapperElement, {\n      childList: true,\n      subtree: true,\n      attributes: true,\n      attributeFilter: [\"hidden\", \"style\", \"class\", \"lvt-autofocus\"]\n    });\n\n    (wrapperElement as any)[observerKey] = observer;\n    this.logger.debug(\"Autofocus delegation set up\");\n  }\n}\n", "import type { Logger } from \"../utils/logger\";\n\nexport interface ObserverContext {\n  getWrapperElement(): Element | null;\n  send(message: any): void;\n}\n\n/**\n * Manages LiveTemplate observers such as infinite scroll and DOM mutations.\n */\nexport class ObserverManager {\n  private infiniteScrollObserver: IntersectionObserver | null = null;\n  private mutationObserver: MutationObserver | null = null;\n\n  constructor(\n    private readonly context: ObserverContext,\n    private readonly logger: Logger\n  ) {}\n\n  setupInfiniteScrollObserver(): void {\n    const wrapperElement = this.context.getWrapperElement();\n    if (!wrapperElement) return;\n\n    const sentinel = document.getElementById(\"scroll-sentinel\");\n    if (!sentinel) {\n      return;\n    }\n\n    if (this.infiniteScrollObserver) {\n      this.infiniteScrollObserver.disconnect();\n    }\n\n    this.infiniteScrollObserver = new IntersectionObserver(\n      (entries) => {\n        if (entries[0].isIntersecting) {\n          this.logger.debug(\"Sentinel visible, sending load_more action\");\n          this.context.send({ action: \"load_more\" });\n        }\n      },\n      {\n        rootMargin: \"200px\",\n      }\n    );\n\n    this.infiniteScrollObserver.observe(sentinel);\n    this.logger.debug(\"Observer set up successfully\");\n  }\n\n  setupInfiniteScrollMutationObserver(): void {\n    const wrapperElement = this.context.getWrapperElement();\n    if (!wrapperElement) return;\n\n    if (this.mutationObserver) {\n      this.mutationObserver.disconnect();\n    }\n\n    this.mutationObserver = new MutationObserver(() => {\n      this.setupInfiniteScrollObserver();\n    });\n\n    this.mutationObserver.observe(wrapperElement, {\n      childList: true,\n      subtree: true,\n    });\n\n    this.logger.debug(\"MutationObserver set up successfully\");\n  }\n\n  teardown(): void {\n    if (this.infiniteScrollObserver) {\n      this.infiniteScrollObserver.disconnect();\n      this.infiniteScrollObserver = null;\n    }\n    if (this.mutationObserver) {\n      this.mutationObserver.disconnect();\n      this.mutationObserver = null;\n    }\n  }\n}\n", "import type { Logger } from \"../utils/logger\";\n\n/**\n * Manages client-side modal interactions for LiveTemplate.\n */\nexport class ModalManager {\n  constructor(private readonly logger: Logger) {}\n\n  open(modalId: string): void {\n    const modal = document.getElementById(modalId);\n    if (!modal) {\n      this.logger.warn(`Modal with id=\"${modalId}\" not found`);\n      return;\n    }\n\n    modal.removeAttribute(\"hidden\");\n    modal.style.display = \"flex\";\n    modal.setAttribute(\"aria-hidden\", \"false\");\n    modal.dispatchEvent(new CustomEvent(\"lvt:modal-opened\", { bubbles: true }));\n\n    this.logger.info(`Opened modal: ${modalId}`);\n\n    const firstInput = modal.querySelector(\n      \"input, textarea, select\"\n    ) as HTMLElement | null;\n    if (firstInput) {\n      setTimeout(() => {\n        const activeElement = document.activeElement as HTMLElement | null;\n        const isVisible = (element: HTMLElement | null): boolean => {\n          if (!element) {\n            return false;\n          }\n\n          if (element === document.body) {\n            return true;\n          }\n\n          // Use offsetParent and bounding rects to determine visibility without hitting layout too hard.\n          if (element.offsetParent !== null) {\n            return true;\n          }\n\n          return element.getClientRects().length > 0;\n        };\n\n        const shouldMoveFocus =\n          !activeElement ||\n          !modal.contains(activeElement) ||\n          !isVisible(activeElement);\n\n        if (shouldMoveFocus) {\n          firstInput.focus();\n        }\n      }, 100);\n    }\n  }\n\n  close(modalId: string): void {\n    const modal = document.getElementById(modalId);\n    if (!modal) {\n      this.logger.warn(`Modal with id=\"${modalId}\" not found`);\n      return;\n    }\n\n    modal.setAttribute(\"hidden\", \"\");\n    modal.style.display = \"none\";\n    modal.setAttribute(\"aria-hidden\", \"true\");\n    modal.dispatchEvent(new CustomEvent(\"lvt:modal-closed\", { bubbles: true }));\n\n    this.logger.info(`Closed modal: ${modalId}`);\n  }\n}\n", "/**\n * Handles showing and hiding the global LiveTemplate loading indicator.\n */\nexport class LoadingIndicator {\n  private bar: HTMLElement | null = null;\n\n  show(): void {\n    if (this.bar) return;\n\n    const bar = document.createElement(\"div\");\n    bar.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      height: 3px;\n      background: linear-gradient(90deg, #3b82f6 0%, #60a5fa 50%, #3b82f6 100%);\n      background-size: 200% 100%;\n      z-index: 9999;\n      animation: lvt-loading-shimmer 1.5s ease-in-out infinite;\n    `;\n\n    if (!document.getElementById(\"lvt-loading-styles\")) {\n      const style = document.createElement(\"style\");\n      style.id = \"lvt-loading-styles\";\n      style.textContent = `\n        @keyframes lvt-loading-shimmer {\n          0% { background-position: 200% 0; }\n          100% { background-position: -200% 0; }\n        }\n      `;\n      document.head.appendChild(style);\n    }\n\n    document.body.insertBefore(bar, document.body.firstChild);\n    this.bar = bar;\n  }\n\n  hide(): void {\n    if (!this.bar) return;\n\n    if (this.bar.parentNode) {\n      this.bar.parentNode.removeChild(this.bar);\n    }\n    this.bar = null;\n  }\n}\n", "/**\n * Enables and disables all form controls inside the LiveTemplate wrapper.\n */\nexport class FormDisabler {\n  disable(wrapper: Element | null): void {\n    if (!wrapper) return;\n\n    const forms = wrapper.querySelectorAll(\"form\");\n    forms.forEach((form) => {\n      const inputs = form.querySelectorAll(\"input, textarea, select, button\");\n      inputs.forEach((input) => {\n        (input as HTMLInputElement).disabled = true;\n      });\n    });\n  }\n\n  enable(wrapper: Element | null): void {\n    if (!wrapper) return;\n\n    const forms = wrapper.querySelectorAll(\"form\");\n    forms.forEach((form) => {\n      const inputs = form.querySelectorAll(\"input, textarea, select, button\");\n      inputs.forEach((input) => {\n        (input as HTMLInputElement).disabled = false;\n      });\n    });\n  }\n}\n", "/**\n * Reactive Attributes - Declarative DOM actions triggered by LiveTemplate lifecycle events.\n *\n * Attribute Pattern: lvt-{action}-on:{event}=\"param\"\n *\n * Events:\n *   - pending: Action started, waiting for server response\n *   - success: Action completed successfully\n *   - error: Action completed with validation errors\n *   - done: Action completed (regardless of success/error)\n *\n * Event Scope:\n *   - Global: lvt-reset-on:success (any action)\n *   - Action-specific: lvt-reset-on:create-todo:success (specific action only)\n *\n * Actions:\n *   - reset: Calls form.reset()\n *   - disable: Sets element.disabled = true\n *   - enable: Sets element.disabled = false\n *   - addClass: Adds CSS class(es)\n *   - removeClass: Removes CSS class(es)\n *   - toggleClass: Toggles CSS class(es)\n *   - setAttr: Sets an attribute (name:value format)\n *   - toggleAttr: Toggles a boolean attribute\n */\n\nexport type ReactiveAction =\n  | \"reset\"\n  | \"disable\"\n  | \"enable\"\n  | \"addClass\"\n  | \"removeClass\"\n  | \"toggleClass\"\n  | \"setAttr\"\n  | \"toggleAttr\";\n\nexport type LifecycleEvent = \"pending\" | \"success\" | \"error\" | \"done\";\n\nexport interface ReactiveBinding {\n  action: ReactiveAction;\n  lifecycle: LifecycleEvent;\n  actionName?: string;\n  param?: string;\n}\n\nconst LIFECYCLE_EVENTS: LifecycleEvent[] = [\"pending\", \"success\", \"error\", \"done\"];\n\nconst REACTIVE_ACTIONS: ReactiveAction[] = [\n  \"reset\",\n  \"disable\",\n  \"enable\",\n  \"addClass\",\n  \"removeClass\",\n  \"toggleClass\",\n  \"setAttr\",\n  \"toggleAttr\",\n];\n\n// Lowercase versions for case-insensitive matching (HTML attributes are lowercased)\nconst ACTION_MAP: Record<string, ReactiveAction> = {\n  reset: \"reset\",\n  disable: \"disable\",\n  enable: \"enable\",\n  addclass: \"addClass\",\n  removeclass: \"removeClass\",\n  toggleclass: \"toggleClass\",\n  setattr: \"setAttr\",\n  toggleattr: \"toggleAttr\",\n};\n\n/**\n * Parse a reactive attribute name and value into a binding.\n *\n * Examples:\n *   parseReactiveAttribute(\"lvt-reset-on:success\", \"\") => { action: \"reset\", lifecycle: \"success\" }\n *   parseReactiveAttribute(\"lvt-addClass-on:pending\", \"loading\") => { action: \"addClass\", lifecycle: \"pending\", param: \"loading\" }\n *   parseReactiveAttribute(\"lvt-reset-on:create-todo:success\", \"\") => { action: \"reset\", lifecycle: \"success\", actionName: \"create-todo\" }\n */\nexport function parseReactiveAttribute(\n  attrName: string,\n  attrValue: string\n): ReactiveBinding | null {\n  // Pattern: lvt-{action}-on:{actionName?}:{lifecycle}\n  // The lifecycle must be at the end, action name is optional in the middle\n  // Note: HTML attributes are lowercased by browsers, so we match case-insensitively\n  const match = attrName.toLowerCase().match(/^lvt-(\\w+)-on:(.+)$/);\n  if (!match) return null;\n\n  const actionKey = match[1];\n  const action = ACTION_MAP[actionKey];\n  if (!action) return null;\n\n  const eventPart = match[2];\n\n  // Check if the last segment is a lifecycle event\n  // Format: \"{actionName}:{lifecycle}\" or just \"{lifecycle}\"\n  const segments = eventPart.split(\":\");\n  const lastSegment = segments[segments.length - 1] as LifecycleEvent;\n\n  if (!LIFECYCLE_EVENTS.includes(lastSegment)) return null;\n\n  const lifecycle = lastSegment;\n  const actionName = segments.length > 1 ? segments.slice(0, -1).join(\":\") : undefined;\n\n  return {\n    action,\n    lifecycle,\n    actionName: actionName || undefined,\n    param: attrValue || undefined,\n  };\n}\n\n/**\n * Execute a reactive action on an element.\n */\nexport function executeAction(\n  element: Element,\n  action: ReactiveAction,\n  param?: string\n): void {\n  switch (action) {\n    case \"reset\":\n      if (element instanceof HTMLFormElement) {\n        element.reset();\n      }\n      break;\n\n    case \"disable\":\n      if (\"disabled\" in element) {\n        (element as HTMLButtonElement | HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement).disabled = true;\n      }\n      break;\n\n    case \"enable\":\n      if (\"disabled\" in element) {\n        (element as HTMLButtonElement | HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement).disabled = false;\n      }\n      break;\n\n    case \"addClass\":\n      if (param) {\n        const classes = param.split(/\\s+/).filter(Boolean);\n        element.classList.add(...classes);\n      }\n      break;\n\n    case \"removeClass\":\n      if (param) {\n        const classes = param.split(/\\s+/).filter(Boolean);\n        element.classList.remove(...classes);\n      }\n      break;\n\n    case \"toggleClass\":\n      if (param) {\n        const classes = param.split(/\\s+/).filter(Boolean);\n        classes.forEach((c) => element.classList.toggle(c));\n      }\n      break;\n\n    case \"setAttr\":\n      if (param) {\n        const colonIndex = param.indexOf(\":\");\n        if (colonIndex > 0) {\n          const name = param.substring(0, colonIndex);\n          const value = param.substring(colonIndex + 1);\n          element.setAttribute(name, value);\n        }\n      }\n      break;\n\n    case \"toggleAttr\":\n      if (param) {\n        element.toggleAttribute(param);\n      }\n      break;\n  }\n}\n\n/**\n * Check if an event matches a binding.\n *\n * @param binding The reactive binding to check\n * @param lifecycle The lifecycle event that fired\n * @param actionName The action name that triggered the event (optional)\n */\nexport function matchesEvent(\n  binding: ReactiveBinding,\n  lifecycle: LifecycleEvent,\n  actionName?: string\n): boolean {\n  // Lifecycle must match\n  if (binding.lifecycle !== lifecycle) return false;\n\n  // If binding has no actionName, it's global (matches any action)\n  if (!binding.actionName) return true;\n\n  // If binding has actionName, it must match the fired action\n  return binding.actionName === actionName;\n}\n\n/**\n * Process all reactive attributes for a lifecycle event.\n *\n * Instead of building complex selectors, we iterate all elements with any lvt-*-on:* attribute\n * and check each one against the fired event.\n */\nexport function processReactiveAttributes(\n  lifecycle: LifecycleEvent,\n  actionName?: string\n): void {\n  // Find all elements that might have reactive attributes\n  // This is a broad selector but avoids escaping issues with attribute names containing colons\n  const allElements = document.querySelectorAll(\"*\");\n\n  allElements.forEach((element) => {\n    // Check all attributes on this element for reactive bindings\n    Array.from(element.attributes).forEach((attr) => {\n      // Quick filter: only process lvt-*-on: attributes\n      if (!attr.name.startsWith(\"lvt-\") || !attr.name.includes(\"-on:\")) {\n        return;\n      }\n\n      const binding = parseReactiveAttribute(attr.name, attr.value);\n      if (binding && matchesEvent(binding, lifecycle, actionName)) {\n        executeAction(element, binding.action, binding.param);\n      }\n    });\n  });\n}\n\n/**\n * Set up document-level event listeners for reactive attributes.\n * This should be called once during client initialization.\n */\nexport function setupReactiveAttributeListeners(): void {\n  LIFECYCLE_EVENTS.forEach((lifecycle) => {\n    // Listen in capture phase to process before event bubbles\n    document.addEventListener(\n      `lvt:${lifecycle}`,\n      (e: Event) => {\n        const customEvent = e as CustomEvent;\n        const actionName = customEvent.detail?.action;\n        processReactiveAttributes(lifecycle, actionName);\n      },\n      true // capture phase\n    );\n  });\n}\n", "import type { TreeNode, UpdateResult } from \"../types\";\nimport type { Logger } from \"../utils/logger\";\n\ninterface RangeStateEntry {\n  items: any[];\n  statics: any[];\n}\n\n/**\n * Deep clone an object. Uses structuredClone if available (Node 17+, modern browsers),\n * falls back to JSON.parse/stringify for older environments.\n */\nfunction deepClone<T>(obj: T): T {\n  if (typeof structuredClone === \"function\") {\n    return structuredClone(obj);\n  }\n  return JSON.parse(JSON.stringify(obj));\n}\n\n/**\n * Handles tree state management and HTML reconstruction logic for LiveTemplate.\n */\nexport class TreeRenderer {\n  private treeState: TreeNode = {};\n  private rangeState: Record<string, RangeStateEntry> = {};\n  private rangeIdKeys: Record<string, string> = {};\n\n  constructor(private readonly logger: Logger) {}\n\n  applyUpdate(update: TreeNode): UpdateResult {\n    let changed = false;\n\n    for (const [key, value] of Object.entries(update)) {\n      const isDifferentialOps =\n        Array.isArray(value) &&\n        value.length > 0 &&\n        Array.isArray(value[0]) &&\n        typeof value[0][0] === \"string\";\n\n      if (isDifferentialOps) {\n        // Check if there's an existing range structure to apply operations to\n        const existing = this.treeState[key];\n        const existingIsRange =\n          existing &&\n          typeof existing === \"object\" &&\n          !Array.isArray(existing) &&\n          Array.isArray(existing.d) &&\n          Array.isArray(existing.s);\n\n        if (existingIsRange) {\n          // Apply differential operations to existing range structure\n          this.treeState[key] = deepClone(existing);\n          this.applyDifferentialOpsToRange(this.treeState[key], value, key);\n        } else {\n          // No existing range, store operations directly (will use rangeState later)\n          this.treeState[key] = value;\n        }\n        changed = true;\n      } else {\n        const oldValue = this.treeState[key];\n        const newValue =\n          typeof value === \"object\" && value !== null && !Array.isArray(value)\n            ? this.deepMergeTreeNodes(oldValue, value, key)\n            : value;\n\n        if (JSON.stringify(oldValue) !== JSON.stringify(newValue)) {\n          this.treeState[key] = newValue;\n          changed = true;\n        }\n      }\n    }\n\n    const html = this.reconstructFromTree(this.treeState, \"\");\n    return { html, changed };\n  }\n\n  reset(): void {\n    this.treeState = {};\n    this.rangeState = {};\n    this.rangeIdKeys = {};\n  }\n\n  getTreeState(): TreeNode {\n    return { ...this.treeState };\n  }\n\n  getStaticStructure(): string[] | null {\n    return this.treeState.s || null;\n  }\n\n  private deepMergeTreeNodes(\n    existing: any,\n    update: any,\n    currentPath: string = \"\"\n  ): any {\n    if (\n      typeof update !== \"object\" ||\n      update === null ||\n      Array.isArray(update)\n    ) {\n      return update;\n    }\n\n    if (\n      typeof existing !== \"object\" ||\n      existing === null ||\n      Array.isArray(existing)\n    ) {\n      return update;\n    }\n\n    const merged: any = { ...existing };\n\n    for (const [key, value] of Object.entries(update)) {\n      const fieldPath = currentPath ? `${currentPath}.${key}` : key;\n\n      // Check if value is a differential operations array\n      const isDifferentialOps =\n        Array.isArray(value) &&\n        value.length > 0 &&\n        Array.isArray(value[0]) &&\n        typeof value[0][0] === \"string\";\n\n      // Check if existing value is a range structure\n      const existingIsRange =\n        merged[key] &&\n        typeof merged[key] === \"object\" &&\n        !Array.isArray(merged[key]) &&\n        Array.isArray(merged[key].d) &&\n        Array.isArray(merged[key].s);\n\n      if (isDifferentialOps && existingIsRange) {\n        // Deep clone the range structure before modifying to avoid mutating the original\n        // (shallow copy {...existing} keeps shared references to nested objects)\n        merged[key] = deepClone(merged[key]);\n        // Apply differential operations to the cloned range\n        this.logger.debug(\n          `[deepMerge] Applying diff ops at path ${fieldPath}`,\n          { ops: value, rangeItems: merged[key].d?.length }\n        );\n        this.applyDifferentialOpsToRange(merged[key], value, fieldPath);\n      } else if (\n        typeof value === \"object\" &&\n        value !== null &&\n        !Array.isArray(value) &&\n        typeof merged[key] === \"object\" &&\n        merged[key] !== null &&\n        !Array.isArray(merged[key])\n      ) {\n        merged[key] = this.deepMergeTreeNodes(merged[key], value, fieldPath);\n      } else {\n        merged[key] = value;\n      }\n    }\n\n    return merged;\n  }\n\n  /**\n   * Applies differential operations to the provided range structure in-place.\n   * The caller is responsible for passing the object to be mutated (typically a clone).\n   * This is called when merging nested updates that contain range operations.\n   */\n  private applyDifferentialOpsToRange(\n    rangeStructure: any,\n    operations: any[],\n    statePath: string\n  ): void {\n    // Validate rangeStructure before proceeding\n    if (\n      !rangeStructure ||\n      typeof rangeStructure !== \"object\" ||\n      !Array.isArray(rangeStructure.d) ||\n      !Array.isArray(rangeStructure.s)\n    ) {\n      this.logger.error(\n        `[applyDiffOpsToRange] Invalid rangeStructure at path ${statePath}`,\n        { rangeStructure }\n      );\n      return;\n    }\n\n    const currentItems = rangeStructure.d;\n\n    // Ensure rangeState is synchronized\n    if (!this.rangeState[statePath]) {\n      this.rangeState[statePath] = {\n        items: currentItems,\n        statics: rangeStructure.s,\n      };\n    }\n    // Also check for idKey metadata\n    if (\n      rangeStructure.m &&\n      typeof rangeStructure.m === \"object\" &&\n      typeof rangeStructure.m.idKey === \"string\"\n    ) {\n      this.rangeIdKeys[statePath] = rangeStructure.m.idKey;\n    }\n\n    this.logger.debug(\n      `[applyDiffOpsToRange] path=${statePath}, idKey=${this.rangeIdKeys[statePath]}, items=${currentItems.length}, ops=${operations.length}`\n    );\n\n    for (const operation of operations) {\n      if (!Array.isArray(operation) || operation.length < 2) {\n        continue;\n      }\n\n      const opType = operation[0];\n\n      switch (opType) {\n        case \"r\": {\n          const key = operation[1];\n          const removeIndex = this.findItemIndexByKey(\n            currentItems,\n            key,\n            rangeStructure.s,\n            statePath\n          );\n          this.logger.debug(\n            `[applyDiffOpsToRange] Remove: key=${key}, index=${removeIndex}, total=${currentItems.length}`\n          );\n          if (removeIndex >= 0) {\n            currentItems.splice(removeIndex, 1);\n            this.logger.debug(`[applyDiffOpsToRange] After removal: ${currentItems.length} items`);\n          } else {\n            this.logger.debug(`[applyDiffOpsToRange] Remove failed: key ${key} not found`);\n          }\n          break;\n        }\n        case \"u\": {\n          const updateIndex = this.findItemIndexByKey(\n            currentItems,\n            operation[1],\n            rangeStructure.s,\n            statePath\n          );\n          const changes = operation[2];\n          if (updateIndex >= 0 && changes) {\n            currentItems[updateIndex] = {\n              ...currentItems[updateIndex],\n              ...changes,\n            };\n          }\n          break;\n        }\n        case \"a\": {\n          const itemsToAdd = Array.isArray(operation[1])\n            ? operation[1]\n            : [operation[1]];\n          if (operation[2]) {\n            rangeStructure.s = operation[2];\n          }\n          currentItems.push(...itemsToAdd);\n          if (\n            operation[3] &&\n            typeof operation[3] === \"object\" &&\n            operation[3].idKey\n          ) {\n            this.rangeIdKeys[statePath] = operation[3].idKey;\n          }\n          break;\n        }\n        case \"p\": {\n          const itemsToPrepend = Array.isArray(operation[1])\n            ? operation[1]\n            : [operation[1]];\n          if (operation[2]) {\n            rangeStructure.s = operation[2];\n          }\n          currentItems.unshift(...itemsToPrepend);\n          break;\n        }\n        case \"i\": {\n          const targetIndex = this.findItemIndexByKey(\n            currentItems,\n            operation[1],\n            rangeStructure.s,\n            statePath\n          );\n          if (targetIndex >= 0) {\n            const itemsToInsert = Array.isArray(operation[2])\n              ? operation[2]\n              : [operation[2]];\n            currentItems.splice(targetIndex + 1, 0, ...itemsToInsert);\n          }\n          break;\n        }\n        case \"o\": {\n          const newOrder = operation[1] as string[];\n          const reorderedItems: any[] = [];\n          const itemsByKey = new Map<string, any>();\n\n          for (const item of currentItems) {\n            const itemKey = this.getItemKey(item, rangeStructure.s, statePath);\n            if (itemKey) {\n              itemsByKey.set(itemKey, item);\n            }\n          }\n\n          for (const orderedKey of newOrder) {\n            const item = itemsByKey.get(orderedKey);\n            if (item) {\n              reorderedItems.push(item);\n            }\n          }\n\n          currentItems.length = 0;\n          currentItems.push(...reorderedItems);\n          break;\n        }\n        default:\n          break;\n      }\n    }\n\n    // Update rangeState to reflect the changes\n    this.rangeState[statePath] = {\n      items: currentItems,\n      statics: rangeStructure.s,\n    };\n  }\n\n  private reconstructFromTree(node: TreeNode, statePath: string): string {\n    if (node.s && Array.isArray(node.s)) {\n      let html = \"\";\n\n      for (let i = 0; i < node.s.length; i++) {\n        const staticSegment = node.s[i];\n        html += staticSegment;\n\n        if (i < node.s.length - 1) {\n          const dynamicKey = i.toString();\n          if (node[dynamicKey] !== undefined) {\n            const newStatePath = statePath\n              ? `${statePath}.${dynamicKey}`\n              : dynamicKey;\n            html += this.renderValue(\n              node[dynamicKey],\n              dynamicKey,\n              newStatePath\n            );\n          }\n        }\n      }\n\n      html = html.replace(/<root>/g, \"\").replace(/<\\/root>/g, \"\");\n      return html;\n    }\n\n    return this.renderValue(node, \"\", statePath);\n  }\n\n  private renderValue(\n    value: any,\n    fieldKey?: string,\n    statePath?: string\n  ): string {\n    if (value === null || value === undefined) {\n      return \"\";\n    }\n\n    if (\n      typeof value === \"string\" &&\n      value.startsWith(\"{{\") &&\n      value.endsWith(\"}}\")\n    ) {\n      return \"\";\n    }\n\n    if (typeof value === \"object\" && !Array.isArray(value)) {\n      if (\n        value.d &&\n        Array.isArray(value.d) &&\n        value.s &&\n        Array.isArray(value.s)\n      ) {\n        const stateKey = statePath || fieldKey || \"\";\n        if (stateKey) {\n          this.rangeState[stateKey] = {\n            items: value.d,\n            statics: value.s,\n          };\n          if (\n            value.m &&\n            typeof value.m === \"object\" &&\n            typeof value.m.idKey === \"string\"\n          ) {\n            this.rangeIdKeys[stateKey] = value.m.idKey;\n          }\n        }\n        return this.renderRangeStructure(value, fieldKey, statePath);\n      }\n\n      if (\"s\" in value && Array.isArray((value as TreeNode).s)) {\n        return this.reconstructFromTree(value as TreeNode, statePath || \"\");\n      }\n\n      // Handle objects with only numeric keys (dynamics without statics)\n      // This occurs when server sends partial updates for nested TreeNodes\n      const keys = Object.keys(value);\n      const numericKeys = keys.filter((k) => /^\\d+$/.test(k)).sort((a, b) => parseInt(a) - parseInt(b));\n      if (numericKeys.length > 0 && numericKeys.length === keys.length) {\n        // All keys are numeric - render each dynamic value in order\n        return numericKeys\n          .map((k) => {\n            const itemStatePath = statePath ? `${statePath}.${k}` : k;\n            return this.renderValue((value as Record<string, unknown>)[k], k, itemStatePath);\n          })\n          .join(\"\");\n      }\n    }\n\n    if (Array.isArray(value)) {\n      if (\n        value.length > 0 &&\n        Array.isArray(value[0]) &&\n        typeof value[0][0] === \"string\"\n      ) {\n        return this.applyDifferentialOperations(value, statePath);\n      }\n\n      return value\n        .map((item, idx) => {\n          const itemKey = idx.toString();\n          const itemStatePath = statePath ? `${statePath}.${itemKey}` : itemKey;\n          if (typeof item === \"object\" && item && (item as TreeNode).s) {\n            return this.reconstructFromTree(item as TreeNode, itemStatePath);\n          }\n          return this.renderValue(item, itemKey, itemStatePath);\n        })\n        .join(\"\");\n    }\n\n    if (typeof value === \"object\") {\n      this.logger.error(\n        \"Object value reached string conversion; this will render as [object Object].\"\n      );\n\n      if (this.logger.isDebugEnabled()) {\n        this.logger.debug(\"Value diagnostics:\", {\n          valueType: typeof value,\n          isArray: Array.isArray(value),\n          keys: Object.keys(value as Record<string, unknown>),\n          hasStatics: Boolean((value as any).s),\n          hasDynamics: Boolean((value as any).d),\n          value,\n        });\n      }\n    }\n\n    return String(value);\n  }\n\n  private renderRangeStructure(\n    rangeNode: any,\n    fieldKey?: string,\n    statePath?: string\n  ): string {\n    const { d: dynamics, s: statics } = rangeNode;\n\n    if (!dynamics || !Array.isArray(dynamics)) {\n      return \"\";\n    }\n\n    if (dynamics.length === 0) {\n      if (rangeNode[\"else\"]) {\n        const elseKey = \"else\";\n        const elseStatePath = statePath ? `${statePath}.else` : \"else\";\n        return this.renderValue(rangeNode[\"else\"], elseKey, elseStatePath);\n      }\n      return \"\";\n    }\n\n    if (statics && Array.isArray(statics)) {\n      return dynamics\n        .map((item: any, itemIdx: number) => {\n          let html = \"\";\n\n          for (let i = 0; i < statics.length; i++) {\n            html += statics[i];\n\n            if (i < statics.length - 1) {\n              const localKey = i.toString();\n              if (item[localKey] !== undefined) {\n                const itemStatePath = statePath\n                  ? `${statePath}.${itemIdx}.${localKey}`\n                  : `${itemIdx}.${localKey}`;\n                html += this.renderValue(\n                  item[localKey],\n                  localKey,\n                  itemStatePath\n                );\n              }\n            }\n          }\n\n          return html;\n        })\n        .join(\"\");\n    }\n\n    return dynamics\n      .map((item: any, idx: number) => {\n        const itemKey = idx.toString();\n        const itemStatePath = statePath ? `${statePath}.${itemKey}` : itemKey;\n        return this.renderValue(item, itemKey, itemStatePath);\n      })\n      .join(\"\");\n  }\n\n  private applyDifferentialOperations(\n    operations: any[],\n    statePath?: string\n  ): string {\n    if (!statePath || !this.rangeState[statePath]) {\n      return \"\";\n    }\n\n    const rangeData = this.rangeState[statePath];\n    const currentItems = [...rangeData.items];\n    const statics = rangeData.statics;\n\n    for (const operation of operations) {\n      if (!Array.isArray(operation) || operation.length < 2) {\n        continue;\n      }\n\n      const opType = operation[0];\n\n      switch (opType) {\n        case \"r\": {\n          const removeIndex = this.findItemIndexByKey(\n            currentItems,\n            operation[1],\n            statics,\n            statePath\n          );\n          if (removeIndex >= 0) {\n            currentItems.splice(removeIndex, 1);\n          }\n          break;\n        }\n        case \"u\": {\n          const updateIndex = this.findItemIndexByKey(\n            currentItems,\n            operation[1],\n            statics,\n            statePath\n          );\n          const changes = operation[2];\n          if (updateIndex >= 0 && changes) {\n            currentItems[updateIndex] = {\n              ...currentItems[updateIndex],\n              ...changes,\n            };\n          }\n          break;\n        }\n        case \"a\": {\n          this.addItemsToRange(\n            currentItems,\n            operation[1],\n            operation[2],\n            rangeData,\n            false\n          );\n          if (\n            operation[3] &&\n            typeof operation[3] === \"object\" &&\n            operation[3].idKey\n          ) {\n            this.rangeIdKeys[statePath || \"\"] = operation[3].idKey;\n          }\n          break;\n        }\n        case \"p\": {\n          this.addItemsToRange(\n            currentItems,\n            operation[1],\n            operation[2],\n            rangeData,\n            true\n          );\n          break;\n        }\n        case \"i\": {\n          const targetIndex = this.findItemIndexByKey(\n            currentItems,\n            operation[1],\n            statics,\n            statePath\n          );\n          if (targetIndex >= 0) {\n            const itemsToInsert = Array.isArray(operation[2])\n              ? operation[2]\n              : [operation[2]];\n            currentItems.splice(targetIndex + 1, 0, ...itemsToInsert);\n          }\n          break;\n        }\n        case \"o\": {\n          const newOrder = operation[1] as string[];\n          const reorderedItems: any[] = [];\n          const itemsByKey = new Map<string, any>();\n\n          for (const item of currentItems) {\n            const itemKey = this.getItemKey(item, statics, statePath);\n            if (itemKey) {\n              itemsByKey.set(itemKey, item);\n            }\n          }\n\n          for (const orderedKey of newOrder) {\n            const item = itemsByKey.get(orderedKey);\n            if (item) {\n              reorderedItems.push(item);\n            }\n          }\n\n          currentItems.length = 0;\n          currentItems.push(...reorderedItems);\n          break;\n        }\n        default:\n          break;\n      }\n    }\n\n    this.rangeState[statePath] = {\n      items: currentItems,\n      statics: rangeData.statics,\n    };\n\n    this.treeState[statePath] = {\n      d: currentItems,\n      s: rangeData.statics,\n    };\n\n    const rangeStructure = this.getCurrentRangeStructure(statePath);\n    if (rangeStructure && rangeStructure.s) {\n      return this.renderItemsWithStatics(currentItems, rangeStructure.s);\n    }\n\n    return currentItems.map((item) => this.renderValue(item)).join(\"\");\n  }\n\n  private getCurrentRangeStructure(stateKey: string): any {\n    if (this.rangeState[stateKey]) {\n      return {\n        d: this.rangeState[stateKey].items,\n        s: this.rangeState[stateKey].statics,\n      };\n    }\n\n    const fieldValue = this.treeState[stateKey];\n    if (\n      fieldValue &&\n      typeof fieldValue === \"object\" &&\n      (fieldValue as TreeNode).s\n    ) {\n      return fieldValue;\n    }\n\n    return null;\n  }\n\n  private renderItemsWithStatics(items: any[], statics: string[]): string {\n    const result = items\n      .map((item: any) => {\n        let html = \"\";\n\n        for (let i = 0; i < statics.length; i++) {\n          html += statics[i];\n\n          if (i < statics.length - 1) {\n            const fieldKey = i.toString();\n            if (item[fieldKey] !== undefined) {\n              html += this.renderValue(item[fieldKey]);\n            }\n          }\n        }\n\n        return html;\n      })\n      .join(\"\");\n\n    if (this.logger.isDebugEnabled()) {\n      this.logger.debug(\"[renderItemsWithStatics] statics:\", statics);\n      this.logger.debug(\"[renderItemsWithStatics] items count:\", items.length);\n      this.logger.debug(\n        \"[renderItemsWithStatics] result snippet:\",\n        result.substring(0, 200)\n      );\n    }\n\n    return result;\n  }\n\n  private addItemsToRange(\n    currentItems: any[],\n    items: any,\n    statics: any[] | undefined,\n    rangeData: RangeStateEntry,\n    prepend: boolean\n  ): void {\n    if (statics) {\n      rangeData.statics = statics;\n    }\n\n    if (!items) return;\n\n    const itemsArray = Array.isArray(items) ? items : [items];\n    if (prepend) {\n      currentItems.unshift(...itemsArray);\n    } else {\n      currentItems.push(...itemsArray);\n    }\n  }\n\n  private getItemKey(\n    item: any,\n    statics: any[],\n    statePath?: string\n  ): string | null {\n    if (!statePath || !this.rangeIdKeys[statePath]) {\n      return null;\n    }\n\n    const keyPosStr = this.rangeIdKeys[statePath];\n    return item[keyPosStr] || null;\n  }\n\n  private findItemIndexByKey(\n    items: any[],\n    key: string,\n    statics: any[],\n    statePath?: string\n  ): number {\n    return items.findIndex(\n      (item: any) => this.getItemKey(item, statics, statePath) === key\n    );\n  }\n}\n", "import type { ResponseMetadata } from \"../types\";\nimport { ModalManager } from \"../dom/modal-manager\";\n\n/**\n * Tracks form submission lifecycle for LiveTemplate actions.\n */\nexport class FormLifecycleManager {\n  private activeForm: HTMLFormElement | null = null;\n  private activeButton: HTMLButtonElement | null = null;\n  private originalButtonText: string | null = null;\n\n  constructor(private readonly modalManager: ModalManager) {}\n\n  setActiveSubmission(\n    form: HTMLFormElement | null,\n    button: HTMLButtonElement | null,\n    originalButtonText: string | null\n  ): void {\n    this.activeForm = form;\n    this.activeButton = button;\n    this.originalButtonText = originalButtonText;\n  }\n\n  handleResponse(meta: ResponseMetadata): void {\n    if (this.activeForm) {\n      this.activeForm.dispatchEvent(\n        new CustomEvent(\"lvt:done\", { detail: meta })\n      );\n    }\n\n    if (meta.success) {\n      this.handleSuccess(meta);\n    } else {\n      this.handleError(meta);\n    }\n\n    this.restoreFormState();\n  }\n\n  reset(): void {\n    this.restoreFormState();\n  }\n\n  private handleSuccess(meta: ResponseMetadata): void {\n    if (!this.activeForm) {\n      return;\n    }\n\n    this.activeForm.dispatchEvent(\n      new CustomEvent(\"lvt:success\", { detail: meta })\n    );\n\n    const modalParent = this.activeForm.closest('[role=\"dialog\"]');\n    if (modalParent && modalParent.id) {\n      this.modalManager.close(modalParent.id);\n    }\n\n    if (!this.activeForm.hasAttribute(\"lvt-preserve\")) {\n      this.activeForm.reset();\n    }\n  }\n\n  private handleError(meta: ResponseMetadata): void {\n    if (!this.activeForm) {\n      return;\n    }\n\n    this.activeForm.dispatchEvent(\n      new CustomEvent(\"lvt:error\", { detail: meta })\n    );\n  }\n\n  private restoreFormState(): void {\n    if (this.activeButton && this.originalButtonText !== null) {\n      this.activeButton.disabled = false;\n      this.activeButton.textContent = this.originalButtonText;\n    }\n\n    this.activeForm = null;\n    this.activeButton = null;\n    this.originalButtonText = null;\n  }\n}\n", "import type { LiveTemplateClientOptions, UpdateResponse } from \"../types\";\nimport type { Logger } from \"../utils/logger\";\n\nexport interface WebSocketTransportOptions {\n  url: string;\n  autoReconnect?: boolean;\n  reconnectDelay?: number;\n  maxReconnectDelay?: number; // Maximum delay between reconnect attempts (default: 16000ms)\n  maxReconnectAttempts?: number; // Maximum number of reconnect attempts (default: 10, 0 = unlimited)\n  onOpen?: (socket: WebSocket) => void;\n  onMessage?: (event: MessageEvent<string>) => void;\n  onClose?: (event: CloseEvent) => void;\n  onReconnectAttempt?: (attempt: number, delay: number) => void;\n  onReconnectFailed?: () => void; // Called when max reconnect attempts reached\n  onError?: (event: Event) => void;\n}\n\n/**\n * Lightweight wrapper around browser WebSocket with optional auto-reconnect support.\n * Implements exponential backoff with jitter to prevent thundering herd.\n */\nexport class WebSocketTransport {\n  private socket: WebSocket | null = null;\n  private reconnectTimer: number | null = null;\n  private manuallyClosed = false;\n  private reconnectAttempts = 0;\n\n  constructor(private readonly options: WebSocketTransportOptions) {}\n\n  connect(): void {\n    this.manuallyClosed = false;\n    this.clearReconnectTimer();\n\n    this.socket = new WebSocket(this.options.url);\n    const socket = this.socket;\n\n    socket.onopen = () => {\n      // Reset reconnect attempts on successful connection\n      this.reconnectAttempts = 0;\n      this.options.onOpen?.(socket);\n    };\n\n    socket.onmessage = (event: MessageEvent<string>) => {\n      this.options.onMessage?.(event);\n    };\n\n    socket.onclose = (event: CloseEvent) => {\n      this.options.onClose?.(event);\n      if (!this.manuallyClosed && this.options.autoReconnect) {\n        this.scheduleReconnect();\n      }\n    };\n\n    socket.onerror = (event: Event) => {\n      this.options.onError?.(event);\n    };\n  }\n\n  send(data: string): void {\n    if (this.socket && this.socket.readyState === 1) {  // WebSocket.OPEN = 1\n      this.socket.send(data);\n    }\n  }\n\n  disconnect(): void {\n    this.manuallyClosed = true;\n    this.clearReconnectTimer();\n    if (this.socket) {\n      this.socket.close();\n      this.socket = null;\n    }\n  }\n\n  getSocket(): WebSocket | null {\n    return this.socket;\n  }\n\n  private scheduleReconnect(): void {\n    this.clearReconnectTimer();\n\n    // Check if max reconnect attempts reached\n    const maxAttempts = this.options.maxReconnectAttempts ?? 10;\n    if (maxAttempts > 0 && this.reconnectAttempts >= maxAttempts) {\n      this.options.onReconnectFailed?.();\n      return;\n    }\n\n    this.reconnectAttempts++;\n\n    // Calculate exponential backoff: baseDelay * 2^attempt\n    const baseDelay = this.options.reconnectDelay ?? 1000;\n    const maxDelay = this.options.maxReconnectDelay ?? 16000;\n    const exponentialDelay = baseDelay * Math.pow(2, this.reconnectAttempts - 1);\n\n    // Add jitter: random value between 0 and 1000ms to prevent thundering herd\n    const jitter = Math.random() * 1000;\n\n    // Calculate final delay with maximum cap\n    const delay = Math.min(exponentialDelay + jitter, maxDelay);\n\n    this.reconnectTimer = window.setTimeout(() => {\n      this.options.onReconnectAttempt?.(this.reconnectAttempts, delay);\n      this.connect();\n    }, delay);\n  }\n\n  private clearReconnectTimer(): void {\n    if (this.reconnectTimer !== null) {\n      clearTimeout(this.reconnectTimer);\n      this.reconnectTimer = null;\n    }\n  }\n}\n\nexport interface WebSocketManagerConfig {\n  options: LiveTemplateClientOptions;\n  onConnected: () => void;\n  onDisconnected: () => void;\n  onMessage: (response: UpdateResponse, event: MessageEvent<string>) => void;\n  onReconnectAttempt?: (attempt: number, delay: number) => void;\n  onReconnectFailed?: () => void;\n  onError?: (event: Event) => void;\n  logger: Logger;\n}\n\nexport interface WebSocketConnectResult {\n  usingWebSocket: boolean;\n  initialState?: UpdateResponse | null;\n}\n\nexport class WebSocketManager {\n  private transport: WebSocketTransport | null = null;\n\n  constructor(private readonly config: WebSocketManagerConfig) {}\n\n  async connect(): Promise<WebSocketConnectResult> {\n    const liveUrl = this.getLiveUrl();\n\n    const wsAvailable = await checkWebSocketAvailability(\n      liveUrl,\n      this.config.logger\n    );\n    if (!wsAvailable) {\n      const initialState = await fetchInitialState(liveUrl, this.config.logger);\n      return { usingWebSocket: false, initialState };\n    }\n\n    this.transport = new WebSocketTransport({\n      url: this.getWebSocketUrl(),\n      autoReconnect: this.config.options.autoReconnect,\n      reconnectDelay: this.config.options.reconnectDelay,\n      maxReconnectDelay: 16000, // 16 seconds maximum\n      maxReconnectAttempts: 10, // 10 attempts before giving up\n      onOpen: () => {\n        this.config.onConnected();\n      },\n      onMessage: (event) => {\n        try {\n          const payload: UpdateResponse = JSON.parse(event.data);\n          this.config.onMessage(payload, event);\n        } catch (error) {\n          this.config.logger.error(\"Failed to parse WebSocket message:\", error);\n        }\n      },\n      onClose: () => {\n        this.config.onDisconnected();\n      },\n      onReconnectAttempt: (attempt, delay) => {\n        this.config.onReconnectAttempt?.(attempt, delay);\n      },\n      onReconnectFailed: () => {\n        this.config.onReconnectFailed?.();\n      },\n      onError: (event) => {\n        this.config.onError?.(event);\n      },\n    });\n\n    this.transport.connect();\n    return { usingWebSocket: true };\n  }\n\n  disconnect(): void {\n    this.transport?.disconnect();\n    this.transport = null;\n  }\n\n  send(data: string): void {\n    this.transport?.send(data);\n  }\n\n  getReadyState(): number | undefined {\n    return this.transport?.getSocket()?.readyState;\n  }\n\n  getSocket(): WebSocket | null {\n    return this.transport?.getSocket() ?? null;\n  }\n\n  private getWebSocketUrl(): string {\n    const liveUrl = this.config.options.liveUrl || \"/live\";\n    const baseUrl = this.config.options.wsUrl;\n    if (baseUrl) {\n      return baseUrl;\n    }\n    return `ws://${window.location.host}${liveUrl}`;\n  }\n\n  private getLiveUrl(): string {\n    return this.config.options.liveUrl || window.location.pathname;\n  }\n}\n\nexport async function checkWebSocketAvailability(\n  liveUrl: string,\n  logger?: Logger\n): Promise<boolean> {\n  try {\n    const response = await fetch(liveUrl, {\n      method: \"HEAD\",\n    });\n\n    const wsHeader = response.headers.get(\"X-LiveTemplate-WebSocket\");\n    if (wsHeader) {\n      return wsHeader === \"enabled\";\n    }\n\n    return true;\n  } catch (error) {\n    logger?.warn(\"Failed to check WebSocket availability:\", error);\n    return true;\n  }\n}\n\nexport async function fetchInitialState(\n  liveUrl: string,\n  logger?: Logger\n): Promise<UpdateResponse | null> {\n  try {\n    const response = await fetch(liveUrl, {\n      method: \"GET\",\n      credentials: \"include\",\n      headers: {\n        Accept: \"application/json\",\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to fetch initial state: ${response.status}`);\n    }\n\n    return (await response.json()) as UpdateResponse;\n  } catch (error) {\n    logger?.warn(\"Failed to fetch initial state:\", error);\n    return null;\n  }\n}\n", "/**\n * S3Uploader - Handles direct uploads to S3 using presigned URLs\n */\n\nimport type {\n  ExternalUploadMeta,\n  UploadEntry,\n  UploadProgressCallback,\n  Uploader,\n} from \"./types\";\n\nexport class S3Uploader implements Uploader {\n  /**\n   * Upload a file directly to S3 using presigned PUT URL\n   */\n  async upload(\n    entry: UploadEntry,\n    meta: ExternalUploadMeta,\n    onProgress?: UploadProgressCallback\n  ): Promise<void> {\n    const { file } = entry;\n\n    // Create abort controller for cancellation\n    entry.abortController = new AbortController();\n\n    try {\n      // Create XMLHttpRequest for progress tracking\n      const xhr = new XMLHttpRequest();\n\n      // Track upload progress and notify handler\n      xhr.upload.addEventListener(\"progress\", (e) => {\n        if (e.lengthComputable) {\n          entry.bytesUploaded = e.loaded;\n          entry.progress = Math.round((e.loaded / e.total) * 100);\n          // Notify progress callback\n          if (onProgress) {\n            onProgress(entry);\n          }\n        }\n      });\n\n      // Handle abort\n      entry.abortController.signal.addEventListener(\"abort\", () => {\n        xhr.abort();\n      });\n\n      // Create promise for upload completion\n      const uploadPromise = new Promise<void>((resolve, reject) => {\n        xhr.addEventListener(\"load\", () => {\n          if (xhr.status >= 200 && xhr.status < 300) {\n            entry.done = true;\n            entry.progress = 100;\n            resolve();\n          } else {\n            reject(new Error(`S3 upload failed with status ${xhr.status}: ${xhr.statusText}`));\n          }\n        });\n\n        xhr.addEventListener(\"error\", () => {\n          reject(new Error(\"S3 upload failed: Network error\"));\n        });\n\n        xhr.addEventListener(\"abort\", () => {\n          reject(new Error(\"S3 upload cancelled\"));\n        });\n      });\n\n      // Open connection\n      xhr.open(\"PUT\", meta.url);\n\n      // Set headers\n      if (meta.headers) {\n        for (const [key, value] of Object.entries(meta.headers)) {\n          xhr.setRequestHeader(key, value);\n        }\n      }\n\n      // Send file\n      xhr.send(file);\n\n      await uploadPromise;\n    } catch (error) {\n      entry.error = error instanceof Error ? error.message : String(error);\n      throw error;\n    }\n  }\n}\n", "/**\n * UploadHandler - Manages file uploads for LiveTemplate\n *\n * Handles:\n * - File input detection and change events\n * - Chunked uploads to server via WebSocket\n * - External uploads (S3) via presigned URLs\n * - Progress tracking and callbacks\n * - Upload cancellation\n */\n\nimport { S3Uploader } from \"./s3-uploader\";\nimport type {\n  ExternalUploadMeta,\n  FileMetadata,\n  UploadChunkMessage,\n  UploadCompleteMessage,\n  UploadEntry,\n  UploadHandlerOptions,\n  UploadProgressMessage,\n  UploadStartMessage,\n  UploadStartResponse,\n  Uploader,\n} from \"./types\";\n\nexport class UploadHandler {\n  private entries: Map<string, UploadEntry> = new Map();\n  private pendingFiles: Map<string, File[]> = new Map(); // uploadName -> files\n  private autoUploadConfig: Map<string, boolean> = new Map(); // uploadName -> autoUpload\n  private chunkSize: number;\n  private uploaders: Map<string, Uploader> = new Map();\n  private onProgress?: (entry: UploadEntry) => void;\n  private onComplete?: (uploadName: string, entries: UploadEntry[]) => void;\n  private onError?: (entry: UploadEntry, error: string) => void;\n  private inputHandlers: WeakMap<HTMLInputElement, EventListener> = new WeakMap();\n\n  constructor(\n    private sendMessage: (message: any) => void,\n    options: UploadHandlerOptions = {}\n  ) {\n    this.chunkSize = options.chunkSize || 256 * 1024; // 256KB default\n    this.onProgress = options.onProgress;\n    this.onComplete = options.onComplete;\n    this.onError = options.onError;\n\n    // Register default uploaders\n    this.uploaders.set(\"s3\", new S3Uploader());\n  }\n\n  /**\n   * Initialize upload detection on file inputs with lvt-upload attribute\n   */\n  initializeFileInputs(container: Element) {\n    const inputs = container.querySelectorAll<HTMLInputElement>(\n      'input[type=\"file\"][lvt-upload]'\n    );\n\n    inputs.forEach((input) => {\n      const uploadName = input.getAttribute(\"lvt-upload\");\n      if (!uploadName) return;\n\n      // Remove existing listener if any\n      const existingHandler = this.inputHandlers.get(input);\n      if (existingHandler) {\n        input.removeEventListener(\"change\", existingHandler);\n      }\n\n      // Create new handler\n      const handler = (e: Event) => {\n        const files = (e.target as HTMLInputElement).files;\n        if (!files || files.length === 0) return;\n\n        // Always send upload_start to get validation and config\n        // But only proceed with chunks if autoUpload is true\n        this.startUpload(uploadName, Array.from(files));\n      };\n\n      input.addEventListener(\"change\", handler);\n      // Store handler in WeakMap to prevent memory leaks\n      this.inputHandlers.set(input, handler);\n    });\n  }\n\n  /**\n   * Start upload process for selected files\n   */\n  async startUpload(uploadName: string, files: File[]): Promise<void> {\n    // Store files temporarily for when server response arrives\n    this.pendingFiles.set(uploadName, files);\n\n    // Create file metadata\n    const fileMetadata: FileMetadata[] = files.map((file) => ({\n      name: file.name,\n      type: file.type || \"application/octet-stream\",\n      size: file.size,\n    }));\n\n    // Send upload_start message to server\n    const startMessage: UploadStartMessage = {\n      action: \"upload_start\",\n      upload_name: uploadName,\n      files: fileMetadata,\n    };\n\n    this.sendMessage(startMessage);\n  }\n\n  /**\n   * Handle upload_start response from server\n   */\n  async handleUploadStartResponse(\n    response: UploadStartResponse\n  ): Promise<void> {\n    const { upload_name, entries: entryInfos } = response;\n\n    // Store autoUpload configuration from first entry\n    if (entryInfos.length > 0) {\n      this.autoUploadConfig.set(upload_name, entryInfos[0].auto_upload);\n    }\n\n    // Get pending files for this upload\n    const files = this.pendingFiles.get(upload_name);\n    if (!files) {\n      console.error(`No pending files found for upload: ${upload_name}`);\n      return;\n    }\n\n    // Clear pending files\n    this.pendingFiles.delete(upload_name);\n\n    // Build a map from file name to file object for lookup\n    const fileMap = new Map<string, File>();\n    for (const file of files) {\n      fileMap.set(file.name, file);\n    }\n\n    // Create upload entries\n    const entries: UploadEntry[] = [];\n\n    for (const info of entryInfos) {\n      const file = fileMap.get(info.client_name);\n\n      if (!file) {\n        console.warn(\n          `No file found for entry ${info.entry_id} (client_name: ${info.client_name})`\n        );\n        continue;\n      }\n\n      const entry: UploadEntry = {\n        id: info.entry_id,\n        file,\n        uploadName: upload_name,\n        progress: 0,\n        bytesUploaded: 0,\n        valid: info.valid,\n        done: false,\n        error: info.error,\n        external: info.external,\n      };\n\n      this.entries.set(entry.id, entry);\n      entries.push(entry);\n\n      // Handle invalid entries\n      if (!info.valid) {\n        if (this.onError && info.error) {\n          this.onError(entry, info.error);\n        }\n        continue;\n      }\n\n      // Only start upload immediately if autoUpload is true\n      // Otherwise, entries are stored and will be uploaded on form submit\n      if (info.auto_upload) {\n        // Start upload (external or chunked)\n        if (info.external) {\n          this.uploadExternal(entry, info.external);\n        } else {\n          this.uploadChunked(entry);\n        }\n      }\n    }\n  }\n\n  /**\n   * Upload file using external uploader (S3, etc.)\n   */\n  private async uploadExternal(\n    entry: UploadEntry,\n    meta: ExternalUploadMeta\n  ): Promise<void> {\n    try {\n      const uploader = this.uploaders.get(meta.uploader);\n      if (!uploader) {\n        throw new Error(`Unknown uploader: ${meta.uploader}`);\n      }\n\n      // Start external upload with progress callback\n      await uploader.upload(entry, meta, this.onProgress);\n\n      // Notify server of completion\n      const completeMessage: UploadCompleteMessage = {\n        action: \"upload_complete\",\n        upload_name: entry.uploadName,\n        entry_ids: [entry.id],\n      };\n\n      this.sendMessage(completeMessage);\n\n      if (this.onComplete) {\n        this.onComplete(entry.uploadName, [entry]);\n      }\n\n      // Clear the file input to prevent re-upload of the same file\n      this.clearFileInput(entry.uploadName);\n\n      // Schedule cleanup after completion\n      this.cleanupEntries(entry.uploadName);\n    } catch (error) {\n      const errorMsg = error instanceof Error ? error.message : String(error);\n      entry.error = errorMsg;\n      if (this.onError) {\n        this.onError(entry, errorMsg);\n      }\n      // Schedule cleanup after error\n      this.cleanupEntries(entry.uploadName);\n    }\n  }\n\n  /**\n   * Upload file in chunks via WebSocket\n   */\n  private async uploadChunked(entry: UploadEntry): Promise<void> {\n    const { file, id } = entry;\n    let offset = 0;\n\n    // Create abort controller for cancellation\n    entry.abortController = new AbortController();\n\n    try {\n      while (offset < file.size) {\n        // Check if upload was cancelled\n        if (entry.abortController.signal.aborted) {\n          throw new Error(\"Upload cancelled\");\n        }\n        // Read chunk\n        const end = Math.min(offset + this.chunkSize, file.size);\n        const chunk = file.slice(offset, end);\n\n        // Convert to base64\n        const base64 = await this.fileToBase64(chunk);\n\n        // Send chunk\n        const chunkMessage: UploadChunkMessage = {\n          action: \"upload_chunk\",\n          entry_id: id,\n          chunk_base64: base64,\n          offset,\n          total: file.size,\n        };\n\n        this.sendMessage(chunkMessage);\n\n        // Update progress\n        offset = end;\n        entry.bytesUploaded = offset;\n        entry.progress = Math.round((offset / file.size) * 100);\n\n        if (this.onProgress) {\n          this.onProgress(entry);\n        }\n      }\n\n      // Send complete message\n      entry.done = true;\n      const completeMessage: UploadCompleteMessage = {\n        action: \"upload_complete\",\n        upload_name: entry.uploadName,\n        entry_ids: [id],\n      };\n\n      this.sendMessage(completeMessage);\n\n      if (this.onComplete) {\n        this.onComplete(entry.uploadName, [entry]);\n      }\n\n      // Clear the file input to prevent re-upload of the same file\n      this.clearFileInput(entry.uploadName);\n\n      // Schedule cleanup after completion\n      this.cleanupEntries(entry.uploadName);\n    } catch (error) {\n      const errorMsg = error instanceof Error ? error.message : String(error);\n      entry.error = errorMsg;\n      if (this.onError) {\n        this.onError(entry, errorMsg);\n      }\n      // Schedule cleanup after error\n      this.cleanupEntries(entry.uploadName);\n    }\n  }\n\n  /**\n   * Handle progress message from server (for chunked uploads)\n   */\n  handleProgressMessage(message: UploadProgressMessage): void {\n    const entry = this.entries.get(message.entry_id);\n    if (!entry) return;\n\n    entry.progress = message.progress;\n    entry.bytesUploaded = message.bytes_recv;\n\n    if (this.onProgress) {\n      this.onProgress(entry);\n    }\n  }\n\n  /**\n   * Cancel upload\n   */\n  cancelUpload(entryId: string): void {\n    const entry = this.entries.get(entryId);\n    if (!entry) return;\n\n    // Abort external upload if in progress\n    if (entry.abortController) {\n      entry.abortController.abort();\n    }\n\n    // Send cancel message to server\n    this.sendMessage({\n      action: \"cancel_upload\",\n      entry_id: entryId,\n    });\n\n    // Remove entry\n    this.entries.delete(entryId);\n  }\n\n  /**\n   * Get all entries for an upload name\n   */\n  getEntries(uploadName: string): UploadEntry[] {\n    const entries: UploadEntry[] = [];\n    for (const entry of this.entries.values()) {\n      if (entry.uploadName === uploadName) {\n        entries.push(entry);\n      }\n    }\n    return entries;\n  }\n\n  /**\n   * Trigger upload for all pending entries (used when autoUpload is false)\n   * Called by LiveTemplate client on form submit\n   */\n  triggerPendingUploads(uploadName: string): void {\n    // Get all entries for this upload that haven't started yet\n    const pendingEntries: UploadEntry[] = [];\n    for (const entry of this.entries.values()) {\n      if (\n        entry.uploadName === uploadName &&\n        entry.progress === 0 &&\n        !entry.done &&\n        !entry.error\n      ) {\n        pendingEntries.push(entry);\n      }\n    }\n\n    // Start uploads\n    for (const entry of pendingEntries) {\n      if (entry.external) {\n        this.uploadExternal(entry, entry.external);\n      } else {\n        this.uploadChunked(entry);\n      }\n    }\n  }\n\n  /**\n   * Register custom uploader\n   */\n  registerUploader(name: string, uploader: Uploader): void {\n    this.uploaders.set(name, uploader);\n  }\n\n  /**\n   * Clear file input to prevent re-upload of the same file\n   * Called after successful upload completion\n   */\n  private clearFileInput(uploadName: string): void {\n    // Find all file inputs with this upload name\n    const inputs = document.querySelectorAll<HTMLInputElement>(\n      `input[type=\"file\"][lvt-upload=\"${uploadName}\"]`\n    );\n\n    inputs.forEach((input) => {\n      // Clear the file input value\n      input.value = '';\n    });\n  }\n\n  /**\n   * Clean up completed or errored upload entries to prevent memory leaks\n   * Automatically called after completion/error, but can be called manually\n   * @param uploadName - Optional upload name to clean specific uploads\n   * @param delay - Optional delay in ms before cleanup (default: 5000ms)\n   */\n  cleanupEntries(uploadName?: string, delay: number = 5000): void {\n    setTimeout(() => {\n      const entriesToRemove: string[] = [];\n\n      for (const [id, entry] of this.entries) {\n        // Skip if uploadName is specified and doesn't match\n        if (uploadName && entry.uploadName !== uploadName) continue;\n\n        // Remove completed or errored entries\n        if (entry.done || entry.error) {\n          entriesToRemove.push(id);\n        }\n      }\n\n      for (const id of entriesToRemove) {\n        this.entries.delete(id);\n      }\n    }, delay);\n  }\n\n  /**\n   * Convert File/Blob to base64 string\n   */\n  private fileToBase64(blob: Blob): Promise<string> {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => {\n        const result = reader.result as string;\n        // Remove data URL prefix\n        const base64 = result.split(\",\")[1];\n        resolve(base64);\n      };\n      reader.onerror = reject;\n      reader.readAsDataURL(blob);\n    });\n  }\n}\n", "export type LogLevel = \"silent\" | \"error\" | \"warn\" | \"info\" | \"debug\";\n\nconst levelPriority: Record<LogLevel, number> = {\n  silent: 0,\n  error: 1,\n  warn: 2,\n  info: 3,\n  debug: 4,\n};\n\ninterface LogState {\n  level: LogLevel;\n}\n\ntype ConsoleMethod = \"error\" | \"warn\" | \"info\" | \"debug\";\n\nconst DEFAULT_SCOPE = \"LiveTemplate\";\n\n/**\n * Lightweight console logger with support for log levels and scoped prefixes.\n */\nexport class Logger {\n  constructor(\n    private readonly state: LogState,\n    private readonly scope: string[] = [],\n    private readonly sink: Console = console\n  ) {}\n\n  setLevel(level: LogLevel): void {\n    this.state.level = level;\n  }\n\n  getLevel(): LogLevel {\n    return this.state.level;\n  }\n\n  child(scope: string): Logger {\n    return new Logger(this.state, [...this.scope, scope], this.sink);\n  }\n\n  isDebugEnabled(): boolean {\n    return this.shouldLog(\"debug\");\n  }\n\n  error(...args: unknown[]): void {\n    this.log(\"error\", \"error\", args);\n  }\n\n  warn(...args: unknown[]): void {\n    this.log(\"warn\", \"warn\", args);\n  }\n\n  info(...args: unknown[]): void {\n    this.log(\"info\", \"info\", args);\n  }\n\n  debug(...args: unknown[]): void {\n    this.log(\"debug\", \"debug\", args);\n  }\n\n  private log(level: LogLevel, method: ConsoleMethod, args: unknown[]): void {\n    if (!this.shouldLog(level)) {\n      return;\n    }\n\n    const target =\n      (this.sink[method] as (...args: unknown[]) => void) ||\n      (console[method] as (...args: unknown[]) => void) ||\n      console.log;\n    target.apply(this.sink, [this.formatPrefix(), ...args]);\n  }\n\n  private shouldLog(level: LogLevel): boolean {\n    return levelPriority[level] <= levelPriority[this.state.level];\n  }\n\n  private formatPrefix(): string {\n    if (this.scope.length === 0) {\n      return `[${DEFAULT_SCOPE}]`;\n    }\n\n    return `[${DEFAULT_SCOPE}:${this.scope.join(\":\")}]`;\n  }\n}\n\nexport interface LoggerOptions {\n  level?: LogLevel;\n  scope?: string | string[];\n  sink?: Console;\n}\n\nexport function createLogger(options: LoggerOptions = {}): Logger {\n  const state: LogState = {\n    level: options.level ?? \"info\",\n  };\n\n  const scope = Array.isArray(options.scope)\n    ? options.scope\n    : options.scope\n    ? [options.scope]\n    : [];\n\n  return new Logger(state, scope, options.sink ?? console);\n}\n", "import type { LiveTemplateClient } from \"../livetemplate-client\";\nimport type { UpdateResult } from \"../types\";\n\n/**\n * Utility function to load and apply updates from JSON files.\n */\nexport async function loadAndApplyUpdate(\n  client: LiveTemplateClient,\n  updatePath: string\n): Promise<UpdateResult> {\n  try {\n    const nodeRequire = (globalThis as any)?.require;\n    if (typeof nodeRequire === \"function\") {\n      const fs = nodeRequire(\"fs\");\n      const updateData = JSON.parse(fs.readFileSync(updatePath, \"utf8\"));\n      return client.applyUpdate(updateData);\n    }\n\n    const response = await fetch(updatePath);\n    const updateData = await response.json();\n    return client.applyUpdate(updateData);\n  } catch (error) {\n    throw new Error(`Failed to load update from ${updatePath}: ${error}`);\n  }\n}\n\n/**\n * Compare two HTML strings, ignoring whitespace differences.\n */\nexport function compareHTML(\n  expected: string,\n  actual: string\n): {\n  match: boolean;\n  differences: string[];\n} {\n  const differences: string[] = [];\n\n  const normalizeHTML = (html: string) => {\n    return html.replace(/\\s+/g, \" \").replace(/>\\s+</g, \"><\").trim();\n  };\n\n  const normalizedExpected = normalizeHTML(expected);\n  const normalizedActual = normalizeHTML(actual);\n\n  if (normalizedExpected === normalizedActual) {\n    return { match: true, differences: [] };\n  }\n\n  const expectedLines = normalizedExpected.split(\"\\n\");\n  const actualLines = normalizedActual.split(\"\\n\");\n  const maxLines = Math.max(expectedLines.length, actualLines.length);\n\n  for (let i = 0; i < maxLines; i++) {\n    const expectedLine = expectedLines[i] || \"\";\n    const actualLine = actualLines[i] || \"\";\n\n    if (expectedLine !== actualLine) {\n      differences.push(`Line ${i + 1}:`);\n      differences.push(`  Expected: ${expectedLine}`);\n      differences.push(`  Actual:   ${actualLine}`);\n    }\n  }\n\n  return { match: false, differences };\n}\n", "/**\n * LiveTemplate TypeScript Client\n *\n * Reconstructs HTML from tree-based updates using cached static structure,\n * following the Phoenix LiveView optimization approach.\n */\n\nimport morphdom from \"morphdom\";\nimport { FocusManager } from \"./dom/focus-manager\";\nimport {\n  handleAnimateDirectives,\n  handleHighlightDirectives,\n  handleScrollDirectives,\n} from \"./dom/directives\";\nimport { EventDelegator } from \"./dom/event-delegation\";\nimport { ObserverManager } from \"./dom/observer-manager\";\nimport { ModalManager } from \"./dom/modal-manager\";\nimport { LoadingIndicator } from \"./dom/loading-indicator\";\nimport { FormDisabler } from \"./dom/form-disabler\";\nimport { setupReactiveAttributeListeners } from \"./dom/reactive-attributes\";\nimport { TreeRenderer } from \"./state/tree-renderer\";\nimport { FormLifecycleManager } from \"./state/form-lifecycle-manager\";\nimport { WebSocketManager } from \"./transport/websocket\";\nimport { UploadHandler } from \"./upload/upload-handler\";\nimport type {\n  UploadProgressMessage,\n  UploadStartResponse,\n} from \"./upload/types\";\nimport type {\n  LiveTemplateClientOptions,\n  ResponseMetadata,\n  TreeNode,\n  UpdateResponse,\n  UpdateResult,\n} from \"./types\";\nimport { createLogger, Logger } from \"./utils/logger\";\nexport { loadAndApplyUpdate, compareHTML } from \"./utils/testing\";\nexport { setupReactiveAttributeListeners } from \"./dom/reactive-attributes\";\nexport { checkLvtConfirm, extractLvtData } from \"./utils/confirm\";\n\nexport class LiveTemplateClient {\n  private readonly treeRenderer: TreeRenderer;\n  private readonly focusManager: FocusManager;\n  private readonly logger: Logger;\n  private lvtId: string | null = null;\n\n  // Transport properties\n  private webSocketManager: WebSocketManager;\n  public ws: WebSocket | null = null;\n  private wrapperElement: Element | null = null;\n  private options: LiveTemplateClientOptions;\n  private useHTTP: boolean = false; // True when WebSocket is unavailable\n  private sessionCookie: string | null = null; // For HTTP mode session tracking\n\n  // Rate limiting: cache of debounced/throttled handlers per element+eventType\n  private rateLimitedHandlers: WeakMap<Element, Map<string, Function>> =\n    new WeakMap();\n\n  private eventDelegator: EventDelegator;\n  private observerManager: ObserverManager;\n  private modalManager: ModalManager;\n  private formLifecycleManager: FormLifecycleManager;\n  private loadingIndicator: LoadingIndicator;\n  private formDisabler: FormDisabler;\n  private uploadHandler: UploadHandler;\n\n  // Initialization tracking for loading indicator\n  private isInitialized: boolean = false;\n\n  // Message tracking for deterministic E2E testing\n  private messageCount: number = 0;\n\n  constructor(options: LiveTemplateClientOptions = {}) {\n    const { logger: providedLogger, logLevel, debug, ...restOptions } = options;\n    const resolvedLevel = logLevel ?? (debug ? \"debug\" : \"info\");\n    const baseLogger = providedLogger ?? createLogger({ level: resolvedLevel });\n\n    if (providedLogger) {\n      if (logLevel) {\n        providedLogger.setLevel(logLevel);\n      } else if (debug) {\n        providedLogger.setLevel(\"debug\");\n      }\n    } else {\n      baseLogger.setLevel(resolvedLevel);\n    }\n\n    this.logger = baseLogger.child(\"Client\");\n\n    this.options = {\n      autoReconnect: false, // Disable autoReconnect by default to avoid connection loops\n      reconnectDelay: 1000,\n      liveUrl: window.location.pathname, // Connect to current page\n      ...restOptions,\n    };\n\n    this.treeRenderer = new TreeRenderer(this.logger.child(\"TreeRenderer\"));\n    this.focusManager = new FocusManager(this.logger.child(\"FocusManager\"));\n\n    this.modalManager = new ModalManager(this.logger.child(\"ModalManager\"));\n    this.formLifecycleManager = new FormLifecycleManager(this.modalManager);\n    this.loadingIndicator = new LoadingIndicator();\n    this.formDisabler = new FormDisabler();\n\n    // Initialize upload handler\n    this.uploadHandler = new UploadHandler(\n      (message) => this.send(message),\n      {\n        chunkSize: 256 * 1024, // 256KB chunks\n        onProgress: (entry) => {\n          // Trigger DOM update to refresh upload progress\n          if (this.wrapperElement) {\n            this.wrapperElement.dispatchEvent(\n              new CustomEvent(\"lvt:upload:progress\", {\n                detail: { entry },\n              })\n            );\n          }\n        },\n        onComplete: (uploadName, entries) => {\n          this.logger.info(`Upload complete: ${uploadName}`, entries);\n          if (this.wrapperElement) {\n            this.wrapperElement.dispatchEvent(\n              new CustomEvent(\"lvt:upload:complete\", {\n                detail: { uploadName, entries },\n              })\n            );\n          }\n        },\n        onError: (entry, error) => {\n          this.logger.error(`Upload error for ${entry.id}:`, error);\n          if (this.wrapperElement) {\n            this.wrapperElement.dispatchEvent(\n              new CustomEvent(\"lvt:upload:error\", {\n                detail: { entry, error },\n              })\n            );\n          }\n        },\n      }\n    );\n\n    this.eventDelegator = new EventDelegator(\n      {\n        getWrapperElement: () => this.wrapperElement,\n        getRateLimitedHandlers: () => this.rateLimitedHandlers,\n        parseValue: (value: string) => this.parseValue(value),\n        send: (message: any) => this.send(message),\n        setActiveSubmission: (\n          form: HTMLFormElement | null,\n          button: HTMLButtonElement | null,\n          originalButtonText: string | null\n        ) =>\n          this.formLifecycleManager.setActiveSubmission(\n            form,\n            button,\n            originalButtonText\n          ),\n        openModal: (modalId: string) => this.modalManager.open(modalId),\n        closeModal: (modalId: string) => this.modalManager.close(modalId),\n        getWebSocketReadyState: () => this.webSocketManager.getReadyState(),\n        triggerPendingUploads: (uploadName: string) =>\n          this.uploadHandler.triggerPendingUploads(uploadName),\n      },\n      this.logger.child(\"EventDelegator\")\n    );\n\n    this.observerManager = new ObserverManager(\n      {\n        getWrapperElement: () => this.wrapperElement,\n        send: (message: any) => this.send(message),\n      },\n      this.logger.child(\"ObserverManager\")\n    );\n\n    this.webSocketManager = new WebSocketManager({\n      options: this.options,\n      logger: this.logger.child(\"Transport\"),\n      onConnected: () => {\n        this.ws = this.webSocketManager.getSocket();\n        this.logger.info(\"WebSocket connected\");\n        this.options.onConnect?.();\n        this.wrapperElement?.dispatchEvent(new Event(\"lvt:connected\"));\n      },\n      onDisconnected: () => {\n        this.ws = null;\n        this.logger.info(\"WebSocket disconnected\");\n        this.options.onDisconnect?.();\n        this.wrapperElement?.dispatchEvent(new Event(\"lvt:disconnected\"));\n      },\n      onMessage: (response, event) => {\n        this.handleWebSocketPayload(response, event);\n      },\n      onReconnectAttempt: () => {\n        this.logger.info(\"Attempting to reconnect...\");\n      },\n      onError: (error) => {\n        this.logger.error(\"WebSocket error:\", error);\n        this.options.onError?.(error);\n      },\n    });\n  }\n\n  /**\n   * Auto-initialize when DOM is ready\n   * Called automatically when script loads\n   */\n  static autoInit(): void {\n    const autoInitLogger = createLogger({ scope: \"Client:autoInit\" });\n    const init = () => {\n      const wrapper = document.querySelector(\"[data-lvt-id]\");\n      if (wrapper) {\n        const client = new LiveTemplateClient();\n        client.wrapperElement = wrapper;\n\n        // Check if loading indicator should be shown\n        const shouldShowLoading =\n          wrapper.getAttribute(\"data-lvt-loading\") === \"true\";\n        if (shouldShowLoading) {\n          client.loadingIndicator.show();\n          client.formDisabler.disable(client.wrapperElement);\n        }\n\n        client.connect().catch((error) => {\n          autoInitLogger.error(\"Auto-initialization connect failed:\", error);\n        });\n\n        // Expose as global for programmatic access\n        (window as any).liveTemplateClient = client;\n      }\n    };\n\n    // Initialize when DOM is ready\n    if (document.readyState === \"loading\") {\n      document.addEventListener(\"DOMContentLoaded\", init);\n    } else {\n      init();\n    }\n  }\n\n  /**\n   * Handle server-sent updates delivered via WebSocket or HTTP fallback.\n   */\n  private handleWebSocketPayload(\n    response: UpdateResponse,\n    event?: MessageEvent<string>\n  ): void {\n    if (event) {\n      (window as any).__lastWSMessage = event.data;\n\n      if (!(window as any).__wsMessages) {\n        (window as any).__wsMessages = [];\n      }\n      (window as any).__wsMessages.push(response);\n    }\n\n    // Check if this is an upload-specific message\n    const uploadMessage = response as any;\n    if (uploadMessage.type === \"upload_progress\") {\n      this.uploadHandler.handleProgressMessage(\n        uploadMessage as UploadProgressMessage\n      );\n      return;\n    }\n\n    // Check if this is an upload_start response\n    if (uploadMessage.upload_name && uploadMessage.entries) {\n      const startResponse = uploadMessage as UploadStartResponse;\n      // Handle upload start response with error handling\n      try {\n        this.handleUploadStartResponse(startResponse);\n      } catch (error) {\n        this.logger.error(\"Error handling upload start response:\", error);\n      }\n      return;\n    }\n\n    // Check if this is an upload_complete response\n    if (uploadMessage.upload_name && uploadMessage.hasOwnProperty('success')) {\n      // UploadCompleteResponse - just log it, no tree update needed\n      if (uploadMessage.success) {\n        this.logger.info(`Upload complete: ${uploadMessage.upload_name}`);\n      } else {\n        this.logger.error(`Upload failed: ${uploadMessage.upload_name}`, uploadMessage.error);\n      }\n      return;\n    }\n\n    if (!this.isInitialized) {\n      this.loadingIndicator.hide();\n      this.formDisabler.enable(this.wrapperElement);\n      if (\n        this.wrapperElement &&\n        this.wrapperElement.hasAttribute(\"data-lvt-loading\")\n      ) {\n        this.wrapperElement.removeAttribute(\"data-lvt-loading\");\n      }\n      this.isInitialized = true;\n    }\n\n    if (this.wrapperElement) {\n      this.updateDOM(this.wrapperElement, response.tree, response.meta);\n      this.messageCount++;\n      (window as any).__wsMessageCount = this.messageCount;\n\n      this.wrapperElement.dispatchEvent(\n        new CustomEvent(\"lvt:updated\", {\n          detail: {\n            messageCount: this.messageCount,\n            action: response.meta?.action,\n            success: response.meta?.success,\n          },\n        })\n      );\n    }\n  }\n\n  /**\n   * Connect to WebSocket and start receiving updates\n   * @param wrapperSelector - CSS selector for the LiveTemplate wrapper (defaults to '[data-lvt-id]')\n   */\n  async connect(wrapperSelector: string = \"[data-lvt-id]\"): Promise<void> {\n    // Find the wrapper element\n    this.wrapperElement = document.querySelector(wrapperSelector);\n    if (!this.wrapperElement) {\n      throw new Error(\n        `LiveTemplate wrapper not found with selector: ${wrapperSelector}`\n      );\n    }\n\n    this.webSocketManager.disconnect();\n\n    const connectionResult = await this.webSocketManager.connect();\n    this.useHTTP = !connectionResult.usingWebSocket;\n\n    if (this.useHTTP) {\n      this.ws = null;\n      this.logger.info(\"WebSocket not available, using HTTP mode\");\n      this.options.onConnect?.();\n      if (connectionResult.initialState && this.wrapperElement) {\n        this.handleWebSocketPayload(connectionResult.initialState);\n      }\n    }\n    // Set up event delegation for lvt-* attributes\n    this.eventDelegator.setupEventDelegation();\n\n    // Set up window-* event delegation\n    this.eventDelegator.setupWindowEventDelegation();\n\n    // Set up click-away delegation\n    this.eventDelegator.setupClickAwayDelegation();\n\n    // Set up modal delegation\n    this.eventDelegator.setupModalDelegation();\n\n    // Set up focus trap delegation for lvt-focus-trap attribute\n    this.eventDelegator.setupFocusTrapDelegation();\n\n    // Set up autofocus delegation for lvt-autofocus attribute\n    this.eventDelegator.setupAutofocusDelegation();\n\n    // Set up reactive attribute listeners for lvt-{action}-on:{event} attributes\n    setupReactiveAttributeListeners();\n\n    // Initialize focus tracking\n    this.focusManager.attach(this.wrapperElement);\n\n    // Set up infinite scroll observers\n    this.observerManager.setupInfiniteScrollObserver();\n    this.observerManager.setupInfiniteScrollMutationObserver();\n  }\n\n  /**\n   * Disconnect from WebSocket\n   */\n  disconnect(): void {\n    this.webSocketManager.disconnect();\n    this.ws = null;\n    this.useHTTP = false;\n    this.observerManager.teardown();\n    this.formLifecycleManager.reset();\n    this.loadingIndicator.hide();\n    this.formDisabler.enable(this.wrapperElement);\n  }\n\n  /**\n   * Determine whether the client finished its initial load and has an active transport.\n   */\n  isReady(): boolean {\n    const wrapper = this.wrapperElement;\n\n    if (!wrapper || wrapper.hasAttribute(\"data-lvt-loading\")) {\n      return false;\n    }\n\n    if (this.useHTTP) {\n      return true;\n    }\n\n    const readyState = this.webSocketManager.getReadyState();\n    return readyState === 1; // WebSocket.OPEN = 1\n  }\n\n  /**\n   * Send a message to the server via WebSocket or HTTP\n   * @param message - Message to send (will be JSON stringified)\n   */\n  send(message: any): void {\n    // Debug flag for testing\n    (window as any).__lvtSendCalled = true;\n    (window as any).__lvtMessageAction = message?.action;\n\n    const readyState = this.webSocketManager.getReadyState();\n\n    if (this.logger.isDebugEnabled()) {\n      this.logger.debug(\"send() invoked\", {\n        message,\n        useHTTP: this.useHTTP,\n        hasWebSocket: readyState !== undefined,\n        readyState,\n      });\n    }\n\n    if (this.useHTTP) {\n      // HTTP mode: send via POST and handle response\n      this.logger.debug(\"Using HTTP mode for send\");\n      (window as any).__lvtSendPath = \"http\";\n      this.sendHTTP(message);\n    } else if (readyState === 1) { // WebSocket.OPEN = 1\n      // WebSocket mode\n      this.logger.debug(\"Sending via WebSocket\");\n      (window as any).__lvtSendPath = \"websocket\";\n      (window as any).__lvtWSMessage = JSON.stringify(message);\n      this.webSocketManager.send(JSON.stringify(message));\n      this.logger.debug(\"WebSocket send complete\");\n      (window as any).__lvtWSSendComplete = true;\n    } else if (readyState !== undefined) {\n      // WebSocket is connecting or closing, fall back to HTTP temporarily\n      this.logger.warn(\n        `WebSocket not ready (state: ${readyState}), using HTTP fallback`\n      );\n      (window as any).__lvtSendPath = \"http-fallback\";\n      this.sendHTTP(message);\n    } else {\n      this.logger.error(\"No transport available\");\n      (window as any).__lvtSendPath = \"no-transport\";\n    }\n  }\n\n  /**\n   * Send action via HTTP POST\n   */\n  private async sendHTTP(message: any): Promise<void> {\n    try {\n      const liveUrl = this.options.liveUrl || \"/live\";\n      const response = await fetch(liveUrl, {\n        method: \"POST\",\n        credentials: \"include\", // Include cookies for session\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Accept: \"application/json\",\n        },\n        body: JSON.stringify(message),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP request failed: ${response.status}`);\n      }\n\n      // Handle the update response\n      const updateResponse: UpdateResponse = await response.json();\n      if (this.wrapperElement) {\n        this.updateDOM(\n          this.wrapperElement,\n          updateResponse.tree,\n          updateResponse.meta\n        );\n      }\n    } catch (error) {\n      this.logger.error(\"Failed to send HTTP request:\", error);\n    }\n  }\n\n  /**\n   * Parse a string value into appropriate type (number, boolean, or string)\n   * @param value - String value to parse\n   * @returns Parsed value with correct type\n   */\n  private parseValue(value: string): any {\n    // Try to parse as number\n    const num = parseFloat(value);\n    if (!isNaN(num) && value.trim() === num.toString()) {\n      return num;\n    }\n\n    // Try to parse as boolean\n    if (value === \"true\") return true;\n    if (value === \"false\") return false;\n\n    // Return as string\n    return value;\n  }\n\n  /**\n   * Apply an update to the current state and reconstruct HTML\n   * @param update - Tree update object from LiveTemplate server\n   * @returns Reconstructed HTML and whether anything changed\n   */\n  applyUpdate(update: TreeNode): UpdateResult {\n    return this.treeRenderer.applyUpdate(update);\n  }\n\n  /**\n   * Apply updates to existing HTML using morphdom for efficient DOM updates\n   * @param existingHTML - Current full HTML document\n   * @param update - Tree update object from LiveTemplate server\n   * @returns Updated HTML content\n   */\n  applyUpdateToHTML(existingHTML: string, update: TreeNode): string {\n    // Apply the update to our internal state\n    const result = this.applyUpdate(update);\n\n    // Extract lvt-id from existing HTML if we don't have it\n    if (!this.lvtId) {\n      const match = existingHTML.match(/data-lvt-id=\"([^\"]+)\"/);\n      if (match) {\n        this.lvtId = match[1];\n      }\n    }\n\n    // The new tree includes complete HTML structure, so we can reconstruct properly\n    const innerContent = result.html;\n\n    // Find where to insert the reconstructed content\n    const bodyMatch = existingHTML.match(/<body>([\\s\\S]*?)<\\/body>/);\n    if (!bodyMatch) {\n      return existingHTML;\n    }\n\n    // Replace the body content with our reconstructed HTML\n    // We need to preserve the wrapper div with data-lvt-id\n    const wrapperStart = `<div data-lvt-id=\"${this.lvtId || \"lvt-unknown\"}\">`;\n    const wrapperEnd = \"</div>\";\n    const newBodyContent = wrapperStart + innerContent + wrapperEnd;\n\n    return existingHTML.replace(\n      /<body>[\\s\\S]*?<\\/body>/,\n      `<body>${newBodyContent}</body>`\n    );\n  }\n\n  /**\n   * Update a live DOM element with new tree data\n   * @param element - DOM element containing the LiveTemplate content (the wrapper div)\n   * @param update - Tree update object from LiveTemplate server\n   * @param meta - Optional metadata about the update (action, success, errors)\n   */\n  updateDOM(element: Element, update: TreeNode, meta?: ResponseMetadata): void {\n    // Apply update to internal state and get reconstructed HTML\n    const result = this.applyUpdate(update);\n\n    // Helper to recursively check if there are any statics in the tree\n    const hasStaticsInTree = (node: any): boolean => {\n      if (!node || typeof node !== \"object\") return false;\n      if (node.s && Array.isArray(node.s)) return true;\n      return Object.values(node).some((v) => hasStaticsInTree(v));\n    };\n\n    if (!result.changed && !hasStaticsInTree(update)) {\n      // No changes detected and no statics in update, skip morphdom\n      return;\n    }\n\n    // Create a temporary wrapper to hold the new content\n    // We need to create a DOM element of the same type as 'element' to avoid browser HTML corrections\n    // For example, if we put <tr> elements in a <div>, the browser strips them out\n    const tempWrapper = document.createElement(element.tagName);\n\n    if (this.logger.isDebugEnabled()) {\n      this.logger.debug(\"[updateDOM] element.tagName:\", element.tagName);\n      this.logger.debug(\n        \"[updateDOM] result.html (first 500 chars):\",\n        result.html.substring(0, 500)\n      );\n      this.logger.debug(\n        \"[updateDOM] Has <table> tag:\",\n        result.html.includes(\"<table>\")\n      );\n      this.logger.debug(\n        \"[updateDOM] Has <tbody> tag:\",\n        result.html.includes(\"<tbody>\")\n      );\n      this.logger.debug(\n        \"[updateDOM] Has <tr> tag:\",\n        result.html.includes(\"<tr\")\n      );\n    }\n\n    tempWrapper.innerHTML = result.html;\n\n    if (this.logger.isDebugEnabled()) {\n      this.logger.debug(\n        \"[updateDOM] tempWrapper.innerHTML (first 500 chars):\",\n        tempWrapper.innerHTML.substring(0, 500)\n      );\n      this.logger.debug(\n        \"[updateDOM] tempWrapper has <table>:\",\n        tempWrapper.innerHTML.includes(\"<table>\")\n      );\n      this.logger.debug(\n        \"[updateDOM] tempWrapper has <tbody>:\",\n        tempWrapper.innerHTML.includes(\"<tbody>\")\n      );\n      this.logger.debug(\n        \"[updateDOM] tempWrapper has <tr>:\",\n        tempWrapper.innerHTML.includes(\"<tr\")\n      );\n    }\n\n    // Use morphdom to efficiently update the element\n    morphdom(element, tempWrapper, {\n      childrenOnly: true, // Only update children, preserve the wrapper element itself\n      getNodeKey: (node: any) => {\n        // Use data-key or data-lvt-key for efficient reconciliation\n        if (node.nodeType === 1) {\n          return (\n            node.getAttribute(\"data-key\") ||\n            node.getAttribute(\"data-lvt-key\") ||\n            undefined\n          );\n        }\n      },\n      onBeforeElUpdated: (fromEl, toEl) => {\n        // Preserve value for the last focused textual input\n        const lastFocused = this.focusManager.getLastFocusedElement();\n        if (lastFocused && this.focusManager.isTextualInput(fromEl)) {\n          if (fromEl === lastFocused) {\n            // Preserve the current value being typed\n            (toEl as any).value = (fromEl as any).value;\n          }\n        }\n\n        // Only update if content actually changed\n        if (fromEl.isEqualNode(toEl)) {\n          return false;\n        }\n        // Execute lvt-updated lifecycle hook\n        this.executeLifecycleHook(fromEl, \"lvt-updated\");\n        return true;\n      },\n      onNodeAdded: (node) => {\n        // Execute lvt-mounted lifecycle hook\n        if (node.nodeType === Node.ELEMENT_NODE) {\n          this.executeLifecycleHook(node as Element, \"lvt-mounted\");\n        }\n      },\n      onBeforeNodeDiscarded: (node) => {\n        // Execute lvt-destroyed lifecycle hook\n        if (node.nodeType === Node.ELEMENT_NODE) {\n          this.executeLifecycleHook(node as Element, \"lvt-destroyed\");\n        }\n        return true;\n      },\n    });\n\n    // Restore focus to previously focused element\n    this.focusManager.restoreFocusedElement();\n\n    // Handle scroll directives\n    handleScrollDirectives(element);\n\n    // Handle highlight directives\n    handleHighlightDirectives(element);\n\n    // Handle animate directives\n    handleAnimateDirectives(element);\n\n    // Initialize upload file inputs\n    this.uploadHandler.initializeFileInputs(element);\n\n    // Handle form lifecycle if metadata is present\n    if (meta) {\n      this.formLifecycleManager.handleResponse(meta);\n    }\n  }\n\n  /**\n   * Handle upload_start response from server\n   */\n  private handleUploadStartResponse(response: UploadStartResponse): void {\n    this.uploadHandler.handleUploadStartResponse(response);\n  }\n\n  /**\n   * Execute lifecycle hook on an element\n   * @param element - Element with lifecycle hook attribute\n   * @param hookName - Name of the lifecycle hook attribute (e.g., 'lvt-mounted')\n   */\n  private executeLifecycleHook(element: Element, hookName: string): void {\n    const hookValue = element.getAttribute(hookName);\n    if (!hookValue) {\n      return;\n    }\n\n    try {\n      // Create a function from the hook value and execute it\n      // The function has access to 'this' (the element) and 'event'\n      const hookFunction = new Function(\"element\", hookValue);\n      hookFunction.call(element, element);\n    } catch (error) {\n      this.logger.error(`Error executing ${hookName} hook:`, error);\n    }\n  }\n\n  /**\n   * Reset client state (useful for testing)\n   */\n  reset(): void {\n    this.treeRenderer.reset();\n    this.focusManager.reset();\n    this.observerManager.teardown();\n    this.formLifecycleManager.reset();\n    this.loadingIndicator.hide();\n    this.formDisabler.enable(this.wrapperElement);\n    this.lvtId = null;\n  }\n\n  /**\n   * Get current tree state (for debugging)\n   */\n  getTreeState(): TreeNode {\n    return this.treeRenderer.getTreeState();\n  }\n\n  /**\n   * Get the static structure if available\n   */\n  getStaticStructure(): string[] | null {\n    return this.treeRenderer.getStaticStructure();\n  }\n}\n\n// Auto-initialize when script loads (for browser use)\nif (typeof window !== \"undefined\") {\n  LiveTemplateClient.autoInit();\n}\n", "/**\n * Browser entry point with auto-initialization\n */\n\n// Export everything from index\nexport * from \"./index\";\n\n// Import auto-init (triggers on load)\nimport \"./auto-init\";\n", "/**\n * LivepageClient - Main orchestrator for Livepage interactive documentation\n */\n\nimport { setupReactiveAttributeListeners } from \"@livetemplate/client\";\nimport { LivepageClientOptions, BlockConfig, BlockMetadata, MessageEnvelope } from \"./types\";\nimport { MessageRouter } from \"./core/message-router\";\nimport { PersistenceManager } from \"./core/persistence-manager\";\nimport { BaseBlock } from \"./blocks/base-block\";\nimport { ServerBlock } from \"./blocks/server-block\";\nimport { InteractiveBlock } from \"./blocks/interactive-block\";\nimport { WasmBlock } from \"./blocks/wasm-block\";\n\nexport class LivepageClient {\n  private options: LivepageClientOptions;\n  private router: MessageRouter;\n  private persistence: PersistenceManager;\n  private blocks: Map<string, BaseBlock> = new Map();\n  private ws: WebSocket | null = null;\n  private reconnectTimer: number | null = null;\n  private isConnected = false;\n\n  constructor(options: LivepageClientOptions) {\n    this.options = {\n      debug: false,\n      persistence: true,\n      cdnFallback: false,\n      ...options,\n    };\n\n    this.router = new MessageRouter(this.options.debug);\n    this.persistence = new PersistenceManager(\n      \"livepage:persistence\",\n      this.options.persistence,\n      this.options.debug\n    );\n\n    if (this.options.debug) {\n      console.log(\"[LivepageClient] Initialized with options:\", this.options);\n    }\n  }\n\n  /**\n   * Connect to the WebSocket server\n   */\n  connect(): void {\n    if (this.ws) {\n      console.warn(\"[LivepageClient] Already connected\");\n      return;\n    }\n\n    try {\n      this.ws = new WebSocket(this.options.wsUrl);\n\n      this.ws.onopen = () => {\n        this.isConnected = true;\n        console.log(\"[LivepageClient] Connected to server\");\n        this.options.onConnect?.();\n      };\n\n      this.ws.onclose = () => {\n        this.isConnected = false;\n        console.log(\"[LivepageClient] Disconnected from server\");\n        this.options.onDisconnect?.();\n        this.scheduleReconnect();\n      };\n\n      this.ws.onerror = (error) => {\n        console.error(\"[LivepageClient] WebSocket error:\", error);\n        this.options.onError?.(new Error(\"WebSocket error\"));\n      };\n\n      this.ws.onmessage = (event) => {\n        this.handleMessage(event.data);\n      };\n    } catch (error) {\n      console.error(\"[LivepageClient] Failed to connect:\", error);\n      this.options.onError?.(error as Error);\n    }\n  }\n\n  /**\n   * Disconnect from the server\n   */\n  disconnect(): void {\n    if (this.reconnectTimer) {\n      clearTimeout(this.reconnectTimer);\n      this.reconnectTimer = null;\n    }\n\n    if (this.ws) {\n      this.ws.close();\n      this.ws = null;\n    }\n\n    this.isConnected = false;\n  }\n\n  /**\n   * Handle incoming WebSocket messages\n   */\n  private handleMessage(data: string): void {\n    if (this.options.debug) {\n      console.log(\"[LivepageClient] Received message:\", data);\n    }\n\n    // Route message to appropriate block\n    this.router.route(data);\n  }\n\n  /**\n   * Send a message to the server\n   */\n  send(blockID: string, action: string, data: any = {}): void {\n    if (!this.isConnected || !this.ws) {\n      console.warn(\"[LivepageClient] Cannot send - not connected\");\n      return;\n    }\n\n    const envelope: MessageEnvelope = {\n      blockID,\n      action,\n      data,\n    };\n\n    const message = JSON.stringify(envelope);\n\n    if (this.options.debug) {\n      console.log(\"[LivepageClient] Sending message:\", message);\n    }\n\n    this.ws.send(message);\n  }\n\n  /**\n   * Schedule reconnection attempt\n   */\n  private scheduleReconnect(): void {\n    if (this.reconnectTimer) {\n      return;\n    }\n\n    this.reconnectTimer = window.setTimeout(() => {\n      this.reconnectTimer = null;\n      console.log(\"[LivepageClient] Attempting to reconnect...\");\n      this.connect();\n    }, 3000);\n  }\n\n  /**\n   * Discover and register all code blocks on the page\n   */\n  discoverBlocks(): void {\n    console.log(\"[LivepageClient] Discovering blocks...\");\n\n    // Set up reactive attribute listeners from @livetemplate/client\n    // This handles lvt-{action}-on:{event} attributes (e.g., lvt-reset-on:success)\n    setupReactiveAttributeListeners();\n\n    // Find all code blocks with livepage metadata\n    const codeBlocks = document.querySelectorAll<HTMLElement>(\n      \"[data-livepage-block]\"\n    );\n\n    for (const element of Array.from(codeBlocks)) {\n      try {\n        const metadata = this.extractMetadata(element);\n        const initialCode = this.extractCode(element);\n\n        const config: BlockConfig = {\n          element,\n          metadata,\n          initialCode,\n        };\n\n        this.registerBlock(config);\n      } catch (error) {\n        console.error(\"[LivepageClient] Error discovering block:\", error);\n      }\n    }\n\n    console.log(`[LivepageClient] Discovered ${this.blocks.size} blocks`);\n  }\n\n  /**\n   * Extract metadata from a code block element\n   */\n  private extractMetadata(element: HTMLElement): BlockMetadata {\n    const id = element.dataset.blockId || this.generateBlockId();\n    const type = (element.dataset.blockType as any) || \"server\";\n    const language = element.dataset.language || \"go\";\n    const readonly = element.dataset.readonly === \"true\";\n    const editable = element.dataset.editable === \"true\";\n    const stateRef = element.dataset.stateRef;\n\n    return {\n      id,\n      type,\n      language,\n      readonly,\n      editable,\n      stateRef,\n    };\n  }\n\n  /**\n   * Extract code from a code block element\n   */\n  private extractCode(element: HTMLElement): string {\n    // Try to find code element\n    const codeElement = element.querySelector(\"code\");\n    if (codeElement) {\n      return codeElement.textContent || \"\";\n    }\n\n    // Fallback to element text content\n    return element.textContent || \"\";\n  }\n\n  /**\n   * Generate a unique block ID\n   */\n  private generateBlockId(): string {\n    return `block-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  /**\n   * Register a code block\n   */\n  registerBlock(config: BlockConfig): void {\n    const { metadata } = config;\n\n    if (this.blocks.has(metadata.id)) {\n      console.warn(`[LivepageClient] Block already registered: ${metadata.id}`);\n      return;\n    }\n\n    // Create appropriate block type\n    let block: BaseBlock;\n\n    switch (metadata.type) {\n      case \"server\":\n        block = new ServerBlock(config, this.persistence, this.options.debug);\n        break;\n\n      case \"interactive\":\n      case \"lvt\":\n        block = new InteractiveBlock(config, this.persistence, this.options.debug);\n        // Set message sender for interactive blocks\n        (block as InteractiveBlock).setMessageSender((blockID, action, data) => {\n          this.send(blockID, action, data);\n        });\n        break;\n\n      case \"wasm\":\n        block = new WasmBlock(config, this.persistence, this.options.debug);\n        break;\n\n      default:\n        console.warn(`[LivepageClient] Unknown block type: ${metadata.type}`);\n        return;\n    }\n\n    // Initialize the block\n    block.initialize();\n\n    // Register with router (for message handling)\n    this.router.register(metadata.id, (action, data) => {\n      block.handleMessage(action, data);\n    });\n\n    // Store block reference\n    this.blocks.set(metadata.id, block);\n\n    if (this.options.debug) {\n      console.log(`[LivepageClient] Registered block: ${metadata.id} (${metadata.type})`);\n    }\n  }\n\n  /**\n   * Unregister a code block\n   */\n  unregisterBlock(blockID: string): void {\n    const block = this.blocks.get(blockID);\n    if (!block) {\n      return;\n    }\n\n    // Destroy the block\n    block.destroy();\n\n    // Unregister from router\n    this.router.unregister(blockID);\n\n    // Remove from blocks map\n    this.blocks.delete(blockID);\n\n    if (this.options.debug) {\n      console.log(`[LivepageClient] Unregistered block: ${blockID}`);\n    }\n  }\n\n  /**\n   * Get a block by ID\n   */\n  getBlock(blockID: string): BaseBlock | undefined {\n    return this.blocks.get(blockID);\n  }\n\n  /**\n   * Get all block IDs\n   */\n  getBlockIds(): string[] {\n    return Array.from(this.blocks.keys());\n  }\n\n  /**\n   * Destroy the client and all blocks\n   */\n  destroy(): void {\n    console.log(\"[LivepageClient] Destroying client\");\n\n    // Destroy all blocks\n    for (const block of this.blocks.values()) {\n      block.destroy();\n    }\n\n    this.blocks.clear();\n    this.router.clear();\n    this.disconnect();\n  }\n}\n", "/**\n * MessageRouter - Multiplexes WebSocket messages by blockID\n */\n\nimport { MessageEnvelope } from \"../types\";\n\nexport type MessageHandler = (action: string, data: any) => void;\n\nexport class MessageRouter {\n  private handlers: Map<string, MessageHandler> = new Map();\n  private debug: boolean;\n\n  constructor(debug = false) {\n    this.debug = debug;\n  }\n\n  /**\n   * Register a handler for a specific block ID\n   */\n  register(blockID: string, handler: MessageHandler): void {\n    if (this.handlers.has(blockID)) {\n      console.warn(`[MessageRouter] Overwriting handler for block: ${blockID}`);\n    }\n    this.handlers.set(blockID, handler);\n    if (this.debug) {\n      console.log(`[MessageRouter] Registered handler for block: ${blockID}`);\n    }\n  }\n\n  /**\n   * Unregister a handler for a specific block ID\n   */\n  unregister(blockID: string): void {\n    this.handlers.delete(blockID);\n    if (this.debug) {\n      console.log(`[MessageRouter] Unregistered handler for block: ${blockID}`);\n    }\n  }\n\n  /**\n   * Route an incoming message to the appropriate handler\n   */\n  route(message: string | MessageEnvelope): void {\n    try {\n      const envelope: MessageEnvelope =\n        typeof message === \"string\" ? JSON.parse(message) : message;\n\n      const { blockID, action, data } = envelope;\n\n      // Handle reload action (special case - no blockID)\n      if (action === \"reload\") {\n        this.handleReload(data?.filePath || \"\");\n        return;\n      }\n\n      if (!blockID) {\n        console.error(\"[MessageRouter] Message missing blockID:\", envelope);\n        return;\n      }\n\n      const handler = this.handlers.get(blockID);\n      if (!handler) {\n        console.warn(`[MessageRouter] No handler for block: ${blockID}`);\n        return;\n      }\n\n      if (this.debug) {\n        console.log(`[MessageRouter] Routing to ${blockID}:`, { action, data });\n      }\n\n      handler(action, data);\n    } catch (error) {\n      console.error(\"[MessageRouter] Error routing message:\", error);\n    }\n  }\n\n  /**\n   * Handle reload message from server\n   */\n  private handleReload(filePath: string): void {\n    console.log(`[MessageRouter] Page reloading: ${filePath} changed`);\n\n    // Show notification\n    this.showReloadNotification(filePath);\n\n    // Reload the page after a short delay to show the notification\n    setTimeout(() => {\n      window.location.reload();\n    }, 500);\n  }\n\n  /**\n   * Show reload notification overlay\n   */\n  private showReloadNotification(filePath: string): void {\n    const existing = document.getElementById(\"livepage-reload-notification\");\n    if (existing) {\n      existing.remove();\n    }\n\n    const notification = document.createElement(\"div\");\n    notification.id = \"livepage-reload-notification\";\n    notification.innerHTML = `\n      <div style=\"\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n        color: white;\n        padding: 16px 20px;\n        border-radius: 8px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n        z-index: 100000;\n        font-family: system-ui, -apple-system, sans-serif;\n        font-size: 14px;\n        animation: slideIn 0.3s ease-out;\n      \">\n        <div style=\"display: flex; align-items: center; gap: 10px;\">\n          <div style=\"font-size: 20px;\">\uD83D\uDD04</div>\n          <div>\n            <div style=\"font-weight: 600;\">File Updated</div>\n            <div style=\"opacity: 0.9; font-size: 12px; margin-top: 2px;\">${filePath}</div>\n          </div>\n        </div>\n      </div>\n    `;\n\n    // Add animation\n    const style = document.createElement(\"style\");\n    style.textContent = `\n      @keyframes slideIn {\n        from {\n          transform: translateX(400px);\n          opacity: 0;\n        }\n        to {\n          transform: translateX(0);\n          opacity: 1;\n        }\n      }\n    `;\n    document.head.appendChild(style);\n    document.body.appendChild(notification);\n  }\n\n  /**\n   * Send a message to the server (formatted as envelope)\n   */\n  createEnvelope(blockID: string, action: string, data: any = {}): MessageEnvelope {\n    return { blockID, action, data };\n  }\n\n  /**\n   * Get all registered block IDs\n   */\n  getRegisteredBlocks(): string[] {\n    return Array.from(this.handlers.keys());\n  }\n\n  /**\n   * Clear all handlers\n   */\n  clear(): void {\n    this.handlers.clear();\n    if (this.debug) {\n      console.log(\"[MessageRouter] Cleared all handlers\");\n    }\n  }\n}\n", "/**\n * PersistenceManager - Handles localStorage for code edits and state\n */\n\nimport { PersistenceData } from \"../types\";\n\nexport class PersistenceManager {\n  private storageKey: string;\n  private enabled: boolean;\n  private debug: boolean;\n\n  constructor(storageKey = \"livepage:persistence\", enabled = true, debug = false) {\n    this.storageKey = storageKey;\n    this.enabled = enabled && this.isLocalStorageAvailable();\n    this.debug = debug;\n\n    if (!this.enabled && enabled) {\n      console.warn(\"[PersistenceManager] localStorage not available, persistence disabled\");\n    }\n  }\n\n  /**\n   * Check if localStorage is available\n   */\n  private isLocalStorageAvailable(): boolean {\n    try {\n      const test = \"__localStorage_test__\";\n      localStorage.setItem(test, test);\n      localStorage.removeItem(test);\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  /**\n   * Save code for a specific block\n   */\n  saveCode(blockID: string, code: string): void {\n    if (!this.enabled) return;\n\n    try {\n      const data = this.loadAll();\n      data.code[blockID] = code;\n      data.timestamp = Date.now();\n\n      localStorage.setItem(this.storageKey, JSON.stringify(data));\n\n      if (this.debug) {\n        console.log(`[PersistenceManager] Saved code for block: ${blockID}`);\n      }\n    } catch (error) {\n      console.error(\"[PersistenceManager] Error saving code:\", error);\n    }\n  }\n\n  /**\n   * Load code for a specific block\n   */\n  loadCode(blockID: string): string | null {\n    if (!this.enabled) return null;\n\n    try {\n      const data = this.loadAll();\n      return data.code[blockID] || null;\n    } catch (error) {\n      console.error(\"[PersistenceManager] Error loading code:\", error);\n      return null;\n    }\n  }\n\n  /**\n   * Load all persisted data\n   */\n  loadAll(): PersistenceData {\n    if (!this.enabled) {\n      return { code: {}, timestamp: Date.now() };\n    }\n\n    try {\n      const raw = localStorage.getItem(this.storageKey);\n      if (!raw) {\n        return { code: {}, timestamp: Date.now() };\n      }\n\n      const data = JSON.parse(raw) as PersistenceData;\n\n      // Validate structure\n      if (!data.code || typeof data.code !== \"object\") {\n        console.warn(\"[PersistenceManager] Invalid data structure, resetting\");\n        return { code: {}, timestamp: Date.now() };\n      }\n\n      return data;\n    } catch (error) {\n      console.error(\"[PersistenceManager] Error loading data:\", error);\n      return { code: {}, timestamp: Date.now() };\n    }\n  }\n\n  /**\n   * Clear code for a specific block\n   */\n  clearCode(blockID: string): void {\n    if (!this.enabled) return;\n\n    try {\n      const data = this.loadAll();\n      delete data.code[blockID];\n      data.timestamp = Date.now();\n\n      localStorage.setItem(this.storageKey, JSON.stringify(data));\n\n      if (this.debug) {\n        console.log(`[PersistenceManager] Cleared code for block: ${blockID}`);\n      }\n    } catch (error) {\n      console.error(\"[PersistenceManager] Error clearing code:\", error);\n    }\n  }\n\n  /**\n   * Clear all persisted data\n   */\n  clearAll(): void {\n    if (!this.enabled) return;\n\n    try {\n      localStorage.removeItem(this.storageKey);\n\n      if (this.debug) {\n        console.log(\"[PersistenceManager] Cleared all persisted data\");\n      }\n    } catch (error) {\n      console.error(\"[PersistenceManager] Error clearing all data:\", error);\n    }\n  }\n\n  /**\n   * Get all persisted block IDs\n   */\n  getPersistedBlocks(): string[] {\n    if (!this.enabled) return [];\n\n    const data = this.loadAll();\n    return Object.keys(data.code);\n  }\n\n  /**\n   * Check if a block has persisted code\n   */\n  hasPersistedCode(blockID: string): boolean {\n    if (!this.enabled) return false;\n\n    const data = this.loadAll();\n    return blockID in data.code;\n  }\n\n  /**\n   * Get the timestamp of last persistence update\n   */\n  getLastUpdate(): number | null {\n    if (!this.enabled) return null;\n\n    const data = this.loadAll();\n    return data.timestamp;\n  }\n}\n", "/**\n * BaseBlock - Abstract base class for all code blocks\n */\n\nimport { BlockConfig, BlockMetadata } from \"../types\";\nimport { PersistenceManager } from \"../core/persistence-manager\";\n\nexport abstract class BaseBlock {\n  protected element: HTMLElement;\n  protected metadata: BlockMetadata;\n  protected persistence: PersistenceManager;\n  protected initialCode: string;\n  protected currentCode: string;\n  protected debug: boolean;\n\n  constructor(config: BlockConfig, persistence: PersistenceManager, debug = false) {\n    this.element = config.element;\n    this.metadata = config.metadata;\n    this.persistence = persistence;\n    this.initialCode = config.initialCode || \"\";\n    this.currentCode = this.initialCode;\n    this.debug = debug;\n  }\n\n  /**\n   * Initialize the block (called by LivepageClient)\n   */\n  abstract initialize(): void;\n\n  /**\n   * Destroy the block and clean up resources\n   */\n  abstract destroy(): void;\n\n  /**\n   * Handle incoming messages from the server\n   */\n  abstract handleMessage(action: string, data: any): void;\n\n  /**\n   * Get the block ID\n   */\n  get id(): string {\n    return this.metadata.id;\n  }\n\n  /**\n   * Get the block type\n   */\n  get type(): string {\n    return this.metadata.type;\n  }\n\n  /**\n   * Get current code content\n   */\n  getCode(): string {\n    return this.currentCode;\n  }\n\n  /**\n   * Set code content\n   */\n  setCode(code: string): void {\n    this.currentCode = code;\n    if (this.metadata.editable) {\n      this.persistence.saveCode(this.id, code);\n    }\n  }\n\n  /**\n   * Reset to initial code\n   */\n  reset(): void {\n    this.setCode(this.initialCode);\n    if (this.debug) {\n      console.log(`[Block:${this.id}] Reset to initial code`);\n    }\n  }\n\n  /**\n   * Load persisted code if available\n   */\n  protected loadPersistedCode(): string {\n    if (!this.metadata.editable) {\n      return this.initialCode;\n    }\n\n    const persisted = this.persistence.loadCode(this.id);\n    if (persisted) {\n      if (this.debug) {\n        console.log(`[Block:${this.id}] Loaded persisted code`);\n      }\n      return persisted;\n    }\n\n    return this.initialCode;\n  }\n\n  /**\n   * Create wrapper HTML for the block\n   */\n  protected createBlockWrapper(): HTMLElement {\n    const wrapper = document.createElement(\"div\");\n    wrapper.className = `livepage-block livepage-block-${this.type}`;\n    wrapper.dataset.blockId = this.id;\n    wrapper.dataset.blockType = this.type;\n    return wrapper;\n  }\n\n  /**\n   * Log debug message\n   */\n  protected log(...args: any[]): void {\n    if (this.debug) {\n      console.log(`[Block:${this.id}]`, ...args);\n    }\n  }\n\n  /**\n   * Log error message\n   */\n  protected error(...args: any[]): void {\n    console.error(`[Block:${this.id}]`, ...args);\n  }\n}\n", "/**\n * ServerBlock - Displays server-side code (read-only)\n */\n\nimport { BaseBlock } from \"./base-block\";\nimport { BlockConfig } from \"../types\";\nimport { PersistenceManager } from \"../core/persistence-manager\";\n\nexport class ServerBlock extends BaseBlock {\n  private codeElement: HTMLElement | null = null;\n\n  constructor(config: BlockConfig, persistence: PersistenceManager, debug = false) {\n    super(config, persistence, debug);\n  }\n\n  initialize(): void {\n    this.log(\"Initializing server block\");\n\n    // Find or create code element\n    this.codeElement = this.element.querySelector(\"code\") || this.element;\n\n    // Add CSS classes for styling\n    this.element.classList.add(\"livepage-server-block\");\n    if (this.metadata.readonly) {\n      this.element.classList.add(\"readonly\");\n    }\n\n    // Add metadata as data attributes\n    this.element.dataset.blockId = this.id;\n    this.element.dataset.language = this.metadata.language;\n\n    // Display initial code\n    this.render();\n\n    this.log(\"Server block initialized\");\n  }\n\n  destroy(): void {\n    this.log(\"Destroying server block\");\n    // No cleanup needed for server blocks\n  }\n\n  handleMessage(action: string, data: any): void {\n    this.log(\"Received message:\", action, data);\n    // Server blocks don't handle messages (they're static)\n    console.warn(`[ServerBlock:${this.id}] Received unexpected message:`, action);\n  }\n\n  private render(): void {\n    if (!this.codeElement) return;\n\n    // Simply display the code (syntax highlighting handled by existing pre/code elements)\n    // The server already rendered this, we're just marking it as a livepage block\n    this.log(\"Rendered server block\");\n  }\n}\n", "/**\n * InteractiveBlock - Wraps a LiveTemplateClient instance for interactive UI\n */\n\nimport { LiveTemplateClient, checkLvtConfirm, extractLvtData } from \"@livetemplate/client\";\nimport { BaseBlock } from \"./base-block\";\nimport { BlockConfig } from \"../types\";\nimport { PersistenceManager } from \"../core/persistence-manager\";\n\nexport class InteractiveBlock extends BaseBlock {\n  private client: LiveTemplateClient | null = null;\n  private containerElement: HTMLElement | null = null;\n  private sendMessage: ((blockID: string, action: string, data: any) => void) | null = null;\n  private pendingForm: HTMLFormElement | null = null;\n  private pendingAction: string | null = null;\n\n  constructor(config: BlockConfig, persistence: PersistenceManager, debug = false) {\n    super(config, persistence, debug);\n  }\n\n  initialize(): void {\n    this.log(\"Initializing interactive block\");\n\n    // Find or create container for the interactive content\n    this.containerElement = this.element.querySelector(\"[data-interactive-content]\") || this.element;\n\n    // Add CSS classes\n    this.element.classList.add(\"livepage-interactive-block\");\n    this.element.dataset.blockId = this.id;\n    if (this.metadata.stateRef) {\n      this.element.dataset.stateRef = this.metadata.stateRef;\n    }\n\n    // Initialize LiveTemplateClient for tree reconciliation\n    // We don't use WebSocket connection - livepage handles that\n    // We only use the client's tree rendering capabilities\n    this.client = new LiveTemplateClient();\n\n    // Attach event handler to intercept lvt-* events\n    this.attachEventHandlers();\n\n    this.log(\"Interactive block initialized\");\n  }\n\n  destroy(): void {\n    this.log(\"Destroying interactive block\");\n    if (this.client) {\n      // Clean up the client instance\n      this.client = null;\n    }\n  }\n\n  handleMessage(action: string, data: any): void {\n    this.log(\"Received message:\", action, data);\n\n    switch (action) {\n      case \"tree\":\n        // Server sent a tree update - apply it to the DOM using LiveTemplateClient\n        if (data && this.containerElement && this.client) {\n          this.client.updateDOM(this.containerElement, data);\n          this.log(\"DOM updated with tree\");\n\n          // Dispatch lifecycle events for pending form (mimics formLifecycleManager)\n          if (this.pendingForm) {\n            const meta = { success: true, errors: {}, action: this.pendingAction };\n\n            // Dispatch lvt:success event from the form\n            // The reactive attribute listeners from @livetemplate/client handle\n            // lvt-reset-on:success and other lvt-{action}-on:{event} attributes\n            this.pendingForm.dispatchEvent(\n              new CustomEvent(\"lvt:success\", { bubbles: true, detail: meta })\n            );\n            this.log(\"Dispatched lvt:success event\");\n\n            this.pendingForm = null;\n            this.pendingAction = null;\n          }\n        }\n        break;\n\n      case \"error\":\n        this.error(\"Server error:\", data.message);\n        // Dispatch lvt:error event for pending form\n        if (this.pendingForm) {\n          const meta = { success: false, errors: data.errors || {}, action: this.pendingAction };\n          this.pendingForm.dispatchEvent(\n            new CustomEvent(\"lvt:error\", { bubbles: true, detail: meta })\n          );\n          this.pendingForm = null;\n          this.pendingAction = null;\n        }\n        break;\n\n      default:\n        this.log(\"Unknown action:\", action);\n    }\n  }\n\n  /**\n   * Set the message sender (called by LivepageClient)\n   */\n  setMessageSender(sender: (blockID: string, action: string, data: any) => void): void {\n    this.sendMessage = sender;\n  }\n\n  /**\n   * Attach event handlers for lvt-* attributes\n   */\n  private attachEventHandlers(): void {\n    if (!this.element) return;\n\n    // Delegate events to our custom handler\n    this.element.addEventListener(\"click\", (e) => this.handleClick(e), true);\n    this.element.addEventListener(\"submit\", (e) => this.handleSubmit(e), true);\n    this.element.addEventListener(\"change\", (e) => this.handleChange(e), true);\n  }\n\n  /**\n   * Handle click events (lvt-click)\n   * Supports lvt-data-* attributes to pass data with the action\n   * Supports lvt-confirm=\"message\" for confirmation dialogs (uses shared utility from @livetemplate/client)\n   * Example: <button lvt-click=\"Delete\" lvt-data-id=\"123\" lvt-confirm=\"Are you sure?\">Delete</button>\n   */\n  private handleClick(e: Event): void {\n    const target = e.target as HTMLElement;\n    const action = target.getAttribute(\"lvt-click\");\n\n    if (action) {\n      e.preventDefault();\n\n      // Check for confirmation dialog (uses shared utility from @livetemplate/client)\n      if (!checkLvtConfirm(target)) {\n        this.log(\"Click action cancelled by user:\", action);\n        return;\n      }\n\n      const data = extractLvtData(target);\n      this.sendAction(action, data);\n      this.log(\"Click action:\", action, data);\n    }\n  }\n\n  /**\n   * Handle submit events (lvt-submit)\n   */\n  private handleSubmit(e: Event): void {\n    const target = e.target as HTMLFormElement;\n    const action = target.getAttribute(\"lvt-submit\");\n\n    if (action) {\n      e.preventDefault();\n      const formData = new FormData(target);\n      const data: Record<string, any> = {};\n      formData.forEach((value, key) => {\n        data[key] = value;\n      });\n\n      // Track form and action for lifecycle events\n      this.pendingForm = target;\n      this.pendingAction = action;\n\n      // Dispatch lvt:pending event\n      target.dispatchEvent(\n        new CustomEvent(\"lvt:pending\", { bubbles: true, detail: { action } })\n      );\n\n      this.sendAction(action, data);\n      this.log(\"Submit action:\", action, data);\n    }\n  }\n\n  /**\n   * Handle change events (lvt-change)\n   */\n  private handleChange(e: Event): void {\n    const target = e.target as HTMLInputElement;\n    const action = target.getAttribute(\"lvt-change\");\n\n    if (action) {\n      const data = { value: target.value };\n      this.sendAction(action, data);\n      this.log(\"Change action:\", action, data);\n    }\n  }\n\n  /**\n   * Send an action to the server\n   */\n  private sendAction(action: string, data: any = {}): void {\n    if (!this.sendMessage) {\n      this.error(\"Cannot send action - no message sender configured\");\n      return;\n    }\n\n    this.sendMessage(this.id, action, data);\n  }\n}\n", "/**\n * Monaco Loader - Load Monaco Editor from CDN on demand\n * This eliminates Monaco from the bundle (~3MB reduction)\n */\n\nimport type * as monaco from \"monaco-editor\";\n\n// Monaco CDN configuration\nconst MONACO_VERSION = \"0.45.0\";\nconst MONACO_CDN_BASE = `https://cdn.jsdelivr.net/npm/monaco-editor@${MONACO_VERSION}/min`;\n\n// Singleton pattern - only load once\nlet monacoInstance: typeof monaco | null = null;\nlet loadingPromise: Promise<typeof monaco> | null = null;\n\n// Declare AMD loader types (avoid conflict with monaco's Window extension)\ninterface AMDRequire {\n  (deps: string[], callback: (...modules: any[]) => void): void;\n  config: (config: any) => void;\n}\n\ndeclare global {\n  interface Window {\n    require: AMDRequire | undefined;\n  }\n}\n\n/**\n * Load the Monaco AMD loader script from CDN\n */\nfunction loadMonacoLoader(): Promise<void> {\n  return new Promise((resolve, reject) => {\n    // Check if loader already exists\n    if (typeof window.require === \"function\") {\n      resolve();\n      return;\n    }\n\n    const script = document.createElement(\"script\");\n    script.src = `${MONACO_CDN_BASE}/vs/loader.js`;\n    script.async = true;\n    script.onload = () => resolve();\n    script.onerror = () => reject(new Error(\"Failed to load Monaco loader from CDN\"));\n    document.head.appendChild(script);\n  });\n}\n\n/**\n * Initialize Monaco environment for workers\n */\nfunction initializeMonacoEnvironment(): void {\n  window.MonacoEnvironment = {\n    getWorkerUrl: function (_moduleId: string, label: string) {\n      // Use CDN for workers\n      const workerMain = `${MONACO_CDN_BASE}/vs/base/worker/workerMain.js`;\n\n      // Return appropriate worker based on language\n      if (label === \"json\") {\n        return `${MONACO_CDN_BASE}/vs/language/json/json.worker.js`;\n      }\n      if (label === \"css\" || label === \"scss\" || label === \"less\") {\n        return `${MONACO_CDN_BASE}/vs/language/css/css.worker.js`;\n      }\n      if (label === \"html\" || label === \"handlebars\" || label === \"razor\") {\n        return `${MONACO_CDN_BASE}/vs/language/html/html.worker.js`;\n      }\n      if (label === \"typescript\" || label === \"javascript\") {\n        return `${MONACO_CDN_BASE}/vs/language/typescript/ts.worker.js`;\n      }\n\n      // Default editor worker\n      return workerMain;\n    },\n  };\n}\n\n/**\n * Lazy load Monaco Editor from CDN\n * @returns Promise that resolves to monaco-editor module\n */\nexport async function loadMonaco(): Promise<typeof monaco> {\n  // Return cached instance if already loaded\n  if (monacoInstance) {\n    return monacoInstance;\n  }\n\n  // Return existing promise if currently loading\n  if (loadingPromise) {\n    return loadingPromise;\n  }\n\n  console.log(\"[MonacoLoader] Loading Monaco Editor from CDN...\");\n  const startTime = performance.now();\n\n  loadingPromise = (async () => {\n    try {\n      // Step 1: Load the AMD loader\n      await loadMonacoLoader();\n\n      // Get the AMD require function\n      const amdRequire = window.require;\n      if (!amdRequire) {\n        throw new Error(\"AMD loader not available after loading\");\n      }\n\n      // Step 2: Configure AMD loader paths\n      amdRequire.config({\n        paths: {\n          vs: `${MONACO_CDN_BASE}/vs`,\n        },\n      });\n\n      // Step 3: Initialize environment before loading\n      initializeMonacoEnvironment();\n\n      // Step 4: Load Monaco editor module\n      return await new Promise<typeof monaco>((resolve, reject) => {\n        amdRequire([\"vs/editor/editor.main\"], (monacoModule: typeof monaco) => {\n          if (!monacoModule) {\n            reject(new Error(\"Monaco module loaded but is undefined\"));\n            return;\n          }\n\n          monacoInstance = monacoModule;\n          const loadTime = Math.round(performance.now() - startTime);\n          console.log(`[MonacoLoader] Monaco Editor loaded from CDN in ${loadTime}ms`);\n          resolve(monacoModule);\n        });\n      });\n    } catch (error) {\n      loadingPromise = null; // Reset on error so we can retry\n      throw error;\n    }\n  })();\n\n  return loadingPromise;\n}\n\n/**\n * Check if Monaco is already loaded\n */\nexport function isMonacoLoaded(): boolean {\n  return monacoInstance !== null;\n}\n\n/**\n * Preload Monaco in the background (optional optimization)\n * Call this early in page lifecycle if you know Monaco will be needed\n */\nexport function preloadMonaco(): void {\n  if (!monacoInstance && !loadingPromise) {\n    // Start loading but don't wait for it\n    loadMonaco().catch((error) => {\n      console.error(\"[MonacoLoader] Failed to preload Monaco from CDN:\", error);\n    });\n  }\n}\n\n/**\n * Check if page has any WASM blocks that need Monaco\n */\nexport function hasEditableBlocks(): boolean {\n  return document.querySelectorAll('[data-block-type=\"wasm\"]').length > 0;\n}\n", "/**\n * MonacoEditor - Wrapper for Monaco Editor with lazy loading\n */\n\nimport type * as monaco from \"monaco-editor\";\nimport { EditorOptions } from \"../types\";\nimport { loadMonaco } from \"./monaco-loader\";\n\nexport class MonacoEditor {\n  private editor: monaco.editor.IStandaloneCodeEditor | null = null;\n  private monaco: typeof monaco | null = null;\n  private container: HTMLElement;\n  private options: EditorOptions;\n  private onChangeCallback: ((code: string) => void) | null = null;\n  private initialCode: string;\n  private editorDiv: HTMLElement | null = null;\n  private initPromise: Promise<void> | null = null;\n\n  constructor(container: HTMLElement, initialCode: string, options: EditorOptions) {\n    this.container = container;\n    this.initialCode = initialCode;\n    this.options = options;\n\n    // Start lazy initialization immediately\n    this.initPromise = this.initialize();\n  }\n\n  private async initialize(): Promise<void> {\n    // Show loading indicator\n    const loadingDiv = document.createElement(\"div\");\n    loadingDiv.className = \"livepage-monaco-loading\";\n    loadingDiv.style.padding = \"2rem\";\n    loadingDiv.style.textAlign = \"center\";\n    loadingDiv.style.color = \"#999\";\n    loadingDiv.textContent = \"Loading editor...\";\n    this.container.appendChild(loadingDiv);\n\n    try {\n      // Lazy load Monaco\n      this.monaco = await loadMonaco();\n\n      // Remove loading indicator\n      loadingDiv.remove();\n\n      // Create editor container\n      this.editorDiv = document.createElement(\"div\");\n      this.editorDiv.className = \"livepage-monaco-editor\";\n      this.editorDiv.style.height = \"300px\"; // Default height\n      this.editorDiv.style.width = \"100%\";\n      this.container.appendChild(this.editorDiv);\n\n      // Initialize Monaco Editor\n      this.editor = this.monaco.editor.create(this.editorDiv, {\n        value: this.initialCode,\n        language: this.options.language,\n        theme: this.options.theme || \"vs-dark\",\n        readOnly: this.options.readonly,\n        minimap: {\n          enabled: this.options.minimap ?? true,\n        },\n        lineNumbers: this.options.lineNumbers !== false ? \"on\" : \"off\",\n        scrollBeyondLastLine: false,\n        automaticLayout: true,\n        fontSize: 14,\n        tabSize: 4,\n        insertSpaces: false, // Use tabs\n      });\n\n      // Listen for content changes\n      this.editor.onDidChangeModelContent(() => {\n        if (this.onChangeCallback && this.editor) {\n          this.onChangeCallback(this.editor.getValue());\n        }\n      });\n    } catch (error) {\n      console.error(\"[MonacoEditor] Failed to load Monaco:\", error);\n      loadingDiv.textContent = \"Failed to load editor\";\n      loadingDiv.style.color = \"#f44\";\n    }\n  }\n\n  /**\n   * Wait for editor to be ready\n   */\n  private async ensureReady(): Promise<void> {\n    if (this.initPromise) {\n      await this.initPromise;\n    }\n  }\n\n  /**\n   * Get current code from editor\n   */\n  getValue(): string {\n    return this.editor?.getValue() || \"\";\n  }\n\n  /**\n   * Set code in editor\n   */\n  async setValue(code: string): Promise<void> {\n    await this.ensureReady();\n    this.editor?.setValue(code);\n  }\n\n  /**\n   * Set onChange callback\n   */\n  onChange(callback: (code: string) => void): void {\n    this.onChangeCallback = callback;\n  }\n\n  /**\n   * Set read-only mode\n   */\n  async setReadOnly(readonly: boolean): Promise<void> {\n    await this.ensureReady();\n    this.editor?.updateOptions({ readOnly: readonly });\n  }\n\n  /**\n   * Focus the editor\n   */\n  async focus(): Promise<void> {\n    await this.ensureReady();\n    this.editor?.focus();\n  }\n\n  /**\n   * Layout the editor (call after resize)\n   */\n  async layout(): Promise<void> {\n    await this.ensureReady();\n    this.editor?.layout();\n  }\n\n  /**\n   * Destroy the editor\n   */\n  destroy(): void {\n    this.editor?.dispose();\n    this.editor = null;\n  }\n\n  /**\n   * Get the underlying Monaco editor instance\n   */\n  async getEditor(): Promise<monaco.editor.IStandaloneCodeEditor | null> {\n    await this.ensureReady();\n    return this.editor;\n  }\n}\n", "/**\n * OutputPanel - Displays execution output (stdout/stderr)\n */\n\nexport interface OutputLine {\n  type: \"stdout\" | \"stderr\" | \"error\" | \"info\";\n  text: string;\n  timestamp: number;\n}\n\nexport class OutputPanel {\n  private element: HTMLElement;\n  private lines: OutputLine[] = [];\n  private maxLines: number;\n  private autoScroll: boolean;\n\n  constructor(container: HTMLElement, maxLines = 1000, autoScroll = true) {\n    this.maxLines = maxLines;\n    this.autoScroll = autoScroll;\n\n    // Create output panel element\n    this.element = this.createPanel();\n    container.appendChild(this.element);\n  }\n\n  private createPanel(): HTMLElement {\n    const panel = document.createElement(\"div\");\n    panel.className = \"livepage-output-panel\";\n    panel.innerHTML = `\n      <div class=\"output-header\">\n        <span class=\"output-title\">Output</span>\n        <button class=\"output-clear\" title=\"Clear output\">Clear</button>\n      </div>\n      <div class=\"output-content\"></div>\n    `;\n\n    // Attach clear button handler\n    const clearBtn = panel.querySelector(\".output-clear\");\n    if (clearBtn) {\n      clearBtn.addEventListener(\"click\", () => this.clear());\n    }\n\n    return panel;\n  }\n\n  /**\n   * Append a line to the output\n   */\n  append(type: OutputLine[\"type\"], text: string): void {\n    const line: OutputLine = {\n      type,\n      text,\n      timestamp: Date.now(),\n    };\n\n    this.lines.push(line);\n\n    // Trim if exceeds max lines\n    if (this.lines.length > this.maxLines) {\n      this.lines = this.lines.slice(-this.maxLines);\n    }\n\n    this.render();\n  }\n\n  /**\n   * Append stdout\n   */\n  stdout(text: string): void {\n    this.append(\"stdout\", text);\n  }\n\n  /**\n   * Append stderr\n   */\n  stderr(text: string): void {\n    this.append(\"stderr\", text);\n  }\n\n  /**\n   * Append error\n   */\n  error(text: string): void {\n    this.append(\"error\", text);\n  }\n\n  /**\n   * Append info message\n   */\n  info(text: string): void {\n    this.append(\"info\", text);\n  }\n\n  /**\n   * Clear all output\n   */\n  clear(): void {\n    this.lines = [];\n    this.render();\n  }\n\n  /**\n   * Show the panel\n   */\n  show(): void {\n    this.element.style.display = \"block\";\n  }\n\n  /**\n   * Hide the panel\n   */\n  hide(): void {\n    this.element.style.display = \"none\";\n  }\n\n  /**\n   * Render the output lines\n   */\n  private render(): void {\n    const content = this.element.querySelector(\".output-content\");\n    if (!content) return;\n\n    // Clear existing content\n    content.innerHTML = \"\";\n\n    // Render each line\n    for (const line of this.lines) {\n      const lineElement = document.createElement(\"div\");\n      lineElement.className = `output-line output-${line.type}`;\n      lineElement.textContent = line.text;\n      content.appendChild(lineElement);\n    }\n\n    // Auto-scroll to bottom\n    if (this.autoScroll) {\n      content.scrollTop = content.scrollHeight;\n    }\n  }\n\n  /**\n   * Get the panel element\n   */\n  getElement(): HTMLElement {\n    return this.element;\n  }\n\n  /**\n   * Destroy the panel\n   */\n  destroy(): void {\n    this.element.remove();\n  }\n}\n", "/**\n * RunButton - Button for executing WASM code\n */\n\nexport type RunButtonCallback = () => void | Promise<void>;\n\nexport class RunButton {\n  private element: HTMLButtonElement;\n  private callback: RunButtonCallback | null = null;\n  private isRunning = false;\n\n  constructor(container: HTMLElement, label = \"Run\") {\n    this.element = this.createButton(label);\n    container.appendChild(this.element);\n  }\n\n  private createButton(label: string): HTMLButtonElement {\n    const button = document.createElement(\"button\");\n    button.className = \"livepage-run-button\";\n    button.textContent = label;\n    button.addEventListener(\"click\", () => this.handleClick());\n    return button;\n  }\n\n  /**\n   * Set the click callback\n   */\n  onClick(callback: RunButtonCallback): void {\n    this.callback = callback;\n  }\n\n  /**\n   * Handle button click\n   */\n  private async handleClick(): Promise<void> {\n    if (this.isRunning || !this.callback) return;\n\n    this.setRunning(true);\n\n    try {\n      await this.callback();\n    } catch (error) {\n      console.error(\"[RunButton] Error executing callback:\", error);\n    } finally {\n      this.setRunning(false);\n    }\n  }\n\n  /**\n   * Set running state\n   */\n  setRunning(running: boolean): void {\n    this.isRunning = running;\n    this.element.disabled = running;\n\n    if (running) {\n      this.element.classList.add(\"running\");\n      this.element.textContent = \"Running...\";\n    } else {\n      this.element.classList.remove(\"running\");\n      this.element.textContent = \"Run\";\n    }\n  }\n\n  /**\n   * Enable the button\n   */\n  enable(): void {\n    this.element.disabled = false;\n  }\n\n  /**\n   * Disable the button\n   */\n  disable(): void {\n    this.element.disabled = true;\n  }\n\n  /**\n   * Get the button element\n   */\n  getElement(): HTMLButtonElement {\n    return this.element;\n  }\n\n  /**\n   * Destroy the button\n   */\n  destroy(): void {\n    this.element.remove();\n  }\n}\n", "/**\n * TinyGoExecutor - Executes Go code via WASM\n *\n * TODO: Client-side TinyGo compilation requires further research.\n * Options:\n * 1. Server-side compilation endpoint (simpler, requires backend)\n * 2. TinyGo compiled to WASM running in browser (complex, large bundle)\n * 3. Hybrid: cache compiled WASM, fallback to server\n *\n * For MVP, we'll implement server-side compilation approach.\n */\n\nimport { WasmExecutionResult } from \"../types\";\n\nexport class TinyGoExecutor {\n  private serverUrl: string;\n  private debug: boolean;\n\n  constructor(serverUrl = \"/api/compile\", debug = false) {\n    this.serverUrl = serverUrl;\n    this.debug = debug;\n  }\n\n  /**\n   * Execute Go code (server-side compilation)\n   */\n  async execute(code: string): Promise<WasmExecutionResult> {\n    if (this.debug) {\n      console.log(\"[TinyGoExecutor] Executing code:\", code);\n    }\n\n    try {\n      // Send code to server for compilation\n      const response = await fetch(this.serverUrl, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ code }),\n      });\n\n      if (!response.ok) {\n        const error = await response.text();\n        return {\n          stdout: \"\",\n          stderr: error,\n          error: `Compilation failed: ${error}`,\n          exitCode: 1,\n        };\n      }\n\n      // Get compiled WASM binary\n      const wasmBuffer = await response.arrayBuffer();\n\n      // Execute WASM\n      return await this.executeWasm(wasmBuffer);\n    } catch (error) {\n      const errorMsg = error instanceof Error ? error.message : String(error);\n      return {\n        stdout: \"\",\n        stderr: \"\",\n        error: `Execution failed: ${errorMsg}`,\n        exitCode: 1,\n      };\n    }\n  }\n\n  /**\n   * Execute compiled WASM binary\n   */\n  private async executeWasm(wasmBuffer: ArrayBuffer): Promise<WasmExecutionResult> {\n    let stdout = \"\";\n    let stderr = \"\";\n\n    try {\n      // Create Go WASM environment\n      const go = new (window as any).Go();\n\n      // Capture stdout\n      const originalLog = console.log;\n      const originalError = console.error;\n\n      console.log = (...args: any[]) => {\n        stdout += args.join(\" \") + \"\\n\";\n      };\n\n      console.error = (...args: any[]) => {\n        stderr += args.join(\" \") + \"\\n\";\n      };\n\n      // Instantiate and run WASM\n      const result = await WebAssembly.instantiate(wasmBuffer, go.importObject);\n      await go.run(result.instance);\n\n      // Restore console\n      console.log = originalLog;\n      console.error = originalError;\n\n      return {\n        stdout,\n        stderr,\n        exitCode: 0,\n      };\n    } catch (error) {\n      const errorMsg = error instanceof Error ? error.message : String(error);\n      return {\n        stdout,\n        stderr,\n        error: `WASM execution failed: ${errorMsg}`,\n        exitCode: 1,\n      };\n    }\n  }\n\n  /**\n   * Check if TinyGo/WASM is supported\n   */\n  static isSupported(): boolean {\n    return (\n      typeof WebAssembly !== \"undefined\" &&\n      typeof (window as any).Go !== \"undefined\"\n    );\n  }\n}\n\n/**\n * Initialize WASM environment (loads wasm_exec.js from TinyGo)\n */\nexport async function initializeWasm(): Promise<void> {\n  if ((window as any).Go) {\n    return; // Already initialized\n  }\n\n  try {\n    // Load TinyGo's wasm_exec.js\n    const script = document.createElement(\"script\");\n    script.src = \"/assets/wasm_exec.js\";\n\n    await new Promise<void>((resolve, reject) => {\n      script.onload = () => resolve();\n      script.onerror = () => reject(new Error(\"Failed to load wasm_exec.js\"));\n      document.head.appendChild(script);\n    });\n\n    console.log(\"[TinyGoExecutor] WASM environment initialized\");\n  } catch (error) {\n    console.error(\"[TinyGoExecutor] Failed to initialize WASM:\", error);\n    throw error;\n  }\n}\n", "/**\n * WasmBlock - Editable code block with WASM execution\n */\n\nimport { BaseBlock } from \"./base-block\";\nimport { BlockConfig } from \"../types\";\nimport { PersistenceManager } from \"../core/persistence-manager\";\nimport { MonacoEditor } from \"../editor/monaco-editor\";\nimport { OutputPanel } from \"../ui/output-panel\";\nimport { RunButton } from \"../ui/run-button\";\nimport { TinyGoExecutor } from \"../wasm/tinygo-executor\";\n\nexport class WasmBlock extends BaseBlock {\n  private editor: MonacoEditor | null = null;\n  private outputPanel: OutputPanel | null = null;\n  private runButton: RunButton | null = null;\n  private executor: TinyGoExecutor | null = null;\n  private containerElement: HTMLElement | null = null;\n  private editorContainer: HTMLElement | null = null;\n  private controlsContainer: HTMLElement | null = null;\n\n  constructor(config: BlockConfig, persistence: PersistenceManager, debug = false) {\n    super(config, persistence, debug);\n  }\n\n  initialize(): void {\n    this.log(\"Initializing WASM block\");\n\n    // Load persisted code\n    this.currentCode = this.loadPersistedCode();\n\n    // Create block structure\n    this.createBlockStructure();\n\n    // Initialize components\n    this.initializeEditor();\n    this.initializeControls();\n    this.initializeExecutor();\n\n    this.log(\"WASM block initialized\");\n  }\n\n  destroy(): void {\n    this.log(\"Destroying WASM block\");\n\n    this.editor?.destroy();\n    this.outputPanel?.destroy();\n    this.runButton?.destroy();\n\n    this.editor = null;\n    this.outputPanel = null;\n    this.runButton = null;\n    this.executor = null;\n  }\n\n  handleMessage(action: string, data: any): void {\n    this.log(\"Received message:\", action, data);\n    // WASM blocks don't receive messages from server (client-side execution)\n  }\n\n  /**\n   * Create the block structure\n   */\n  private createBlockStructure(): void {\n    // Wrap existing element or create new structure\n    this.containerElement = document.createElement(\"div\");\n    this.containerElement.className = \"livepage-wasm-block\";\n    this.containerElement.dataset.blockId = this.id;\n\n    // Editor container\n    this.editorContainer = document.createElement(\"div\");\n    this.editorContainer.className = \"wasm-editor-container\";\n    this.containerElement.appendChild(this.editorContainer);\n\n    // Controls container (run button, reset, etc.)\n    this.controlsContainer = document.createElement(\"div\");\n    this.controlsContainer.className = \"wasm-controls\";\n    this.containerElement.appendChild(this.controlsContainer);\n\n    // Replace or append to original element\n    if (this.element.parentNode) {\n      this.element.parentNode.replaceChild(this.containerElement, this.element);\n    }\n  }\n\n  /**\n   * Initialize Monaco editor\n   */\n  private initializeEditor(): void {\n    if (!this.editorContainer) return;\n\n    this.editor = new MonacoEditor(\n      this.editorContainer,\n      this.currentCode,\n      {\n        language: this.metadata.language || \"go\",\n        readonly: this.metadata.readonly || false,\n        theme: \"vs-dark\",\n        minimap: false,\n        lineNumbers: true,\n      }\n    );\n\n    // Save code changes to persistence\n    this.editor.onChange((code) => {\n      this.setCode(code);\n    });\n\n    this.log(\"Editor initialized\");\n  }\n\n  /**\n   * Initialize controls (run button, reset, etc.)\n   */\n  private initializeControls(): void {\n    if (!this.controlsContainer) return;\n\n    // Create button container\n    const buttonContainer = document.createElement(\"div\");\n    buttonContainer.className = \"wasm-buttons\";\n\n    // Run button\n    this.runButton = new RunButton(buttonContainer, \"Run\");\n    this.runButton.onClick(() => this.executeCode());\n\n    // Reset button\n    const resetButton = document.createElement(\"button\");\n    resetButton.className = \"livepage-reset-button\";\n    resetButton.textContent = \"Reset\";\n    resetButton.addEventListener(\"click\", () => this.resetCode());\n    buttonContainer.appendChild(resetButton);\n\n    this.controlsContainer.appendChild(buttonContainer);\n\n    // Output panel\n    this.outputPanel = new OutputPanel(this.controlsContainer);\n    this.outputPanel.hide(); // Hide until first run\n\n    this.log(\"Controls initialized\");\n  }\n\n  /**\n   * Initialize WASM executor\n   */\n  private initializeExecutor(): void {\n    this.executor = new TinyGoExecutor(\"/api/compile\", this.debug);\n    this.log(\"Executor initialized\");\n  }\n\n  /**\n   * Execute the current code\n   */\n  private async executeCode(): Promise<void> {\n    if (!this.editor || !this.executor || !this.outputPanel) {\n      this.error(\"Cannot execute - components not initialized\");\n      return;\n    }\n\n    const code = this.editor.getValue();\n\n    this.log(\"Executing code\");\n    this.outputPanel.clear();\n    this.outputPanel.show();\n    this.outputPanel.info(\"Compiling and running...\");\n\n    try {\n      const result = await this.executor.execute(code);\n\n      // Clear \"Compiling...\" message\n      this.outputPanel.clear();\n\n      // Display output\n      if (result.stdout) {\n        this.outputPanel.stdout(result.stdout);\n      }\n\n      if (result.stderr) {\n        this.outputPanel.stderr(result.stderr);\n      }\n\n      if (result.error) {\n        this.outputPanel.error(result.error);\n      }\n\n      if (result.exitCode === 0 && !result.stdout && !result.stderr) {\n        this.outputPanel.info(\"Program completed successfully (no output)\");\n      }\n\n      this.log(\"Execution completed with exit code:\", result.exitCode);\n    } catch (error) {\n      const errorMsg = error instanceof Error ? error.message : String(error);\n      this.outputPanel.error(`Execution error: ${errorMsg}`);\n      this.error(\"Execution error:\", error);\n    }\n  }\n\n  /**\n   * Reset code to initial state\n   */\n  private resetCode(): void {\n    if (!this.editor) return;\n\n    this.editor.setValue(this.initialCode);\n    this.setCode(this.initialCode);\n    this.outputPanel?.clear();\n    this.log(\"Code reset to initial state\");\n  }\n}\n", "/**\n * Tutorial Step Navigation\n *\n * Provides navigation controls for multi-step tutorials including:\n * - Sidebar table of contents\n * - Bottom navigation bar (prev/next buttons)\n * - Keyboard shortcuts\n * - URL hash support for deep linking\n * - Smooth scrolling between sections\n */\n\nexport interface TutorialStep {\n  id: string;\n  title: string;\n  element: HTMLElement;\n  index: number;\n}\n\nexport class TutorialNavigation {\n  private steps: TutorialStep[] = [];\n  private currentStepIndex: number = 0;\n  private sidebar: HTMLElement | null = null;\n  private bottomNav: HTMLElement | null = null;\n\n  constructor() {\n    this.init();\n  }\n\n  private init() {\n    // Skip tutorial navigation if site navigation exists\n    if (document.querySelector('.livepage-nav-sidebar')) {\n      return; // Site mode - navigation already rendered by server\n    }\n\n    // Parse H2 headings as tutorial steps\n    this.parseSteps();\n\n    if (this.steps.length === 0) {\n      return; // No multi-step tutorial\n    }\n\n    // Create navigation UI\n    this.createSidebar();\n    this.createBottomNav();\n\n    // Set up event listeners\n    this.setupKeyboardShortcuts();\n    this.setupHashNavigation();\n    this.setupScrollTracking();\n\n    // Initialize from URL hash or show first step\n    this.initializeFromHash();\n  }\n\n  private parseSteps() {\n    const headings = document.querySelectorAll('h2');\n\n    headings.forEach((heading, index) => {\n      const id = heading.id || this.generateId(heading.textContent || '');\n\n      // Ensure heading has an ID for navigation\n      if (!heading.id) {\n        heading.id = id;\n      }\n\n      this.steps.push({\n        id,\n        title: heading.textContent || '',\n        element: heading as HTMLElement,\n        index\n      });\n    });\n  }\n\n  private generateId(text: string): string {\n    return text\n      .toLowerCase()\n      .replace(/[^\\w\\s-]/g, '')\n      .replace(/\\s+/g, '-')\n      .replace(/-+/g, '-')\n      .trim();\n  }\n\n  private createSidebar() {\n    // Create sidebar container\n    this.sidebar = document.createElement('nav');\n    this.sidebar.className = 'livepage-nav-sidebar';\n    this.sidebar.innerHTML = `\n      <div class=\"nav-sidebar-header\">\n        <h3>Contents</h3>\n      </div>\n      <ol class=\"nav-sidebar-steps\">\n        ${this.steps.map((step, i) => `\n          <li class=\"nav-step ${i === 0 ? 'active' : ''}\" data-step=\"${i}\">\n            <a href=\"#${step.id}\">\n              <span class=\"step-number\">${i + 1}</span>\n              <span class=\"step-title\">${step.title}</span>\n            </a>\n          </li>\n        `).join('')}\n      </ol>\n    `;\n\n    // Add click handlers\n    this.sidebar.querySelectorAll('.nav-step').forEach((stepEl, i) => {\n      stepEl.addEventListener('click', (e) => {\n        e.preventDefault();\n        this.navigateToStep(i);\n      });\n    });\n\n    document.body.appendChild(this.sidebar);\n  }\n\n  private createBottomNav() {\n    this.bottomNav = document.createElement('nav');\n    this.bottomNav.className = 'livepage-nav-bottom';\n    this.bottomNav.innerHTML = `\n      <button class=\"nav-btn nav-prev\" ${this.currentStepIndex === 0 ? 'disabled' : ''}>\n        <span class=\"nav-arrow\">\u2190</span>\n        <span class=\"nav-label\">Previous</span>\n      </button>\n      <span class=\"nav-progress\">\n        Step <span class=\"current-step\">1</span> of <span class=\"total-steps\">${this.steps.length}</span>\n      </span>\n      <button class=\"nav-btn nav-next\" ${this.currentStepIndex === this.steps.length - 1 ? 'disabled' : ''}>\n        <span class=\"nav-label\">Next</span>\n        <span class=\"nav-arrow\">\u2192</span>\n      </button>\n    `;\n\n    // Add click handlers\n    const prevBtn = this.bottomNav.querySelector('.nav-prev');\n    const nextBtn = this.bottomNav.querySelector('.nav-next');\n\n    prevBtn?.addEventListener('click', () => this.navigatePrev());\n    nextBtn?.addEventListener('click', () => this.navigateNext());\n\n    document.body.appendChild(this.bottomNav);\n  }\n\n  private setupKeyboardShortcuts() {\n    document.addEventListener('keydown', (e) => {\n      // Ignore if user is typing in an input\n      if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) {\n        return;\n      }\n\n      switch (e.key) {\n        case 'ArrowRight':\n        case 'ArrowDown':\n          e.preventDefault();\n          this.navigateNext();\n          break;\n        case 'ArrowLeft':\n        case 'ArrowUp':\n          e.preventDefault();\n          this.navigatePrev();\n          break;\n      }\n    });\n  }\n\n  private setupHashNavigation() {\n    window.addEventListener('hashchange', () => {\n      this.handleHashChange();\n    });\n  }\n\n  private setupScrollTracking() {\n    // Track which section is currently visible\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            const heading = entry.target as HTMLElement;\n            const stepIndex = this.steps.findIndex(s => s.element === heading);\n            if (stepIndex !== -1 && stepIndex !== this.currentStepIndex) {\n              this.updateCurrentStep(stepIndex, false); // Don't scroll, just update UI\n            }\n          }\n        });\n      },\n      {\n        threshold: 0.5,\n        rootMargin: '-100px 0px -50% 0px'\n      }\n    );\n\n    this.steps.forEach(step => observer.observe(step.element));\n  }\n\n  private initializeFromHash() {\n    const hash = window.location.hash.slice(1);\n    if (hash) {\n      const stepIndex = this.steps.findIndex(s => s.id === hash);\n      if (stepIndex !== -1) {\n        this.navigateToStep(stepIndex);\n        return;\n      }\n    }\n\n    // Default to first step\n    this.updateCurrentStep(0, false);\n  }\n\n  private handleHashChange() {\n    const hash = window.location.hash.slice(1);\n    if (hash) {\n      const stepIndex = this.steps.findIndex(s => s.id === hash);\n      if (stepIndex !== -1) {\n        this.navigateToStep(stepIndex, false); // Don't update hash again\n      }\n    }\n  }\n\n  private navigateToStep(index: number, updateHash: boolean = true) {\n    if (index < 0 || index >= this.steps.length) {\n      return;\n    }\n\n    this.updateCurrentStep(index, true);\n\n    if (updateHash) {\n      history.pushState(null, '', `#${this.steps[index].id}`);\n    }\n  }\n\n  private navigateNext() {\n    if (this.currentStepIndex < this.steps.length - 1) {\n      this.navigateToStep(this.currentStepIndex + 1);\n    }\n  }\n\n  private navigatePrev() {\n    if (this.currentStepIndex > 0) {\n      this.navigateToStep(this.currentStepIndex - 1);\n    }\n  }\n\n  private updateCurrentStep(index: number, scroll: boolean = true) {\n    this.currentStepIndex = index;\n\n    // Update sidebar\n    if (this.sidebar) {\n      this.sidebar.querySelectorAll('.nav-step').forEach((el, i) => {\n        el.classList.toggle('active', i === index);\n      });\n    }\n\n    // Update bottom nav\n    if (this.bottomNav) {\n      const prevBtn = this.bottomNav.querySelector('.nav-prev') as HTMLButtonElement;\n      const nextBtn = this.bottomNav.querySelector('.nav-next') as HTMLButtonElement;\n      const currentStepEl = this.bottomNav.querySelector('.current-step');\n\n      if (prevBtn) prevBtn.disabled = index === 0;\n      if (nextBtn) nextBtn.disabled = index === this.steps.length - 1;\n      if (currentStepEl) currentStepEl.textContent = String(index + 1);\n    }\n\n    // Scroll to step\n    if (scroll) {\n      this.scrollToStep(index);\n    }\n  }\n\n  private scrollToStep(index: number) {\n    const step = this.steps[index];\n    if (!step) return;\n\n    step.element.scrollIntoView({\n      behavior: 'smooth',\n      block: 'start'\n    });\n  }\n\n  // Public API\n  public getCurrentStep(): number {\n    return this.currentStepIndex;\n  }\n\n  public getTotalSteps(): number {\n    return this.steps.length;\n  }\n\n  public goToStep(index: number) {\n    this.navigateToStep(index);\n  }\n}\n", "/**\n * Search Functionality for Site Mode\n *\n * Provides client-side search across all pages with:\n * - Fuzzy search through titles and content\n * - Keyboard shortcuts (Ctrl+K / Cmd+K)\n * - Search result highlighting\n * - Modal/overlay UI\n */\n\nimport './search.css';\n\nexport interface SearchEntry {\n  title: string;\n  path: string;\n  content: string;\n  section?: string;\n}\n\nexport interface SearchResult extends SearchEntry {\n  score: number;\n  titleMatches: boolean;\n  contentMatches: boolean;\n}\n\nexport class SiteSearch {\n  public searchIndex: SearchEntry[] = []; // Made public for testing\n  private searchModal: HTMLElement | null = null;\n  private searchInput: HTMLInputElement | null = null;\n  private resultsContainer: HTMLElement | null = null;\n  private selectedIndex: number = 0;\n\n  constructor() {\n    // Only initialize in site mode\n    if (!document.querySelector('.livepage-nav-sidebar')) {\n      return;\n    }\n\n    this.init();\n  }\n\n  private async init() {\n    // Load search index\n    await this.loadSearchIndex();\n\n    // Create search UI\n    this.createSearchModal();\n\n    // Setup keyboard shortcuts\n    this.setupKeyboardShortcuts();\n\n    // Add search button to navigation\n    this.addSearchButton();\n  }\n\n  private async loadSearchIndex() {\n    try {\n      const response = await fetch('/search-index.json');\n      if (!response.ok) {\n        console.warn('[Search] Failed to load search index');\n        return;\n      }\n\n      this.searchIndex = await response.json();\n      console.log(`[Search] Loaded ${this.searchIndex.length} pages`);\n    } catch (error) {\n      console.error('[Search] Error loading search index:', error);\n    }\n  }\n\n  private createSearchModal() {\n    this.searchModal = document.createElement('div');\n    this.searchModal.className = 'search-modal';\n    this.searchModal.innerHTML = `\n      <div class=\"search-backdrop\"></div>\n      <div class=\"search-container\">\n        <div class=\"search-input-wrapper\">\n          <svg class=\"search-icon\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\n          </svg>\n          <input\n            type=\"text\"\n            class=\"search-input\"\n            placeholder=\"Search documentation...\"\n            autocomplete=\"off\"\n            spellcheck=\"false\"\n          />\n          <button class=\"search-close\" aria-label=\"Close search\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\n            </svg>\n          </button>\n        </div>\n        <div class=\"search-results\"></div>\n        <div class=\"search-footer\">\n          <div class=\"search-hints\">\n            <span><kbd>\u2191</kbd><kbd>\u2193</kbd> Navigate</span>\n            <span><kbd>\u21B5</kbd> Select</span>\n            <span><kbd>Esc</kbd> Close</span>\n          </div>\n        </div>\n      </div>\n    `;\n\n    document.body.appendChild(this.searchModal);\n\n    // Get references\n    this.searchInput = this.searchModal.querySelector('.search-input');\n    this.resultsContainer = this.searchModal.querySelector('.search-results');\n\n    // Setup event listeners\n    this.searchInput?.addEventListener('input', () => this.handleSearch());\n    this.searchInput?.addEventListener('keydown', (e) => this.handleKeyDown(e));\n\n    this.searchModal.querySelector('.search-close')?.addEventListener('click', () => this.closeSearch());\n    this.searchModal.querySelector('.search-backdrop')?.addEventListener('click', () => this.closeSearch());\n  }\n\n  private addSearchButton() {\n    const sidebar = document.querySelector('.livepage-nav-sidebar');\n    if (!sidebar) return;\n\n    const header = sidebar.querySelector('.nav-header');\n    if (!header) return;\n\n    const searchButton = document.createElement('button');\n    searchButton.className = 'search-button';\n    searchButton.innerHTML = `\n      <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\n      </svg>\n      <span>Search</span>\n      <kbd>\u2318K</kbd>\n    `;\n    searchButton.addEventListener('click', () => this.openSearch());\n\n    header.appendChild(searchButton);\n  }\n\n  private setupKeyboardShortcuts() {\n    document.addEventListener('keydown', (e) => {\n      // Ctrl+K or Cmd+K\n      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {\n        e.preventDefault();\n        this.openSearch();\n      }\n\n      // Escape to close\n      if (e.key === 'Escape' && this.searchModal?.classList.contains('open')) {\n        this.closeSearch();\n      }\n    });\n  }\n\n  private openSearch() {\n    this.searchModal?.classList.add('open');\n    this.searchInput?.focus();\n    this.selectedIndex = 0;\n  }\n\n  private closeSearch() {\n    this.searchModal?.classList.remove('open');\n    if (this.searchInput) {\n      this.searchInput.value = '';\n    }\n    if (this.resultsContainer) {\n      this.resultsContainer.innerHTML = '';\n    }\n  }\n\n  private handleSearch() {\n    const query = this.searchInput?.value.trim() || '';\n\n    if (query.length === 0) {\n      if (this.resultsContainer) {\n        this.resultsContainer.innerHTML = '';\n      }\n      return;\n    }\n\n    const results = this.search(query);\n    this.renderResults(results);\n  }\n\n  private search(query: string): SearchResult[] {\n    const lowerQuery = query.toLowerCase();\n    const results: SearchResult[] = [];\n\n    for (const entry of this.searchIndex) {\n      const lowerTitle = entry.title.toLowerCase();\n      const lowerContent = entry.content.toLowerCase();\n\n      const titleMatches = lowerTitle.includes(lowerQuery);\n      const contentMatches = lowerContent.includes(lowerQuery);\n\n      if (titleMatches || contentMatches) {\n        // Calculate score (title matches are worth more)\n        let score = 0;\n        if (titleMatches) {\n          score += 10;\n          // Exact match or starts with gets bonus\n          if (lowerTitle === lowerQuery) score += 50;\n          else if (lowerTitle.startsWith(lowerQuery)) score += 20;\n        }\n        if (contentMatches) {\n          score += 1;\n        }\n\n        results.push({\n          ...entry,\n          score,\n          titleMatches,\n          contentMatches,\n        });\n      }\n    }\n\n    // Sort by score (highest first)\n    results.sort((a, b) => b.score - a.score);\n\n    // Limit to top 10 results\n    return results.slice(0, 10);\n  }\n\n  private renderResults(results: SearchResult[]) {\n    if (!this.resultsContainer) return;\n\n    if (results.length === 0) {\n      this.resultsContainer.innerHTML = '<div class=\"search-no-results\">No results found</div>';\n      return;\n    }\n\n    this.resultsContainer.innerHTML = results.map((result, index) => `\n      <a\n        href=\"${result.path}\"\n        class=\"search-result ${index === this.selectedIndex ? 'selected' : ''}\"\n        data-index=\"${index}\"\n      >\n        <div class=\"search-result-title\">\n          ${this.highlightMatch(result.title, this.searchInput?.value || '')}\n        </div>\n        ${result.section ? `<div class=\"search-result-section\">${result.section}</div>` : ''}\n        <div class=\"search-result-content\">\n          ${this.highlightMatch(this.truncateContent(result.content), this.searchInput?.value || '')}\n        </div>\n      </a>\n    `).join('');\n\n    // Add click handlers\n    this.resultsContainer.querySelectorAll('.search-result').forEach((el) => {\n      el.addEventListener('click', () => this.closeSearch());\n    });\n  }\n\n  private highlightMatch(text: string, query: string): string {\n    if (!query) return text;\n\n    const regex = new RegExp(`(${this.escapeRegex(query)})`, 'gi');\n    return text.replace(regex, '<mark>$1</mark>');\n  }\n\n  private truncateContent(content: string, maxLength: number = 200): string {\n    if (content.length <= maxLength) return content;\n    return content.substring(0, maxLength) + '...';\n  }\n\n  private escapeRegex(str: string): string {\n    return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n  }\n\n  private handleKeyDown(e: KeyboardEvent) {\n    if (!this.resultsContainer) return;\n\n    const results = this.resultsContainer.querySelectorAll('.search-result');\n\n    switch (e.key) {\n      case 'Escape':\n        e.preventDefault();\n        this.closeSearch();\n        break;\n\n      case 'ArrowDown':\n        if (results.length === 0) return;\n        e.preventDefault();\n        this.selectedIndex = Math.min(this.selectedIndex + 1, results.length - 1);\n        this.updateSelection();\n        break;\n\n      case 'ArrowUp':\n        if (results.length === 0) return;\n        e.preventDefault();\n        this.selectedIndex = Math.max(this.selectedIndex - 1, 0);\n        this.updateSelection();\n        break;\n\n      case 'Enter':\n        if (results.length === 0) return;\n        e.preventDefault();\n        const selected = results[this.selectedIndex] as HTMLAnchorElement;\n        if (selected) {\n          window.location.href = selected.href;\n          this.closeSearch();\n        }\n        break;\n    }\n  }\n\n  private updateSelection() {\n    if (!this.resultsContainer) return;\n\n    const results = this.resultsContainer.querySelectorAll('.search-result');\n    results.forEach((el, index) => {\n      el.classList.toggle('selected', index === this.selectedIndex);\n    });\n\n    // Scroll selected result into view\n    const selected = results[this.selectedIndex] as HTMLElement;\n    if (selected) {\n      selected.scrollIntoView({ block: 'nearest', behavior: 'smooth' });\n    }\n  }\n}\n", "/**\n * Code Copy Button Functionality\n * Adds copy buttons to all code blocks in documentation\n */\n\nimport './code-copy.css';\n\nexport class CodeCopy {\n  private static readonly COPY_BUTTON_CLASS = 'code-copy-btn';\n  private static readonly CODE_WRAPPER_CLASS = 'code-block-wrapper';\n  private static readonly COPIED_CLASS = 'copied';\n\n  constructor() {\n    this.init();\n  }\n\n  /**\n   * Initialize code copy functionality\n   */\n  private init(): void {\n    // Wait for DOM to be ready\n    if (document.readyState === 'loading') {\n      document.addEventListener('DOMContentLoaded', () => this.addCopyButtons());\n    } else {\n      this.addCopyButtons();\n    }\n  }\n\n  /**\n   * Add copy buttons to all pre > code blocks\n   */\n  private addCopyButtons(): void {\n    const codeBlocks = document.querySelectorAll('pre > code');\n\n    codeBlocks.forEach((codeElement) => {\n      const pre = codeElement.parentElement;\n      if (!pre || pre.querySelector(`.${CodeCopy.COPY_BUTTON_CLASS}`)) {\n        // Already has a copy button\n        return;\n      }\n\n      // Wrap pre in a container for positioning\n      if (!pre.parentElement?.classList.contains(CodeCopy.CODE_WRAPPER_CLASS)) {\n        const wrapper = document.createElement('div');\n        wrapper.className = CodeCopy.CODE_WRAPPER_CLASS;\n        pre.parentNode?.insertBefore(wrapper, pre);\n        wrapper.appendChild(pre);\n      }\n\n      // Create copy button\n      const button = this.createCopyButton();\n      pre.appendChild(button);\n\n      // Add click handler\n      button.addEventListener('click', (e) => {\n        e.preventDefault();\n        this.copyCode(codeElement as HTMLElement, button);\n      });\n    });\n  }\n\n  /**\n   * Create copy button element\n   */\n  private createCopyButton(): HTMLButtonElement {\n    const button = document.createElement('button');\n    button.className = CodeCopy.COPY_BUTTON_CLASS;\n    button.setAttribute('aria-label', 'Copy code to clipboard');\n    button.innerHTML = this.getCopyIcon();\n    return button;\n  }\n\n  /**\n   * Copy code to clipboard\n   */\n  private async copyCode(codeElement: HTMLElement, button: HTMLButtonElement): Promise<void> {\n    const code = codeElement.textContent || '';\n\n    try {\n      await navigator.clipboard.writeText(code);\n      this.showCopiedFeedback(button);\n    } catch (err) {\n      console.error('Failed to copy code:', err);\n      // Fallback for older browsers\n      this.fallbackCopy(code, button);\n    }\n  }\n\n  /**\n   * Show \"Copied!\" feedback\n   */\n  private showCopiedFeedback(button: HTMLButtonElement): void {\n    button.classList.add(CodeCopy.COPIED_CLASS);\n    button.innerHTML = this.getCheckIcon();\n    button.setAttribute('aria-label', 'Code copied!');\n\n    setTimeout(() => {\n      button.classList.remove(CodeCopy.COPIED_CLASS);\n      button.innerHTML = this.getCopyIcon();\n      button.setAttribute('aria-label', 'Copy code to clipboard');\n    }, 2000);\n  }\n\n  /**\n   * Fallback copy method for older browsers\n   */\n  private fallbackCopy(text: string, button: HTMLButtonElement): void {\n    const textarea = document.createElement('textarea');\n    textarea.value = text;\n    textarea.style.position = 'fixed';\n    textarea.style.opacity = '0';\n    document.body.appendChild(textarea);\n    textarea.select();\n\n    try {\n      document.execCommand('copy');\n      this.showCopiedFeedback(button);\n    } catch (err) {\n      console.error('Fallback copy failed:', err);\n    } finally {\n      document.body.removeChild(textarea);\n    }\n  }\n\n  /**\n   * Get copy icon SVG\n   */\n  private getCopyIcon(): string {\n    return `\n      <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path d=\"M10.5 2H3.5C2.67 2 2 2.67 2 3.5V10.5\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n        <rect x=\"5.5\" y=\"5.5\" width=\"8\" height=\"8\" rx=\"1\" stroke=\"currentColor\" stroke-width=\"1.5\"/>\n      </svg>\n    `;\n  }\n\n  /**\n   * Get check icon SVG (for \"copied\" state)\n   */\n  private getCheckIcon(): string {\n    return `\n      <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path d=\"M3 8L6.5 11.5L13 4\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n      </svg>\n    `;\n  }\n}\n", "/**\n * Page Table of Contents (TOC)\n *\n * Adds on-page navigation for H2 sections in documentation pages.\n * This is specifically for site-mode pages that already have site navigation sidebar.\n * Unlike TutorialNavigation (which creates its own sidebar), PageTOC adds a\n * section to the existing sidebar showing H2 sections within the current page.\n */\n\nimport './page-toc.css';\n\nexport interface PageSection {\n  id: string;\n  title: string;\n  element: HTMLElement;\n  index: number;\n}\n\nexport class PageTOC {\n  private sections: PageSection[] = [];\n  private tocElement: HTMLElement | null = null;\n  private currentActiveSection: number = -1;\n\n  constructor() {\n    this.init();\n  }\n\n  private init() {\n    // Only run in site mode (when site navigation sidebar exists)\n    const siteNav = document.querySelector('.livepage-nav-sidebar');\n    if (!siteNav) {\n      return; // Not in site mode\n    }\n\n    // Parse H2 headings as page sections\n    this.parseSections();\n\n    if (this.sections.length === 0) {\n      return; // No sections to show\n    }\n\n    // Create TOC UI in the sidebar\n    this.createTOC();\n\n    // Set up scroll tracking to highlight current section\n    this.setupScrollTracking();\n  }\n\n  private parseSections() {\n    // Find all H2 elements within .content-wrapper\n    const headings = document.querySelectorAll('.content-wrapper h2');\n\n    headings.forEach((heading, index) => {\n      const id = heading.id || this.generateId(heading.textContent || '');\n\n      // Ensure heading has an ID for navigation\n      if (!heading.id) {\n        heading.id = id;\n      }\n\n      this.sections.push({\n        id,\n        title: heading.textContent || '',\n        element: heading as HTMLElement,\n        index\n      });\n    });\n  }\n\n  private generateId(text: string): string {\n    return text\n      .toLowerCase()\n      .replace(/[^\\w\\s-]/g, '')\n      .replace(/\\s+/g, '-')\n      .replace(/-+/g, '-')\n      .trim();\n  }\n\n  private createTOC() {\n    const siteNav = document.querySelector('.livepage-nav-sidebar');\n    if (!siteNav) return;\n\n    // Find the current page link in the navigation\n    const currentPageLink = siteNav.querySelector('.nav-page-link.active');\n    if (!currentPageLink) return; // Can't add sub-nav if we don't know current page\n\n    const currentPageItem = currentPageLink.closest('li');\n    if (!currentPageItem) return;\n\n    // Create nested list of H2 sections\n    const subNav = document.createElement('ul');\n    subNav.className = 'page-toc-list';\n    subNav.innerHTML = this.sections.map((section, i) => `\n      <li class=\"page-toc-item\" data-section=\"${i}\">\n        <a href=\"#${section.id}\" class=\"page-toc-link\">\n          ${this.escapeHtml(section.title)}\n        </a>\n      </li>\n    `).join('');\n\n    // Add click handlers\n    subNav.querySelectorAll('.page-toc-item').forEach((itemEl, i) => {\n      const link = itemEl.querySelector('a');\n      link?.addEventListener('click', (e) => {\n        e.preventDefault();\n        this.scrollToSection(i);\n      });\n    });\n\n    // Insert sub-navigation under the current page\n    currentPageItem.appendChild(subNav);\n\n    // Add expanded class to current page item\n    currentPageItem.classList.add('has-subnav');\n\n    this.tocElement = subNav;\n  }\n\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n\n  private setupScrollTracking() {\n    // Track which section is currently visible\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            const heading = entry.target as HTMLElement;\n            const sectionIndex = this.sections.findIndex(s => s.element === heading);\n            if (sectionIndex !== -1 && sectionIndex !== this.currentActiveSection) {\n              this.updateActiveSection(sectionIndex);\n            }\n          }\n        });\n      },\n      {\n        threshold: 0.5,\n        rootMargin: '-100px 0px -50% 0px'\n      }\n    );\n\n    this.sections.forEach(section => observer.observe(section.element));\n  }\n\n  private updateActiveSection(index: number) {\n    this.currentActiveSection = index;\n\n    if (!this.tocElement) return;\n\n    // Update active state in TOC\n    this.tocElement.querySelectorAll('.page-toc-item').forEach((el, i) => {\n      el.classList.toggle('active', i === index);\n    });\n  }\n\n  private scrollToSection(index: number) {\n    const section = this.sections[index];\n    if (!section) return;\n\n    section.element.scrollIntoView({\n      behavior: 'smooth',\n      block: 'start'\n    });\n\n    // Update URL hash\n    history.pushState(null, '', `#${section.id}`);\n  }\n}\n", "/**\n * Auto-initialization for browser builds\n */\n\nimport { LivepageClient } from \"./livepage-client\";\nimport { TutorialNavigation } from \"./core/navigation\";\nimport { SiteSearch } from \"./core/search\";\nimport { CodeCopy } from \"./core/code-copy\";\nimport { PageTOC } from \"./core/page-toc\";\nimport { hasEditableBlocks, preloadMonaco } from \"./editor/monaco-loader\";\n\n/**\n * Auto-initialization function\n */\nfunction initializeLivepage(): void {\n  // Check if auto-init is disabled\n  if ((window as any).LIVEPAGE_DISABLE_AUTO_INIT) {\n    console.log(\"[Livepage] Auto-initialization disabled\");\n    return;\n  }\n\n  // Get WebSocket URL from meta tag or default\n  const wsMeta = document.querySelector<HTMLMetaElement>('meta[name=\"livepage-ws-url\"]');\n  const wsUrl = wsMeta?.content || `ws://${window.location.host}/ws`;\n\n  // Get debug flag from meta tag\n  const debugMeta = document.querySelector<HTMLMetaElement>('meta[name=\"livepage-debug\"]');\n  const debug = debugMeta?.content === \"true\";\n\n  // Preload Monaco if page has WASM blocks (lazy load in background)\n  if (hasEditableBlocks()) {\n    console.log(\"[Livepage] Preloading Monaco Editor for WASM blocks...\");\n    preloadMonaco();\n  }\n\n  // Create and initialize client\n  const client = new LivepageClient({\n    wsUrl,\n    debug,\n    persistence: true,\n    onConnect: () => console.log(\"[Livepage] Connected\"),\n    onDisconnect: () => console.log(\"[Livepage] Disconnected\"),\n    onError: (error: Error) => console.error(\"[Livepage] Error:\", error),\n  });\n\n  // Discover blocks\n  client.discoverBlocks();\n\n  // Connect to server (for interactive blocks)\n  const hasInteractiveBlocks = client.getBlockIds().some((id: string) => {\n    const block = client.getBlock(id);\n    return block?.type === \"interactive\" || block?.type === \"lvt\";\n  });\n\n  if (hasInteractiveBlocks) {\n    client.connect();\n  }\n\n  // Expose client globally for debugging\n  (window as any).livepageClient = client;\n\n  // Initialize tutorial navigation (if H2 headings exist)\n  const nav = new TutorialNavigation();\n  (window as any).livepageNavigation = nav;\n\n  // Initialize page TOC (for site-mode pages with H2 sections)\n  const pageTOC = new PageTOC();\n  (window as any).livepagePageTOC = pageTOC;\n\n  // Initialize site search (if in site mode)\n  const search = new SiteSearch();\n  (window as any).livepageSearch = search;\n\n  // Initialize code copy buttons\n  const codeCopy = new CodeCopy();\n  (window as any).livepageCodeCopy = codeCopy;\n\n  console.log(`[Livepage] Initialized with ${client.getBlockIds().length} blocks`);\n}\n\n/**\n * Initialize Livepage client automatically when script loads\n */\nif (typeof window !== \"undefined\") {\n  // Auto-initialize on DOMContentLoaded\n  if (document.readyState === \"loading\") {\n    document.addEventListener(\"DOMContentLoaded\", initializeLivepage);\n  } else {\n    initializeLivepage();\n  }\n}\n"],
  "mappings": "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",
  "names": ["require_morphdom", "__commonJSMin", "exports", "module", "DOCUMENT_FRAGMENT_NODE", "morphAttrs", "fromNode", "toNode", "toNodeAttrs", "attr", "attrName", "attrNamespaceURI", "attrValue", "fromValue", "i", "fromNodeAttrs", "range", "NS_XHTML", "doc", "HAS_TEMPLATE_SUPPORT", "HAS_RANGE_SUPPORT", "createFragmentFromTemplate", "str", "template", "createFragmentFromRange", "fragment", "createFragmentFromWrap", "toElement", "compareNodeNames", "fromEl", "toEl", "fromNodeName", "toNodeName", "fromCodeStart", "toCodeStart", "createElementNS", "name", "namespaceURI", "moveChildren", "curChild", "nextChild", "syncBooleanAttrProp", "specialElHandlers", "parentNode", "parentName", "newValue", "firstChild", "oldValue", "selectedIndex", "optgroup", "nodeName", "ELEMENT_NODE", "DOCUMENT_FRAGMENT_NODE$1", "TEXT_NODE", "COMMENT_NODE", "noop", "defaultGetNodeKey", "node", "morphdomFactory", "options", "toNodeHtml", "getNodeKey", "onBeforeNodeAdded", "onNodeAdded", "onBeforeElUpdated", "onElUpdated", "onBeforeNodeDiscarded", "onNodeDiscarded", "onBeforeElChildrenUpdated", "skipFromChildren", "addChild", "parent", "child", "childrenOnly", "fromNodesLookup", "keyedRemovalList", "addKeyedRemoval", "key", "walkDiscardedChildNodes", "skipKeyedNodes", "removeNode", "indexTree", "handleNodeAdded", "el", "nextSibling", "unmatchedFromEl", "morphEl", "cleanupFromEl", "curFromNodeChild", "curFromNodeKey", "fromNextSibling", "toElKey", "beforeUpdateResult", "morphChildren", "skipFrom", "curToNodeChild", "curToNodeKey", "toNextSibling", "matchingFromEl", "outer", "curFromNodeType", "isCompatible", "onBeforeNodeAddedResult", "specialElHandler", "morphedNode", "morphedNodeType", "toNodeType", "len", "elToRemove", "morphdom", "exports", "constants_1", "FocusManager", "logger", "wrapper", "selector", "type", "wrapperId", "focusKey", "blurKey", "focusListener", "event", "target", "blurListener", "element", "index", "wasFocused", "el", "exports", "exports", "handleScrollDirectives", "handleHighlightDirectives", "handleAnimateDirectives", "rootElement", "element", "htmlElement", "mode", "behavior", "threshold", "duration", "color", "originalBackground", "originalTransition", "animation", "style", "exports", "debounce", "throttle", "func", "wait", "timeout", "args", "context", "limit", "inThrottle", "exports", "checkLvtConfirm", "extractLvtData", "element", "confirmMessage", "data", "attributes", "i", "attr", "key", "rate_limit_1", "confirm_1", "EventDelegator", "context", "logger", "wrapperElement", "eventTypes", "wrapperId", "rateLimitedHandlers", "eventType", "listenerKey", "existingListener", "listener", "e", "currentWrapper", "target", "element", "inWrapper", "attrName", "action", "actionElement", "persistTable", "formElement", "keyFilter", "targetElement", "handleAction", "message", "formData", "checkboxes", "checkboxNames", "cb", "name", "value", "key", "attr", "submitButton", "originalButtonText", "input", "uploadName", "throttleValue", "debounceValue", "handlerCache", "cacheKey", "rateLimitedHandler", "limit", "wait", "windowEvents", "openListenerKey", "existingOpenListener", "openListener", "modalId", "closeListenerKey", "existingCloseListener", "closeListener", "backdropListenerKey", "existingBackdropListener", "backdropListener", "escapeListenerKey", "existingEscapeListener", "escapeListener", "openModals", "lastModal", "getFocusableElements", "container", "selector", "el", "htmlEl", "style", "isNotDisplayNone", "isNotVisibilityHidden", "hasLayoutContext", "focusTrapElements", "activeTrap", "trap", "htmlTrap", "focusableElements", "firstElement", "lastElement", "observerKey", "existingObserver", "processAutofocus", "htmlElement", "isVisible", "wasFocused", "observer", "mutations", "shouldProcess", "mutation", "node", "exports", "ObserverManager", "context", "logger", "sentinel", "entries", "wrapperElement", "exports", "ModalManager", "logger", "modalId", "modal", "firstInput", "activeElement", "isVisible", "element", "exports", "LoadingIndicator", "bar", "style", "exports", "FormDisabler", "wrapper", "form", "input", "exports", "exports", "parseReactiveAttribute", "executeAction", "matchesEvent", "processReactiveAttributes", "setupReactiveAttributeListeners", "LIFECYCLE_EVENTS", "ACTION_MAP", "attrName", "attrValue", "match", "actionKey", "action", "segments", "lastSegment", "lifecycle", "actionName", "element", "param", "classes", "c", "colonIndex", "name", "value", "binding", "attr", "deepClone", "obj", "TreeRenderer", "logger", "update", "changed", "key", "value", "existing", "oldValue", "newValue", "currentPath", "merged", "fieldPath", "isDifferentialOps", "existingIsRange", "rangeStructure", "operations", "statePath", "currentItems", "operation", "removeIndex", "updateIndex", "changes", "itemsToAdd", "itemsToPrepend", "targetIndex", "itemsToInsert", "newOrder", "reorderedItems", "itemsByKey", "item", "itemKey", "orderedKey", "node", "html", "i", "staticSegment", "dynamicKey", "newStatePath", "fieldKey", "stateKey", "keys", "numericKeys", "k", "b", "itemStatePath", "idx", "rangeNode", "dynamics", "statics", "elseKey", "elseStatePath", "itemIdx", "localKey", "rangeData", "fieldValue", "items", "result", "prepend", "itemsArray", "keyPosStr", "exports", "FormLifecycleManager", "modalManager", "form", "button", "originalButtonText", "meta", "modalParent", "exports", "exports", "checkWebSocketAvailability", "fetchInitialState", "WebSocketTransport", "options", "socket", "event", "data", "maxAttempts", "baseDelay", "maxDelay", "exponentialDelay", "jitter", "delay", "WebSocketManager", "config", "liveUrl", "payload", "error", "attempt", "baseUrl", "logger", "wsHeader", "response", "S3Uploader", "entry", "meta", "onProgress", "file", "xhr", "e", "uploadPromise", "resolve", "reject", "key", "value", "error", "exports", "s3_uploader_1", "UploadHandler", "sendMessage", "options", "container", "input", "uploadName", "existingHandler", "handler", "e", "files", "fileMetadata", "file", "startMessage", "response", "upload_name", "entryInfos", "fileMap", "entries", "info", "entry", "meta", "uploader", "completeMessage", "error", "errorMsg", "id", "offset", "end", "chunk", "base64", "chunkMessage", "message", "entryId", "pendingEntries", "name", "delay", "entriesToRemove", "blob", "resolve", "reject", "reader", "exports", "exports", "createLogger", "levelPriority", "DEFAULT_SCOPE", "Logger", "_Logger", "state", "scope", "sink", "level", "args", "method", "options", "exports", "loadAndApplyUpdate", "compareHTML", "client", "updatePath", "nodeRequire", "fs", "updateData", "error", "expected", "actual", "differences", "normalizeHTML", "html", "normalizedExpected", "normalizedActual", "expectedLines", "actualLines", "maxLines", "i", "expectedLine", "actualLine", "morphdom_1", "__importDefault", "focus_manager_1", "directives_1", "event_delegation_1", "observer_manager_1", "modal_manager_1", "loading_indicator_1", "form_disabler_1", "reactive_attributes_1", "tree_renderer_1", "form_lifecycle_manager_1", "websocket_1", "upload_handler_1", "logger_1", "testing_1", "exports", "reactive_attributes_2", "confirm_1", "LiveTemplateClient", "_LiveTemplateClient", "options", "providedLogger", "logLevel", "debug", "restOptions", "resolvedLevel", "baseLogger", "message", "entry", "uploadName", "entries", "error", "value", "form", "button", "originalButtonText", "modalId", "response", "event", "autoInitLogger", "init", "wrapper", "client", "uploadMessage", "startResponse", "wrapperSelector", "connectionResult", "readyState", "liveUrl", "updateResponse", "num", "update", "existingHTML", "result", "match", "innerContent", "newBodyContent", "element", "meta", "hasStaticsInTree", "node", "v", "tempWrapper", "fromEl", "toEl", "lastFocused", "hookName", "hookValue", "browser_exports", "__export", "BaseBlock", "InteractiveBlock", "LivepageClient", "MessageRouter", "MonacoEditor", "OutputPanel", "PersistenceManager", "RunButton", "ServerBlock", "TinyGoExecutor", "WasmBlock", "hasEditableBlocks", "initializeWasm", "isMonacoLoaded", "loadMonaco", "preloadMonaco", "import_client", "MessageRouter", "debug", "blockID", "handler", "message", "envelope", "action", "data", "error", "filePath", "existing", "notification", "style", "PersistenceManager", "storageKey", "enabled", "debug", "test", "blockID", "code", "data", "error", "raw", "BaseBlock", "config", "persistence", "debug", "code", "persisted", "wrapper", "args", "ServerBlock", "BaseBlock", "config", "persistence", "debug", "action", "data", "import_client", "InteractiveBlock", "BaseBlock", "config", "persistence", "debug", "action", "data", "meta", "sender", "e", "target", "formData", "value", "key", "MONACO_VERSION", "MONACO_CDN_BASE", "monacoInstance", "loadingPromise", "loadMonacoLoader", "resolve", "reject", "script", "initializeMonacoEnvironment", "_moduleId", "label", "workerMain", "loadMonaco", "startTime", "amdRequire", "monacoModule", "loadTime", "error", "isMonacoLoaded", "preloadMonaco", "hasEditableBlocks", "MonacoEditor", "container", "initialCode", "options", "loadingDiv", "loadMonaco", "error", "code", "callback", "readonly", "OutputPanel", "container", "maxLines", "autoScroll", "panel", "clearBtn", "type", "text", "line", "content", "lineElement", "RunButton", "container", "label", "button", "callback", "error", "running", "TinyGoExecutor", "serverUrl", "debug", "code", "response", "error", "wasmBuffer", "stdout", "stderr", "go", "originalLog", "originalError", "args", "result", "errorMsg", "initializeWasm", "script", "resolve", "reject", "WasmBlock", "BaseBlock", "config", "persistence", "debug", "action", "data", "MonacoEditor", "code", "buttonContainer", "RunButton", "resetButton", "OutputPanel", "TinyGoExecutor", "result", "error", "errorMsg", "LivepageClient", "options", "MessageRouter", "PersistenceManager", "error", "event", "data", "blockID", "action", "message", "codeBlocks", "element", "metadata", "initialCode", "config", "id", "type", "language", "readonly", "editable", "stateRef", "codeElement", "block", "ServerBlock", "InteractiveBlock", "WasmBlock", "TutorialNavigation", "heading", "index", "id", "text", "step", "i", "stepEl", "e", "prevBtn", "nextBtn", "observer", "entries", "entry", "stepIndex", "s", "hash", "updateHash", "scroll", "el", "currentStepEl", "SiteSearch", "response", "error", "sidebar", "header", "searchButton", "query", "results", "lowerQuery", "entry", "lowerTitle", "lowerContent", "titleMatches", "contentMatches", "score", "a", "b", "result", "index", "el", "text", "regex", "content", "maxLength", "str", "selected", "CodeCopy", "_CodeCopy", "codeElement", "pre", "wrapper", "button", "e", "code", "err", "text", "textarea", "PageTOC", "heading", "index", "id", "text", "siteNav", "currentPageLink", "currentPageItem", "subNav", "section", "i", "itemEl", "e", "div", "observer", "entries", "entry", "sectionIndex", "s", "el", "initializeLivepage", "wsUrl", "debug", "hasEditableBlocks", "preloadMonaco", "client", "LivepageClient", "error", "id", "block", "nav", "TutorialNavigation", "pageTOC", "PageTOC", "search", "SiteSearch", "codeCopy", "CodeCopy"]
}
