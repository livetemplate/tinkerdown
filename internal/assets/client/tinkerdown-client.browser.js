"use strict";var TinkerdownClient=(()=>{var Qt=Object.create;var pe=Object.defineProperty;var Zt=Object.getOwnPropertyDescriptor;var er=Object.getOwnPropertyNames;var tr=Object.getPrototypeOf,rr=Object.prototype.hasOwnProperty;var L=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),nr=(s,e)=>{for(var t in e)pe(s,t,{get:e[t],enumerable:!0})},at=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of er(e))!rr.call(s,n)&&n!==t&&pe(s,n,{get:()=>e[n],enumerable:!(r=Zt(e,n))||r.enumerable});return s};var lt=(s,e,t)=>(t=s!=null?Qt(tr(s)):{},at(e||!s||!s.__esModule?pe(t,"default",{value:s,enumerable:!0}):t,s)),or=s=>at(pe({},"__esModule",{value:!0}),s);var ft=L((Qr,gt)=>{"use strict";var ct=11;function ir(s,e){var t=e.attributes,r,n,o,a,i;if(!(e.nodeType===ct||s.nodeType===ct)){for(var l=t.length-1;l>=0;l--)r=t[l],n=r.name,o=r.namespaceURI,a=r.value,o?(n=r.localName||n,i=s.getAttributeNS(o,n),i!==a&&(r.prefix==="xmlns"&&(n=r.name),s.setAttributeNS(o,n,a))):(i=s.getAttribute(n),i!==a&&s.setAttribute(n,a));for(var c=s.attributes,d=c.length-1;d>=0;d--)r=c[d],n=r.name,o=r.namespaceURI,o?(n=r.localName||n,e.hasAttributeNS(o,n)||s.removeAttributeNS(o,n)):e.hasAttribute(n)||s.removeAttribute(n)}}var ge,sr="http://www.w3.org/1999/xhtml",R=typeof document>"u"?void 0:document,ar=!!R&&"content"in R.createElement("template"),lr=!!R&&R.createRange&&"createContextualFragment"in R.createRange();function cr(s){var e=R.createElement("template");return e.innerHTML=s,e.content.childNodes[0]}function dr(s){ge||(ge=R.createRange(),ge.selectNode(R.body));var e=ge.createContextualFragment(s);return e.childNodes[0]}function ur(s){var e=R.createElement("body");return e.innerHTML=s,e.childNodes[0]}function hr(s){return s=s.trim(),ar?cr(s):lr?dr(s):ur(s)}function fe(s,e){var t=s.nodeName,r=e.nodeName,n,o;return t===r?!0:(n=t.charCodeAt(0),o=r.charCodeAt(0),n<=90&&o>=97?t===r.toUpperCase():o<=90&&n>=97?r===t.toUpperCase():!1)}function pr(s,e){return!e||e===sr?R.createElement(s):R.createElementNS(e,s)}function gr(s,e){for(var t=s.firstChild;t;){var r=t.nextSibling;e.appendChild(t),t=r}return e}function je(s,e,t){s[t]!==e[t]&&(s[t]=e[t],s[t]?s.setAttribute(t,""):s.removeAttribute(t))}var dt={OPTION:function(s,e){var t=s.parentNode;if(t){var r=t.nodeName.toUpperCase();r==="OPTGROUP"&&(t=t.parentNode,r=t&&t.nodeName.toUpperCase()),r==="SELECT"&&!t.hasAttribute("multiple")&&(s.hasAttribute("selected")&&!e.selected&&(s.setAttribute("selected","selected"),s.removeAttribute("selected")),t.selectedIndex=-1)}je(s,e,"selected")},INPUT:function(s,e){je(s,e,"checked"),je(s,e,"disabled"),s.value!==e.value&&(s.value=e.value),e.hasAttribute("value")||s.removeAttribute("value")},TEXTAREA:function(s,e){var t=e.value;s.value!==t&&(s.value=t);var r=s.firstChild;if(r){var n=r.nodeValue;if(n==t||!t&&n==s.placeholder)return;r.nodeValue=t}},SELECT:function(s,e){if(!e.hasAttribute("multiple")){for(var t=-1,r=0,n=s.firstChild,o,a;n;)if(a=n.nodeName&&n.nodeName.toUpperCase(),a==="OPTGROUP")o=n,n=o.firstChild,n||(n=o.nextSibling,o=null);else{if(a==="OPTION"){if(n.hasAttribute("selected")){t=r;break}r++}n=n.nextSibling,!n&&o&&(n=o.nextSibling,o=null)}s.selectedIndex=t}}},ie=1,ut=11,ht=3,pt=8;function F(){}function fr(s){if(s)return s.getAttribute&&s.getAttribute("id")||s.id}function mr(s){return function(t,r,n){if(n||(n={}),typeof r=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var o=r;r=R.createElement("html"),r.innerHTML=o}else r=hr(r);else r.nodeType===ut&&(r=r.firstElementChild);var a=n.getNodeKey||fr,i=n.onBeforeNodeAdded||F,l=n.onNodeAdded||F,c=n.onBeforeElUpdated||F,d=n.onElUpdated||F,u=n.onBeforeNodeDiscarded||F,p=n.onNodeDiscarded||F,g=n.onBeforeElChildrenUpdated||F,S=n.skipFromChildren||F,C=n.addChild||function(f,m){return f.appendChild(m)},b=n.childrenOnly===!0,h=Object.create(null),k=[];function v(f){k.push(f)}function I(f,m){if(f.nodeType===ie)for(var T=f.firstChild;T;){var y=void 0;m&&(y=a(T))?v(y):(p(T),T.firstChild&&I(T,m)),T=T.nextSibling}}function w(f,m,T){u(f)!==!1&&(m&&m.removeChild(f),p(f),I(f,T))}function x(f){if(f.nodeType===ie||f.nodeType===ut)for(var m=f.firstChild;m;){var T=a(m);T&&(h[T]=m),x(m),m=m.nextSibling}}x(t);function A(f){l(f);for(var m=f.firstChild;m;){var T=m.nextSibling,y=a(m);if(y){var E=h[y];E&&fe(m,E)?(m.parentNode.replaceChild(E,m),W(E,m)):A(m)}else A(m);m=T}}function O(f,m,T){for(;m;){var y=m.nextSibling;(T=a(m))?v(T):w(m,f,!0),m=y}}function W(f,m,T){var y=a(m);if(y&&delete h[y],!T){var E=c(f,m);if(E===!1||(E instanceof HTMLElement&&(f=E,x(f)),s(f,m),d(f),g(f,m)===!1))return}f.nodeName!=="TEXTAREA"?D(f,m):dt.TEXTAREA(f,m)}function D(f,m){var T=S(f,m),y=m.firstChild,E=f.firstChild,U,N,z,ue,B;e:for(;y;){for(ue=y.nextSibling,U=a(y);!T&&E;){if(z=E.nextSibling,y.isSameNode&&y.isSameNode(E)){y=ue,E=z;continue e}N=a(E);var he=E.nodeType,P=void 0;if(he===y.nodeType&&(he===ie?(U?U!==N&&((B=h[U])?z===B?P=!1:(f.insertBefore(B,E),N?v(N):w(E,f,!0),E=B,N=a(E)):P=!1):N&&(P=!1),P=P!==!1&&fe(E,y),P&&W(E,y)):(he===ht||he==pt)&&(P=!0,E.nodeValue!==y.nodeValue&&(E.nodeValue=y.nodeValue))),P){y=ue,E=z;continue e}N?v(N):w(E,f,!0),E=z}if(U&&(B=h[U])&&fe(B,y))T||C(f,B),W(B,y);else{var qe=i(y);qe!==!1&&(qe&&(y=qe),y.actualize&&(y=y.actualize(f.ownerDocument||R)),C(f,y),A(y))}y=ue,E=z}O(f,E,N);var st=dt[f.nodeName];st&&st(f,m)}var M=t,de=M.nodeType,it=r.nodeType;if(!b){if(de===ie)it===ie?fe(t,r)||(p(t),M=gr(t,pr(r.nodeName,r.namespaceURI))):M=r;else if(de===ht||de===pt){if(it===de)return M.nodeValue!==r.nodeValue&&(M.nodeValue=r.nodeValue),M;M=r}}if(M===r)p(t);else{if(r.isSameNode&&r.isSameNode(M))return;if(W(M,r,b),k)for(var $e=0,Xt=k.length;$e<Xt;$e++){var We=h[k[$e]];We&&w(We,We.parentNode,!1)}}return!b&&M!==t&&t.parentNode&&(M.actualize&&(M=M.actualize(t.ownerDocument||R)),t.parentNode.replaceChild(M,t)),M}}var br=mr(ir);gt.exports=br});var mt=L(me=>{"use strict";Object.defineProperty(me,"__esModule",{value:!0});me.FOCUSABLE_INPUTS=void 0;me.FOCUSABLE_INPUTS=["text","textarea","number","email","password","search","tel","url","date","time","datetime-local","color","range"]});var vt=L(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});be.FocusManager=void 0;var bt=mt(),Ue=class{constructor(e){this.logger=e,this.wrapperElement=null,this.focusableElements=[],this.lastFocusedElement=null,this.lastFocusedSelectionStart=null,this.lastFocusedSelectionEnd=null}attach(e){this.wrapperElement=e,e&&(this.updateFocusableElements(),this.setupFocusTracking())}reset(){this.wrapperElement=null,this.focusableElements=[],this.lastFocusedElement=null,this.lastFocusedSelectionStart=null,this.lastFocusedSelectionEnd=null}updateFocusableElements(){if(!this.wrapperElement)return;let r=`${bt.FOCUSABLE_INPUTS.map(n=>n==="textarea"?"textarea:not([disabled])":`input[type="${n}"]:not([disabled])`).join(", ")}, select:not([disabled]), button:not([disabled]), [contenteditable="true"], [tabindex]:not([tabindex="-1"])`;this.focusableElements=Array.from(this.wrapperElement.querySelectorAll(r))}setupFocusTracking(){if(!this.wrapperElement)return;let e=this.wrapperElement.getAttribute("data-lvt-id"),t=`__lvt_focus_tracker_${e}`,r=`__lvt_blur_tracker_${e}`,n=a=>{let i=a.target;!i||!this.wrapperElement?.contains(i)||(this.isTextualInput(i)||i instanceof HTMLSelectElement)&&(this.lastFocusedElement=i,this.logger.debug("[Focus] Tracked focus on:",i.tagName,i.id||i.getAttribute("name")),this.isTextualInput(i)&&(this.lastFocusedSelectionStart=i.selectionStart,this.lastFocusedSelectionEnd=i.selectionEnd))},o=a=>{let i=a.target;!i||!this.wrapperElement?.contains(i)||this.isTextualInput(i)&&i===this.lastFocusedElement&&(this.lastFocusedSelectionStart=i.selectionStart,this.lastFocusedSelectionEnd=i.selectionEnd,this.logger.debug("[Focus] Saved cursor on blur:",this.lastFocusedSelectionStart,"-",this.lastFocusedSelectionEnd))};document[t]&&document.removeEventListener("focus",document[t],!0),document[r]&&document.removeEventListener("blur",document[r],!0),document[t]=n,document[r]=o,document.addEventListener("focus",n,!0),document.addEventListener("blur",o,!0),this.logger.debug("[Focus] Focus tracking set up")}restoreFocusedElement(){if(this.logger.debug("[Focus] restoreFocusedElement - lastFocusedElement:",this.lastFocusedElement?.tagName,this.lastFocusedElement?.id||this.lastFocusedElement?.getAttribute("name")),!this.lastFocusedElement||!this.wrapperElement){this.logger.debug("[Focus] No element to restore");return}let e=this.getElementSelector(this.lastFocusedElement);if(this.logger.debug("[Focus] Selector for last focused:",e),!e){this.logger.debug("[Focus] Could not generate selector");return}let t=null;if(e.startsWith("data-focus-index-")){this.updateFocusableElements();let n=parseInt(e.replace("data-focus-index-",""),10);t=this.focusableElements[n]||null,this.logger.debug("[Focus] Found by index:",n,t?.tagName)}else t=this.wrapperElement.querySelector(e),this.logger.debug("[Focus] Found by selector:",e,t?.tagName);if(!t){this.logger.debug("[Focus] Element not found in updated DOM");return}let r=t.matches(":focus");this.logger.debug("[Focus] Already focused:",r),r||(t.focus(),this.logger.debug("[Focus] Restored focus")),this.isTextualInput(t)&&this.lastFocusedSelectionStart!==null&&this.lastFocusedSelectionEnd!==null&&(t.setSelectionRange(this.lastFocusedSelectionStart,this.lastFocusedSelectionEnd),this.logger.debug("[Focus] Restored cursor:",this.lastFocusedSelectionStart,"-",this.lastFocusedSelectionEnd))}isTextualInput(e){return e instanceof HTMLTextAreaElement?!0:e instanceof HTMLInputElement?bt.FOCUSABLE_INPUTS.indexOf(e.type)>=0:!1}getLastFocusedElement(){return this.lastFocusedElement}getElementSelector(e){if(e.id)return`#${e.id}`;if(e.name)return`[name="${e.name}"]`;if(e.getAttribute("data-key"))return`[data-key="${e.getAttribute("data-key")}"]`;let t=this.focusableElements.indexOf(e);return t>=0?`data-focus-index-${t}`:null}};be.FocusManager=Ue});var yt=L(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});se.handleScrollDirectives=vr;se.handleHighlightDirectives=yr;se.handleAnimateDirectives=wr;function vr(s){s.querySelectorAll("[lvt-scroll]").forEach(t=>{let r=t,n=r.getAttribute("lvt-scroll"),o=r.getAttribute("lvt-scroll-behavior")||"auto",a=parseInt(r.getAttribute("lvt-scroll-threshold")||"100",10);if(n)switch(n){case"bottom":r.scrollTo({top:r.scrollHeight,behavior:o});break;case"bottom-sticky":{r.scrollHeight-r.scrollTop-r.clientHeight<=a&&r.scrollTo({top:r.scrollHeight,behavior:o});break}case"top":r.scrollTo({top:0,behavior:o});break;case"preserve":break;default:console.warn(`Unknown lvt-scroll mode: ${n}`)}})}function yr(s){s.querySelectorAll("[lvt-highlight]").forEach(t=>{let r=t.getAttribute("lvt-highlight"),n=parseInt(t.getAttribute("lvt-highlight-duration")||"500",10),o=t.getAttribute("lvt-highlight-color")||"#ffc107";if(!r)return;let a=t,i=a.style.backgroundColor,l=a.style.transition;a.style.transition=`background-color ${n}ms ease-out`,a.style.backgroundColor=o,setTimeout(()=>{a.style.backgroundColor=i,setTimeout(()=>{a.style.transition=l},n)},50)})}function wr(s){if(s.querySelectorAll("[lvt-animate]").forEach(t=>{let r=t.getAttribute("lvt-animate"),n=parseInt(t.getAttribute("lvt-animate-duration")||"300",10);if(!r)return;let o=t;switch(o.style.setProperty("--lvt-animate-duration",`${n}ms`),r){case"fade":o.style.animation="lvt-fade-in var(--lvt-animate-duration) ease-out";break;case"slide":o.style.animation="lvt-slide-in var(--lvt-animate-duration) ease-out";break;case"scale":o.style.animation="lvt-scale-in var(--lvt-animate-duration) ease-out";break;default:console.warn(`Unknown lvt-animate mode: ${r}`)}o.addEventListener("animationend",()=>{o.style.animation=""},{once:!0})}),!document.getElementById("lvt-animate-styles")){let t=document.createElement("style");t.id="lvt-animate-styles",t.textContent=`
      @keyframes lvt-fade-in {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      @keyframes lvt-slide-in {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes lvt-scale-in {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
    `,document.head.appendChild(t)}}});var wt=L(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.debounce=kr;ve.throttle=xr;function kr(s,e){let t=null;return function(...n){let o=this;t!==null&&clearTimeout(t),t=window.setTimeout(()=>{s.apply(o,n)},e)}}function xr(s,e){let t=!1;return function(...n){let o=this;t||(s.apply(o,n),t=!0,setTimeout(()=>{t=!1},e))}}});var ze=L(ye=>{"use strict";Object.defineProperty(ye,"__esModule",{value:!0});ye.checkLvtConfirm=Er;ye.extractLvtData=Sr;function Er(s){if(s.hasAttribute("lvt-confirm")){let e=s.getAttribute("lvt-confirm");if(e&&!confirm(e))return!1}return!0}function Sr(s){let e={},t=s.attributes;for(let r=0;r<t.length;r++){let n=t[r];if(n.name.startsWith("lvt-data-")){let o=n.name.substring(9);e[o]=n.value}}return e}});var kt=L(ke=>{"use strict";Object.defineProperty(ke,"__esModule",{value:!0});ke.EventDelegator=void 0;var we=wt(),Mr=ze(),Ke=class{constructor(e,t){this.context=e,this.logger=t}setupEventDelegation(){let e=this.context.getWrapperElement();if(!e)return;let t=["click","submit","change","input","keydown","keyup","focus","blur","mouseenter","mouseleave"],r=e.getAttribute("data-lvt-id"),n=this.context.getRateLimitedHandlers();t.forEach(o=>{let a=`__lvt_delegated_${o}_${r}`,i=document[a];i&&document.removeEventListener(o,i,!1);let l=c=>{let d=this.context.getWrapperElement();if(!d)return;o==="submit"&&(window.__lvtSubmitListenerTriggered=!0,window.__lvtSubmitEventTarget=c.target?.tagName),this.logger.debug("Event listener triggered:",o,c.target);let u=c.target;if(!u)return;let p=u,g=!1;for(;p;){if(p===d){g=!0;break}p=p.parentElement}if(o==="submit"&&(window.__lvtInWrapper=g,window.__lvtWrapperElement=d.getAttribute("data-lvt-id")),!g)return;let S=`lvt-${o}`;for(p=u;p&&p!==d.parentElement;){let C=p.getAttribute(S),b=p;if(!C&&o==="submit"&&p instanceof HTMLFormElement){let h=p.getAttribute("lvt-persist");h&&(C=`persist:${h}`,b=p)}if(!C&&(o==="change"||o==="input")){let h=p.closest("form");h&&h.hasAttribute("lvt-change")&&(C=h.getAttribute("lvt-change"),b=h)}if(C&&b){if(o==="submit"&&(window.__lvtActionFound=C,window.__lvtActionElement=b.tagName),o==="submit"&&c.preventDefault(),(o==="keydown"||o==="keyup")&&b.hasAttribute("lvt-key")){let w=b.getAttribute("lvt-key");if(w&&c.key!==w){p=p.parentElement;continue}}let h=b,k=()=>{if(this.logger.debug("handleAction called",{action:C,eventType:o,targetElement:h}),!(0,Mr.checkLvtConfirm)(h)){this.logger.debug("Action cancelled by user:",C);return}let w={action:C,data:{}};if(h instanceof HTMLFormElement){this.logger.debug("Processing form element");let x=new FormData(h),A=Array.from(h.querySelectorAll('input[type="checkbox"][name]')),O=new Set(A.map(D=>D.name));O.forEach(D=>{w.data[D]=!1});let W=new Set(Array.from(h.querySelectorAll('input[type="password"][name]')).map(D=>D.name));x.forEach((D,M)=>{O.has(M)?(w.data[M]=!0,this.logger.debug("Converted checkbox",M,"to true")):W.has(M)?w.data[M]=D:w.data[M]=this.context.parseValue(D)}),this.logger.debug("Form data collected:",w.data)}else if(o==="change"||o==="input"){if(h instanceof HTMLInputElement){let x=h.name||"value";w.data[x]=this.context.parseValue(h.value)}else if(h instanceof HTMLSelectElement){let x=h.name||"value";w.data[x]=this.context.parseValue(h.value)}else if(h instanceof HTMLTextAreaElement){let x=h.name||"value";w.data[x]=this.context.parseValue(h.value)}}if(Array.from(h.attributes).forEach(x=>{if(x.name.startsWith("lvt-data-")){let A=x.name.replace("lvt-data-","");w.data[A]=this.context.parseValue(x.value)}}),Array.from(h.attributes).forEach(x=>{if(x.name.startsWith("lvt-value-")){let A=x.name.replace("lvt-value-","");w.data[A]=this.context.parseValue(x.value)}}),o==="submit"&&h instanceof HTMLFormElement){let A=c.submitter,O=null;A&&A.hasAttribute("lvt-disable-with")&&(O=A.textContent,A.disabled=!0,A.textContent=A.getAttribute("lvt-disable-with"),this.logger.debug("Disabled submit button")),this.context.setActiveSubmission(h,A||null,O),h.querySelectorAll('input[type="file"][lvt-upload]').forEach(D=>{let M=D.getAttribute("lvt-upload");M&&(this.logger.debug("Triggering pending uploads for:",M),this.context.triggerPendingUploads(M))}),h.dispatchEvent(new CustomEvent("lvt:pending",{detail:w})),this.logger.debug("Emitted lvt:pending event")}this.logger.debug("About to send message:",w),this.logger.debug("WebSocket state:",this.context.getWebSocketReadyState()),this.context.send(w),this.logger.debug("send() called")},v=b.getAttribute("lvt-throttle"),I=b.getAttribute("lvt-debounce");if(v||I){n.has(b)||n.set(b,new Map);let w=n.get(b),x=`${o}:${C}`,A=w.get(x);if(!A){if(v){let O=parseInt(v,10);A=(0,we.throttle)(k,O)}else if(I){let O=parseInt(I,10);A=(0,we.debounce)(k,O)}A&&w.set(x,A)}A&&A()}else o==="submit"&&(window.__lvtBeforeHandleAction=!0),k(),o==="submit"&&(window.__lvtAfterHandleAction=!0);return}p=p.parentElement}};document[a]=l,document.addEventListener(o,l,!1),this.logger.debug("Registered event listener:",o,"with key:",a)})}setupWindowEventDelegation(){let e=this.context.getWrapperElement();if(!e)return;let t=["keydown","keyup","scroll","resize","focus","blur"],r=e.getAttribute("data-lvt-id"),n=this.context.getRateLimitedHandlers();t.forEach(o=>{let a=`__lvt_window_${o}_${r}`,i=window[a];i&&window.removeEventListener(o,i);let l=c=>{let d=this.context.getWrapperElement();if(!d)return;let u=`lvt-window-${o}`;d.querySelectorAll(`[${u}]`).forEach(g=>{let S=g.getAttribute(u);if(!S)return;if((o==="keydown"||o==="keyup")&&g.hasAttribute("lvt-key")){let v=g.getAttribute("lvt-key");if(v&&c.key!==v)return}let C={action:S,data:{}};Array.from(g.attributes).forEach(v=>{if(v.name.startsWith("lvt-data-")){let I=v.name.replace("lvt-data-","");C.data[I]=this.context.parseValue(v.value)}}),Array.from(g.attributes).forEach(v=>{if(v.name.startsWith("lvt-value-")){let I=v.name.replace("lvt-value-","");C.data[I]=this.context.parseValue(v.value)}});let b=g.getAttribute("lvt-throttle"),h=g.getAttribute("lvt-debounce"),k=()=>this.context.send(C);if(b||h){n.has(g)||n.set(g,new Map);let v=n.get(g),I=`window-${o}:${S}`,w=v.get(I);if(!w){if(b){let x=parseInt(b,10);w=(0,we.throttle)(k,x)}else if(h){let x=parseInt(h,10);w=(0,we.debounce)(k,x)}w&&v.set(I,w)}w&&w()}else k()})};window[a]=l,window.addEventListener(o,l)})}setupClickAwayDelegation(){let e=this.context.getWrapperElement();if(!e)return;let r=`__lvt_click_away_${e.getAttribute("data-lvt-id")}`,n=document[r];n&&document.removeEventListener("click",n);let o=a=>{let i=this.context.getWrapperElement();if(!i)return;let l=a.target;i.querySelectorAll("[lvt-click-away]").forEach(d=>{if(!d.contains(l)){let u=d.getAttribute("lvt-click-away");if(!u)return;let p={action:u,data:{}};Array.from(d.attributes).forEach(g=>{if(g.name.startsWith("lvt-data-")){let S=g.name.replace("lvt-data-","");p.data[S]=this.context.parseValue(g.value)}}),Array.from(d.attributes).forEach(g=>{if(g.name.startsWith("lvt-value-")){let S=g.name.replace("lvt-value-","");p.data[S]=this.context.parseValue(g.value)}}),this.context.send(p)}})};document[r]=o,document.addEventListener("click",o)}setupModalDelegation(){let e=this.context.getWrapperElement();if(!e)return;let t=e.getAttribute("data-lvt-id"),r=`__lvt_modal_open_${t}`,n=document[r];n&&document.removeEventListener("click",n);let o=b=>{let h=this.context.getWrapperElement();if(!h)return;let k=b.target?.closest("[lvt-modal-open]");if(!k||!h.contains(k))return;let v=k.getAttribute("lvt-modal-open");v&&(b.preventDefault(),this.context.openModal(v))};document[r]=o,document.addEventListener("click",o);let a=`__lvt_modal_close_${t}`,i=document[a];i&&document.removeEventListener("click",i);let l=b=>{let h=b.target?.closest("[lvt-modal-close]");if(!h)return;let k=h.getAttribute("lvt-modal-close");!k||!document.getElementById(k)||(b.preventDefault(),this.context.closeModal(k))};document[a]=l,document.addEventListener("click",l);let c=`__lvt_modal_backdrop_${t}`,d=document[c];d&&document.removeEventListener("click",d);let u=(b,h)=>{let k=b.getAttribute("data-modal-close-action");k?this.context.send({action:k,data:{}}):this.context.closeModal(h)},p=b=>{let h=b.target;if(!h.hasAttribute("data-modal-backdrop"))return;let k=h.getAttribute("data-modal-id");if(!k)return;let v=document.getElementById(k);v&&u(v,k)};document[c]=p,document.addEventListener("click",p);let g=`__lvt_modal_escape_${t}`,S=document[g];S&&document.removeEventListener("keydown",S);let C=b=>{if(b.key!=="Escape")return;let h=this.context.getWrapperElement();if(!h)return;let k=h.querySelectorAll('[role="dialog"]:not([hidden])');if(k.length>0){let v=k[k.length-1];v.id&&u(v,v.id)}};document[g]=C,document.addEventListener("keydown",C)}setupFocusTrapDelegation(){let e=this.context.getWrapperElement();if(!e)return;let r=`__lvt_focus_trap_${e.getAttribute("data-lvt-id")}`,n=document[r];n&&document.removeEventListener("keydown",n);let o=i=>{let l=["a[href]:not([disabled])","button:not([disabled])","textarea:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])",'[tabindex]:not([tabindex="-1"]):not([disabled])','[contenteditable="true"]'].join(", ");return Array.from(i.querySelectorAll(l)).filter(c=>{let d=c,u=window.getComputedStyle(d),p=u.display!=="none",g=u.visibility!=="hidden",S=d.offsetParent!==null||u.position==="fixed"||u.position==="absolute"||typeof process<"u"&&!1;return p&&g&&S})},a=i=>{if(i.key!=="Tab")return;let l=this.context.getWrapperElement();if(!l)return;let c=l.querySelectorAll("[lvt-focus-trap]"),d=null;if(c.forEach(S=>{S.contains(document.activeElement)&&(!d||S.contains(d))&&(d=S)}),d||c.forEach(S=>{let C=S,b=window.getComputedStyle(C);b.display!=="none"&&b.visibility!=="hidden"&&(d=S)}),!d)return;let u=o(d);if(u.length===0)return;let p=u[0],g=u[u.length-1];i.shiftKey?document.activeElement===p&&(i.preventDefault(),g.focus()):document.activeElement===g&&(i.preventDefault(),p.focus())};document[r]=a,document.addEventListener("keydown",a),this.logger.debug("Focus trap delegation set up")}setupAutofocusDelegation(){let e=this.context.getWrapperElement();if(!e)return;let r=`__lvt_autofocus_observer_${e.getAttribute("data-lvt-id")}`,n=e[r];n&&n.disconnect();let o=()=>{let i=this.context.getWrapperElement();if(!i)return;i.querySelectorAll("[lvt-autofocus]").forEach(c=>{let d=c,u=window.getComputedStyle(d),p=u.display!=="none",g=u.visibility!=="hidden",S=d.offsetParent!==null||u.position==="fixed"||u.position==="absolute"||d.tagName==="BODY"||typeof process<"u"&&!1,C=p&&g&&S,b=d.getAttribute("data-lvt-autofocused")==="true";C&&!b?(d.setAttribute("data-lvt-autofocused","true"),requestAnimationFrame(()=>{d.focus(),this.logger.debug("Autofocused element:",d.tagName,d.id||d.getAttribute("name"))})):!C&&b&&d.removeAttribute("data-lvt-autofocused")})};o();let a=new MutationObserver(i=>{let l=!1;i.forEach(c=>{c.type==="childList"&&c.addedNodes.length>0&&c.addedNodes.forEach(d=>{d instanceof Element&&(d.hasAttribute("lvt-autofocus")||d.querySelector("[lvt-autofocus]"))&&(l=!0)}),c.type==="attributes"&&(c.target.hasAttribute("lvt-autofocus")||c.attributeName==="hidden"||c.attributeName==="style"||c.attributeName==="class")&&(l=!0)}),l&&o()});a.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["hidden","style","class","lvt-autofocus"]}),e[r]=a,this.logger.debug("Autofocus delegation set up")}};ke.EventDelegator=Ke});var xt=L(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});xe.ObserverManager=void 0;var Ve=class{constructor(e,t){this.context=e,this.logger=t,this.infiniteScrollObserver=null,this.mutationObserver=null}setupInfiniteScrollObserver(){if(!this.context.getWrapperElement())return;let t=document.getElementById("scroll-sentinel");t&&(this.infiniteScrollObserver&&this.infiniteScrollObserver.disconnect(),this.infiniteScrollObserver=new IntersectionObserver(r=>{r[0].isIntersecting&&(this.logger.debug("Sentinel visible, sending load_more action"),this.context.send({action:"load_more"}))},{rootMargin:"200px"}),this.infiniteScrollObserver.observe(t),this.logger.debug("Observer set up successfully"))}setupInfiniteScrollMutationObserver(){let e=this.context.getWrapperElement();e&&(this.mutationObserver&&this.mutationObserver.disconnect(),this.mutationObserver=new MutationObserver(()=>{this.setupInfiniteScrollObserver()}),this.mutationObserver.observe(e,{childList:!0,subtree:!0}),this.logger.debug("MutationObserver set up successfully"))}teardown(){this.infiniteScrollObserver&&(this.infiniteScrollObserver.disconnect(),this.infiniteScrollObserver=null),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null)}};xe.ObserverManager=Ve});var Et=L(Ee=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0});Ee.ModalManager=void 0;var Ge=class{constructor(e){this.logger=e}open(e){let t=document.getElementById(e);if(!t){this.logger.warn(`Modal with id="${e}" not found`);return}t.removeAttribute("hidden"),t.style.display="flex",t.setAttribute("aria-hidden","false"),t.dispatchEvent(new CustomEvent("lvt:modal-opened",{bubbles:!0})),this.logger.info(`Opened modal: ${e}`);let r=t.querySelector("input, textarea, select");r&&setTimeout(()=>{let n=document.activeElement,o=i=>i?i===document.body||i.offsetParent!==null?!0:i.getClientRects().length>0:!1;(!n||!t.contains(n)||!o(n))&&r.focus()},100)}close(e){let t=document.getElementById(e);if(!t){this.logger.warn(`Modal with id="${e}" not found`);return}t.setAttribute("hidden",""),t.style.display="none",t.setAttribute("aria-hidden","true"),t.dispatchEvent(new CustomEvent("lvt:modal-closed",{bubbles:!0})),this.logger.info(`Closed modal: ${e}`)}};Ee.ModalManager=Ge});var St=L(Se=>{"use strict";Object.defineProperty(Se,"__esModule",{value:!0});Se.LoadingIndicator=void 0;var Je=class{constructor(){this.bar=null}show(){if(this.bar)return;let e=document.createElement("div");if(e.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #3b82f6 0%, #60a5fa 50%, #3b82f6 100%);
      background-size: 200% 100%;
      z-index: 9999;
      animation: lvt-loading-shimmer 1.5s ease-in-out infinite;
    `,!document.getElementById("lvt-loading-styles")){let t=document.createElement("style");t.id="lvt-loading-styles",t.textContent=`
        @keyframes lvt-loading-shimmer {
          0% { background-position: 200% 0; }
          100% { background-position: -200% 0; }
        }
      `,document.head.appendChild(t)}document.body.insertBefore(e,document.body.firstChild),this.bar=e}hide(){this.bar&&(this.bar.parentNode&&this.bar.parentNode.removeChild(this.bar),this.bar=null)}};Se.LoadingIndicator=Je});var Mt=L(Me=>{"use strict";Object.defineProperty(Me,"__esModule",{value:!0});Me.FormDisabler=void 0;var Ye=class{disable(e){if(!e)return;e.querySelectorAll("form").forEach(r=>{r.querySelectorAll("input, textarea, select, button").forEach(o=>{o.disabled=!0})})}enable(e){if(!e)return;e.querySelectorAll("form").forEach(r=>{r.querySelectorAll("input, textarea, select, button").forEach(o=>{o.disabled=!1})})}};Me.FormDisabler=Ye});var Xe=L(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.parseReactiveAttribute=At;q.executeAction=Tt;q.matchesEvent=Lt;q.processReactiveAttributes=_t;q.setupReactiveAttributeListeners=Ar;var Ct=["pending","success","error","done"],Cr={reset:"reset",disable:"disable",enable:"enable",addclass:"addClass",removeclass:"removeClass",toggleclass:"toggleClass",setattr:"setAttr",toggleattr:"toggleAttr"};function At(s,e){let t=s.toLowerCase().match(/^lvt-(\w+)-on:(.+)$/);if(!t)return null;let r=t[1],n=Cr[r];if(!n)return null;let a=t[2].split(":"),i=a[a.length-1];if(!Ct.includes(i))return null;let l=i,c=a.length>1?a.slice(0,-1).join(":"):void 0;return{action:n,lifecycle:l,actionName:c||void 0,param:e||void 0}}function Tt(s,e,t){switch(e){case"reset":s instanceof HTMLFormElement&&s.reset();break;case"disable":"disabled"in s&&(s.disabled=!0);break;case"enable":"disabled"in s&&(s.disabled=!1);break;case"addClass":if(t){let r=t.split(/\s+/).filter(Boolean);s.classList.add(...r)}break;case"removeClass":if(t){let r=t.split(/\s+/).filter(Boolean);s.classList.remove(...r)}break;case"toggleClass":t&&t.split(/\s+/).filter(Boolean).forEach(n=>s.classList.toggle(n));break;case"setAttr":if(t){let r=t.indexOf(":");if(r>0){let n=t.substring(0,r),o=t.substring(r+1);s.setAttribute(n,o)}}break;case"toggleAttr":t&&s.toggleAttribute(t);break}}function Lt(s,e,t){return s.lifecycle!==e?!1:s.actionName?s.actionName===t:!0}function _t(s,e){document.querySelectorAll("*").forEach(r=>{Array.from(r.attributes).forEach(n=>{if(!n.name.startsWith("lvt-")||!n.name.includes("-on:"))return;let o=At(n.name,n.value);o&&Lt(o,s,e)&&Tt(r,o.action,o.param)})})}function Ar(){Ct.forEach(s=>{document.addEventListener(`lvt:${s}`,e=>{let r=e.detail?.action;_t(s,r)},!0)})}});var Dt=L(Ce=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.TreeRenderer=void 0;function It(s){return typeof structuredClone=="function"?structuredClone(s):JSON.parse(JSON.stringify(s))}function Rt(s){return s!=null&&typeof s=="object"&&Array.isArray(s.d)&&Array.isArray(s.s)}var Qe=class{constructor(e){this.logger=e,this.treeState={},this.rangeState={},this.rangeIdKeys={}}applyUpdate(e){let t=!1;for(let[n,o]of Object.entries(e))if(Array.isArray(o)&&o.length>0&&Array.isArray(o[0])&&typeof o[0][0]=="string"){let i=this.treeState[n];i&&typeof i=="object"&&!Array.isArray(i)&&Array.isArray(i.d)&&Array.isArray(i.s)?(this.treeState[n]=It(i),this.applyDifferentialOpsToRange(this.treeState[n],o,n)):this.treeState[n]=o,t=!0}else{let i=this.treeState[n],l=typeof o=="object"&&o!==null&&!Array.isArray(o)?this.deepMergeTreeNodes(i,o,n):o;JSON.stringify(i)!==JSON.stringify(l)&&(this.treeState[n]=l,t=!0)}return{html:this.reconstructFromTree(this.treeState,""),changed:t}}reset(){this.treeState={},this.rangeState={},this.rangeIdKeys={}}getTreeState(){return{...this.treeState}}getStaticStructure(){return this.treeState.s||null}deepMergeTreeNodes(e,t,r=""){if(typeof t!="object"||t===null||Array.isArray(t)||typeof e!="object"||e===null||Array.isArray(e))return t;if(Rt(e)&&!Rt(t))return this.logger.debug(`[deepMerge] Range\u2192non-range transition at path ${r}, replacing instead of merging`),t;let n={...e};for(let[o,a]of Object.entries(t)){let i=r?`${r}.${o}`:o,l=Array.isArray(a)&&a.length>0&&Array.isArray(a[0])&&typeof a[0][0]=="string",c=n[o]&&typeof n[o]=="object"&&!Array.isArray(n[o])&&Array.isArray(n[o].d)&&Array.isArray(n[o].s);l&&c?(n[o]=It(n[o]),this.logger.debug(`[deepMerge] Applying diff ops at path ${i}`,{ops:a,rangeItems:n[o].d?.length}),this.applyDifferentialOpsToRange(n[o],a,i)):typeof a=="object"&&a!==null&&!Array.isArray(a)&&typeof n[o]=="object"&&n[o]!==null&&!Array.isArray(n[o])?n[o]=this.deepMergeTreeNodes(n[o],a,i):n[o]=a}return n}applyDifferentialOpsToRange(e,t,r){if(!e||typeof e!="object"||!Array.isArray(e.d)||!Array.isArray(e.s)){this.logger.error(`[applyDiffOpsToRange] Invalid rangeStructure at path ${r}`,{rangeStructure:e});return}let n=e.d;this.rangeState[r]||(this.rangeState[r]={items:n,statics:e.s,staticsMap:e.sm}),e.m&&typeof e.m=="object"&&typeof e.m.idKey=="string"&&(this.rangeIdKeys[r]=e.m.idKey),this.logger.debug(`[applyDiffOpsToRange] path=${r}, idKey=${this.rangeIdKeys[r]}, items=${n.length}, ops=${t.length}`);for(let o of t){if(!Array.isArray(o)||o.length<2)continue;switch(o[0]){case"r":{let i=o[1],l=this.findItemIndexByKey(n,i,e.s,r);this.logger.debug(`[applyDiffOpsToRange] Remove: key=${i}, index=${l}, total=${n.length}`),l>=0?(n.splice(l,1),this.logger.debug(`[applyDiffOpsToRange] After removal: ${n.length} items`)):this.logger.debug(`[applyDiffOpsToRange] Remove failed: key ${i} not found`);break}case"u":{let i=this.findItemIndexByKey(n,o[1],e.s,r),l=o[2];i>=0&&l&&(n[i]={...n[i],...l});break}case"a":{let i=Array.isArray(o[1])?o[1]:[o[1]];o[2]&&(e.s=o[2]),n.push(...i),o[3]&&typeof o[3]=="object"&&o[3].idKey&&(this.rangeIdKeys[r]=o[3].idKey);break}case"p":{let i=Array.isArray(o[1])?o[1]:[o[1]];o[2]&&(e.s=o[2]),n.unshift(...i);break}case"i":{let i=this.findItemIndexByKey(n,o[1],e.s,r);if(i>=0){let l=Array.isArray(o[2])?o[2]:[o[2]];n.splice(i+1,0,...l)}break}case"o":{let i=o[1],l=[],c=new Map;for(let d of n){let u=this.getItemKey(d,e.s,r);u&&c.set(u,d)}for(let d of i){let u=c.get(d);u&&l.push(u)}n.length=0,n.push(...l);break}default:break}}this.rangeState[r]={items:n,statics:e.s,staticsMap:e.sm}}reconstructFromTree(e,t){if(e.s&&Array.isArray(e.s)){let r="";for(let n=0;n<e.s.length;n++){let o=e.s[n];if(r+=o,n<e.s.length-1){let a=n.toString();if(e[a]!==void 0){let i=t?`${t}.${a}`:a;r+=this.renderValue(e[a],a,i)}}}return r=r.replace(/<root>/g,"").replace(/<\/root>/g,""),r}return this.renderValue(e,"",t)}renderValue(e,t,r){if(e==null||typeof e=="string"&&e.startsWith("{{")&&e.endsWith("}}"))return"";if(typeof e=="object"&&!Array.isArray(e)){if(e.d&&Array.isArray(e.d)&&e.s&&Array.isArray(e.s)){let a=r||t||"";return a&&(this.rangeState[a]={items:e.d,statics:e.s,staticsMap:e.sm},e.m&&typeof e.m=="object"&&typeof e.m.idKey=="string"&&(this.rangeIdKeys[a]=e.m.idKey)),this.renderRangeStructure(e,t,r)}if("s"in e&&Array.isArray(e.s))return this.reconstructFromTree(e,r||"");let n=Object.keys(e),o=n.filter(a=>/^\d+$/.test(a)).sort((a,i)=>parseInt(a)-parseInt(i));if(o.length>0&&o.length===n.length)return o.map(a=>{let i=r?`${r}.${a}`:a;return this.renderValue(e[a],a,i)}).join("")}return Array.isArray(e)?e.length>0&&Array.isArray(e[0])&&typeof e[0][0]=="string"?this.applyDifferentialOperations(e,r):e.map((n,o)=>{let a=o.toString(),i=r?`${r}.${a}`:a;return typeof n=="object"&&n&&n.s?this.reconstructFromTree(n,i):this.renderValue(n,a,i)}).join(""):typeof e=="object"?(this.logger.debug("Skipping plain object value (not a tree node) - this is normal for state-only data"),""):String(e)}renderRangeStructure(e,t,r){let{d:n,s:o,sm:a}=e;if(!n||!Array.isArray(n))return"";if(n.length===0){if(e.else){let l="else",c=r?`${r}.else`:"else";return this.renderValue(e.else,l,c)}return""}let i=a&&typeof a=="object";return o&&Array.isArray(o)?n.map((l,c)=>{let d=o;i&&l._sk&&a[l._sk]&&(d=a[l._sk]);let u="";for(let p=0;p<d.length;p++)if(u+=d[p],p<d.length-1){let g=p.toString();if(l[g]!==void 0){let S=r?`${r}.${c}.${g}`:`${c}.${g}`;u+=this.renderValue(l[g],g,S)}}return u}).join(""):n.map((l,c)=>{let d=c.toString(),u=r?`${r}.${d}`:d;return this.renderValue(l,d,u)}).join("")}applyDifferentialOperations(e,t){if(!t||!this.rangeState[t])return"";let r=this.rangeState[t],n=[...r.items],o=r.statics;for(let i of e){if(!Array.isArray(i)||i.length<2)continue;switch(i[0]){case"r":{let c=this.findItemIndexByKey(n,i[1],o,t);c>=0&&n.splice(c,1);break}case"u":{let c=this.findItemIndexByKey(n,i[1],o,t),d=i[2];c>=0&&d&&(n[c]={...n[c],...d});break}case"a":{this.addItemsToRange(n,i[1],i[2],r,!1),i[3]&&typeof i[3]=="object"&&i[3].idKey&&(this.rangeIdKeys[t||""]=i[3].idKey);break}case"p":{this.addItemsToRange(n,i[1],i[2],r,!0);break}case"i":{let c=this.findItemIndexByKey(n,i[1],o,t);if(c>=0){let d=Array.isArray(i[2])?i[2]:[i[2]];n.splice(c+1,0,...d)}break}case"o":{let c=i[1],d=[],u=new Map;for(let p of n){let g=this.getItemKey(p,o,t);g&&u.set(g,p)}for(let p of c){let g=u.get(p);g&&d.push(g)}n.length=0,n.push(...d);break}default:break}}this.rangeState[t]={items:n,statics:r.statics,staticsMap:r.staticsMap},this.treeState[t]={d:n,s:r.statics,sm:r.staticsMap};let a=this.getCurrentRangeStructure(t);return a&&a.s?this.renderItemsWithStatics(n,a.s,a.sm,t):n.map(i=>this.renderValue(i)).join("")}getCurrentRangeStructure(e){if(this.rangeState[e])return{d:this.rangeState[e].items,s:this.rangeState[e].statics,sm:this.rangeState[e].staticsMap};let t=this.treeState[e];return t&&typeof t=="object"&&t.s?t:null}renderItemsWithStatics(e,t,r,n){let o=e.map((a,i)=>{let l=t;r&&typeof r=="object"&&a._sk&&r[a._sk]&&(l=r[a._sk]);let c="";for(let d=0;d<l.length;d++)if(c+=l[d],d<l.length-1){let u=d.toString();if(a[u]!==void 0){let p=n?`${n}.${i}.${u}`:`${i}.${u}`;c+=this.renderValue(a[u],u,p)}}return c}).join("");return this.logger.isDebugEnabled()&&(this.logger.debug("[renderItemsWithStatics] statics:",t),this.logger.debug("[renderItemsWithStatics] items count:",e.length),this.logger.debug("[renderItemsWithStatics] result snippet:",o.substring(0,200))),o}addItemsToRange(e,t,r,n,o){if(r&&(n.statics=r),!t)return;let a=Array.isArray(t)?t:[t];o?e.unshift(...a):e.push(...a)}getItemKey(e,t,r){if(!r||!this.rangeIdKeys[r])return null;let n=this.rangeIdKeys[r];return e[n]||null}findItemIndexByKey(e,t,r,n){return e.findIndex(o=>this.getItemKey(o,r,n)===t)}};Ce.TreeRenderer=Qe});var Ot=L(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.FormLifecycleManager=void 0;var Ze=class{constructor(e){this.modalManager=e,this.activeForm=null,this.activeButton=null,this.originalButtonText=null}setActiveSubmission(e,t,r){this.activeForm=e,this.activeButton=t,this.originalButtonText=r}handleResponse(e){this.activeForm&&this.activeForm.dispatchEvent(new CustomEvent("lvt:done",{detail:e})),e.success?this.handleSuccess(e):this.handleError(e),this.restoreFormState()}reset(){this.restoreFormState()}handleSuccess(e){if(!this.activeForm)return;this.activeForm.dispatchEvent(new CustomEvent("lvt:success",{detail:e}));let t=this.activeForm.closest('[role="dialog"]');t&&t.id&&this.modalManager.close(t.id),this.activeForm.hasAttribute("lvt-preserve")||this.activeForm.reset()}handleError(e){this.activeForm&&this.activeForm.dispatchEvent(new CustomEvent("lvt:error",{detail:e}))}restoreFormState(){this.activeButton&&this.originalButtonText!==null&&(this.activeButton.disabled=!1,this.activeButton.textContent=this.originalButtonText),this.activeForm=null,this.activeButton=null,this.originalButtonText=null}};Ae.FormLifecycleManager=Ze});var Bt=L($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.WebSocketManager=$.WebSocketTransport=void 0;$.checkWebSocketAvailability=Ht;$.fetchInitialState=Nt;var Te=class{constructor(e){this.options=e,this.socket=null,this.reconnectTimer=null,this.manuallyClosed=!1,this.reconnectAttempts=0}connect(){this.manuallyClosed=!1,this.clearReconnectTimer(),this.socket=new WebSocket(this.options.url);let e=this.socket;e.onopen=()=>{this.reconnectAttempts=0,this.options.onOpen?.(e)},e.onmessage=t=>{this.options.onMessage?.(t)},e.onclose=t=>{this.options.onClose?.(t),!this.manuallyClosed&&this.options.autoReconnect&&this.scheduleReconnect()},e.onerror=t=>{this.options.onError?.(t)}}send(e){this.socket&&this.socket.readyState===1&&this.socket.send(e)}disconnect(){this.manuallyClosed=!0,this.clearReconnectTimer(),this.socket&&(this.socket.close(),this.socket=null)}getSocket(){return this.socket}scheduleReconnect(){this.clearReconnectTimer();let e=this.options.maxReconnectAttempts??10;if(e>0&&this.reconnectAttempts>=e){this.options.onReconnectFailed?.();return}this.reconnectAttempts++;let t=this.options.reconnectDelay??1e3,r=this.options.maxReconnectDelay??16e3,n=t*Math.pow(2,this.reconnectAttempts-1),o=Math.random()*1e3,a=Math.min(n+o,r);this.reconnectTimer=window.setTimeout(()=>{this.options.onReconnectAttempt?.(this.reconnectAttempts,a),this.connect()},a)}clearReconnectTimer(){this.reconnectTimer!==null&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}};$.WebSocketTransport=Te;var et=class{constructor(e){this.config=e,this.transport=null}async connect(){let e=this.getLiveUrl();return await Ht(e,this.config.logger)?(this.transport=new Te({url:this.getWebSocketUrl(),autoReconnect:this.config.options.autoReconnect,reconnectDelay:this.config.options.reconnectDelay,maxReconnectDelay:16e3,maxReconnectAttempts:10,onOpen:()=>{this.config.onConnected()},onMessage:r=>{try{let n=JSON.parse(r.data);this.config.onMessage(n,r)}catch(n){this.config.logger.error("Failed to parse WebSocket message:",n)}},onClose:()=>{this.config.onDisconnected()},onReconnectAttempt:(r,n)=>{this.config.onReconnectAttempt?.(r,n)},onReconnectFailed:()=>{this.config.onReconnectFailed?.()},onError:r=>{this.config.onError?.(r)}}),this.transport.connect(),{usingWebSocket:!0}):{usingWebSocket:!1,initialState:await Nt(e,this.config.logger)}}disconnect(){this.transport?.disconnect(),this.transport=null}send(e){this.transport?.send(e)}getReadyState(){return this.transport?.getSocket()?.readyState}getSocket(){return this.transport?.getSocket()??null}getWebSocketUrl(){let e=this.config.options.liveUrl||"/live",t=this.config.options.wsUrl;return t||`ws://${window.location.host}${e}`}getLiveUrl(){return this.config.options.liveUrl||window.location.pathname+window.location.search}};$.WebSocketManager=et;async function Ht(s,e){try{let r=(await fetch(s,{method:"HEAD"})).headers.get("X-LiveTemplate-WebSocket");return r?r==="enabled":!0}catch(t){return e?.warn("Failed to check WebSocket availability:",t),!0}}async function Nt(s,e){try{let t=await fetch(s,{method:"GET",credentials:"include",headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`Failed to fetch initial state: ${t.status}`);return await t.json()}catch(t){return e?.warn("Failed to fetch initial state:",t),null}}});var Pt=L(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});Le.S3Uploader=void 0;var tt=class{async upload(e,t,r){let{file:n}=e;e.abortController=new AbortController;try{let o=new XMLHttpRequest;o.upload.addEventListener("progress",i=>{i.lengthComputable&&(e.bytesUploaded=i.loaded,e.progress=Math.round(i.loaded/i.total*100),r&&r(e))}),e.abortController.signal.addEventListener("abort",()=>{o.abort()});let a=new Promise((i,l)=>{o.addEventListener("load",()=>{o.status>=200&&o.status<300?(e.done=!0,e.progress=100,i()):l(new Error(`S3 upload failed with status ${o.status}: ${o.statusText}`))}),o.addEventListener("error",()=>{l(new Error("S3 upload failed: Network error"))}),o.addEventListener("abort",()=>{l(new Error("S3 upload cancelled"))})});if(o.open("PUT",t.url),t.headers)for(let[i,l]of Object.entries(t.headers))o.setRequestHeader(i,l);o.send(n),await a}catch(o){throw e.error=o instanceof Error?o.message:String(o),o}}};Le.S3Uploader=tt});var Ft=L(_e=>{"use strict";Object.defineProperty(_e,"__esModule",{value:!0});_e.UploadHandler=void 0;var Tr=Pt(),rt=class{constructor(e,t={}){this.sendMessage=e,this.entries=new Map,this.pendingFiles=new Map,this.autoUploadConfig=new Map,this.uploaders=new Map,this.inputHandlers=new WeakMap,this.chunkSize=t.chunkSize||256*1024,this.onProgress=t.onProgress,this.onComplete=t.onComplete,this.onError=t.onError,this.uploaders.set("s3",new Tr.S3Uploader)}initializeFileInputs(e){e.querySelectorAll('input[type="file"][lvt-upload]').forEach(r=>{let n=r.getAttribute("lvt-upload");if(!n)return;let o=this.inputHandlers.get(r);o&&r.removeEventListener("change",o);let a=i=>{let l=i.target.files;!l||l.length===0||this.startUpload(n,Array.from(l))};r.addEventListener("change",a),this.inputHandlers.set(r,a)})}async startUpload(e,t){this.pendingFiles.set(e,t);let r=t.map(o=>({name:o.name,type:o.type||"application/octet-stream",size:o.size})),n={action:"upload_start",upload_name:e,files:r};this.sendMessage(n)}async handleUploadStartResponse(e){let{upload_name:t,entries:r}=e;r.length>0&&this.autoUploadConfig.set(t,r[0].auto_upload);let n=this.pendingFiles.get(t);if(!n){console.error(`No pending files found for upload: ${t}`);return}this.pendingFiles.delete(t);let o=new Map;for(let i of n)o.set(i.name,i);let a=[];for(let i of r){let l=o.get(i.client_name);if(!l){console.warn(`No file found for entry ${i.entry_id} (client_name: ${i.client_name})`);continue}let c={id:i.entry_id,file:l,uploadName:t,progress:0,bytesUploaded:0,valid:i.valid,done:!1,error:i.error,external:i.external};if(this.entries.set(c.id,c),a.push(c),!i.valid){this.onError&&i.error&&this.onError(c,i.error);continue}i.auto_upload&&(i.external?this.uploadExternal(c,i.external):this.uploadChunked(c))}}async uploadExternal(e,t){try{let r=this.uploaders.get(t.uploader);if(!r)throw new Error(`Unknown uploader: ${t.uploader}`);await r.upload(e,t,this.onProgress);let n={action:"upload_complete",upload_name:e.uploadName,entry_ids:[e.id]};this.sendMessage(n),this.onComplete&&this.onComplete(e.uploadName,[e]),this.clearFileInput(e.uploadName),this.cleanupEntries(e.uploadName)}catch(r){let n=r instanceof Error?r.message:String(r);e.error=n,this.onError&&this.onError(e,n),this.cleanupEntries(e.uploadName)}}async uploadChunked(e){let{file:t,id:r}=e,n=0;e.abortController=new AbortController;try{for(;n<t.size;){if(e.abortController.signal.aborted)throw new Error("Upload cancelled");let a=Math.min(n+this.chunkSize,t.size),i=t.slice(n,a),l=await this.fileToBase64(i),c={action:"upload_chunk",entry_id:r,chunk_base64:l,offset:n,total:t.size};this.sendMessage(c),n=a,e.bytesUploaded=n,e.progress=Math.round(n/t.size*100),this.onProgress&&this.onProgress(e)}e.done=!0;let o={action:"upload_complete",upload_name:e.uploadName,entry_ids:[r]};this.sendMessage(o),this.onComplete&&this.onComplete(e.uploadName,[e]),this.clearFileInput(e.uploadName),this.cleanupEntries(e.uploadName)}catch(o){let a=o instanceof Error?o.message:String(o);e.error=a,this.onError&&this.onError(e,a),this.cleanupEntries(e.uploadName)}}handleProgressMessage(e){let t=this.entries.get(e.entry_id);t&&(t.progress=e.progress,t.bytesUploaded=e.bytes_recv,this.onProgress&&this.onProgress(t))}cancelUpload(e){let t=this.entries.get(e);t&&(t.abortController&&t.abortController.abort(),this.sendMessage({action:"cancel_upload",entry_id:e}),this.entries.delete(e))}getEntries(e){let t=[];for(let r of this.entries.values())r.uploadName===e&&t.push(r);return t}triggerPendingUploads(e){let t=[];for(let r of this.entries.values())r.uploadName===e&&r.progress===0&&!r.done&&!r.error&&t.push(r);for(let r of t)r.external?this.uploadExternal(r,r.external):this.uploadChunked(r)}registerUploader(e,t){this.uploaders.set(e,t)}clearFileInput(e){document.querySelectorAll(`input[type="file"][lvt-upload="${e}"]`).forEach(r=>{r.value=""})}cleanupEntries(e,t=5e3){setTimeout(()=>{let r=[];for(let[n,o]of this.entries)e&&o.uploadName!==e||(o.done||o.error)&&r.push(n);for(let n of r)this.entries.delete(n)},t)}fileToBase64(e){return new Promise((t,r)=>{let n=new FileReader;n.onload=()=>{let a=n.result.split(",")[1];t(a)},n.onerror=r,n.readAsDataURL(e)})}};_e.UploadHandler=rt});var qt=L(ae=>{"use strict";Object.defineProperty(ae,"__esModule",{value:!0});ae.Logger=void 0;ae.createLogger=Lr;var $t={silent:0,error:1,warn:2,info:3,debug:4},Wt="LiveTemplate",Ie=class s{constructor(e,t=[],r=console){this.state=e,this.scope=t,this.sink=r}setLevel(e){this.state.level=e}getLevel(){return this.state.level}child(e){return new s(this.state,[...this.scope,e],this.sink)}isDebugEnabled(){return this.shouldLog("debug")}error(...e){this.log("error","error",e)}warn(...e){this.log("warn","warn",e)}info(...e){this.log("info","info",e)}debug(...e){this.log("debug","debug",e)}log(e,t,r){if(!this.shouldLog(e))return;(this.sink[t]||console[t]||console.log).apply(this.sink,[this.formatPrefix(),...r])}shouldLog(e){return $t[e]<=$t[this.state.level]}formatPrefix(){return this.scope.length===0?`[${Wt}]`:`[${Wt}:${this.scope.join(":")}]`}};ae.Logger=Ie;function Lr(s={}){let e={level:s.level??"info"},t=Array.isArray(s.scope)?s.scope:s.scope?[s.scope]:[];return new Ie(e,t,s.sink??console)}});var jt=L(Re=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0});Re.loadAndApplyUpdate=_r;Re.compareHTML=Ir;async function _r(s,e){try{let t=globalThis?.require;if(typeof t=="function"){let o=t("fs"),a=JSON.parse(o.readFileSync(e,"utf8"));return s.applyUpdate(a)}let n=await(await fetch(e)).json();return s.applyUpdate(n)}catch(t){throw new Error(`Failed to load update from ${e}: ${t}`)}}function Ir(s,e){let t=[],r=c=>c.replace(/\s+/g," ").replace(/>\s+</g,"><").trim(),n=r(s),o=r(e);if(n===o)return{match:!0,differences:[]};let a=n.split(`
`),i=o.split(`
`),l=Math.max(a.length,i.length);for(let c=0;c<l;c++){let d=a[c]||"",u=i[c]||"";d!==u&&(t.push(`Line ${c+1}:`),t.push(`  Expected: ${d}`),t.push(`  Actual:   ${u}`))}return{match:!1,differences:t}}});var ot=L(_=>{"use strict";var Rr=_&&_.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(_,"__esModule",{value:!0});_.LiveTemplateClient=_.extractLvtData=_.checkLvtConfirm=_.setupReactiveAttributeListeners=_.compareHTML=_.loadAndApplyUpdate=void 0;var Dr=Rr(ft()),Or=vt(),nt=yt(),Hr=kt(),Nr=xt(),Br=Et(),Pr=St(),Fr=Mt(),$r=Xe(),Wr=Dt(),qr=Ot(),jr=Bt(),Ur=Ft(),Ut=qt(),zt=jt();Object.defineProperty(_,"loadAndApplyUpdate",{enumerable:!0,get:function(){return zt.loadAndApplyUpdate}});Object.defineProperty(_,"compareHTML",{enumerable:!0,get:function(){return zt.compareHTML}});var zr=Xe();Object.defineProperty(_,"setupReactiveAttributeListeners",{enumerable:!0,get:function(){return zr.setupReactiveAttributeListeners}});var Kt=ze();Object.defineProperty(_,"checkLvtConfirm",{enumerable:!0,get:function(){return Kt.checkLvtConfirm}});Object.defineProperty(_,"extractLvtData",{enumerable:!0,get:function(){return Kt.extractLvtData}});var De=class s{constructor(e={}){this.lvtId=null,this.ws=null,this.wrapperElement=null,this.useHTTP=!1,this.sessionCookie=null,this.rateLimitedHandlers=new WeakMap,this.isInitialized=!1,this.messageCount=0;let{logger:t,logLevel:r,debug:n,...o}=e,a=r??(n?"debug":"info"),i=t??(0,Ut.createLogger)({level:a});t?r?t.setLevel(r):n&&t.setLevel("debug"):i.setLevel(a),this.logger=i.child("Client"),this.options={autoReconnect:!1,reconnectDelay:1e3,liveUrl:window.location.pathname+window.location.search,...o},this.treeRenderer=new Wr.TreeRenderer(this.logger.child("TreeRenderer")),this.focusManager=new Or.FocusManager(this.logger.child("FocusManager")),this.modalManager=new Br.ModalManager(this.logger.child("ModalManager")),this.formLifecycleManager=new qr.FormLifecycleManager(this.modalManager),this.loadingIndicator=new Pr.LoadingIndicator,this.formDisabler=new Fr.FormDisabler,this.uploadHandler=new Ur.UploadHandler(l=>this.send(l),{chunkSize:256*1024,onProgress:l=>{this.wrapperElement&&this.wrapperElement.dispatchEvent(new CustomEvent("lvt:upload:progress",{detail:{entry:l}}))},onComplete:(l,c)=>{this.logger.info(`Upload complete: ${l}`,c),this.wrapperElement&&this.wrapperElement.dispatchEvent(new CustomEvent("lvt:upload:complete",{detail:{uploadName:l,entries:c}}))},onError:(l,c)=>{this.logger.error(`Upload error for ${l.id}:`,c),this.wrapperElement&&this.wrapperElement.dispatchEvent(new CustomEvent("lvt:upload:error",{detail:{entry:l,error:c}}))}}),this.eventDelegator=new Hr.EventDelegator({getWrapperElement:()=>this.wrapperElement,getRateLimitedHandlers:()=>this.rateLimitedHandlers,parseValue:l=>this.parseValue(l),send:l=>this.send(l),setActiveSubmission:(l,c,d)=>this.formLifecycleManager.setActiveSubmission(l,c,d),openModal:l=>this.modalManager.open(l),closeModal:l=>this.modalManager.close(l),getWebSocketReadyState:()=>this.webSocketManager.getReadyState(),triggerPendingUploads:l=>this.uploadHandler.triggerPendingUploads(l)},this.logger.child("EventDelegator")),this.observerManager=new Nr.ObserverManager({getWrapperElement:()=>this.wrapperElement,send:l=>this.send(l)},this.logger.child("ObserverManager")),this.webSocketManager=new jr.WebSocketManager({options:this.options,logger:this.logger.child("Transport"),onConnected:()=>{this.ws=this.webSocketManager.getSocket(),this.logger.info("WebSocket connected"),this.clearFlashQueryParams(),this.options.onConnect?.(),this.wrapperElement?.dispatchEvent(new Event("lvt:connected"))},onDisconnected:()=>{this.ws=null,this.logger.info("WebSocket disconnected"),this.options.onDisconnect?.(),this.wrapperElement?.dispatchEvent(new Event("lvt:disconnected"))},onMessage:(l,c)=>{this.handleWebSocketPayload(l,c)},onReconnectAttempt:()=>{this.logger.info("Attempting to reconnect...")},onError:l=>{this.logger.error("WebSocket error:",l),this.options.onError?.(l)}})}static autoInit(){let e=(0,Ut.createLogger)({scope:"Client:autoInit"}),t=()=>{let r=document.querySelector("[data-lvt-id]");if(r){let n=new s;n.wrapperElement=r,r.getAttribute("data-lvt-loading")==="true"&&(n.loadingIndicator.show(),n.formDisabler.disable(n.wrapperElement)),n.connect().catch(a=>{e.error("Auto-initialization connect failed:",a)}),window.liveTemplateClient=n}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t()}handleWebSocketPayload(e,t){t&&(window.__lastWSMessage=t.data,window.__wsMessages||(window.__wsMessages=[]),window.__wsMessages.push(e));let r=e;if(r.type==="upload_progress"){this.uploadHandler.handleProgressMessage(r);return}if(r.upload_name&&r.entries){let n=r;try{this.handleUploadStartResponse(n)}catch(o){this.logger.error("Error handling upload start response:",o)}return}if(r.upload_name&&r.hasOwnProperty("success")){r.success?this.logger.info(`Upload complete: ${r.upload_name}`):this.logger.error(`Upload failed: ${r.upload_name}`,r.error);return}this.isInitialized||(this.loadingIndicator.hide(),this.formDisabler.enable(this.wrapperElement),this.wrapperElement&&this.wrapperElement.hasAttribute("data-lvt-loading")&&this.wrapperElement.removeAttribute("data-lvt-loading"),this.isInitialized=!0),this.wrapperElement&&(this.updateDOM(this.wrapperElement,e.tree,e.meta),this.messageCount++,window.__wsMessageCount=this.messageCount,this.wrapperElement.dispatchEvent(new CustomEvent("lvt:updated",{detail:{messageCount:this.messageCount,action:e.meta?.action,success:e.meta?.success}})))}async connect(e="[data-lvt-id]"){if(this.wrapperElement=document.querySelector(e),!this.wrapperElement)throw new Error(`LiveTemplate wrapper not found with selector: ${e}`);this.webSocketManager.disconnect();let t=await this.webSocketManager.connect();this.useHTTP=!t.usingWebSocket,this.useHTTP&&(this.ws=null,this.logger.info("WebSocket not available, using HTTP mode"),this.options.onConnect?.(),t.initialState&&this.wrapperElement&&this.handleWebSocketPayload(t.initialState)),this.eventDelegator.setupEventDelegation(),this.eventDelegator.setupWindowEventDelegation(),this.eventDelegator.setupClickAwayDelegation(),this.eventDelegator.setupModalDelegation(),this.eventDelegator.setupFocusTrapDelegation(),this.eventDelegator.setupAutofocusDelegation(),(0,$r.setupReactiveAttributeListeners)(),this.focusManager.attach(this.wrapperElement),this.observerManager.setupInfiniteScrollObserver(),this.observerManager.setupInfiniteScrollMutationObserver()}disconnect(){this.webSocketManager.disconnect(),this.ws=null,this.useHTTP=!1,this.observerManager.teardown(),this.formLifecycleManager.reset(),this.loadingIndicator.hide(),this.formDisabler.enable(this.wrapperElement)}clearFlashQueryParams(){let e=new URL(window.location.href),t=["error","success"],r=!1;for(let n of t)e.searchParams.has(n)&&(e.searchParams.delete(n),r=!0);r&&(this.logger.debug("Clearing flash query params from URL"),window.history.replaceState(null,"",e.toString()))}isReady(){let e=this.wrapperElement;return!e||e.hasAttribute("data-lvt-loading")?!1:this.useHTTP?!0:this.webSocketManager.getReadyState()===1}send(e){window.__lvtSendCalled=!0,window.__lvtMessageAction=e?.action;let t=this.webSocketManager.getReadyState();this.logger.isDebugEnabled()&&this.logger.debug("send() invoked",{message:e,useHTTP:this.useHTTP,hasWebSocket:t!==void 0,readyState:t}),this.useHTTP?(this.logger.debug("Using HTTP mode for send"),window.__lvtSendPath="http",this.sendHTTP(e)):t===1?(this.logger.debug("Sending via WebSocket"),window.__lvtSendPath="websocket",window.__lvtWSMessage=JSON.stringify(e),this.webSocketManager.send(JSON.stringify(e)),this.logger.debug("WebSocket send complete"),window.__lvtWSSendComplete=!0):t!==void 0?(this.logger.warn(`WebSocket not ready (state: ${t}), using HTTP fallback`),window.__lvtSendPath="http-fallback",this.sendHTTP(e)):(this.logger.error("No transport available"),window.__lvtSendPath="no-transport")}async sendHTTP(e){try{let t=this.options.liveUrl||"/live",r=await fetch(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)});if(!r.ok)throw new Error(`HTTP request failed: ${r.status}`);let n=await r.json();this.wrapperElement&&this.updateDOM(this.wrapperElement,n.tree,n.meta)}catch(t){this.logger.error("Failed to send HTTP request:",t)}}parseValue(e){let t=parseFloat(e);return!isNaN(t)&&e.trim()===t.toString()?t:e==="true"?!0:e==="false"?!1:e}applyUpdate(e){return this.treeRenderer.applyUpdate(e)}applyUpdateToHTML(e,t){let r=this.applyUpdate(t);if(!this.lvtId){let c=e.match(/data-lvt-id="([^"]+)"/);c&&(this.lvtId=c[1])}let n=r.html;if(!e.match(/<body>([\s\S]*?)<\/body>/))return e;let l=`<div data-lvt-id="${this.lvtId||"lvt-unknown"}">`+n+"</div>";return e.replace(/<body>[\s\S]*?<\/body>/,`<body>${l}</body>`)}updateDOM(e,t,r){let n=this.applyUpdate(t),o=i=>!i||typeof i!="object"?!1:i.s&&Array.isArray(i.s)?!0:Object.values(i).some(l=>o(l));if(!n.changed&&!o(t))return;let a=document.createElement(e.tagName);this.logger.isDebugEnabled()&&(this.logger.debug("[updateDOM] element.tagName:",e.tagName),this.logger.debug("[updateDOM] result.html (first 500 chars):",n.html.substring(0,500)),this.logger.debug("[updateDOM] Has <table> tag:",n.html.includes("<table>")),this.logger.debug("[updateDOM] Has <tbody> tag:",n.html.includes("<tbody>")),this.logger.debug("[updateDOM] Has <tr> tag:",n.html.includes("<tr"))),a.innerHTML=n.html,this.logger.isDebugEnabled()&&(this.logger.debug("[updateDOM] tempWrapper.innerHTML (first 500 chars):",a.innerHTML.substring(0,500)),this.logger.debug("[updateDOM] tempWrapper has <table>:",a.innerHTML.includes("<table>")),this.logger.debug("[updateDOM] tempWrapper has <tbody>:",a.innerHTML.includes("<tbody>")),this.logger.debug("[updateDOM] tempWrapper has <tr>:",a.innerHTML.includes("<tr"))),(0,Dr.default)(e,a,{childrenOnly:!0,getNodeKey:i=>{if(i.nodeType===1)return i.getAttribute("data-key")||i.getAttribute("data-lvt-key")||void 0},onBeforeElUpdated:(i,l)=>{let c=this.focusManager.getLastFocusedElement();return c&&this.focusManager.isTextualInput(i)&&i===c&&(l.value=i.value),i.isEqualNode(l)?!1:(this.executeLifecycleHook(i,"lvt-updated"),!0)},onNodeAdded:i=>{i.nodeType===Node.ELEMENT_NODE&&this.executeLifecycleHook(i,"lvt-mounted")},onBeforeNodeDiscarded:i=>(i.nodeType===Node.ELEMENT_NODE&&this.executeLifecycleHook(i,"lvt-destroyed"),!0)}),this.focusManager.restoreFocusedElement(),(0,nt.handleScrollDirectives)(e),(0,nt.handleHighlightDirectives)(e),(0,nt.handleAnimateDirectives)(e),this.uploadHandler.initializeFileInputs(e),r&&this.formLifecycleManager.handleResponse(r)}handleUploadStartResponse(e){this.uploadHandler.handleUploadStartResponse(e)}executeLifecycleHook(e,t){let r=e.getAttribute(t);if(r)try{new Function("element",r).call(e,e)}catch(n){this.logger.error(`Error executing ${t} hook:`,n)}}reset(){this.treeRenderer.reset(),this.focusManager.reset(),this.observerManager.teardown(),this.formLifecycleManager.reset(),this.loadingIndicator.hide(),this.formDisabler.enable(this.wrapperElement),this.lvtId=null}getTreeState(){return this.treeRenderer.getTreeState()}getStaticStructure(){return this.treeRenderer.getStaticStructure()}};_.LiveTemplateClient=De;typeof window<"u"&&De.autoInit()});var Yr={};nr(Yr,{BaseBlock:()=>H,InteractiveBlock:()=>Y,MessageRouter:()=>K,MonacoEditor:()=>Z,OutputPanel:()=>ee,PersistenceManager:()=>V,RunButton:()=>te,ServerBlock:()=>J,TabsController:()=>G,TinkerdownClient:()=>oe,TinyGoExecutor:()=>re,WasmBlock:()=>ne,hasEditableBlocks:()=>He,initializeWasm:()=>Gt,isMonacoLoaded:()=>Vt,loadMonaco:()=>ce,preloadMonaco:()=>Oe});var Jt=lt(ot());var Kr="__expressions__",K=class{constructor(e=!1){this.handlers=new Map;this.debug=e}register(e,t){this.handlers.has(e)&&console.warn(`[MessageRouter] Overwriting handler for block: ${e}`),this.handlers.set(e,t),this.debug&&console.log(`[MessageRouter] Registered handler for block: ${e}`)}unregister(e){this.handlers.delete(e),this.debug&&console.log(`[MessageRouter] Unregistered handler for block: ${e}`)}route(e){try{let t=typeof e=="string"?JSON.parse(e):e,{blockID:r,action:n,data:o,execMeta:a,cacheMeta:i}=t;if(n==="reload"){this.handleReload(o?.filePath||"");return}if(r===Kr&&n==="expr-update"){this.handleExpressionUpdate(o);return}if(!r){console.error("[MessageRouter] Message missing blockID:",t);return}let l=this.handlers.get(r);if(!l){console.warn(`[MessageRouter] No handler for block: ${r}`);return}this.debug&&console.log(`[MessageRouter] Routing to ${r}:`,{action:n,data:o}),l(n,o,a,i)}catch(t){console.error("[MessageRouter] Error routing message:",t)}}handleExpressionUpdate(e){this.debug&&console.log("[MessageRouter] Expression update received:",e);for(let[t,r]of Object.entries(e)){let n=document.querySelector(`.tinkerdown-expr[data-expr-id="${t}"]`);if(!n){this.debug&&console.warn(`[MessageRouter] Expression element not found: ${t}`);continue}for(;n.firstChild;)n.removeChild(n.firstChild);if(r&&typeof r=="object"&&"error"in r){let o=document.createElement("span");o.className="expr-error",o.title=String(r.error),o.textContent="\u26A0",n.appendChild(o),n.classList.add("has-error"),n.classList.remove("has-value")}else{let o=this.formatExprValue(r),a=document.createElement("span");a.className="expr-value",a.textContent=o,n.appendChild(a),n.classList.add("has-value"),n.classList.remove("has-error")}n.classList.remove("loading")}}formatExprValue(e){if(e==null)return"\u2013";if(typeof e=="boolean")return e?"\u2713":"\u2717";if(typeof e=="number")return Number.isNaN(e)?"NaN":Number.isFinite(e)?Number.isInteger(e)?e.toLocaleString():e.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2}):e>0?"\u221E":"-\u221E";if(typeof e=="string")return e;if(Array.isArray(e))return e.length===0?"[]":e.length<=3?e.map(t=>this.formatExprValue(t)).join(", "):`[${e.length} items]`;if(typeof e=="object"){let t=Object.keys(e);return t.length===0?"{}":`{${t.length} fields}`}return String(e)}handleReload(e){console.log(`[MessageRouter] Page reloading: ${e} changed`),this.showReloadNotification(e),setTimeout(()=>{window.location.reload()},500)}showReloadNotification(e){let t=document.getElementById("livemdtools-reload-notification");t&&t.remove();let r=document.createElement("div");r.id="livemdtools-reload-notification",r.innerHTML=`
      <div style="
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 16px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 100000;
        font-family: system-ui, -apple-system, sans-serif;
        font-size: 14px;
        animation: slideIn 0.3s ease-out;
      ">
        <div style="display: flex; align-items: center; gap: 10px;">
          <div style="font-size: 20px;">\u{1F504}</div>
          <div>
            <div style="font-weight: 600;">File Updated</div>
            <div style="opacity: 0.9; font-size: 12px; margin-top: 2px;">${e}</div>
          </div>
        </div>
      </div>
    `;let n=document.createElement("style");n.textContent=`
      @keyframes slideIn {
        from {
          transform: translateX(400px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
    `,document.head.appendChild(n),document.body.appendChild(r)}createEnvelope(e,t,r={}){return{blockID:e,action:t,data:r}}getRegisteredBlocks(){return Array.from(this.handlers.keys())}clear(){this.handlers.clear(),this.debug&&console.log("[MessageRouter] Cleared all handlers")}};var V=class{constructor(e="livemdtools:persistence",t=!0,r=!1){this.storageKey=e,this.enabled=t&&this.isLocalStorageAvailable(),this.debug=r,!this.enabled&&t&&console.warn("[PersistenceManager] localStorage not available, persistence disabled")}isLocalStorageAvailable(){try{let e="__localStorage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}saveCode(e,t){if(this.enabled)try{let r=this.loadAll();r.code[e]=t,r.timestamp=Date.now(),localStorage.setItem(this.storageKey,JSON.stringify(r)),this.debug&&console.log(`[PersistenceManager] Saved code for block: ${e}`)}catch(r){console.error("[PersistenceManager] Error saving code:",r)}}loadCode(e){if(!this.enabled)return null;try{return this.loadAll().code[e]||null}catch(t){return console.error("[PersistenceManager] Error loading code:",t),null}}loadAll(){if(!this.enabled)return{code:{},timestamp:Date.now()};try{let e=localStorage.getItem(this.storageKey);if(!e)return{code:{},timestamp:Date.now()};let t=JSON.parse(e);return!t.code||typeof t.code!="object"?(console.warn("[PersistenceManager] Invalid data structure, resetting"),{code:{},timestamp:Date.now()}):t}catch(e){return console.error("[PersistenceManager] Error loading data:",e),{code:{},timestamp:Date.now()}}}clearCode(e){if(this.enabled)try{let t=this.loadAll();delete t.code[e],t.timestamp=Date.now(),localStorage.setItem(this.storageKey,JSON.stringify(t)),this.debug&&console.log(`[PersistenceManager] Cleared code for block: ${e}`)}catch(t){console.error("[PersistenceManager] Error clearing code:",t)}}clearAll(){if(this.enabled)try{localStorage.removeItem(this.storageKey),this.debug&&console.log("[PersistenceManager] Cleared all persisted data")}catch(e){console.error("[PersistenceManager] Error clearing all data:",e)}}getPersistedBlocks(){if(!this.enabled)return[];let e=this.loadAll();return Object.keys(e.code)}hasPersistedCode(e){if(!this.enabled)return!1;let t=this.loadAll();return e in t.code}getLastUpdate(){return this.enabled?this.loadAll().timestamp:null}};var G=class{constructor(e=!1){this.tabGroups=new Map;this.sendMessage=null;this.debug=e,this.init()}log(...e){this.debug&&console.log("[TabsController]",...e)}setMessageSender(e){this.sendMessage=e}init(){document.querySelectorAll(".tinkerdown-tabs").forEach(t=>{let r=t.dataset.tabsId;if(!r)return;let n=Array.from(t.querySelectorAll(".tinkerdown-tab")),o=t.querySelector("[data-tabs-content]");if(n.length===0)return;let a={id:r,container:t,tabs:n,activeIndex:0,contentPanel:o};this.tabGroups.set(r,a),n.forEach((i,l)=>{i.addEventListener("click",()=>this.handleTabClick(r,l)),i.addEventListener("keydown",c=>this.handleTabKeydown(c,r,l))}),this.wrapContent(t,o),this.log("Registered tab group:",r,"with",n.length,"tabs")}),this.log("Initialized with",this.tabGroups.size,"tab groups")}wrapContent(e,t){if(!t)return;let r=[],n=e.nextSibling;for(;n&&!(n instanceof HTMLElement&&n.classList.contains("tinkerdown-tabs")||n instanceof HTMLElement&&/^H[1-6]$/.test(n.tagName)&&!n.classList.contains("tinkerdown-tabs-heading"));)r.push(n),n=n.nextSibling;r.forEach(o=>{t.appendChild(o)})}handleTabClick(e,t){let r=this.tabGroups.get(e);if(!r)return;this.setActiveTab(r,t);let o=r.tabs[t].dataset.filter||"";this.log("Tab clicked:",e,"index:",t,"filter:",o),this.applyFilter(r,o)}handleTabKeydown(e,t,r){let n=this.tabGroups.get(t);if(!n)return;let o;switch(e.key){case"ArrowLeft":o=r===0?n.tabs.length-1:r-1;break;case"ArrowRight":o=r===n.tabs.length-1?0:r+1;break;case"Home":o=0;break;case"End":o=n.tabs.length-1;break;default:return}e.preventDefault(),this.setActiveTab(n,o),n.tabs[o].focus();let a=n.tabs[o].dataset.filter||"";this.applyFilter(n,a)}setActiveTab(e,t){e.tabs.forEach((r,n)=>{let o=n===t;r.classList.toggle("active",o),r.setAttribute("aria-selected",o?"true":"false"),r.setAttribute("tabindex",o?"0":"-1")}),e.activeIndex=t,e.contentPanel&&e.contentPanel.setAttribute("aria-labelledby",e.tabs[t].id||"")}applyFilter(e,t){let r=e.contentPanel?.querySelector(".tinkerdown-interactive-block");if(!r){this.log("No interactive block found for filtering");return}let n=r.dataset.blockId;if(!n){this.log("Interactive block has no ID");return}this.sendMessage?(this.log("Sending Filter action to block:",n,"filter:",t),this.sendMessage(n,"Filter",{filter:t})):this.log("No message sender configured")}getActiveIndex(e){return this.tabGroups.get(e)?.activeIndex??0}setTab(e,t){let r=this.tabGroups.get(e);!r||t<0||t>=r.tabs.length||this.handleTabClick(e,t)}};var H=class{constructor(e,t,r=!1){this.element=e.element,this.metadata=e.metadata,this.persistence=t,this.initialCode=e.initialCode||"",this.currentCode=this.initialCode,this.debug=r}get id(){return this.metadata.id}get type(){return this.metadata.type}getCode(){return this.currentCode}setCode(e){this.currentCode=e,this.metadata.editable&&this.persistence.saveCode(this.id,e)}reset(){this.setCode(this.initialCode),this.debug&&console.log(`[Block:${this.id}] Reset to initial code`)}loadPersistedCode(){if(!this.metadata.editable)return this.initialCode;let e=this.persistence.loadCode(this.id);return e?(this.debug&&console.log(`[Block:${this.id}] Loaded persisted code`),e):this.initialCode}createBlockWrapper(){let e=document.createElement("div");return e.className=`livemdtools-block livemdtools-block-${this.type}`,e.dataset.blockId=this.id,e.dataset.blockType=this.type,e}log(...e){this.debug&&console.log(`[Block:${this.id}]`,...e)}error(...e){console.error(`[Block:${this.id}]`,...e)}};var J=class extends H{constructor(t,r,n=!1){super(t,r,n);this.codeElement=null}initialize(){this.log("Initializing server block"),this.codeElement=this.element.querySelector("code")||this.element,this.element.classList.add("livemdtools-server-block"),this.metadata.readonly&&this.element.classList.add("readonly"),this.element.dataset.blockId=this.id,this.element.dataset.language=this.metadata.language,this.render(),this.log("Server block initialized")}destroy(){this.log("Destroying server block")}handleMessage(t,r,n,o){this.log("Received message:",t,r),console.warn(`[ServerBlock:${this.id}] Received unexpected message:`,t)}render(){this.codeElement&&this.log("Rendered server block")}};var X=lt(ot());var Y=class extends H{constructor(t,r,n=!1){super(t,r,n);this.client=null;this.containerElement=null;this.sendMessage=null;this.pendingForm=null;this.pendingAction=null;this.execToolbar=null;this.outputPanel=null;this.outputExpanded=!1}initialize(){this.log("Initializing interactive block");let t=this.element.querySelector("[data-interactive-content]");if(t)this.containerElement=t;else{let r=document.createElement("div");for(r.className="exec-content-wrapper",r.dataset.interactiveContent="true";this.element.firstChild;)r.appendChild(this.element.firstChild);this.element.appendChild(r),this.containerElement=r}this.element.classList.add("livemdtools-interactive-block"),this.element.dataset.blockId=this.id,this.metadata.stateRef&&(this.element.dataset.stateRef=this.metadata.stateRef),this.client=new X.LiveTemplateClient,this.attachEventHandlers(),this.element.dataset.execSource==="true"&&this.injectExecToolbar(),this.log("Interactive block initialized")}destroy(){this.log("Destroying interactive block"),this.client&&(this.client=null)}handleMessage(t,r,n,o){switch(this.log("Received message:",t,r),t){case"tree":if(r&&this.containerElement&&this.client&&(this.client.updateDOM(this.containerElement,r),this.log("DOM updated with tree"),o&&this.updateCacheAttributes(o),this.execToolbar&&n&&this.updateExecToolbar(n),this.pendingForm)){let a={success:!0,errors:{},action:this.pendingAction};this.pendingForm.dispatchEvent(new CustomEvent("lvt:success",{bubbles:!0,detail:a})),this.log("Dispatched lvt:success event"),this.pendingForm=null,this.pendingAction=null}break;case"error":if(this.error("Server error:",r.message),this.pendingForm){let a={success:!1,errors:r.errors||{},action:this.pendingAction};this.pendingForm.dispatchEvent(new CustomEvent("lvt:error",{bubbles:!0,detail:a})),this.pendingForm=null,this.pendingAction=null}break;default:this.log("Unknown action:",t)}}setMessageSender(t){this.sendMessage=t}attachEventHandlers(){this.element&&(this.element.addEventListener("click",t=>this.handleClick(t),!0),this.element.addEventListener("submit",t=>this.handleSubmit(t),!0),this.element.addEventListener("change",t=>this.handleChange(t),!0))}handleClick(t){let r=t.target,n=r.getAttribute("lvt-click");if(n){if(t.preventDefault(),!(0,X.checkLvtConfirm)(r)){this.log("Click action cancelled by user:",n);return}let o=(0,X.extractLvtData)(r);this.sendAction(n,o),this.log("Click action:",n,o)}}handleSubmit(t){let r=t.target,n=r.getAttribute("lvt-submit");if(n){t.preventDefault();let o=new FormData(r),a={};o.forEach((i,l)=>{a[l]=i}),this.pendingForm=r,this.pendingAction=n,r.dispatchEvent(new CustomEvent("lvt:pending",{bubbles:!0,detail:{action:n}})),this.sendAction(n,a),this.log("Submit action:",n,a)}}handleChange(t){let r=t.target,n=r.getAttribute("lvt-change");if(n){let o={value:r.value};this.sendAction(n,o),this.log("Change action:",n,o)}}sendAction(t,r={}){if(!this.sendMessage){this.error("Cannot send action - no message sender configured");return}this.sendMessage(this.id,t,r)}injectExecToolbar(){let t=this.element.dataset.execCommand||"...";this.execToolbar=document.createElement("div"),this.execToolbar.className="exec-toolbar",this.execToolbar.innerHTML=`
      <div class="exec-toolbar-command"><code>${this.escapeHtml(t)}</code></div>
      <div class="exec-toolbar-status idle"><span>Ready</span></div>
      <span class="exec-toolbar-duration"></span>
      <button class="exec-toolbar-run-btn" type="button">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
          <path d="M8 5v14l11-7z"/>
        </svg>
        Run
      </button>
    `,this.outputPanel=document.createElement("div"),this.outputPanel.className="exec-output-panel",this.outputPanel.innerHTML=`
      <button class="exec-output-toggle" type="button">
        <svg class="exec-output-toggle-icon" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
          <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
        </svg>
        Output
      </button>
      <div class="exec-output-content">
        <pre class="exec-output-stdout"></pre>
        <pre class="exec-output-stderr"></pre>
      </div>
    `,this.containerElement&&this.containerElement.parentNode===this.element?(this.element.insertBefore(this.execToolbar,this.containerElement),this.execToolbar.after(this.outputPanel)):(this.element.insertBefore(this.execToolbar,this.element.firstChild),this.execToolbar.after(this.outputPanel)),this.execToolbar.querySelector(".exec-toolbar-run-btn")?.addEventListener("click",()=>this.handleExecRun()),this.outputPanel.querySelector(".exec-output-toggle")?.addEventListener("click",()=>this.toggleOutput()),this.log("Exec toolbar injected")}handleExecRun(){this.log("Run button clicked"),this.sendAction("Run",{})}toggleOutput(){this.outputExpanded=!this.outputExpanded,this.outputPanel?.querySelector(".exec-output-toggle")?.classList.toggle("expanded",this.outputExpanded),this.outputPanel?.querySelector(".exec-output-content")?.classList.toggle("expanded",this.outputExpanded)}updateExecToolbar(t){let r=t.status||"idle",n=this.execToolbar?.querySelector(".exec-toolbar-status"),o=this.execToolbar?.querySelector(".exec-toolbar-duration"),a=this.execToolbar?.querySelector(".exec-toolbar-run-btn");n&&(n.className=`exec-toolbar-status ${r}`,r==="running"?n.innerHTML='<span class="exec-spinner"></span>':r==="success"?n.innerHTML="<span>\u2713 Success</span>":r==="error"?n.innerHTML="<span>\u2717 Error</span>":n.innerHTML="<span>Ready</span>"),o&&t.duration&&(o.textContent=`${t.duration}ms`),a&&(a.disabled=r==="running",r==="running"?(a.classList.add("running"),a.innerHTML=`
          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 5v14l11-7z"/>
          </svg>
          Running...
        `):(a.classList.remove("running"),a.innerHTML=`
          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 5v14l11-7z"/>
          </svg>
          Run
        `));let i=this.outputPanel?.querySelector(".exec-output-stdout"),l=this.outputPanel?.querySelector(".exec-output-stderr");i&&(i.textContent=t.output||""),l&&(l.textContent=t.stderr||"",l.style.display=t.stderr?"block":"none"),this.log("Exec toolbar updated:",r,t.duration)}updateCacheAttributes(t){this.element&&(t.stale?this.element.dataset.cacheStale="true":delete this.element.dataset.cacheStale,t.refreshing?this.element.dataset.cacheRefreshing="true":delete this.element.dataset.cacheRefreshing,t.cached?(this.element.dataset.cacheCached="true",t.age&&(this.element.dataset.cacheAge=t.age),t.expires_in&&(this.element.dataset.cacheExpiresIn=t.expires_in)):(delete this.element.dataset.cacheCached,delete this.element.dataset.cacheAge,delete this.element.dataset.cacheExpiresIn),this.log("Cache attributes updated:",t))}escapeHtml(t){let r=document.createElement("div");return r.textContent=t,r.innerHTML}};var Vr="0.45.0",j=`https://cdn.jsdelivr.net/npm/monaco-editor@${Vr}/min`,le=null,Q=null;function Gr(){return new Promise((s,e)=>{if(typeof window.require=="function"){s();return}let t=document.createElement("script");t.src=`${j}/vs/loader.js`,t.async=!0,t.onload=()=>s(),t.onerror=()=>e(new Error("Failed to load Monaco loader from CDN")),document.head.appendChild(t)})}function Jr(){window.MonacoEnvironment={getWorkerUrl:function(s,e){let t=`${j}/vs/base/worker/workerMain.js`;return e==="json"?`${j}/vs/language/json/json.worker.js`:e==="css"||e==="scss"||e==="less"?`${j}/vs/language/css/css.worker.js`:e==="html"||e==="handlebars"||e==="razor"?`${j}/vs/language/html/html.worker.js`:e==="typescript"||e==="javascript"?`${j}/vs/language/typescript/ts.worker.js`:t}}}async function ce(){if(le)return le;if(Q)return Q;console.log("[MonacoLoader] Loading Monaco Editor from CDN...");let s=performance.now();return Q=(async()=>{try{await Gr();let e=window.require;if(!e)throw new Error("AMD loader not available after loading");return e.config({paths:{vs:`${j}/vs`}}),Jr(),await new Promise((t,r)=>{e(["vs/editor/editor.main"],n=>{if(!n){r(new Error("Monaco module loaded but is undefined"));return}le=n;let o=Math.round(performance.now()-s);console.log(`[MonacoLoader] Monaco Editor loaded from CDN in ${o}ms`),t(n)})})}catch(e){throw Q=null,e}})(),Q}function Vt(){return le!==null}function Oe(){!le&&!Q&&ce().catch(s=>{console.error("[MonacoLoader] Failed to preload Monaco from CDN:",s)})}function He(){return document.querySelectorAll('[data-block-type="wasm"]').length>0}var Z=class{constructor(e,t,r){this.editor=null;this.monaco=null;this.onChangeCallback=null;this.editorDiv=null;this.initPromise=null;this.container=e,this.initialCode=t,this.options=r,this.initPromise=this.initialize()}async initialize(){let e=document.createElement("div");e.className="livemdtools-monaco-loading",e.style.padding="2rem",e.style.textAlign="center",e.style.color="#999",e.textContent="Loading editor...",this.container.appendChild(e);try{this.monaco=await ce(),e.remove(),this.editorDiv=document.createElement("div"),this.editorDiv.className="livemdtools-monaco-editor",this.editorDiv.style.height="300px",this.editorDiv.style.width="100%",this.container.appendChild(this.editorDiv),this.editor=this.monaco.editor.create(this.editorDiv,{value:this.initialCode,language:this.options.language,theme:this.options.theme||"vs-dark",readOnly:this.options.readonly,minimap:{enabled:this.options.minimap??!0},lineNumbers:this.options.lineNumbers!==!1?"on":"off",scrollBeyondLastLine:!1,automaticLayout:!0,fontSize:14,tabSize:4,insertSpaces:!1}),this.editor.onDidChangeModelContent(()=>{this.onChangeCallback&&this.editor&&this.onChangeCallback(this.editor.getValue())})}catch(t){console.error("[MonacoEditor] Failed to load Monaco:",t),e.textContent="Failed to load editor",e.style.color="#f44"}}async ensureReady(){this.initPromise&&await this.initPromise}getValue(){return this.editor?.getValue()||""}async setValue(e){await this.ensureReady(),this.editor?.setValue(e)}onChange(e){this.onChangeCallback=e}async setReadOnly(e){await this.ensureReady(),this.editor?.updateOptions({readOnly:e})}async focus(){await this.ensureReady(),this.editor?.focus()}async layout(){await this.ensureReady(),this.editor?.layout()}destroy(){this.editor?.dispose(),this.editor=null}async getEditor(){return await this.ensureReady(),this.editor}};var ee=class{constructor(e,t=1e3,r=!0){this.lines=[];this.maxLines=t,this.autoScroll=r,this.element=this.createPanel(),e.appendChild(this.element)}createPanel(){let e=document.createElement("div");e.className="livemdtools-output-panel",e.innerHTML=`
      <div class="output-header">
        <span class="output-title">Output</span>
        <button class="output-clear" title="Clear output">Clear</button>
      </div>
      <div class="output-content"></div>
    `;let t=e.querySelector(".output-clear");return t&&t.addEventListener("click",()=>this.clear()),e}append(e,t){let r={type:e,text:t,timestamp:Date.now()};this.lines.push(r),this.lines.length>this.maxLines&&(this.lines=this.lines.slice(-this.maxLines)),this.render()}stdout(e){this.append("stdout",e)}stderr(e){this.append("stderr",e)}error(e){this.append("error",e)}info(e){this.append("info",e)}clear(){this.lines=[],this.render()}show(){this.element.style.display="block"}hide(){this.element.style.display="none"}render(){let e=this.element.querySelector(".output-content");if(e){e.innerHTML="";for(let t of this.lines){let r=document.createElement("div");r.className=`output-line output-${t.type}`,r.textContent=t.text,e.appendChild(r)}this.autoScroll&&(e.scrollTop=e.scrollHeight)}}getElement(){return this.element}destroy(){this.element.remove()}};var te=class{constructor(e,t="Run"){this.callback=null;this.isRunning=!1;this.element=this.createButton(t),e.appendChild(this.element)}createButton(e){let t=document.createElement("button");return t.className="livemdtools-run-button",t.textContent=e,t.addEventListener("click",()=>this.handleClick()),t}onClick(e){this.callback=e}async handleClick(){if(!(this.isRunning||!this.callback)){this.setRunning(!0);try{await this.callback()}catch(e){console.error("[RunButton] Error executing callback:",e)}finally{this.setRunning(!1)}}}setRunning(e){this.isRunning=e,this.element.disabled=e,e?(this.element.classList.add("running"),this.element.textContent="Running..."):(this.element.classList.remove("running"),this.element.textContent="Run")}enable(){this.element.disabled=!1}disable(){this.element.disabled=!0}getElement(){return this.element}destroy(){this.element.remove()}};var re=class{constructor(e="/api/compile",t=!1){this.serverUrl=e,this.debug=t}async execute(e){this.debug&&console.log("[TinyGoExecutor] Executing code:",e);try{let t=await fetch(this.serverUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})});if(!t.ok){let n=await t.text();return{stdout:"",stderr:n,error:`Compilation failed: ${n}`,exitCode:1}}let r=await t.arrayBuffer();return await this.executeWasm(r)}catch(t){return{stdout:"",stderr:"",error:`Execution failed: ${t instanceof Error?t.message:String(t)}`,exitCode:1}}}async executeWasm(e){let t="",r="";try{let n=new window.Go,o=console.log,a=console.error;console.log=(...l)=>{t+=l.join(" ")+`
`},console.error=(...l)=>{r+=l.join(" ")+`
`};let i=await WebAssembly.instantiate(e,n.importObject);return await n.run(i.instance),console.log=o,console.error=a,{stdout:t,stderr:r,exitCode:0}}catch(n){let o=n instanceof Error?n.message:String(n);return{stdout:t,stderr:r,error:`WASM execution failed: ${o}`,exitCode:1}}}static isSupported(){return typeof WebAssembly<"u"&&typeof window.Go<"u"}};async function Gt(){if(!window.Go)try{let s=document.createElement("script");s.src="/assets/wasm_exec.js",await new Promise((e,t)=>{s.onload=()=>e(),s.onerror=()=>t(new Error("Failed to load wasm_exec.js")),document.head.appendChild(s)}),console.log("[TinyGoExecutor] WASM environment initialized")}catch(s){throw console.error("[TinyGoExecutor] Failed to initialize WASM:",s),s}}var ne=class extends H{constructor(t,r,n=!1){super(t,r,n);this.editor=null;this.outputPanel=null;this.runButton=null;this.executor=null;this.containerElement=null;this.editorContainer=null;this.controlsContainer=null}initialize(){this.log("Initializing WASM block"),this.currentCode=this.loadPersistedCode(),this.createBlockStructure(),this.initializeEditor(),this.initializeControls(),this.initializeExecutor(),this.log("WASM block initialized")}destroy(){this.log("Destroying WASM block"),this.editor?.destroy(),this.outputPanel?.destroy(),this.runButton?.destroy(),this.editor=null,this.outputPanel=null,this.runButton=null,this.executor=null}handleMessage(t,r,n,o){this.log("Received message:",t,r)}createBlockStructure(){this.containerElement=document.createElement("div"),this.containerElement.className="livemdtools-wasm-block",this.containerElement.dataset.blockId=this.id,this.editorContainer=document.createElement("div"),this.editorContainer.className="wasm-editor-container",this.containerElement.appendChild(this.editorContainer),this.controlsContainer=document.createElement("div"),this.controlsContainer.className="wasm-controls",this.containerElement.appendChild(this.controlsContainer),this.element.parentNode&&this.element.parentNode.replaceChild(this.containerElement,this.element)}initializeEditor(){this.editorContainer&&(this.editor=new Z(this.editorContainer,this.currentCode,{language:this.metadata.language||"go",readonly:this.metadata.readonly||!1,theme:"vs-dark",minimap:!1,lineNumbers:!0}),this.editor.onChange(t=>{this.setCode(t)}),this.log("Editor initialized"))}initializeControls(){if(!this.controlsContainer)return;let t=document.createElement("div");t.className="wasm-buttons",this.runButton=new te(t,"Run"),this.runButton.onClick(()=>this.executeCode());let r=document.createElement("button");r.className="livemdtools-reset-button",r.textContent="Reset",r.addEventListener("click",()=>this.resetCode()),t.appendChild(r),this.controlsContainer.appendChild(t),this.outputPanel=new ee(this.controlsContainer),this.outputPanel.hide(),this.log("Controls initialized")}initializeExecutor(){this.executor=new re("/api/compile",this.debug),this.log("Executor initialized")}async executeCode(){if(!this.editor||!this.executor||!this.outputPanel){this.error("Cannot execute - components not initialized");return}let t=this.editor.getValue();this.log("Executing code"),this.outputPanel.clear(),this.outputPanel.show(),this.outputPanel.info("Compiling and running...");try{let r=await this.executor.execute(t);this.outputPanel.clear(),r.stdout&&this.outputPanel.stdout(r.stdout),r.stderr&&this.outputPanel.stderr(r.stderr),r.error&&this.outputPanel.error(r.error),r.exitCode===0&&!r.stdout&&!r.stderr&&this.outputPanel.info("Program completed successfully (no output)"),this.log("Execution completed with exit code:",r.exitCode)}catch(r){let n=r instanceof Error?r.message:String(r);this.outputPanel.error(`Execution error: ${n}`),this.error("Execution error:",r)}}resetCode(){this.editor&&(this.editor.setValue(this.initialCode),this.setCode(this.initialCode),this.outputPanel?.clear(),this.log("Code reset to initial state"))}};var oe=class{constructor(e){this.tabs=null;this.blocks=new Map;this.ws=null;this.reconnectTimer=null;this.isConnected=!1;this.options={debug:!1,persistence:!0,cdnFallback:!1,...e},this.router=new K(this.options.debug),this.persistence=new V("tinkerdown:persistence",this.options.persistence,this.options.debug),this.options.debug&&console.log("[TinkerdownClient] Initialized with options:",this.options)}connect(){if(this.ws){console.warn("[TinkerdownClient] Already connected");return}try{this.ws=new WebSocket(this.options.wsUrl),this.ws.onopen=()=>{this.isConnected=!0,console.log("[TinkerdownClient] Connected to server"),this.options.onConnect?.()},this.ws.onclose=()=>{this.isConnected=!1,console.log("[TinkerdownClient] Disconnected from server"),this.options.onDisconnect?.(),this.scheduleReconnect()},this.ws.onerror=e=>{console.error("[TinkerdownClient] WebSocket error:",e),this.options.onError?.(new Error("WebSocket error"))},this.ws.onmessage=e=>{this.handleMessage(e.data)}}catch(e){console.error("[TinkerdownClient] Failed to connect:",e),this.options.onError?.(e)}}disconnect(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws&&(this.ws.close(),this.ws=null),this.isConnected=!1}handleMessage(e){this.options.debug&&console.log("[TinkerdownClient] Received message:",e),this.router.route(e)}send(e,t,r={}){if(!this.isConnected||!this.ws){console.warn("[TinkerdownClient] Cannot send - not connected");return}let o=JSON.stringify({blockID:e,action:t,data:r});this.options.debug&&console.log("[TinkerdownClient] Sending message:",o),this.ws.send(o)}scheduleReconnect(){this.reconnectTimer||(this.reconnectTimer=window.setTimeout(()=>{this.reconnectTimer=null,console.log("[TinkerdownClient] Attempting to reconnect..."),this.connect()},3e3))}discoverBlocks(){console.log("[TinkerdownClient] Discovering blocks..."),(0,Jt.setupReactiveAttributeListeners)(),this.tabs=new G(this.options.debug),this.tabs.setMessageSender((t,r,n)=>{this.send(t,r,n)});let e=document.querySelectorAll("[data-tinkerdown-block]");for(let t of Array.from(e))try{let r=this.extractMetadata(t),n=this.extractCode(t),o={element:t,metadata:r,initialCode:n};this.registerBlock(o)}catch(r){console.error("[TinkerdownClient] Error discovering block:",r)}console.log(`[TinkerdownClient] Discovered ${this.blocks.size} blocks`)}extractMetadata(e){let t=e.dataset.blockId||this.generateBlockId(),r=e.dataset.blockType||"server",n=e.dataset.language||"go",o=e.dataset.readonly==="true",a=e.dataset.editable==="true",i=e.dataset.stateRef;return{id:t,type:r,language:n,readonly:o,editable:a,stateRef:i}}extractCode(e){let t=e.querySelector("code");return t?t.textContent||"":e.textContent||""}generateBlockId(){return`block-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}registerBlock(e){let{metadata:t}=e;if(this.blocks.has(t.id)){console.warn(`[TinkerdownClient] Block already registered: ${t.id}`);return}let r;switch(t.type){case"server":r=new J(e,this.persistence,this.options.debug);break;case"interactive":case"lvt":r=new Y(e,this.persistence,this.options.debug),r.setMessageSender((n,o,a)=>{this.send(n,o,a)});break;case"wasm":r=new ne(e,this.persistence,this.options.debug);break;default:console.warn(`[TinkerdownClient] Unknown block type: ${t.type}`);return}r.initialize(),this.router.register(t.id,(n,o,a,i)=>{r.handleMessage(n,o,a,i)}),this.blocks.set(t.id,r),this.options.debug&&console.log(`[TinkerdownClient] Registered block: ${t.id} (${t.type})`)}unregisterBlock(e){let t=this.blocks.get(e);t&&(t.destroy(),this.router.unregister(e),this.blocks.delete(e),this.options.debug&&console.log(`[TinkerdownClient] Unregistered block: ${e}`))}getBlock(e){return this.blocks.get(e)}getBlockIds(){return Array.from(this.blocks.keys())}destroy(){console.log("[TinkerdownClient] Destroying client");for(let e of this.blocks.values())e.destroy();this.blocks.clear(),this.router.clear(),this.disconnect()}};var Ne=class{constructor(){this.steps=[];this.currentStepIndex=0;this.sidebar=null;this.bottomNav=null;this.init()}init(){if(document.querySelector(".tinkerdown-nav-sidebar"))return;let e=document.querySelector('meta[name="tinkerdown-sidebar"]');e&&e.getAttribute("content")==="false"||(this.parseSteps(),this.steps.length!==0&&(this.createSidebar(),this.createBottomNav(),this.setupKeyboardShortcuts(),this.setupHashNavigation(),this.setupScrollTracking(),this.initializeFromHash()))}parseSteps(){document.querySelectorAll("h2").forEach((t,r)=>{let n=t.id||this.generateId(t.textContent||"");t.id||(t.id=n),this.steps.push({id:n,title:t.textContent||"",element:t,index:r})})}generateId(e){return e.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim()}createSidebar(){this.sidebar=document.createElement("nav"),this.sidebar.className="tinkerdown-nav-sidebar",this.sidebar.innerHTML=`
      <div class="nav-sidebar-header">
        <h3>Contents</h3>
      </div>
      <ol class="nav-sidebar-steps">
        ${this.steps.map((e,t)=>`
          <li class="nav-step ${t===0?"active":""}" data-step="${t}">
            <a href="#${e.id}">
              <span class="step-number">${t+1}</span>
              <span class="step-title">${e.title}</span>
            </a>
          </li>
        `).join("")}
      </ol>
    `,this.sidebar.querySelectorAll(".nav-step").forEach((e,t)=>{e.addEventListener("click",r=>{r.preventDefault(),this.navigateToStep(t)})}),document.body.appendChild(this.sidebar)}createBottomNav(){this.bottomNav=document.createElement("nav"),this.bottomNav.className="livemdtools-nav-bottom",this.bottomNav.innerHTML=`
      <button class="nav-btn nav-prev" ${this.currentStepIndex===0?"disabled":""}>
        <span class="nav-arrow">\u2190</span>
        <span class="nav-label">Previous</span>
      </button>
      <span class="nav-progress">
        Step <span class="current-step">1</span> of <span class="total-steps">${this.steps.length}</span>
      </span>
      <button class="nav-btn nav-next" ${this.currentStepIndex===this.steps.length-1?"disabled":""}>
        <span class="nav-label">Next</span>
        <span class="nav-arrow">\u2192</span>
      </button>
    `;let e=this.bottomNav.querySelector(".nav-prev"),t=this.bottomNav.querySelector(".nav-next");e?.addEventListener("click",()=>this.navigatePrev()),t?.addEventListener("click",()=>this.navigateNext()),document.body.appendChild(this.bottomNav)}setupKeyboardShortcuts(){document.addEventListener("keydown",e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))switch(e.key){case"ArrowRight":case"ArrowDown":e.preventDefault(),this.navigateNext();break;case"ArrowLeft":case"ArrowUp":e.preventDefault(),this.navigatePrev();break}})}setupHashNavigation(){window.addEventListener("hashchange",()=>{this.handleHashChange()})}setupScrollTracking(){let e=new IntersectionObserver(t=>{t.forEach(r=>{if(r.isIntersecting){let n=r.target,o=this.steps.findIndex(a=>a.element===n);o!==-1&&o!==this.currentStepIndex&&this.updateCurrentStep(o,!1)}})},{threshold:.5,rootMargin:"-100px 0px -50% 0px"});this.steps.forEach(t=>e.observe(t.element))}initializeFromHash(){let e=window.location.hash.slice(1);if(e){let t=this.steps.findIndex(r=>r.id===e);if(t!==-1){this.navigateToStep(t);return}}this.updateCurrentStep(0,!1)}handleHashChange(){let e=window.location.hash.slice(1);if(e){let t=this.steps.findIndex(r=>r.id===e);t!==-1&&this.navigateToStep(t,!1)}}navigateToStep(e,t=!0){e<0||e>=this.steps.length||(this.updateCurrentStep(e,!0),t&&history.pushState(null,"",`#${this.steps[e].id}`))}navigateNext(){this.currentStepIndex<this.steps.length-1&&this.navigateToStep(this.currentStepIndex+1)}navigatePrev(){this.currentStepIndex>0&&this.navigateToStep(this.currentStepIndex-1)}updateCurrentStep(e,t=!0){if(this.currentStepIndex=e,this.sidebar&&this.sidebar.querySelectorAll(".nav-step").forEach((r,n)=>{r.classList.toggle("active",n===e)}),this.bottomNav){let r=this.bottomNav.querySelector(".nav-prev"),n=this.bottomNav.querySelector(".nav-next"),o=this.bottomNav.querySelector(".current-step");r&&(r.disabled=e===0),n&&(n.disabled=e===this.steps.length-1),o&&(o.textContent=String(e+1))}t&&this.scrollToStep(e)}scrollToStep(e){let t=this.steps[e];t&&t.element.scrollIntoView({behavior:"smooth",block:"start"})}getCurrentStep(){return this.currentStepIndex}getTotalSteps(){return this.steps.length}goToStep(e){this.navigateToStep(e)}};var Be=class{constructor(){this.searchIndex=[];this.searchModal=null;this.searchInput=null;this.resultsContainer=null;this.selectedIndex=0;document.querySelector(".tinkerdown-nav-sidebar")&&this.init()}async init(){await this.loadSearchIndex(),this.createSearchModal(),this.setupKeyboardShortcuts(),this.addSearchButton()}async loadSearchIndex(){try{let e=await fetch("/search-index.json");if(!e.ok)return;let t=e.headers.get("content-type");if(!t||!t.includes("application/json"))return;this.searchIndex=await e.json(),console.log(`[Search] Loaded ${this.searchIndex.length} pages`)}catch{}}createSearchModal(){this.searchModal=document.createElement("div"),this.searchModal.className="search-modal",this.searchModal.innerHTML=`
      <div class="search-backdrop"></div>
      <div class="search-container">
        <div class="search-input-wrapper">
          <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          <input
            type="text"
            class="search-input"
            placeholder="Search documentation..."
            autocomplete="off"
            spellcheck="false"
          />
          <button class="search-close" aria-label="Close search">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        <div class="search-results"></div>
        <div class="search-footer">
          <div class="search-hints">
            <span><kbd>\u2191</kbd><kbd>\u2193</kbd> Navigate</span>
            <span><kbd>\u21B5</kbd> Select</span>
            <span><kbd>Esc</kbd> Close</span>
          </div>
        </div>
      </div>
    `,document.body.appendChild(this.searchModal),this.searchInput=this.searchModal.querySelector(".search-input"),this.resultsContainer=this.searchModal.querySelector(".search-results"),this.searchInput?.addEventListener("input",()=>this.handleSearch()),this.searchInput?.addEventListener("keydown",e=>this.handleKeyDown(e)),this.searchModal.querySelector(".search-close")?.addEventListener("click",()=>this.closeSearch()),this.searchModal.querySelector(".search-backdrop")?.addEventListener("click",()=>this.closeSearch())}addSearchButton(){let e=document.querySelector(".tinkerdown-nav-sidebar");if(!e)return;let t=e.querySelector(".nav-header");if(!t)return;let r=document.createElement("button");r.className="search-button",r.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
      <span>Search</span>
      <kbd>\u2318K</kbd>
    `,r.addEventListener("click",()=>this.openSearch()),t.appendChild(r)}setupKeyboardShortcuts(){document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="k"&&(e.preventDefault(),this.openSearch()),e.key==="Escape"&&this.searchModal?.classList.contains("open")&&this.closeSearch()})}openSearch(){this.searchModal?.classList.add("open"),this.searchInput?.focus(),this.selectedIndex=0}closeSearch(){this.searchModal?.classList.remove("open"),this.searchInput&&(this.searchInput.value=""),this.resultsContainer&&(this.resultsContainer.innerHTML="")}handleSearch(){let e=this.searchInput?.value.trim()||"";if(e.length===0){this.resultsContainer&&(this.resultsContainer.innerHTML="");return}let t=this.search(e);this.renderResults(t)}search(e){let t=e.toLowerCase(),r=[];for(let n of this.searchIndex){let o=n.title.toLowerCase(),a=n.content.toLowerCase(),i=o.includes(t),l=a.includes(t);if(i||l){let c=0;i&&(c+=10,o===t?c+=50:o.startsWith(t)&&(c+=20)),l&&(c+=1),r.push({...n,score:c,titleMatches:i,contentMatches:l})}}return r.sort((n,o)=>o.score-n.score),r.slice(0,10)}renderResults(e){if(this.resultsContainer){if(e.length===0){this.resultsContainer.innerHTML='<div class="search-no-results">No results found</div>';return}this.resultsContainer.innerHTML=e.map((t,r)=>`
      <a
        href="${t.path}"
        class="search-result ${r===this.selectedIndex?"selected":""}"
        data-index="${r}"
      >
        <div class="search-result-title">
          ${this.highlightMatch(t.title,this.searchInput?.value||"")}
        </div>
        ${t.section?`<div class="search-result-section">${t.section}</div>`:""}
        <div class="search-result-content">
          ${this.highlightMatch(this.truncateContent(t.content),this.searchInput?.value||"")}
        </div>
      </a>
    `).join(""),this.resultsContainer.querySelectorAll(".search-result").forEach(t=>{t.addEventListener("click",()=>this.closeSearch())})}}highlightMatch(e,t){if(!t)return e;let r=new RegExp(`(${this.escapeRegex(t)})`,"gi");return e.replace(r,"<mark>$1</mark>")}truncateContent(e,t=200){return e.length<=t?e:e.substring(0,t)+"..."}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}handleKeyDown(e){if(!this.resultsContainer)return;let t=this.resultsContainer.querySelectorAll(".search-result");switch(e.key){case"Escape":e.preventDefault(),this.closeSearch();break;case"ArrowDown":if(t.length===0)return;e.preventDefault(),this.selectedIndex=Math.min(this.selectedIndex+1,t.length-1),this.updateSelection();break;case"ArrowUp":if(t.length===0)return;e.preventDefault(),this.selectedIndex=Math.max(this.selectedIndex-1,0),this.updateSelection();break;case"Enter":if(t.length===0)return;e.preventDefault();let r=t[this.selectedIndex];r&&(window.location.href=r.href,this.closeSearch());break}}updateSelection(){if(!this.resultsContainer)return;let e=this.resultsContainer.querySelectorAll(".search-result");e.forEach((r,n)=>{r.classList.toggle("selected",n===this.selectedIndex)});let t=e[this.selectedIndex];t&&t.scrollIntoView({block:"nearest",behavior:"smooth"})}};var Pe=class s{static{this.COPY_BUTTON_CLASS="code-copy-btn"}static{this.CODE_WRAPPER_CLASS="code-block-wrapper"}static{this.COPIED_CLASS="copied"}constructor(){this.init()}init(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.addCopyButtons()):this.addCopyButtons()}addCopyButtons(){document.querySelectorAll("pre > code").forEach(t=>{let r=t.parentElement;if(!r||r.querySelector(`.${s.COPY_BUTTON_CLASS}`))return;if(!r.parentElement?.classList.contains(s.CODE_WRAPPER_CLASS)){let o=document.createElement("div");o.className=s.CODE_WRAPPER_CLASS,r.parentNode?.insertBefore(o,r),o.appendChild(r)}let n=this.createCopyButton();r.appendChild(n),n.addEventListener("click",o=>{o.preventDefault(),this.copyCode(t,n)})})}createCopyButton(){let e=document.createElement("button");return e.className=s.COPY_BUTTON_CLASS,e.setAttribute("aria-label","Copy code to clipboard"),e.innerHTML=this.getCopyIcon(),e}async copyCode(e,t){let r=e.textContent||"";try{await navigator.clipboard.writeText(r),this.showCopiedFeedback(t)}catch(n){console.error("Failed to copy code:",n),this.fallbackCopy(r,t)}}showCopiedFeedback(e){e.classList.add(s.COPIED_CLASS),e.innerHTML=this.getCheckIcon(),e.setAttribute("aria-label","Code copied!"),setTimeout(()=>{e.classList.remove(s.COPIED_CLASS),e.innerHTML=this.getCopyIcon(),e.setAttribute("aria-label","Copy code to clipboard")},2e3)}fallbackCopy(e,t){let r=document.createElement("textarea");r.value=e,r.style.position="fixed",r.style.opacity="0",document.body.appendChild(r),r.select();try{document.execCommand("copy"),this.showCopiedFeedback(t)}catch(n){console.error("Fallback copy failed:",n)}finally{document.body.removeChild(r)}}getCopyIcon(){return`
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10.5 2H3.5C2.67 2 2 2.67 2 3.5V10.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        <rect x="5.5" y="5.5" width="8" height="8" rx="1" stroke="currentColor" stroke-width="1.5"/>
      </svg>
    `}getCheckIcon(){return`
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 8L6.5 11.5L13 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    `}};var Fe=class{constructor(){this.sections=[];this.tocElement=null;this.currentActiveSection=-1;this.init()}init(){document.querySelector(".tinkerdown-nav-sidebar")&&(this.parseSections(),this.sections.length!==0&&(this.createTOC(),this.setupScrollTracking()))}parseSections(){document.querySelectorAll(".content-wrapper h2").forEach((t,r)=>{let n=t.id||this.generateId(t.textContent||"");t.id||(t.id=n),this.sections.push({id:n,title:t.textContent||"",element:t,index:r})})}generateId(e){return e.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim()}createTOC(){let e=document.querySelector(".tinkerdown-nav-sidebar");if(!e)return;let t=e.querySelector(".nav-page-link.active");if(!t)return;let r=t.closest("li");if(!r)return;let n=document.createElement("ul");n.className="page-toc-list",n.innerHTML=this.sections.map((o,a)=>`
      <li class="page-toc-item" data-section="${a}">
        <a href="#${o.id}" class="page-toc-link">
          ${this.escapeHtml(o.title)}
        </a>
      </li>
    `).join(""),n.querySelectorAll(".page-toc-item").forEach((o,a)=>{o.querySelector("a")?.addEventListener("click",l=>{l.preventDefault(),this.scrollToSection(a)})}),r.appendChild(n),r.classList.add("has-subnav"),this.tocElement=n}escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}setupScrollTracking(){let e=new IntersectionObserver(t=>{t.forEach(r=>{if(r.isIntersecting){let n=r.target,o=this.sections.findIndex(a=>a.element===n);o!==-1&&o!==this.currentActiveSection&&this.updateActiveSection(o)}})},{threshold:.5,rootMargin:"-100px 0px -50% 0px"});this.sections.forEach(t=>e.observe(t.element))}updateActiveSection(e){this.currentActiveSection=e,this.tocElement&&this.tocElement.querySelectorAll(".page-toc-item").forEach((t,r)=>{t.classList.toggle("active",r===e)})}scrollToSection(e){let t=this.sections[e];t&&(t.element.scrollIntoView({behavior:"smooth",block:"start"}),history.pushState(null,"",`#${t.id}`))}};function Yt(){if(window.LIVEMDTOOLS_DISABLE_AUTO_INIT){console.log("[Tinkerdown] Auto-initialization disabled");return}let e=document.querySelector('meta[name="tinkerdown-ws-url"]')?.content||`ws://${window.location.host}/ws`,r=document.querySelector('meta[name="tinkerdown-debug"]')?.content==="true";He()&&(console.log("[Tinkerdown] Preloading Monaco Editor for WASM blocks..."),Oe());let n=new oe({wsUrl:e,debug:r,persistence:!0,onConnect:()=>console.log("[Tinkerdown] Connected"),onDisconnect:()=>console.log("[Tinkerdown] Disconnected"),onError:d=>console.error("[Tinkerdown] Error:",d)});n.discoverBlocks(),n.getBlockIds().some(d=>{let u=n.getBlock(d);return u?.type==="interactive"||u?.type==="lvt"})&&n.connect(),window.tinkerdownClient=n;let a=new Ne;window.tinkerdownNavigation=a;let i=new Fe;window.tinkerdownPageTOC=i;let l=new Be;window.tinkerdownSearch=l;let c=new Pe;window.tinkerdownCodeCopy=c,console.log(`[Tinkerdown] Initialized with ${n.getBlockIds().length} blocks`)}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Yt):Yt());return or(Yr);})();
//# sourceMappingURL=tinkerdown-client.browser.js.map
